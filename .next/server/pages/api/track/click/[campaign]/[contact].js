"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/track/click/[campaign]/[contact]";
exports.ids = ["pages/api/track/click/[campaign]/[contact]"];
exports.modules = {

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftrack%2Fclick%2F%5Bcampaign%5D%2F%5Bcontact%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctrack%5Cclick%5C%5Bcampaign%5D%5C%5Bcontact%5D.ts&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftrack%2Fclick%2F%5Bcampaign%5D%2F%5Bcontact%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctrack%5Cclick%5C%5Bcampaign%5D%5C%5Bcontact%5D.ts&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_track_click_campaign_contact_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\track\\click\\[campaign]\\[contact].ts */ \"(api)/./pages/api/track/click/[campaign]/[contact].ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_track_click_campaign_contact_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_track_click_campaign_contact_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/track/click/[campaign]/[contact]\",\n        pathname: \"/api/track/click/[campaign]/[contact]\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_track_click_campaign_contact_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnRyYWNrJTJGY2xpY2slMkYlNUJjYW1wYWlnbiU1RCUyRiU1QmNvbnRhY3QlNUQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q3RyYWNrJTVDY2xpY2slNUMlNUJjYW1wYWlnbiU1RCU1QyU1QmNvbnRhY3QlNUQudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDaUY7QUFDakY7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHVFQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx1RUFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLz8yNTEyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcdHJhY2tcXFxcY2xpY2tcXFxcW2NhbXBhaWduXVxcXFxbY29udGFjdF0udHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS90cmFjay9jbGljay9bY2FtcGFpZ25dL1tjb250YWN0XVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3RyYWNrL2NsaWNrL1tjYW1wYWlnbl0vW2NvbnRhY3RdXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftrack%2Fclick%2F%5Bcampaign%5D%2F%5Bcontact%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctrack%5Cclick%5C%5Bcampaign%5D%5C%5Bcontact%5D.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/mongo.ts":
/*!**********************!*\
  !*** ./lib/mongo.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n// lib/mongo.ts\n\nconst uri = process.env.MONGODB_URI;\nif (!uri) throw new Error(\"MONGODB_URI not set\");\nlet client;\nlet clientPromise;\n// Retry logic in case MongoDB connection fails\nasync function connectWithRetry() {\n    const MAX_RETRIES = 5;\n    let attempts = 0;\n    let lastError = null;\n    while(attempts < MAX_RETRIES){\n        try {\n            const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, {\n                maxPoolSize: 10,\n                serverSelectionTimeoutMS: 10000,\n                socketTimeoutMS: 45000\n            });\n            await client.connect();\n            return client;\n        } catch (err) {\n            lastError = err;\n            attempts++;\n            console.error(`MongoDB connection failed (attempt ${attempts}/${MAX_RETRIES}):`, err);\n            if (attempts < MAX_RETRIES) {\n                await new Promise((resolve)=>setTimeout(resolve, 5000)); // wait for 5 seconds before retrying\n            }\n        }\n    }\n    // After max retries, throw the last error encountered\n    throw lastError || new Error(\"MongoDB connection failed after maximum retry attempts\");\n}\nif (!global._mongoClientPromise) {\n    global._mongoClientPromise = connectWithRetry();\n    // Optional: log connection events\n    global._mongoClientPromise.then((client)=>{\n        client.on(\"serverOpening\", (event)=>console.log(\"MongoDB server opening\", event));\n        client.on(\"serverClosed\", (event)=>console.warn(\"MongoDB server closed\", event));\n        client.on(\"topologyClosed\", ()=>console.warn(\"MongoDB topology closed\"));\n        client.on(\"topologyOpening\", ()=>console.log(\"MongoDB topology opening\"));\n        client.on(\"error\", (err)=>console.error(\"MongoDB error\", err));\n    }).catch((err)=>{\n        console.error(\"MongoDB client failed to connect after retries\", err);\n    });\n}\nclientPromise = global._mongoClientPromise;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvbW9uZ28udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZUFBZTtBQUN1QjtBQUV0QyxNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFdBQVc7QUFDbkMsSUFBSSxDQUFDSCxLQUFLLE1BQU0sSUFBSUksTUFBTTtBQUUxQixJQUFJQztBQUNKLElBQUlDO0FBT0osK0NBQStDO0FBQy9DLGVBQWVDO0lBQ2IsTUFBTUMsY0FBYztJQUNwQixJQUFJQyxXQUFXO0lBQ2YsSUFBSUMsWUFBMEI7SUFFOUIsTUFBT0QsV0FBV0QsWUFBYTtRQUM3QixJQUFJO1lBQ0YsTUFBTUgsU0FBUyxJQUFJTixnREFBV0EsQ0FBQ0MsS0FBSztnQkFDbENXLGFBQWE7Z0JBQ2JDLDBCQUEwQjtnQkFDMUJDLGlCQUFpQjtZQUNuQjtZQUNBLE1BQU1SLE9BQU9TLE9BQU87WUFDcEIsT0FBT1Q7UUFDVCxFQUFFLE9BQU9VLEtBQVU7WUFDakJMLFlBQVlLO1lBQ1pOO1lBQ0FPLFFBQVFDLEtBQUssQ0FBQyxDQUFDLG1DQUFtQyxFQUFFUixTQUFTLENBQUMsRUFBRUQsWUFBWSxFQUFFLENBQUMsRUFBRU87WUFDakYsSUFBSU4sV0FBV0QsYUFBYTtnQkFDMUIsTUFBTSxJQUFJVSxRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTLFFBQVEscUNBQXFDO1lBQ2hHO1FBQ0Y7SUFDRjtJQUVBLHNEQUFzRDtJQUN0RCxNQUFNVCxhQUFhLElBQUlOLE1BQU07QUFDL0I7QUFFQSxJQUFJLENBQUNpQixPQUFPQyxtQkFBbUIsRUFBRTtJQUMvQkQsT0FBT0MsbUJBQW1CLEdBQUdmO0lBRTdCLGtDQUFrQztJQUNsQ2MsT0FBT0MsbUJBQW1CLENBQ3ZCQyxJQUFJLENBQUNsQixDQUFBQTtRQUNKQSxPQUFPbUIsRUFBRSxDQUFDLGlCQUFpQixDQUFDQyxRQUFVVCxRQUFRVSxHQUFHLENBQUMsMEJBQTBCRDtRQUM1RXBCLE9BQU9tQixFQUFFLENBQUMsZ0JBQWdCLENBQUNDLFFBQVVULFFBQVFXLElBQUksQ0FBQyx5QkFBeUJGO1FBQzNFcEIsT0FBT21CLEVBQUUsQ0FBQyxrQkFBa0IsSUFBTVIsUUFBUVcsSUFBSSxDQUFDO1FBQy9DdEIsT0FBT21CLEVBQUUsQ0FBQyxtQkFBbUIsSUFBTVIsUUFBUVUsR0FBRyxDQUFDO1FBQy9DckIsT0FBT21CLEVBQUUsQ0FBQyxTQUFTLENBQUNULE1BQVFDLFFBQVFDLEtBQUssQ0FBQyxpQkFBaUJGO0lBQzdELEdBQ0NhLEtBQUssQ0FBQ2IsQ0FBQUE7UUFDTEMsUUFBUUMsS0FBSyxDQUFDLGtEQUFrREY7SUFDbEU7QUFDSjtBQUVBVCxnQkFBZ0JlLE9BQU9DLG1CQUFtQjtBQUUxQyxpRUFBZWhCLGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vbGliL21vbmdvLnRzPzU3ZmUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21vbmdvLnRzXHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuaWYgKCF1cmkpIHRocm93IG5ldyBFcnJvcignTU9OR09EQl9VUkkgbm90IHNldCcpO1xyXG5cclxubGV0IGNsaWVudDogTW9uZ29DbGllbnQ7XHJcbmxldCBjbGllbnRQcm9taXNlOiBQcm9taXNlPE1vbmdvQ2xpZW50PjtcclxuXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXHJcbiAgdmFyIF9tb25nb0NsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+IHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG4vLyBSZXRyeSBsb2dpYyBpbiBjYXNlIE1vbmdvREIgY29ubmVjdGlvbiBmYWlsc1xyXG5hc3luYyBmdW5jdGlvbiBjb25uZWN0V2l0aFJldHJ5KCk6IFByb21pc2U8TW9uZ29DbGllbnQ+IHtcclxuICBjb25zdCBNQVhfUkVUUklFUyA9IDU7XHJcbiAgbGV0IGF0dGVtcHRzID0gMDtcclxuICBsZXQgbGFzdEVycm9yOiBFcnJvciB8IG51bGwgPSBudWxsO1xyXG5cclxuICB3aGlsZSAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwge1xyXG4gICAgICAgIG1heFBvb2xTaXplOiAxMCxcclxuICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDEwMDAwLFxyXG4gICAgICAgIHNvY2tldFRpbWVvdXRNUzogNDUwMDAsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgICByZXR1cm4gY2xpZW50O1xyXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgbGFzdEVycm9yID0gZXJyO1xyXG4gICAgICBhdHRlbXB0cysrO1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBNb25nb0RCIGNvbm5lY3Rpb24gZmFpbGVkIChhdHRlbXB0ICR7YXR0ZW1wdHN9LyR7TUFYX1JFVFJJRVN9KTpgLCBlcnIpO1xyXG4gICAgICBpZiAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDAwKSk7IC8vIHdhaXQgZm9yIDUgc2Vjb25kcyBiZWZvcmUgcmV0cnlpbmdcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQWZ0ZXIgbWF4IHJldHJpZXMsIHRocm93IHRoZSBsYXN0IGVycm9yIGVuY291bnRlcmVkXHJcbiAgdGhyb3cgbGFzdEVycm9yIHx8IG5ldyBFcnJvcignTW9uZ29EQiBjb25uZWN0aW9uIGZhaWxlZCBhZnRlciBtYXhpbXVtIHJldHJ5IGF0dGVtcHRzJyk7XHJcbn1cclxuXHJcbmlmICghZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UpIHtcclxuICBnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZSA9IGNvbm5lY3RXaXRoUmV0cnkoKTtcclxuICBcclxuICAvLyBPcHRpb25hbDogbG9nIGNvbm5lY3Rpb24gZXZlbnRzXHJcbiAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2VcclxuICAgIC50aGVuKGNsaWVudCA9PiB7XHJcbiAgICAgIGNsaWVudC5vbignc2VydmVyT3BlbmluZycsIChldmVudCkgPT4gY29uc29sZS5sb2coJ01vbmdvREIgc2VydmVyIG9wZW5pbmcnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3NlcnZlckNsb3NlZCcsIChldmVudCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHNlcnZlciBjbG9zZWQnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3RvcG9sb2d5Q2xvc2VkJywgKCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHRvcG9sb2d5IGNsb3NlZCcpKTtcclxuICAgICAgY2xpZW50Lm9uKCd0b3BvbG9neU9wZW5pbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnTW9uZ29EQiB0b3BvbG9neSBvcGVuaW5nJykpO1xyXG4gICAgICBjbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4gY29uc29sZS5lcnJvcignTW9uZ29EQiBlcnJvcicsIGVycikpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIGNsaWVudCBmYWlsZWQgdG8gY29ubmVjdCBhZnRlciByZXRyaWVzJywgZXJyKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jbGllbnRQcm9taXNlID0gZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2U7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnRQcm9taXNlOyJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwiY2xpZW50IiwiY2xpZW50UHJvbWlzZSIsImNvbm5lY3RXaXRoUmV0cnkiLCJNQVhfUkVUUklFUyIsImF0dGVtcHRzIiwibGFzdEVycm9yIiwibWF4UG9vbFNpemUiLCJzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMiLCJzb2NrZXRUaW1lb3V0TVMiLCJjb25uZWN0IiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZ2xvYmFsIiwiX21vbmdvQ2xpZW50UHJvbWlzZSIsInRoZW4iLCJvbiIsImV2ZW50IiwibG9nIiwid2FybiIsImNhdGNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/mongo.ts\n");

/***/ }),

/***/ "(api)/./lib/redis.ts":
/*!**********************!*\
  !*** ./lib/redis.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   redis: () => (/* binding */ redis),\n/* harmony export */   subscribe: () => (/* binding */ subscribe),\n/* harmony export */   subscribeToChannels: () => (/* binding */ subscribeToChannels)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n// lib/redis.ts\n\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(process.env.REDIS_URL || \"redis://127.0.0.1:6379\", {\n    maxRetriesPerRequest: null,\n    lazyConnect: true,\n    reconnectOnError: (err)=>{\n        const targetErrors = [\n            \"READONLY\",\n            \"ECONNRESET\",\n            \"ETIMEDOUT\"\n        ];\n        try {\n            if (err && typeof err.message === \"string\") {\n                return targetErrors.some((e)=>err.message.includes(e));\n            }\n        } catch  {\n        // fall through\n        }\n        return false;\n    }\n});\nredis.on(\"connect\", ()=>console.log(\"Redis connected\"));\nredis.on(\"ready\", ()=>console.log(\"Redis ready\"));\nredis.on(\"error\", (err)=>console.error(\"Redis error\", err));\nredis.on(\"close\", ()=>console.warn(\"Redis connection closed\"));\nredis.on(\"reconnecting\", ()=>console.log(\"Redis reconnecting\"));\n/**\r\n * Subscribe to a single Redis channel (ioredis-style).\r\n * Returns an async unsubscribe function.\r\n */ async function subscribe(channel, handler) {\n    const sub = redis.duplicate();\n    const onMessage = (msgChannel, message)=>{\n        if (msgChannel !== channel) return;\n        try {\n            handler(JSON.parse(message));\n        } catch  {\n            handler(message);\n        }\n    };\n    sub.on(\"error\", (err)=>{\n        console.error(`Redis subscriber error for channel ${channel}`, err);\n    });\n    sub.on(\"message\", onMessage);\n    try {\n        // connect only if not already connecting/ready\n        try {\n            if (typeof sub.connect === \"function\") {\n                const status = sub.status;\n                if (status !== \"ready\" && status !== \"connecting\") {\n                    await sub.connect().catch((err)=>{\n                        console.warn(\"Subscriber connect error (continuing):\", err);\n                    });\n                } else {\n                // already connecting/ready â€” skip connect\n                }\n            }\n        } catch (e) {\n            console.warn(\"Subscriber connect guard error\", e);\n        }\n        await sub.subscribe(channel).catch((err)=>{\n            console.warn(`subscribe(${channel}) failed`, err);\n        });\n    } catch (err) {\n        console.error(`Failed to subscribe to Redis channel ${channel}`, err);\n    }\n    return async ()=>{\n        try {\n            sub.off(\"message\", onMessage);\n            try {\n                await sub.unsubscribe(channel);\n            } catch (e) {}\n            try {\n                await sub.quit();\n            } catch (e) {}\n        } catch (err) {\n            console.warn(`Failed to cleanly unsubscribe from Redis channel ${channel}`, err);\n        }\n    };\n}\n/**\r\n * Robust multi-channel subscription helper.\r\n */ async function subscribeToChannels(sub, channels, handler) {\n    if (!sub || !channels || channels.length === 0) return;\n    // ensure connection if possible (guard against duplicate connect calls)\n    try {\n        if (typeof sub.connect === \"function\") {\n            const status = sub.status;\n            if (status !== \"ready\" && status !== \"connecting\") {\n                await sub.connect().catch((err)=>{\n                    console.warn(\"subscribeToChannels: subscriber connect warning\", err);\n                });\n            } else {\n            // already connecting/ready, skip connect\n            }\n        }\n    } catch (e) {\n    // ignore connect errors\n    }\n    for (const ch of channels){\n        try {\n            if (typeof sub.subscribe === \"function\") {\n                await sub.subscribe(ch).catch((err)=>{\n                    console.warn(`subscribeToChannels: subscribe(${ch}) failed`, err);\n                });\n            } else {\n                await sub.subscribe(ch);\n            }\n        } catch (e) {\n            console.warn(`subscribe failed for channel ${ch}, will attempt fallback`, e);\n        }\n    }\n    // Attach 'message' listener\n    try {\n        if (typeof sub.on === \"function\") {\n            const onMsg = (a, b)=>{\n                if (typeof a === \"string\" && typeof b === \"string\") {\n                    handler(a, b);\n                } else if (typeof b === \"string\" && channels.includes(b)) {\n                    handler(b, a);\n                } else {\n                    handler(String(a), String(b));\n                }\n            };\n            sub.__subscribe_to_channels_on_message = onMsg;\n            sub.on(\"message\", onMsg);\n        }\n    } catch (e) {\n        console.warn(\"Fallback Redis message hook failed\", e);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJLE9BQU9BLE1BQU0sWUFBWUwsU0FBU3RCLFFBQVEsQ0FBQzJCLElBQUk7b0JBQ3hEbkIsUUFBUW1CLEdBQUdEO2dCQUNiLE9BQU87b0JBQ0xsQixRQUFRb0IsT0FBT0YsSUFBSUUsT0FBT0Q7Z0JBQzVCO1lBQ0Y7WUFDQ2xCLElBQVlvQixrQ0FBa0MsR0FBR0o7WUFDbERoQixJQUFJUixFQUFFLENBQUMsV0FBV3dCO1FBQ3BCO0lBQ0YsRUFBRSxPQUFPMUIsR0FBRztRQUNWRyxRQUFRRyxJQUFJLENBQUMsc0NBQXNDTjtJQUNyRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFya2V0aW5nLW12cC8uL2xpYi9yZWRpcy50cz81MWU5Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9yZWRpcy50c1xyXG5pbXBvcnQgSU9SZWRpcyBmcm9tICdpb3JlZGlzJztcclxuXHJcbmV4cG9ydCBjb25zdCByZWRpcyA9IG5ldyBJT1JlZGlzKHByb2Nlc3MuZW52LlJFRElTX1VSTCB8fCAncmVkaXM6Ly8xMjcuMC4wLjE6NjM3OScsIHtcclxuICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogbnVsbCxcclxuICBsYXp5Q29ubmVjdDogdHJ1ZSxcclxuICByZWNvbm5lY3RPbkVycm9yOiAoZXJyOiBhbnkpID0+IHtcclxuICAgIGNvbnN0IHRhcmdldEVycm9ycyA9IFsnUkVBRE9OTFknLCAnRUNPTk5SRVNFVCcsICdFVElNRURPVVQnXTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChlcnIgJiYgdHlwZW9mIGVyci5tZXNzYWdlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHJldHVybiB0YXJnZXRFcnJvcnMuc29tZShlID0+IGVyci5tZXNzYWdlLmluY2x1ZGVzKGUpKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCB7XHJcbiAgICAgIC8vIGZhbGwgdGhyb3VnaFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH0sXHJcbn0pO1xyXG5cclxucmVkaXMub24oJ2Nvbm5lY3QnLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgY29ubmVjdGVkJykpO1xyXG5yZWRpcy5vbigncmVhZHknLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgcmVhZHknKSk7XHJcbnJlZGlzLm9uKCdlcnJvcicsIChlcnIpID0+IGNvbnNvbGUuZXJyb3IoJ1JlZGlzIGVycm9yJywgZXJyKSk7XHJcbnJlZGlzLm9uKCdjbG9zZScsICgpID0+IGNvbnNvbGUud2FybignUmVkaXMgY29ubmVjdGlvbiBjbG9zZWQnKSk7XHJcbnJlZGlzLm9uKCdyZWNvbm5lY3RpbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgcmVjb25uZWN0aW5nJykpO1xyXG5cclxuLyoqXHJcbiAqIFN1YnNjcmliZSB0byBhIHNpbmdsZSBSZWRpcyBjaGFubmVsIChpb3JlZGlzLXN0eWxlKS5cclxuICogUmV0dXJucyBhbiBhc3luYyB1bnN1YnNjcmliZSBmdW5jdGlvbi5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdWJzY3JpYmUoY2hhbm5lbDogc3RyaW5nLCBoYW5kbGVyOiAoZGF0YTogYW55KSA9PiB2b2lkKTogUHJvbWlzZTwoKSA9PiBQcm9taXNlPHZvaWQ+PiB7XHJcbiAgY29uc3Qgc3ViID0gcmVkaXMuZHVwbGljYXRlKCk7XHJcblxyXG4gIGNvbnN0IG9uTWVzc2FnZSA9IChtc2dDaGFubmVsOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykgPT4ge1xyXG4gICAgaWYgKG1zZ0NoYW5uZWwgIT09IGNoYW5uZWwpIHJldHVybjtcclxuICAgIHRyeSB7XHJcbiAgICAgIGhhbmRsZXIoSlNPTi5wYXJzZShtZXNzYWdlKSk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgaGFuZGxlcihtZXNzYWdlKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBzdWIub24oJ2Vycm9yJywgKGVycjogYW55KSA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKGBSZWRpcyBzdWJzY3JpYmVyIGVycm9yIGZvciBjaGFubmVsICR7Y2hhbm5lbH1gLCBlcnIpO1xyXG4gIH0pO1xyXG5cclxuICBzdWIub24oJ21lc3NhZ2UnLCBvbk1lc3NhZ2UpO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gY29ubmVjdCBvbmx5IGlmIG5vdCBhbHJlYWR5IGNvbm5lY3RpbmcvcmVhZHlcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh0eXBlb2YgKHN1YiBhcyBhbnkpLmNvbm5lY3QgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBjb25zdCBzdGF0dXMgPSAoc3ViIGFzIGFueSkuc3RhdHVzO1xyXG4gICAgICAgIGlmIChzdGF0dXMgIT09ICdyZWFkeScgJiYgc3RhdHVzICE9PSAnY29ubmVjdGluZycpIHtcclxuICAgICAgICAgIGF3YWl0IChzdWIgYXMgYW55KS5jb25uZWN0KCkuY2F0Y2goKGVycjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignU3Vic2NyaWJlciBjb25uZWN0IGVycm9yIChjb250aW51aW5nKTonLCBlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIGFscmVhZHkgY29ubmVjdGluZy9yZWFkeSDigJQgc2tpcCBjb25uZWN0XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignU3Vic2NyaWJlciBjb25uZWN0IGd1YXJkIGVycm9yJywgZSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgKHN1YiBhcyBhbnkpLnN1YnNjcmliZShjaGFubmVsKS5jYXRjaCgoZXJyOiBhbnkpID0+IHtcclxuICAgICAgY29uc29sZS53YXJuKGBzdWJzY3JpYmUoJHtjaGFubmVsfSkgZmFpbGVkYCwgZXJyKTtcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHN1YnNjcmliZSB0byBSZWRpcyBjaGFubmVsICR7Y2hhbm5lbH1gLCBlcnIpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGFzeW5jICgpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHN1Yi5vZmYoJ21lc3NhZ2UnLCBvbk1lc3NhZ2UpO1xyXG4gICAgICB0cnkgeyBhd2FpdCAoc3ViIGFzIGFueSkudW5zdWJzY3JpYmUoY2hhbm5lbCk7IH0gY2F0Y2ggKGUpIHt9XHJcbiAgICAgIHRyeSB7IGF3YWl0IChzdWIgYXMgYW55KS5xdWl0KCk7IH0gY2F0Y2ggKGUpIHt9XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gY2xlYW5seSB1bnN1YnNjcmliZSBmcm9tIFJlZGlzIGNoYW5uZWwgJHtjaGFubmVsfWAsIGVycik7XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJvYnVzdCBtdWx0aS1jaGFubmVsIHN1YnNjcmlwdGlvbiBoZWxwZXIuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3Vic2NyaWJlVG9DaGFubmVscyhcclxuICBzdWI6IGFueSxcclxuICBjaGFubmVsczogc3RyaW5nW10sXHJcbiAgaGFuZGxlcjogKGNoYW5uZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nKSA9PiB2b2lkXHJcbik6IFByb21pc2U8dm9pZD4ge1xyXG4gIGlmICghc3ViIHx8ICFjaGFubmVscyB8fCBjaGFubmVscy5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgLy8gZW5zdXJlIGNvbm5lY3Rpb24gaWYgcG9zc2libGUgKGd1YXJkIGFnYWluc3QgZHVwbGljYXRlIGNvbm5lY3QgY2FsbHMpXHJcbiAgdHJ5IHtcclxuICAgIGlmICh0eXBlb2Ygc3ViLmNvbm5lY3QgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgY29uc3Qgc3RhdHVzID0gKHN1YiBhcyBhbnkpLnN0YXR1cztcclxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ3JlYWR5JyAmJiBzdGF0dXMgIT09ICdjb25uZWN0aW5nJykge1xyXG4gICAgICAgIGF3YWl0IHN1Yi5jb25uZWN0KCkuY2F0Y2goKGVycjogYW55KSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ3N1YnNjcmliZVRvQ2hhbm5lbHM6IHN1YnNjcmliZXIgY29ubmVjdCB3YXJuaW5nJywgZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBhbHJlYWR5IGNvbm5lY3RpbmcvcmVhZHksIHNraXAgY29ubmVjdFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgLy8gaWdub3JlIGNvbm5lY3QgZXJyb3JzXHJcbiAgfVxyXG5cclxuICBmb3IgKGNvbnN0IGNoIG9mIGNoYW5uZWxzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAodHlwZW9mIHN1Yi5zdWJzY3JpYmUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBhd2FpdCBzdWIuc3Vic2NyaWJlKGNoKS5jYXRjaCgoZXJyOiBhbnkpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUud2Fybihgc3Vic2NyaWJlVG9DaGFubmVsczogc3Vic2NyaWJlKCR7Y2h9KSBmYWlsZWRgLCBlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGF3YWl0IChzdWIgYXMgYW55KS5zdWJzY3JpYmUoY2gpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2Fybihgc3Vic2NyaWJlIGZhaWxlZCBmb3IgY2hhbm5lbCAke2NofSwgd2lsbCBhdHRlbXB0IGZhbGxiYWNrYCwgZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBBdHRhY2ggJ21lc3NhZ2UnIGxpc3RlbmVyXHJcbiAgdHJ5IHtcclxuICAgIGlmICh0eXBlb2Ygc3ViLm9uID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNvbnN0IG9uTXNnID0gKGE6IGFueSwgYjogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBhID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgYiA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgIGhhbmRsZXIoYSwgYik7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYiA9PT0gJ3N0cmluZycgJiYgY2hhbm5lbHMuaW5jbHVkZXMoYikpIHtcclxuICAgICAgICAgIGhhbmRsZXIoYiwgYSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGhhbmRsZXIoU3RyaW5nKGEpLCBTdHJpbmcoYikpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgKHN1YiBhcyBhbnkpLl9fc3Vic2NyaWJlX3RvX2NoYW5uZWxzX29uX21lc3NhZ2UgPSBvbk1zZztcclxuICAgICAgc3ViLm9uKCdtZXNzYWdlJywgb25Nc2cpO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUud2FybignRmFsbGJhY2sgUmVkaXMgbWVzc2FnZSBob29rIGZhaWxlZCcsIGUpO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiSU9SZWRpcyIsInJlZGlzIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsIm1heFJldHJpZXNQZXJSZXF1ZXN0IiwibGF6eUNvbm5lY3QiLCJyZWNvbm5lY3RPbkVycm9yIiwiZXJyIiwidGFyZ2V0RXJyb3JzIiwibWVzc2FnZSIsInNvbWUiLCJlIiwiaW5jbHVkZXMiLCJvbiIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsIndhcm4iLCJzdWJzY3JpYmUiLCJjaGFubmVsIiwiaGFuZGxlciIsInN1YiIsImR1cGxpY2F0ZSIsIm9uTWVzc2FnZSIsIm1zZ0NoYW5uZWwiLCJKU09OIiwicGFyc2UiLCJjb25uZWN0Iiwic3RhdHVzIiwiY2F0Y2giLCJvZmYiLCJ1bnN1YnNjcmliZSIsInF1aXQiLCJzdWJzY3JpYmVUb0NoYW5uZWxzIiwiY2hhbm5lbHMiLCJsZW5ndGgiLCJjaCIsIm9uTXNnIiwiYSIsImIiLCJTdHJpbmciLCJfX3N1YnNjcmliZV90b19jaGFubmVsc19vbl9tZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/redis.ts\n");

/***/ }),

/***/ "(api)/./pages/api/track/click/[campaign]/[contact].ts":
/*!*******************************************************!*\
  !*** ./pages/api/track/click/[campaign]/[contact].ts ***!
  \*******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_mongo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../lib/mongo */ \"(api)/./lib/mongo.ts\");\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../../lib/redis */ \"(api)/./lib/redis.ts\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n// pages/api/track/click/[campaign]/[contact].ts\n\n\n\nfunction tryParseObjectId(maybeId) {\n    if (!maybeId) return null;\n    if (typeof maybeId === \"object\" && maybeId instanceof mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId) return maybeId;\n    if (typeof maybeId === \"string\" && /^[0-9a-fA-F]{24}$/.test(maybeId)) {\n        try {\n            return new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(maybeId);\n        } catch  {\n            return null;\n        }\n    }\n    return null;\n}\nfunction safeLog(...args) {\n    try {\n        console.log(...args);\n    } catch  {}\n}\n/**\r\n * Try multiple ways to decode the `u` parameter to the real destination URL.\r\n * We encoded with: encodeURIComponent(Buffer.from(url).toString('base64'))\r\n * But email clients / proxies may double-encode, rewrite, or pass the raw URL.\r\n *\r\n * Improvements:\r\n *  - accept URL-safe base64 (- and _), convert to standard base64\r\n *  - tolerate double-encoding and stray spaces/+\r\n *  - accept bare \"www.example.com\" by prepending \"http://\"\r\n */ function decodeDestination(uRaw) {\n    if (!uRaw) return null;\n    const u = Array.isArray(uRaw) ? uRaw[0] : uRaw;\n    // heuristic: if it already looks like an http(s) URL, return raw\n    if (/^https?:\\/\\//i.test(u)) return u;\n    // Try decodeURIComponent then base64\n    const attempts = [];\n    try {\n        attempts.push(decodeURIComponent(u));\n    } catch (e) {\n    // skip\n    }\n    attempts.push(u);\n    // Also unescape plus/space issues\n    attempts.push(u.replace(/\\s/g, \"\"));\n    attempts.push(u.replace(/\\+/g, \" \"));\n    attempts.push(u.replace(/\\s/g, \"+\"));\n    for (const a of attempts){\n        if (!a) continue;\n        try {\n            // Clean possible double-encoding (strip surrounding quotes)\n            const cleaned = String(a).trim().replace(/^\"+|\"+$/g, \"\").replace(/^'+|'+$/g, \"\");\n            // Normalize URL-safe base64 to standard\n            const normalized = cleaned.replace(/-/g, \"+\").replace(/_/g, \"/\");\n            // Padding (base64 requires padding)\n            const pad = normalized.length % 4;\n            const candidate = normalized + (pad === 0 ? \"\" : \"=\".repeat(4 - pad));\n            const buf = Buffer.from(candidate, \"base64\");\n            const str = buf.toString(\"utf8\").trim();\n            if (str && /^https?:\\/\\//i.test(str)) return str;\n            // also accept bare www (no scheme) from decoded string\n            if (str && /^www\\./i.test(str)) return `http://${str}`;\n        } catch (e) {\n        // try next\n        }\n    }\n    // Last-chance: maybe it's plain URL but percent-encoded differently or missing scheme\n    try {\n        const asDecoded = decodeURIComponent(String(u)).trim();\n        if (/^https?:\\/\\//i.test(asDecoded)) return asDecoded;\n        if (/^www\\./i.test(asDecoded)) return `http://${asDecoded}`;\n    } catch (e) {}\n    // Also if the raw value is a bare www host, accept it\n    try {\n        const rawClean = String(u).trim();\n        if (/^www\\./i.test(rawClean)) return `http://${rawClean}`;\n    } catch (e) {}\n    return null;\n}\nasync function handler(req, res) {\n    const { campaign, contact } = req.query;\n    const uRaw = req.query.u;\n    const trace = req.query.t || String(Date.now());\n    safeLog(\"[CLICK] incoming request\", {\n        url: req.url,\n        query: req.query,\n        headers: {\n            \"user-agent\": req.headers[\"user-agent\"],\n            referer: req.headers.referer || req.headers.referrer,\n            host: req.headers.host,\n            \"x-forwarded-for\": req.headers[\"x-forwarded-for\"]\n        }\n    });\n    try {\n        if (!campaign || !contact) {\n            safeLog(\"[CLICK] missing campaign/contact path params\");\n            return res.status(400).send(\"Missing params\");\n        }\n        const campaignIdStr = String(campaign);\n        const contactIdStr = String(contact);\n        const campaignIdObj = tryParseObjectId(campaignIdStr);\n        const contactIdObj = tryParseObjectId(contactIdStr);\n        const dest = decodeDestination(uRaw) ?? (()=>{\n            // fallback: maybe u contains a raw url despite no base64\n            const fallback = Array.isArray(uRaw) ? uRaw[0] : uRaw;\n            if (typeof fallback === \"string\") {\n                const f = fallback.trim();\n                if (/^https?:\\/\\//i.test(f)) return f;\n                if (/^www\\./i.test(f)) return `http://${f}`;\n            }\n            return null;\n        })();\n        if (!dest) {\n            safeLog(\"[CLICK] failed to decode destination\", {\n                uRaw\n            });\n            // Log an event so we can inspect\n            try {\n                const client = await _lib_mongo__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n                const db = client.db(\"PlatformData\");\n                await db.collection(\"campaign_events\").insertOne({\n                    campaignId: campaignIdObj ?? campaignIdStr,\n                    contactId: contactIdObj ?? contactIdStr,\n                    type: \"click\",\n                    url: null,\n                    note: \"decode_failed\",\n                    raw_u: uRaw,\n                    trace,\n                    createdAt: new Date()\n                });\n            } catch (e) {\n                safeLog(\"[CLICK] failed recording decode-failed event\", e);\n            }\n            return res.status(400).send(\"Invalid destination\");\n        }\n        // Persist event + update ledger + redis + publish\n        const client = await _lib_mongo__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n        const db = client.db(\"PlatformData\");\n        const ua = req.headers[\"user-agent\"] || \"\";\n        const ip = req.headers[\"x-forwarded-for\"]?.split(\",\")[0] || req.socket.remoteAddress || null;\n        const now = new Date();\n        // --- BACKFILL OPEN if missing (click implies open) ---\n        try {\n            // Check ledger for openedAt directly (more efficient than scanning events)\n            let ledgerRowForOpen = null;\n            if (campaignIdObj && contactIdObj) {\n                ledgerRowForOpen = await db.collection(\"campaign_contacts\").findOne({\n                    campaignId: campaignIdObj,\n                    contactId: contactIdObj\n                }, {\n                    projection: {\n                        openedAt: 1\n                    }\n                });\n            }\n            if (!ledgerRowForOpen && campaignIdObj) {\n                ledgerRowForOpen = await db.collection(\"campaign_contacts\").findOne({\n                    campaignId: campaignIdObj,\n                    contactId: contactIdStr\n                }, {\n                    projection: {\n                        openedAt: 1\n                    }\n                });\n            }\n            if (!ledgerRowForOpen) {\n                ledgerRowForOpen = await db.collection(\"campaign_contacts\").findOne({\n                    campaignId: campaignIdStr,\n                    contactId: contactIdStr\n                }, {\n                    projection: {\n                        openedAt: 1\n                    }\n                });\n            }\n            const alreadyOpened = !!(ledgerRowForOpen && ledgerRowForOpen.openedAt);\n            if (!alreadyOpened) {\n                // Insert \"open\" event (best-effort)\n                try {\n                    const evOpen = {\n                        campaignId: campaignIdObj ?? campaignIdStr,\n                        contactId: contactIdObj ?? contactIdStr,\n                        type: \"open\",\n                        ua,\n                        ip,\n                        createdAt: now,\n                        trace,\n                        via: \"click-backfill\"\n                    };\n                    const rOpen = await db.collection(\"campaign_events\").insertOne(evOpen);\n                    safeLog(\"[CLICK] backfilled open ->\", rOpen.insertedId?.toString?.());\n                    // Update campaign_contacts: set openedAt and bump lastActivityAt (use $max)\n                    try {\n                        const updateDoc = {\n                            $set: {\n                                openedAt: now\n                            },\n                            $max: {\n                                lastActivityAt: now\n                            }\n                        };\n                        let resUpdate = null;\n                        if (campaignIdObj && contactIdObj) {\n                            resUpdate = await db.collection(\"campaign_contacts\").updateOne({\n                                campaignId: campaignIdObj,\n                                contactId: contactIdObj\n                            }, updateDoc);\n                        }\n                        if ((!resUpdate || (resUpdate.matchedCount ?? 0) === 0) && campaignIdObj) {\n                            resUpdate = await db.collection(\"campaign_contacts\").updateOne({\n                                campaignId: campaignIdObj,\n                                contactId: contactIdStr\n                            }, updateDoc);\n                        }\n                        if (!resUpdate || (resUpdate.matchedCount ?? 0) === 0) {\n                            resUpdate = await db.collection(\"campaign_contacts\").updateOne({\n                                campaignId: campaignIdStr,\n                                contactId: contactIdStr\n                            }, updateDoc);\n                        }\n                        if (!resUpdate || (resUpdate.matchedCount ?? 0) === 0) {\n                            safeLog(\"[CLICK] open backfill: campaign_contacts no match for\", {\n                                campaignIdStr,\n                                contactIdStr\n                            });\n                        }\n                    } catch (e) {\n                        safeLog(\"[CLICK] open backfill: campaign_contacts update failed\", e);\n                    }\n                    // Redis counters & publish open event for UI\n                    try {\n                        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hincrby(`campaign:${campaignIdStr}:metrics`, \"opens\", 1);\n                        const payloadOpen = {\n                            campaignId: campaignIdStr,\n                            contactId: contactIdStr,\n                            event: \"open\",\n                            openedAt: now.toISOString(),\n                            trace,\n                            ts: now.toISOString(),\n                            via: \"click-backfill\"\n                        };\n                        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.publish(`campaign:${campaignIdStr}:contact_update`, JSON.stringify(payloadOpen));\n                        safeLog(\"[CLICK] published backfill open contact_update\", payloadOpen);\n                    } catch (e) {\n                        safeLog(\"[CLICK] open backfill: redis publish failed\", e);\n                    }\n                } catch (e) {\n                    safeLog(\"[CLICK] failed to insert backfill open event\", e);\n                }\n            }\n        } catch (e) {\n            safeLog(\"[CLICK] open backfill check failed\", e);\n        // continue anyway\n        }\n        // --- Insert click event ---\n        try {\n            const ev = {\n                campaignId: campaignIdObj ?? campaignIdStr,\n                contactId: contactIdObj ?? contactIdStr,\n                type: \"click\",\n                url: dest,\n                ua,\n                ip,\n                createdAt: now,\n                trace\n            };\n            const r = await db.collection(\"campaign_events\").insertOne(ev);\n            safeLog(\"[CLICK] campaign_events.insertOne ->\", r.insertedId?.toString?.());\n        } catch (e) {\n            safeLog(\"[CLICK] failed inserting campaign_events\", e);\n        }\n        // Update campaign_contacts: lastClickAt and lastActivityAt (use $max)\n        try {\n            const updateDoc = {\n                $set: {\n                    lastClickAt: now\n                },\n                $max: {\n                    lastActivityAt: now\n                }\n            };\n            let resUpdate = null;\n            if (campaignIdObj && contactIdObj) {\n                resUpdate = await db.collection(\"campaign_contacts\").updateOne({\n                    campaignId: campaignIdObj,\n                    contactId: contactIdObj\n                }, updateDoc);\n            }\n            if ((!resUpdate || (resUpdate.matchedCount ?? 0) === 0) && campaignIdObj) {\n                resUpdate = await db.collection(\"campaign_contacts\").updateOne({\n                    campaignId: campaignIdObj,\n                    contactId: contactIdStr\n                }, updateDoc);\n            }\n            if (!resUpdate || (resUpdate.matchedCount ?? 0) === 0) {\n                resUpdate = await db.collection(\"campaign_contacts\").updateOne({\n                    campaignId: campaignIdStr,\n                    contactId: contactIdStr\n                }, updateDoc);\n            }\n            if (!resUpdate || (resUpdate.matchedCount ?? 0) === 0) {\n                safeLog(\"[CLICK] campaign_contacts no match for\", {\n                    campaignIdStr,\n                    contactIdStr\n                });\n            }\n        } catch (e) {\n            safeLog(\"[CLICK] campaign_contacts update failed\", e);\n        }\n        // Redis counters and publish click update\n        try {\n            await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hincrby(`campaign:${campaignIdStr}:metrics`, \"clicks\", 1);\n            const payload = {\n                campaignId: campaignIdStr,\n                contactId: contactIdStr,\n                event: \"click\",\n                url: dest,\n                trace,\n                ts: now.toISOString()\n            };\n            await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.publish(`campaign:${campaignIdStr}:contact_update`, JSON.stringify(payload));\n            safeLog(\"[CLICK] published contact_update\", payload);\n        } catch (e) {\n            safeLog(\"[CLICK] redis publish failed\", e);\n        }\n        // Redirect to dest\n        res.setHeader(\"Cache-Control\", \"no-cache, no-store, must-revalidate, max-age=0, s-maxage=0\");\n        res.setHeader(\"Pragma\", \"no-cache\");\n        res.setHeader(\"Expires\", \"0\");\n        return res.redirect(302, dest);\n    } catch (err) {\n        safeLog(\"[CLICK] unexpected error\", err);\n        return res.status(500).send(\"error\");\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvdHJhY2svY2xpY2svW2NhbXBhaWduXS9bY29udGFjdF0udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxnREFBZ0Q7QUFFSztBQUNKO0FBQ2Q7QUFFbkMsU0FBU0csaUJBQWlCQyxPQUFZO0lBQ3BDLElBQUksQ0FBQ0EsU0FBUyxPQUFPO0lBQ3JCLElBQUksT0FBT0EsWUFBWSxZQUFZQSxtQkFBbUJGLDZDQUFRQSxFQUFFLE9BQU9FO0lBQ3ZFLElBQUksT0FBT0EsWUFBWSxZQUFZLG9CQUFvQkMsSUFBSSxDQUFDRCxVQUFVO1FBQ3BFLElBQUk7WUFBRSxPQUFPLElBQUlGLDZDQUFRQSxDQUFDRTtRQUFVLEVBQUUsT0FBTTtZQUFFLE9BQU87UUFBTTtJQUM3RDtJQUNBLE9BQU87QUFDVDtBQUVBLFNBQVNFLFFBQVEsR0FBR0MsSUFBVztJQUM3QixJQUFJO1FBQUVDLFFBQVFDLEdBQUcsSUFBSUY7SUFBTyxFQUFFLE9BQU0sQ0FBQztBQUN2QztBQUVBOzs7Ozs7Ozs7Q0FTQyxHQUNELFNBQVNHLGtCQUFrQkMsSUFBb0M7SUFDN0QsSUFBSSxDQUFDQSxNQUFNLE9BQU87SUFDbEIsTUFBTUMsSUFBSUMsTUFBTUMsT0FBTyxDQUFDSCxRQUFRQSxJQUFJLENBQUMsRUFBRSxHQUFHQTtJQUUxQyxpRUFBaUU7SUFDakUsSUFBSSxnQkFBZ0JOLElBQUksQ0FBQ08sSUFBSSxPQUFPQTtJQUVwQyxxQ0FBcUM7SUFDckMsTUFBTUcsV0FBcUIsRUFBRTtJQUU3QixJQUFJO1FBQ0ZBLFNBQVNDLElBQUksQ0FBQ0MsbUJBQW1CTDtJQUNuQyxFQUFFLE9BQU9NLEdBQUc7SUFDVixPQUFPO0lBQ1Q7SUFDQUgsU0FBU0MsSUFBSSxDQUFDSjtJQUVkLGtDQUFrQztJQUNsQ0csU0FBU0MsSUFBSSxDQUFDSixFQUFFTyxPQUFPLENBQUMsT0FBTztJQUMvQkosU0FBU0MsSUFBSSxDQUFDSixFQUFFTyxPQUFPLENBQUMsT0FBTztJQUMvQkosU0FBU0MsSUFB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Q0FBQyxXQUFXO1FBQ3pCLE9BQU9qRSxJQUFJa0UsUUFBUSxDQUFDLEtBQUsvQztJQUMzQixFQUFFLE9BQU9nRCxLQUFLO1FBQ1puRyxRQUFRLDRCQUE0Qm1HO1FBQ3BDLE9BQU9uRSxJQUFJYSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO0lBQzlCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vcGFnZXMvYXBpL3RyYWNrL2NsaWNrL1tjYW1wYWlnbl0vW2NvbnRhY3RdLnRzP2Y0YjQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvYXBpL3RyYWNrL2NsaWNrL1tjYW1wYWlnbl0vW2NvbnRhY3RdLnRzXHJcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgY2xpZW50UHJvbWlzZSBmcm9tICcuLi8uLi8uLi8uLi8uLi9saWIvbW9uZ28nO1xyXG5pbXBvcnQgeyByZWRpcyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2xpYi9yZWRpcyc7XHJcbmltcG9ydCB7IE9iamVjdElkIH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5mdW5jdGlvbiB0cnlQYXJzZU9iamVjdElkKG1heWJlSWQ6IGFueSkge1xyXG4gIGlmICghbWF5YmVJZCkgcmV0dXJuIG51bGw7XHJcbiAgaWYgKHR5cGVvZiBtYXliZUlkID09PSAnb2JqZWN0JyAmJiBtYXliZUlkIGluc3RhbmNlb2YgT2JqZWN0SWQpIHJldHVybiBtYXliZUlkO1xyXG4gIGlmICh0eXBlb2YgbWF5YmVJZCA9PT0gJ3N0cmluZycgJiYgL15bMC05YS1mQS1GXXsyNH0kLy50ZXN0KG1heWJlSWQpKSB7XHJcbiAgICB0cnkgeyByZXR1cm4gbmV3IE9iamVjdElkKG1heWJlSWQpOyB9IGNhdGNoIHsgcmV0dXJuIG51bGw7IH1cclxuICB9XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNhZmVMb2coLi4uYXJnczogYW55W10pIHtcclxuICB0cnkgeyBjb25zb2xlLmxvZyguLi5hcmdzKTsgfSBjYXRjaCB7fVxyXG59XHJcblxyXG4vKipcclxuICogVHJ5IG11bHRpcGxlIHdheXMgdG8gZGVjb2RlIHRoZSBgdWAgcGFyYW1ldGVyIHRvIHRoZSByZWFsIGRlc3RpbmF0aW9uIFVSTC5cclxuICogV2UgZW5jb2RlZCB3aXRoOiBlbmNvZGVVUklDb21wb25lbnQoQnVmZmVyLmZyb20odXJsKS50b1N0cmluZygnYmFzZTY0JykpXHJcbiAqIEJ1dCBlbWFpbCBjbGllbnRzIC8gcHJveGllcyBtYXkgZG91YmxlLWVuY29kZSwgcmV3cml0ZSwgb3IgcGFzcyB0aGUgcmF3IFVSTC5cclxuICpcclxuICogSW1wcm92ZW1lbnRzOlxyXG4gKiAgLSBhY2NlcHQgVVJMLXNhZmUgYmFzZTY0ICgtIGFuZCBfKSwgY29udmVydCB0byBzdGFuZGFyZCBiYXNlNjRcclxuICogIC0gdG9sZXJhdGUgZG91YmxlLWVuY29kaW5nIGFuZCBzdHJheSBzcGFjZXMvK1xyXG4gKiAgLSBhY2NlcHQgYmFyZSBcInd3dy5leGFtcGxlLmNvbVwiIGJ5IHByZXBlbmRpbmcgXCJodHRwOi8vXCJcclxuICovXHJcbmZ1bmN0aW9uIGRlY29kZURlc3RpbmF0aW9uKHVSYXc/OiBzdHJpbmcgfCBzdHJpbmdbXSB8IHVuZGVmaW5lZCk6IHN0cmluZyB8IG51bGwge1xyXG4gIGlmICghdVJhdykgcmV0dXJuIG51bGw7XHJcbiAgY29uc3QgdSA9IEFycmF5LmlzQXJyYXkodVJhdykgPyB1UmF3WzBdIDogdVJhdztcclxuXHJcbiAgLy8gaGV1cmlzdGljOiBpZiBpdCBhbHJlYWR5IGxvb2tzIGxpa2UgYW4gaHR0cChzKSBVUkwsIHJldHVybiByYXdcclxuICBpZiAoL15odHRwcz86XFwvXFwvL2kudGVzdCh1KSkgcmV0dXJuIHU7XHJcblxyXG4gIC8vIFRyeSBkZWNvZGVVUklDb21wb25lbnQgdGhlbiBiYXNlNjRcclxuICBjb25zdCBhdHRlbXB0czogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGF0dGVtcHRzLnB1c2goZGVjb2RlVVJJQ29tcG9uZW50KHUpKTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICAvLyBza2lwXHJcbiAgfVxyXG4gIGF0dGVtcHRzLnB1c2godSk7XHJcblxyXG4gIC8vIEFsc28gdW5lc2NhcGUgcGx1cy9zcGFjZSBpc3N1ZXNcclxuICBhdHRlbXB0cy5wdXNoKHUucmVwbGFjZSgvXFxzL2csICcnKSk7XHJcbiAgYXR0ZW1wdHMucHVzaCh1LnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcclxuICBhdHRlbXB0cy5wdXNoKHUucmVwbGFjZSgvXFxzL2csICcrJykpO1xyXG5cclxuICBmb3IgKGNvbnN0IGEgb2YgYXR0ZW1wdHMpIHtcclxuICAgIGlmICghYSkgY29udGludWU7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBDbGVhbiBwb3NzaWJsZSBkb3VibGUtZW5jb2RpbmcgKHN0cmlwIHN1cnJvdW5kaW5nIHF1b3RlcylcclxuICAgICAgY29uc3QgY2xlYW5lZCA9IFN0cmluZyhhKS50cmltKCkucmVwbGFjZSgvXlwiK3xcIiskL2csICcnKS5yZXBsYWNlKC9eJyt8JyskL2csICcnKTtcclxuICAgICAgLy8gTm9ybWFsaXplIFVSTC1zYWZlIGJhc2U2NCB0byBzdGFuZGFyZFxyXG4gICAgICBjb25zdCBub3JtYWxpemVkID0gY2xlYW5lZC5yZXBsYWNlKC8tL2csICcrJykucmVwbGFjZSgvXy9nLCAnLycpO1xyXG4gICAgICAvLyBQYWRkaW5nIChiYXNlNjQgcmVxdWlyZXMgcGFkZGluZylcclxuICAgICAgY29uc3QgcGFkID0gbm9ybWFsaXplZC5sZW5ndGggJSA0O1xyXG4gICAgICBjb25zdCBjYW5kaWRhdGUgPSBub3JtYWxpemVkICsgKHBhZCA9PT0gMCA/ICcnIDogJz0nLnJlcGVhdCg0IC0gcGFkKSk7XHJcblxyXG4gICAgICBjb25zdCBidWYgPSBCdWZmZXIuZnJvbShjYW5kaWRhdGUsICdiYXNlNjQnKTtcclxuICAgICAgY29uc3Qgc3RyID0gYnVmLnRvU3RyaW5nKCd1dGY4JykudHJpbSgpO1xyXG4gICAgICBpZiAoc3RyICYmIC9eaHR0cHM/OlxcL1xcLy9pLnRlc3Qoc3RyKSkgcmV0dXJuIHN0cjtcclxuXHJcbiAgICAgIC8vIGFsc28gYWNjZXB0IGJhcmUgd3d3IChubyBzY2hlbWUpIGZyb20gZGVjb2RlZCBzdHJpbmdcclxuICAgICAgaWYgKHN0ciAmJiAvXnd3d1xcLi9pLnRlc3Qoc3RyKSkgcmV0dXJuIGBodHRwOi8vJHtzdHJ9YDtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgLy8gdHJ5IG5leHRcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIExhc3QtY2hhbmNlOiBtYXliZSBpdCdzIHBsYWluIFVSTCBidXQgcGVyY2VudC1lbmNvZGVkIGRpZmZlcmVudGx5IG9yIG1pc3Npbmcgc2NoZW1lXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGFzRGVjb2RlZCA9IGRlY29kZVVSSUNvbXBvbmVudChTdHJpbmcodSkpLnRyaW0oKTtcclxuICAgIGlmICgvXmh0dHBzPzpcXC9cXC8vaS50ZXN0KGFzRGVjb2RlZCkpIHJldHVybiBhc0RlY29kZWQ7XHJcbiAgICBpZiAoL153d3dcXC4vaS50ZXN0KGFzRGVjb2RlZCkpIHJldHVybiBgaHR0cDovLyR7YXNEZWNvZGVkfWA7XHJcbiAgfSBjYXRjaCAoZSkge31cclxuXHJcbiAgLy8gQWxzbyBpZiB0aGUgcmF3IHZhbHVlIGlzIGEgYmFyZSB3d3cgaG9zdCwgYWNjZXB0IGl0XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJhd0NsZWFuID0gU3RyaW5nKHUpLnRyaW0oKTtcclxuICAgIGlmICgvXnd3d1xcLi9pLnRlc3QocmF3Q2xlYW4pKSByZXR1cm4gYGh0dHA6Ly8ke3Jhd0NsZWFufWA7XHJcbiAgfSBjYXRjaCAoZSkge31cclxuXHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBjb25zdCB7IGNhbXBhaWduLCBjb250YWN0IH0gPSByZXEucXVlcnk7XHJcbiAgY29uc3QgdVJhdyA9IHJlcS5xdWVyeS51IGFzIHN0cmluZyB8IHVuZGVmaW5lZDtcclxuICBjb25zdCB0cmFjZSA9IChyZXEucXVlcnkudCBhcyBzdHJpbmcpIHx8IFN0cmluZyhEYXRlLm5vdygpKTtcclxuXHJcbiAgc2FmZUxvZygnW0NMSUNLXSBpbmNvbWluZyByZXF1ZXN0JywgeyB1cmw6IHJlcS51cmwsIHF1ZXJ5OiByZXEucXVlcnksIGhlYWRlcnM6IHtcclxuICAgICd1c2VyLWFnZW50JzogcmVxLmhlYWRlcnNbJ3VzZXItYWdlbnQnXSxcclxuICAgIHJlZmVyZXI6IHJlcS5oZWFkZXJzLnJlZmVyZXIgfHwgcmVxLmhlYWRlcnMucmVmZXJyZXIsXHJcbiAgICBob3N0OiByZXEuaGVhZGVycy5ob3N0LFxyXG4gICAgJ3gtZm9yd2FyZGVkLWZvcic6IHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXSxcclxuICB9IH0pO1xyXG5cclxuICB0cnkge1xyXG4gICAgaWYgKCFjYW1wYWlnbiB8fCAhY29udGFjdCkge1xyXG4gICAgICBzYWZlTG9nKCdbQ0xJQ0tdIG1pc3NpbmcgY2FtcGFpZ24vY29udGFjdCBwYXRoIHBhcmFtcycpO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoJ01pc3NpbmcgcGFyYW1zJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2FtcGFpZ25JZFN0ciA9IFN0cmluZyhjYW1wYWlnbik7XHJcbiAgICBjb25zdCBjb250YWN0SWRTdHIgPSBTdHJpbmcoY29udGFjdCk7XHJcbiAgICBjb25zdCBjYW1wYWlnbklkT2JqID0gdHJ5UGFyc2VPYmplY3RJZChjYW1wYWlnbklkU3RyKTtcclxuICAgIGNvbnN0IGNvbnRhY3RJZE9iaiA9IHRyeVBhcnNlT2JqZWN0SWQoY29udGFjdElkU3RyKTtcclxuXHJcbiAgICBjb25zdCBkZXN0ID0gZGVjb2RlRGVzdGluYXRpb24odVJhdykgPz8gKCgpID0+IHtcclxuICAgICAgLy8gZmFsbGJhY2s6IG1heWJlIHUgY29udGFpbnMgYSByYXcgdXJsIGRlc3BpdGUgbm8gYmFzZTY0XHJcbiAgICAgIGNvbnN0IGZhbGxiYWNrID0gQXJyYXkuaXNBcnJheSh1UmF3KSA/IHVSYXdbMF0gOiB1UmF3O1xyXG4gICAgICBpZiAodHlwZW9mIGZhbGxiYWNrID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGNvbnN0IGYgPSBmYWxsYmFjay50cmltKCk7XHJcbiAgICAgICAgaWYgKC9eaHR0cHM/OlxcL1xcLy9pLnRlc3QoZikpIHJldHVybiBmO1xyXG4gICAgICAgIGlmICgvXnd3d1xcLi9pLnRlc3QoZikpIHJldHVybiBgaHR0cDovLyR7Zn1gO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfSkoKTtcclxuXHJcbiAgICBpZiAoIWRlc3QpIHtcclxuICAgICAgc2FmZUxvZygnW0NMSUNLXSBmYWlsZWQgdG8gZGVjb2RlIGRlc3RpbmF0aW9uJywgeyB1UmF3IH0pO1xyXG4gICAgICAvLyBMb2cgYW4gZXZlbnQgc28gd2UgY2FuIGluc3BlY3RcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBjbGllbnRQcm9taXNlO1xyXG4gICAgICAgIGNvbnN0IGRiID0gY2xpZW50LmRiKCdQbGF0Zm9ybURhdGEnKTtcclxuICAgICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbl9ldmVudHMnKS5pbnNlcnRPbmUoe1xyXG4gICAgICAgICAgY2FtcGFpZ25JZDogY2FtcGFpZ25JZE9iaiA/PyBjYW1wYWlnbklkU3RyLFxyXG4gICAgICAgICAgY29udGFjdElkOiBjb250YWN0SWRPYmogPz8gY29udGFjdElkU3RyLFxyXG4gICAgICAgICAgdHlwZTogJ2NsaWNrJyxcclxuICAgICAgICAgIHVybDogbnVsbCxcclxuICAgICAgICAgIG5vdGU6ICdkZWNvZGVfZmFpbGVkJyxcclxuICAgICAgICAgIHJhd191OiB1UmF3LFxyXG4gICAgICAgICAgdHJhY2UsXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBzYWZlTG9nKCdbQ0xJQ0tdIGZhaWxlZCByZWNvcmRpbmcgZGVjb2RlLWZhaWxlZCBldmVudCcsIGUpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZCgnSW52YWxpZCBkZXN0aW5hdGlvbicpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFBlcnNpc3QgZXZlbnQgKyB1cGRhdGUgbGVkZ2VyICsgcmVkaXMgKyBwdWJsaXNoXHJcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBjbGllbnRQcm9taXNlO1xyXG4gICAgY29uc3QgZGIgPSBjbGllbnQuZGIoJ1BsYXRmb3JtRGF0YScpO1xyXG5cclxuICAgIGNvbnN0IHVhID0gKHJlcS5oZWFkZXJzWyd1c2VyLWFnZW50J10gYXMgc3RyaW5nKSB8fCAnJztcclxuICAgIGNvbnN0IGlwID0gKHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXSBhcyBzdHJpbmcpPy5zcGxpdCgnLCcpWzBdIHx8IHJlcS5zb2NrZXQucmVtb3RlQWRkcmVzcyB8fCBudWxsO1xyXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcclxuXHJcbiAgICAvLyAtLS0gQkFDS0ZJTEwgT1BFTiBpZiBtaXNzaW5nIChjbGljayBpbXBsaWVzIG9wZW4pIC0tLVxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ2hlY2sgbGVkZ2VyIGZvciBvcGVuZWRBdCBkaXJlY3RseSAobW9yZSBlZmZpY2llbnQgdGhhbiBzY2FubmluZyBldmVudHMpXHJcbiAgICAgIGxldCBsZWRnZXJSb3dGb3JPcGVuOiBhbnkgPSBudWxsO1xyXG5cclxuICAgICAgaWYgKGNhbXBhaWduSWRPYmogJiYgY29udGFjdElkT2JqKSB7XHJcbiAgICAgICAgbGVkZ2VyUm93Rm9yT3BlbiA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NhbXBhaWduX2NvbnRhY3RzJykuZmluZE9uZShcclxuICAgICAgICAgIHsgY2FtcGFpZ25JZDogY2FtcGFpZ25JZE9iaiwgY29udGFjdElkOiBjb250YWN0SWRPYmogfSxcclxuICAgICAgICAgIHsgcHJvamVjdGlvbjogeyBvcGVuZWRBdDogMSB9IH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICgoIWxlZGdlclJvd0Zvck9wZW4pICYmIGNhbXBhaWduSWRPYmopIHtcclxuICAgICAgICBsZWRnZXJSb3dGb3JPcGVuID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS5maW5kT25lKFxyXG4gICAgICAgICAgeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkT2JqLCBjb250YWN0SWQ6IGNvbnRhY3RJZFN0ciB9LFxyXG4gICAgICAgICAgeyBwcm9qZWN0aW9uOiB7IG9wZW5lZEF0OiAxIH0gfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKCghbGVkZ2VyUm93Rm9yT3BlbikpIHtcclxuICAgICAgICBsZWRnZXJSb3dGb3JPcGVuID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS5maW5kT25lKFxyXG4gICAgICAgICAgeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkU3RyLCBjb250YWN0SWQ6IGNvbnRhY3RJZFN0ciB9LFxyXG4gICAgICAgICAgeyBwcm9qZWN0aW9uOiB7IG9wZW5lZEF0OiAxIH0gfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGFscmVhZHlPcGVuZWQgPSAhIShsZWRnZXJSb3dGb3JPcGVuICYmIGxlZGdlclJvd0Zvck9wZW4ub3BlbmVkQXQpO1xyXG5cclxuICAgICAgaWYgKCFhbHJlYWR5T3BlbmVkKSB7XHJcbiAgICAgICAgLy8gSW5zZXJ0IFwib3BlblwiIGV2ZW50IChiZXN0LWVmZm9ydClcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgZXZPcGVuOiBhbnkgPSB7XHJcbiAgICAgICAgICAgIGNhbXBhaWduSWQ6IGNhbXBhaWduSWRPYmogPz8gY2FtcGFpZ25JZFN0cixcclxuICAgICAgICAgICAgY29udGFjdElkOiBjb250YWN0SWRPYmogPz8gY29udGFjdElkU3RyLFxyXG4gICAgICAgICAgICB0eXBlOiAnb3BlbicsXHJcbiAgICAgICAgICAgIHVhLFxyXG4gICAgICAgICAgICBpcCxcclxuICAgICAgICAgICAgY3JlYXRlZEF0OiBub3csXHJcbiAgICAgICAgICAgIHRyYWNlLFxyXG4gICAgICAgICAgICB2aWE6ICdjbGljay1iYWNrZmlsbCcsXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgY29uc3Qgck9wZW4gPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbl9ldmVudHMnKS5pbnNlcnRPbmUoZXZPcGVuKTtcclxuICAgICAgICAgIHNhZmVMb2coJ1tDTElDS10gYmFja2ZpbGxlZCBvcGVuIC0+Jywgck9wZW4uaW5zZXJ0ZWRJZD8udG9TdHJpbmc/LigpKTtcclxuXHJcbiAgICAgICAgICAvLyBVcGRhdGUgY2FtcGFpZ25fY29udGFjdHM6IHNldCBvcGVuZWRBdCBhbmQgYnVtcCBsYXN0QWN0aXZpdHlBdCAodXNlICRtYXgpXHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVEb2M6IGFueSA9IHtcclxuICAgICAgICAgICAgICAkc2V0OiB7IG9wZW5lZEF0OiBub3cgfSxcclxuICAgICAgICAgICAgICAkbWF4OiB7IGxhc3RBY3Rpdml0eUF0OiBub3cgfSxcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGxldCByZXNVcGRhdGUgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoY2FtcGFpZ25JZE9iaiAmJiBjb250YWN0SWRPYmopIHtcclxuICAgICAgICAgICAgICByZXNVcGRhdGUgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbl9jb250YWN0cycpLnVwZGF0ZU9uZSh7IGNhbXBhaWduSWQ6IGNhbXBhaWduSWRPYmosIGNvbnRhY3RJZDogY29udGFjdElkT2JqIH0sIHVwZGF0ZURvYyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCghcmVzVXBkYXRlIHx8IChyZXNVcGRhdGUubWF0Y2hlZENvdW50ID8/IDApID09PSAwKSAmJiBjYW1wYWlnbklkT2JqKSB7XHJcbiAgICAgICAgICAgICAgcmVzVXBkYXRlID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS51cGRhdGVPbmUoeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkT2JqLCBjb250YWN0SWQ6IGNvbnRhY3RJZFN0ciB9LCB1cGRhdGVEb2MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgoIXJlc1VwZGF0ZSB8fCAocmVzVXBkYXRlLm1hdGNoZWRDb3VudCA/PyAwKSA9PT0gMCkpIHtcclxuICAgICAgICAgICAgICByZXNVcGRhdGUgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbl9jb250YWN0cycpLnVwZGF0ZU9uZSh7IGNhbXBhaWduSWQ6IGNhbXBhaWduSWRTdHIsIGNvbnRhY3RJZDogY29udGFjdElkU3RyIH0sIHVwZGF0ZURvYyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFyZXNVcGRhdGUgfHwgKHJlc1VwZGF0ZS5tYXRjaGVkQ291bnQgPz8gMCkgPT09IDApIHtcclxuICAgICAgICAgICAgICBzYWZlTG9nKCdbQ0xJQ0tdIG9wZW4gYmFja2ZpbGw6IGNhbXBhaWduX2NvbnRhY3RzIG5vIG1hdGNoIGZvcicsIHsgY2FtcGFpZ25JZFN0ciwgY29udGFjdElkU3RyIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHNhZmVMb2coJ1tDTElDS10gb3BlbiBiYWNrZmlsbDogY2FtcGFpZ25fY29udGFjdHMgdXBkYXRlIGZhaWxlZCcsIGUpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIFJlZGlzIGNvdW50ZXJzICYgcHVibGlzaCBvcGVuIGV2ZW50IGZvciBVSVxyXG4gICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYXdhaXQgcmVkaXMuaGluY3JieShgY2FtcGFpZ246JHtjYW1wYWlnbklkU3RyfTptZXRyaWNzYCwgJ29wZW5zJywgMSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWRPcGVuID0geyBjYW1wYWlnbklkOiBjYW1wYWlnbklkU3RyLCBjb250YWN0SWQ6IGNvbnRhY3RJZFN0ciwgZXZlbnQ6ICdvcGVuJywgb3BlbmVkQXQ6IG5vdy50b0lTT1N0cmluZygpLCB0cmFjZSwgdHM6IG5vdy50b0lTT1N0cmluZygpLCB2aWE6ICdjbGljay1iYWNrZmlsbCcgfTtcclxuICAgICAgICAgICAgYXdhaXQgcmVkaXMucHVibGlzaChgY2FtcGFpZ246JHtjYW1wYWlnbklkU3RyfTpjb250YWN0X3VwZGF0ZWAsIEpTT04uc3RyaW5naWZ5KHBheWxvYWRPcGVuKSk7XHJcbiAgICAgICAgICAgIHNhZmVMb2coJ1tDTElDS10gcHVibGlzaGVkIGJhY2tmaWxsIG9wZW4gY29udGFjdF91cGRhdGUnLCBwYXlsb2FkT3Blbik7XHJcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHNhZmVMb2coJ1tDTElDS10gb3BlbiBiYWNrZmlsbDogcmVkaXMgcHVibGlzaCBmYWlsZWQnLCBlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICBzYWZlTG9nKCdbQ0xJQ0tdIGZhaWxlZCB0byBpbnNlcnQgYmFja2ZpbGwgb3BlbiBldmVudCcsIGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBzYWZlTG9nKCdbQ0xJQ0tdIG9wZW4gYmFja2ZpbGwgY2hlY2sgZmFpbGVkJywgZSk7XHJcbiAgICAgIC8vIGNvbnRpbnVlIGFueXdheVxyXG4gICAgfVxyXG5cclxuICAgIC8vIC0tLSBJbnNlcnQgY2xpY2sgZXZlbnQgLS0tXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBldjogYW55ID0ge1xyXG4gICAgICAgIGNhbXBhaWduSWQ6IGNhbXBhaWduSWRPYmogPz8gY2FtcGFpZ25JZFN0cixcclxuICAgICAgICBjb250YWN0SWQ6IGNvbnRhY3RJZE9iaiA/PyBjb250YWN0SWRTdHIsXHJcbiAgICAgICAgdHlwZTogJ2NsaWNrJyxcclxuICAgICAgICB1cmw6IGRlc3QsXHJcbiAgICAgICAgdWEsXHJcbiAgICAgICAgaXAsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBub3csXHJcbiAgICAgICAgdHJhY2UsXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHIgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbl9ldmVudHMnKS5pbnNlcnRPbmUoZXYpO1xyXG4gICAgICBzYWZlTG9nKCdbQ0xJQ0tdIGNhbXBhaWduX2V2ZW50cy5pbnNlcnRPbmUgLT4nLCByLmluc2VydGVkSWQ/LnRvU3RyaW5nPy4oKSk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHNhZmVMb2coJ1tDTElDS10gZmFpbGVkIGluc2VydGluZyBjYW1wYWlnbl9ldmVudHMnLCBlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgY2FtcGFpZ25fY29udGFjdHM6IGxhc3RDbGlja0F0IGFuZCBsYXN0QWN0aXZpdHlBdCAodXNlICRtYXgpXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB1cGRhdGVEb2M6IGFueSA9IHsgJHNldDogeyBsYXN0Q2xpY2tBdDogbm93IH0sICRtYXg6IHsgbGFzdEFjdGl2aXR5QXQ6IG5vdyB9IH07XHJcblxyXG4gICAgICBsZXQgcmVzVXBkYXRlID0gbnVsbDtcclxuICAgICAgaWYgKGNhbXBhaWduSWRPYmogJiYgY29udGFjdElkT2JqKSB7XHJcbiAgICAgICAgcmVzVXBkYXRlID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS51cGRhdGVPbmUoeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkT2JqLCBjb250YWN0SWQ6IGNvbnRhY3RJZE9iaiB9LCB1cGRhdGVEb2MpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICgoIXJlc1VwZGF0ZSB8fCAocmVzVXBkYXRlLm1hdGNoZWRDb3VudCA/PyAwKSA9PT0gMCkgJiYgY2FtcGFpZ25JZE9iaikge1xyXG4gICAgICAgIHJlc1VwZGF0ZSA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NhbXBhaWduX2NvbnRhY3RzJykudXBkYXRlT25lKHsgY2FtcGFpZ25JZDogY2FtcGFpZ25JZE9iaiwgY29udGFjdElkOiBjb250YWN0SWRTdHIgfSwgdXBkYXRlRG9jKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoKCFyZXNVcGRhdGUgfHwgKHJlc1VwZGF0ZS5tYXRjaGVkQ291bnQgPz8gMCkgPT09IDApKSB7XHJcbiAgICAgICAgcmVzVXBkYXRlID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS51cGRhdGVPbmUoeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkU3RyLCBjb250YWN0SWQ6IGNvbnRhY3RJZFN0ciB9LCB1cGRhdGVEb2MpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIXJlc1VwZGF0ZSB8fCAocmVzVXBkYXRlLm1hdGNoZWRDb3VudCA/PyAwKSA9PT0gMCkge1xyXG4gICAgICAgIHNhZmVMb2coJ1tDTElDS10gY2FtcGFpZ25fY29udGFjdHMgbm8gbWF0Y2ggZm9yJywgeyBjYW1wYWlnbklkU3RyLCBjb250YWN0SWRTdHIgfSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgc2FmZUxvZygnW0NMSUNLXSBjYW1wYWlnbl9jb250YWN0cyB1cGRhdGUgZmFpbGVkJywgZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVkaXMgY291bnRlcnMgYW5kIHB1Ymxpc2ggY2xpY2sgdXBkYXRlXHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCByZWRpcy5oaW5jcmJ5KGBjYW1wYWlnbjoke2NhbXBhaWduSWRTdHJ9Om1ldHJpY3NgLCAnY2xpY2tzJywgMSk7XHJcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7IGNhbXBhaWduSWQ6IGNhbXBhaWduSWRTdHIsIGNvbnRhY3RJZDogY29udGFjdElkU3RyLCBldmVudDogJ2NsaWNrJywgdXJsOiBkZXN0LCB0cmFjZSwgdHM6IG5vdy50b0lTT1N0cmluZygpIH07XHJcbiAgICAgIGF3YWl0IHJlZGlzLnB1Ymxpc2goYGNhbXBhaWduOiR7Y2FtcGFpZ25JZFN0cn06Y29udGFjdF91cGRhdGVgLCBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSk7XHJcbiAgICAgIHNhZmVMb2coJ1tDTElDS10gcHVibGlzaGVkIGNvbnRhY3RfdXBkYXRlJywgcGF5bG9hZCk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHNhZmVMb2coJ1tDTElDS10gcmVkaXMgcHVibGlzaCBmYWlsZWQnLCBlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZWRpcmVjdCB0byBkZXN0XHJcbiAgICByZXMuc2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJywgJ25vLWNhY2hlLCBuby1zdG9yZSwgbXVzdC1yZXZhbGlkYXRlLCBtYXgtYWdlPTAsIHMtbWF4YWdlPTAnKTtcclxuICAgIHJlcy5zZXRIZWFkZXIoJ1ByYWdtYScsICduby1jYWNoZScpO1xyXG4gICAgcmVzLnNldEhlYWRlcignRXhwaXJlcycsICcwJyk7XHJcbiAgICByZXR1cm4gcmVzLnJlZGlyZWN0KDMwMiwgZGVzdCk7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBzYWZlTG9nKCdbQ0xJQ0tdIHVuZXhwZWN0ZWQgZXJyb3InLCBlcnIpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5zZW5kKCdlcnJvcicpO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiY2xpZW50UHJvbWlzZSIsInJlZGlzIiwiT2JqZWN0SWQiLCJ0cnlQYXJzZU9iamVjdElkIiwibWF5YmVJZCIsInRlc3QiLCJzYWZlTG9nIiwiYXJncyIsImNvbnNvbGUiLCJsb2ciLCJkZWNvZGVEZXN0aW5hdGlvbiIsInVSYXciLCJ1IiwiQXJyYXkiLCJpc0FycmF5IiwiYXR0ZW1wdHMiLCJwdXNoIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiZSIsInJlcGxhY2UiLCJhIiwiY2xlYW5lZCIsIlN0cmluZyIsInRyaW0iLCJub3JtYWxpemVkIiwicGFkIiwibGVuZ3RoIiwiY2FuZGlkYXRlIiwicmVwZWF0IiwiYnVmIiwiQnVmZmVyIiwiZnJvbSIsInN0ciIsInRvU3RyaW5nIiwiYXNEZWNvZGVkIiwicmF3Q2xlYW4iLCJoYW5kbGVyIiwicmVxIiwicmVzIiwiY2FtcGFpZ24iLCJjb250YWN0IiwicXVlcnkiLCJ0cmFjZSIsInQiLCJEYXRlIiwibm93IiwidXJsIiwiaGVhZGVycyIsInJlZmVyZXIiLCJyZWZlcnJlciIsImhvc3QiLCJzdGF0dXMiLCJzZW5kIiwiY2FtcGFpZ25JZFN0ciIsImNvbnRhY3RJZFN0ciIsImNhbXBhaWduSWRPYmoiLCJjb250YWN0SWRPYmoiLCJkZXN0IiwiZmFsbGJhY2siLCJmIiwiY2xpZW50IiwiZGIiLCJjb2xsZWN0aW9uIiwiaW5zZXJ0T25lIiwiY2FtcGFpZ25JZCIsImNvbnRhY3RJZCIsInR5cGUiLCJub3RlIiwicmF3X3UiLCJjcmVhdGVkQXQiLCJ1YSIsImlwIiwic3BsaXQiLCJzb2NrZXQiLCJyZW1vdGVBZGRyZXNzIiwibGVkZ2VyUm93Rm9yT3BlbiIsImZpbmRPbmUiLCJwcm9qZWN0aW9uIiwib3BlbmVkQXQiLCJhbHJlYWR5T3BlbmVkIiwiZXZPcGVuIiwidmlhIiwick9wZW4iLCJpbnNlcnRlZElkIiwidXBkYXRlRG9jIiwiJHNldCIsIiRtYXgiLCJsYXN0QWN0aXZpdHlBdCIsInJlc1VwZGF0ZSIsInVwZGF0ZU9uZSIsIm1hdGNoZWRDb3VudCIsImhpbmNyYnkiLCJwYXlsb2FkT3BlbiIsImV2ZW50IiwidG9JU09TdHJpbmciLCJ0cyIsInB1Ymxpc2giLCJKU09OIiwic3RyaW5naWZ5IiwiZXYiLCJyIiwibGFzdENsaWNrQXQiLCJwYXlsb2FkIiwic2V0SGVhZGVyIiwicmVkaXJlY3QiLCJlcnIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/track/click/[campaign]/[contact].ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftrack%2Fclick%2F%5Bcampaign%5D%2F%5Bcontact%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctrack%5Cclick%5C%5Bcampaign%5D%5C%5Bcontact%5D.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();