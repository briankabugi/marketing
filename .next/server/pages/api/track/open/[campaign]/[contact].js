"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/track/open/[campaign]/[contact]";
exports.ids = ["pages/api/track/open/[campaign]/[contact]"];
exports.modules = {

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftrack%2Fopen%2F%5Bcampaign%5D%2F%5Bcontact%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctrack%5Copen%5C%5Bcampaign%5D%5C%5Bcontact%5D.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftrack%2Fopen%2F%5Bcampaign%5D%2F%5Bcontact%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctrack%5Copen%5C%5Bcampaign%5D%5C%5Bcontact%5D.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_track_open_campaign_contact_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\track\\open\\[campaign]\\[contact].ts */ \"(api)/./pages/api/track/open/[campaign]/[contact].ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_track_open_campaign_contact_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_track_open_campaign_contact_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/track/open/[campaign]/[contact]\",\n        pathname: \"/api/track/open/[campaign]/[contact]\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_track_open_campaign_contact_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnRyYWNrJTJGb3BlbiUyRiU1QmNhbXBhaWduJTVEJTJGJTVCY29udGFjdCU1RCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDdHJhY2slNUNvcGVuJTVDJTVCY2FtcGFpZ24lNUQlNUMlNUJjb250YWN0JTVELnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ2dGO0FBQ2hGO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxzRUFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsc0VBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFya2V0aW5nLW12cC8/ODlkYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHRyYWNrXFxcXG9wZW5cXFxcW2NhbXBhaWduXVxcXFxbY29udGFjdF0udHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS90cmFjay9vcGVuL1tjYW1wYWlnbl0vW2NvbnRhY3RdXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvdHJhY2svb3Blbi9bY2FtcGFpZ25dL1tjb250YWN0XVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftrack%2Fopen%2F%5Bcampaign%5D%2F%5Bcontact%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctrack%5Copen%5C%5Bcampaign%5D%5C%5Bcontact%5D.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/mongo.ts":
/*!**********************!*\
  !*** ./lib/mongo.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n// lib/mongo.ts\n\nconst uri = process.env.MONGODB_URI;\nif (!uri) throw new Error(\"MONGODB_URI not set\");\nlet client;\nlet clientPromise;\n// Retry logic in case MongoDB connection fails\nasync function connectWithRetry() {\n    const MAX_RETRIES = 5;\n    let attempts = 0;\n    let lastError = null;\n    while(attempts < MAX_RETRIES){\n        try {\n            const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, {\n                maxPoolSize: 10,\n                serverSelectionTimeoutMS: 10000,\n                socketTimeoutMS: 45000\n            });\n            await client.connect();\n            return client;\n        } catch (err) {\n            lastError = err;\n            attempts++;\n            console.error(`MongoDB connection failed (attempt ${attempts}/${MAX_RETRIES}):`, err);\n            if (attempts < MAX_RETRIES) {\n                await new Promise((resolve)=>setTimeout(resolve, 5000)); // wait for 5 seconds before retrying\n            }\n        }\n    }\n    // After max retries, throw the last error encountered\n    throw lastError || new Error(\"MongoDB connection failed after maximum retry attempts\");\n}\nif (!global._mongoClientPromise) {\n    global._mongoClientPromise = connectWithRetry();\n    // Optional: log connection events\n    global._mongoClientPromise.then((client)=>{\n        client.on(\"serverOpening\", (event)=>console.log(\"MongoDB server opening\", event));\n        client.on(\"serverClosed\", (event)=>console.warn(\"MongoDB server closed\", event));\n        client.on(\"topologyClosed\", ()=>console.warn(\"MongoDB topology closed\"));\n        client.on(\"topologyOpening\", ()=>console.log(\"MongoDB topology opening\"));\n        client.on(\"error\", (err)=>console.error(\"MongoDB error\", err));\n    }).catch((err)=>{\n        console.error(\"MongoDB client failed to connect after retries\", err);\n    });\n}\nclientPromise = global._mongoClientPromise;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvbW9uZ28udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZUFBZTtBQUN1QjtBQUV0QyxNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFdBQVc7QUFDbkMsSUFBSSxDQUFDSCxLQUFLLE1BQU0sSUFBSUksTUFBTTtBQUUxQixJQUFJQztBQUNKLElBQUlDO0FBT0osK0NBQStDO0FBQy9DLGVBQWVDO0lBQ2IsTUFBTUMsY0FBYztJQUNwQixJQUFJQyxXQUFXO0lBQ2YsSUFBSUMsWUFBMEI7SUFFOUIsTUFBT0QsV0FBV0QsWUFBYTtRQUM3QixJQUFJO1lBQ0YsTUFBTUgsU0FBUyxJQUFJTixnREFBV0EsQ0FBQ0MsS0FBSztnQkFDbENXLGFBQWE7Z0JBQ2JDLDBCQUEwQjtnQkFDMUJDLGlCQUFpQjtZQUNuQjtZQUNBLE1BQU1SLE9BQU9TLE9BQU87WUFDcEIsT0FBT1Q7UUFDVCxFQUFFLE9BQU9VLEtBQVU7WUFDakJMLFlBQVlLO1lBQ1pOO1lBQ0FPLFFBQVFDLEtBQUssQ0FBQyxDQUFDLG1DQUFtQyxFQUFFUixTQUFTLENBQUMsRUFBRUQsWUFBWSxFQUFFLENBQUMsRUFBRU87WUFDakYsSUFBSU4sV0FBV0QsYUFBYTtnQkFDMUIsTUFBTSxJQUFJVSxRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTLFFBQVEscUNBQXFDO1lBQ2hHO1FBQ0Y7SUFDRjtJQUVBLHNEQUFzRDtJQUN0RCxNQUFNVCxhQUFhLElBQUlOLE1BQU07QUFDL0I7QUFFQSxJQUFJLENBQUNpQixPQUFPQyxtQkFBbUIsRUFBRTtJQUMvQkQsT0FBT0MsbUJBQW1CLEdBQUdmO0lBRTdCLGtDQUFrQztJQUNsQ2MsT0FBT0MsbUJBQW1CLENBQ3ZCQyxJQUFJLENBQUNsQixDQUFBQTtRQUNKQSxPQUFPbUIsRUFBRSxDQUFDLGlCQUFpQixDQUFDQyxRQUFVVCxRQUFRVSxHQUFHLENBQUMsMEJBQTBCRDtRQUM1RXBCLE9BQU9tQixFQUFFLENBQUMsZ0JBQWdCLENBQUNDLFFBQVVULFFBQVFXLElBQUksQ0FBQyx5QkFBeUJGO1FBQzNFcEIsT0FBT21CLEVBQUUsQ0FBQyxrQkFBa0IsSUFBTVIsUUFBUVcsSUFBSSxDQUFDO1FBQy9DdEIsT0FBT21CLEVBQUUsQ0FBQyxtQkFBbUIsSUFBTVIsUUFBUVUsR0FBRyxDQUFDO1FBQy9DckIsT0FBT21CLEVBQUUsQ0FBQyxTQUFTLENBQUNULE1BQVFDLFFBQVFDLEtBQUssQ0FBQyxpQkFBaUJGO0lBQzdELEdBQ0NhLEtBQUssQ0FBQ2IsQ0FBQUE7UUFDTEMsUUFBUUMsS0FBSyxDQUFDLGtEQUFrREY7SUFDbEU7QUFDSjtBQUVBVCxnQkFBZ0JlLE9BQU9DLG1CQUFtQjtBQUUxQyxpRUFBZWhCLGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vbGliL21vbmdvLnRzPzU3ZmUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21vbmdvLnRzXHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuaWYgKCF1cmkpIHRocm93IG5ldyBFcnJvcignTU9OR09EQl9VUkkgbm90IHNldCcpO1xyXG5cclxubGV0IGNsaWVudDogTW9uZ29DbGllbnQ7XHJcbmxldCBjbGllbnRQcm9taXNlOiBQcm9taXNlPE1vbmdvQ2xpZW50PjtcclxuXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXHJcbiAgdmFyIF9tb25nb0NsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+IHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG4vLyBSZXRyeSBsb2dpYyBpbiBjYXNlIE1vbmdvREIgY29ubmVjdGlvbiBmYWlsc1xyXG5hc3luYyBmdW5jdGlvbiBjb25uZWN0V2l0aFJldHJ5KCk6IFByb21pc2U8TW9uZ29DbGllbnQ+IHtcclxuICBjb25zdCBNQVhfUkVUUklFUyA9IDU7XHJcbiAgbGV0IGF0dGVtcHRzID0gMDtcclxuICBsZXQgbGFzdEVycm9yOiBFcnJvciB8IG51bGwgPSBudWxsO1xyXG5cclxuICB3aGlsZSAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwge1xyXG4gICAgICAgIG1heFBvb2xTaXplOiAxMCxcclxuICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDEwMDAwLFxyXG4gICAgICAgIHNvY2tldFRpbWVvdXRNUzogNDUwMDAsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgICByZXR1cm4gY2xpZW50O1xyXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgbGFzdEVycm9yID0gZXJyO1xyXG4gICAgICBhdHRlbXB0cysrO1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBNb25nb0RCIGNvbm5lY3Rpb24gZmFpbGVkIChhdHRlbXB0ICR7YXR0ZW1wdHN9LyR7TUFYX1JFVFJJRVN9KTpgLCBlcnIpO1xyXG4gICAgICBpZiAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDAwKSk7IC8vIHdhaXQgZm9yIDUgc2Vjb25kcyBiZWZvcmUgcmV0cnlpbmdcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQWZ0ZXIgbWF4IHJldHJpZXMsIHRocm93IHRoZSBsYXN0IGVycm9yIGVuY291bnRlcmVkXHJcbiAgdGhyb3cgbGFzdEVycm9yIHx8IG5ldyBFcnJvcignTW9uZ29EQiBjb25uZWN0aW9uIGZhaWxlZCBhZnRlciBtYXhpbXVtIHJldHJ5IGF0dGVtcHRzJyk7XHJcbn1cclxuXHJcbmlmICghZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UpIHtcclxuICBnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZSA9IGNvbm5lY3RXaXRoUmV0cnkoKTtcclxuICBcclxuICAvLyBPcHRpb25hbDogbG9nIGNvbm5lY3Rpb24gZXZlbnRzXHJcbiAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2VcclxuICAgIC50aGVuKGNsaWVudCA9PiB7XHJcbiAgICAgIGNsaWVudC5vbignc2VydmVyT3BlbmluZycsIChldmVudCkgPT4gY29uc29sZS5sb2coJ01vbmdvREIgc2VydmVyIG9wZW5pbmcnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3NlcnZlckNsb3NlZCcsIChldmVudCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHNlcnZlciBjbG9zZWQnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3RvcG9sb2d5Q2xvc2VkJywgKCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHRvcG9sb2d5IGNsb3NlZCcpKTtcclxuICAgICAgY2xpZW50Lm9uKCd0b3BvbG9neU9wZW5pbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnTW9uZ29EQiB0b3BvbG9neSBvcGVuaW5nJykpO1xyXG4gICAgICBjbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4gY29uc29sZS5lcnJvcignTW9uZ29EQiBlcnJvcicsIGVycikpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIGNsaWVudCBmYWlsZWQgdG8gY29ubmVjdCBhZnRlciByZXRyaWVzJywgZXJyKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jbGllbnRQcm9taXNlID0gZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2U7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnRQcm9taXNlOyJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwiY2xpZW50IiwiY2xpZW50UHJvbWlzZSIsImNvbm5lY3RXaXRoUmV0cnkiLCJNQVhfUkVUUklFUyIsImF0dGVtcHRzIiwibGFzdEVycm9yIiwibWF4UG9vbFNpemUiLCJzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMiLCJzb2NrZXRUaW1lb3V0TVMiLCJjb25uZWN0IiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZ2xvYmFsIiwiX21vbmdvQ2xpZW50UHJvbWlzZSIsInRoZW4iLCJvbiIsImV2ZW50IiwibG9nIiwid2FybiIsImNhdGNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/mongo.ts\n");

/***/ }),

/***/ "(api)/./lib/redis.ts":
/*!**********************!*\
  !*** ./lib/redis.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   redis: () => (/* binding */ redis),\n/* harmony export */   subscribe: () => (/* binding */ subscribe),\n/* harmony export */   subscribeToChannels: () => (/* binding */ subscribeToChannels)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n// lib/redis.ts\n\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(process.env.REDIS_URL || \"redis://127.0.0.1:6379\", {\n    maxRetriesPerRequest: null,\n    lazyConnect: true,\n    reconnectOnError: (err)=>{\n        const targetErrors = [\n            \"READONLY\",\n            \"ECONNRESET\",\n            \"ETIMEDOUT\"\n        ];\n        try {\n            if (err && typeof err.message === \"string\") {\n                return targetErrors.some((e)=>err.message.includes(e));\n            }\n        } catch  {\n        // fall through\n        }\n        return false;\n    }\n});\nredis.on(\"connect\", ()=>console.log(\"Redis connected\"));\nredis.on(\"ready\", ()=>console.log(\"Redis ready\"));\nredis.on(\"error\", (err)=>console.error(\"Redis error\", err));\nredis.on(\"close\", ()=>console.warn(\"Redis connection closed\"));\nredis.on(\"reconnecting\", ()=>console.log(\"Redis reconnecting\"));\n/**\r\n * Subscribe to a single Redis channel (ioredis-style).\r\n * Returns an async unsubscribe function.\r\n */ async function subscribe(channel, handler) {\n    const sub = redis.duplicate();\n    const onMessage = (msgChannel, message)=>{\n        if (msgChannel !== channel) return;\n        try {\n            handler(JSON.parse(message));\n        } catch  {\n            handler(message);\n        }\n    };\n    sub.on(\"error\", (err)=>{\n        console.error(`Redis subscriber error for channel ${channel}`, err);\n    });\n    sub.on(\"message\", onMessage);\n    try {\n        // connect only if not already connecting/ready\n        try {\n            if (typeof sub.connect === \"function\") {\n                const status = sub.status;\n                if (status !== \"ready\" && status !== \"connecting\") {\n                    await sub.connect().catch((err)=>{\n                        console.warn(\"Subscriber connect error (continuing):\", err);\n                    });\n                } else {\n                // already connecting/ready â€” skip connect\n                }\n            }\n        } catch (e) {\n            console.warn(\"Subscriber connect guard error\", e);\n        }\n        await sub.subscribe(channel).catch((err)=>{\n            console.warn(`subscribe(${channel}) failed`, err);\n        });\n    } catch (err) {\n        console.error(`Failed to subscribe to Redis channel ${channel}`, err);\n    }\n    return async ()=>{\n        try {\n            sub.off(\"message\", onMessage);\n            try {\n                await sub.unsubscribe(channel);\n            } catch (e) {}\n            try {\n                await sub.quit();\n            } catch (e) {}\n        } catch (err) {\n            console.warn(`Failed to cleanly unsubscribe from Redis channel ${channel}`, err);\n        }\n    };\n}\n/**\r\n * Robust multi-channel subscription helper.\r\n */ async function subscribeToChannels(sub, channels, handler) {\n    if (!sub || !channels || channels.length === 0) return;\n    // ensure connection if possible (guard against duplicate connect calls)\n    try {\n        if (typeof sub.connect === \"function\") {\n            const status = sub.status;\n            if (status !== \"ready\" && status !== \"connecting\") {\n                await sub.connect().catch((err)=>{\n                    console.warn(\"subscribeToChannels: subscriber connect warning\", err);\n                });\n            } else {\n            // already connecting/ready, skip connect\n            }\n        }\n    } catch (e) {\n    // ignore connect errors\n    }\n    for (const ch of channels){\n        try {\n            if (typeof sub.subscribe === \"function\") {\n                await sub.subscribe(ch).catch((err)=>{\n                    console.warn(`subscribeToChannels: subscribe(${ch}) failed`, err);\n                });\n            } else {\n                await sub.subscribe(ch);\n            }\n        } catch (e) {\n            console.warn(`subscribe failed for channel ${ch}, will attempt fallback`, e);\n        }\n    }\n    // Attach 'message' listener\n    try {\n        if (typeof sub.on === \"function\") {\n            const onMsg = (a, b)=>{\n                if (typeof a === \"string\" && typeof b === \"string\") {\n                    handler(a, b);\n                } else if (typeof b === \"string\" && channels.includes(b)) {\n                    handler(b, a);\n                } else {\n                    handler(String(a), String(b));\n                }\n            };\n            sub.__subscribe_to_channels_on_message = onMsg;\n            sub.on(\"message\", onMsg);\n        }\n    } catch (e) {\n        console.warn(\"Fallback Redis message hook failed\", e);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvcmVkaXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxlQUFlO0FBQ2U7QUFFdkIsTUFBTUMsUUFBUSxJQUFJRCxnREFBT0EsQ0FBQ0UsUUFBUUMsR0FBRyxDQUFDQyxTQUFTLElBQUksMEJBQTBCO0lBQ2xGQyxzQkFBc0I7SUFDdEJDLGFBQWE7SUFDYkMsa0JBQWtCLENBQUNDO1FBQ2pCLE1BQU1DLGVBQWU7WUFBQztZQUFZO1lBQWM7U0FBWTtRQUM1RCxJQUFJO1lBQ0YsSUFBSUQsT0FBTyxPQUFPQSxJQUFJRSxPQUFPLEtBQUssVUFBVTtnQkFDMUMsT0FBT0QsYUFBYUUsSUFBSSxDQUFDQyxDQUFBQSxJQUFLSixJQUFJRSxPQUFPLENBQUNHLFFBQVEsQ0FBQ0Q7WUFDckQ7UUFDRixFQUFFLE9BQU07UUFDTixlQUFlO1FBQ2pCO1FBQ0EsT0FBTztJQUNUO0FBQ0YsR0FBRztBQUVIWCxNQUFNYSxFQUFFLENBQUMsV0FBVyxJQUFNQyxRQUFRQyxHQUFHLENBQUM7QUFDdENmLE1BQU1hLEVBQUUsQ0FBQyxTQUFTLElBQU1DLFFBQVFDLEdBQUcsQ0FBQztBQUNwQ2YsTUFBTWEsRUFBRSxDQUFDLFNBQVMsQ0FBQ04sTUFBUU8sUUFBUUUsS0FBSyxDQUFDLGVBQWVUO0FBQ3hEUCxNQUFNYSxFQUFFLENBQUMsU0FBUyxJQUFNQyxRQUFRRyxJQUFJLENBQUM7QUFDckNqQixNQUFNYSxFQUFFLENBQUMsZ0JBQWdCLElBQU1DLFFBQVFDLEdBQUcsQ0FBQztBQUUzQzs7O0NBR0MsR0FDTSxlQUFlRyxVQUFVQyxPQUFlLEVBQUVDLE9BQTRCO0lBQzNFLE1BQU1DLE1BQU1yQixNQUFNc0IsU0FBUztJQUUzQixNQUFNQyxZQUFZLENBQUNDLFlBQW9CZjtRQUNyQyxJQUFJZSxlQUFlTCxTQUFTO1FBQzVCLElBQUk7WUFDRkMsUUFBUUssS0FBS0MsS0FBSyxDQUFDakI7UUFDckIsRUFBRSxPQUFNO1lBQ05XLFFBQVFYO1FBQ1Y7SUFDRjtJQUVBWSxJQUFJUixFQUFFLENBQUMsU0FBUyxDQUFDTjtRQUNmTyxRQUFRRSxLQUFLLENBQUMsQ0FBQyxtQ0FBbUMsRUFBRUcsUUFBUSxDQUFDLEVBQUVaO0lBQ2pFO0lBRUFjLElBQUlSLEVBQUUsQ0FBQyxXQUFXVTtJQUVsQixJQUFJO1FBQ0YsK0NBQStDO1FBQy9DLElBQUk7WUFDRixJQUFJLE9BQU8sSUFBYUksT0FBTyxLQUFLLFlBQVk7Z0JBQzlDLE1BQU1DLFNBQVMsSUFBYUEsTUFBTTtnQkFDbEMsSUFBSUEsV0FBVyxXQUFXQSxXQUFXLGNBQWM7b0JBQ2pELE1BQU0sSUFBYUQsT0FBTyxHQUFHRSxLQUFLLENBQUMsQ0FBQ3RCO3dCQUNsQ08sUUFBUUcsSUFBSSxDQUFDLDBDQUEwQ1Y7b0JBQ3pEO2dCQUNGLE9BQU87Z0JBQ0wsMENBQTBDO2dCQUM1QztZQUNGO1FBQ0YsRUFBRSxPQUFPSSxHQUFHO1lBQ1ZHLFFBQVFHLElBQUksQ0FBQyxrQ0FBa0NOO1FBQ2pEO1FBRUEsTUFBTSxJQUFhTyxTQUFTLENBQUNDLFNBQVNVLEtBQUssQ0FBQyxDQUFDdEI7WUFDM0NPLFFBQVFHLElBQUksQ0FBQyxDQUFDLFVBQVUsRUFBRUUsUUFBUSxRQUFRLENBQUMsRUFBRVo7UUFDL0M7SUFDRixFQUFFLE9BQU9BLEtBQUs7UUFDWk8sUUFBUUUsS0FBSyxDQUFDLENBQUMscUNBQXFDLEVBQUVHLFFBQVEsQ0FBQyxFQUFFWjtJQUNuRTtJQUVBLE9BQU87UUFDTCxJQUFJO1lBQ0ZjLElBQUlTLEdBQUcsQ0FBQyxXQUFXUDtZQUNuQixJQUFJO2dCQUFFLE1BQU0sSUFBYVEsV0FBVyxDQUFDWjtZQUFVLEVBQUUsT0FBT1IsR0FBRyxDQUFDO1lBQzVELElBQUk7Z0JBQUUsTUFBTSxJQUFhcUIsSUFBSTtZQUFJLEVBQUUsT0FBT3JCLEdBQUcsQ0FBQztRQUNoRCxFQUFFLE9BQU9KLEtBQUs7WUFDWk8sUUFBUUcsSUFBSSxDQUFDLENBQUMsaURBQWlELEVBQUVFLFFBQVEsQ0FBQyxFQUFFWjtRQUM5RTtJQUNGO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLGVBQWUwQixvQkFDcEJaLEdBQVEsRUFDUmEsUUFBa0IsRUFDbEJkLE9BQW1EO0lBRW5ELElBQUksQ0FBQ0MsT0FBTyxDQUFDYSxZQUFZQSxTQUFTQyxNQUFNLEtBQUssR0FBRztJQUVoRCx3RUFBd0U7SUFDeEUsSUFBSTtRQUNGLElBQUksT0FBT2QsSUFBSU0sT0FBTyxLQUFLLFlBQVk7WUFDckMsTUFBTUMsU0FBUyxJQUFhQSxNQUFNO1lBQ2xDLElBQUlBLFdBQVcsV0FBV0EsV0FBVyxjQUFjO2dCQUNqRCxNQUFNUCxJQUFJTSxPQUFPLEdBQUdFLEtBQUssQ0FBQyxDQUFDdEI7b0JBQ3pCTyxRQUFRRyxJQUFJLENBQUMsbURBQW1EVjtnQkFDbEU7WUFDRixPQUFPO1lBQ0wseUNBQXlDO1lBQzNDO1FBQ0Y7SUFDRixFQUFFLE9BQU9JLEdBQUc7SUFDVix3QkFBd0I7SUFDMUI7SUFFQSxLQUFLLE1BQU15QixNQUFNRixTQUFVO1FBQ3pCLElBQUk7WUFDRixJQUFJLE9BQU9iLElBQUlILFNBQVMsS0FBSyxZQUFZO2dCQUN2QyxNQUFNRyxJQUFJSCxTQUFTLENBQUNrQixJQUFJUCxLQUFLLENBQUMsQ0FBQ3RCO29CQUM3Qk8sUUFBUUcsSUFBSSxDQUFDLENBQUMsK0JBQStCLEVBQUVtQixHQUFHLFFBQVEsQ0FBQyxFQUFFN0I7Z0JBQy9EO1lBQ0YsT0FBTztnQkFDTCxNQUFNLElBQWFXLFNBQVMsQ0FBQ2tCO1lBQy9CO1FBQ0YsRUFBRSxPQUFPekIsR0FBRztZQUNWRyxRQUFRRyxJQUFJLENBQUMsQ0FBQyw2QkFBNkIsRUFBRW1CLEdBQUcsdUJBQXVCLENBQUMsRUFBRXpCO1FBQzVFO0lBQ0Y7SUFFQSw0QkFBNEI7SUFDNUIsSUFBSTtRQUNGLElBQUksT0FBT1UsSUFBSVIsRUFBRSxLQUFLLFlBQVk7WUFDaEMsTUFBTXdCLFFBQVEsQ0FBQ0MsR0FBUUM7Z0JBQ3JCLElBQUksT0FBT0QsTUFBTSxZQUFZLE9BQU9DLE1BQU0sVUFBVTtvQkFDbERuQixRQUFRa0IsR0FBR0M7Z0JBQ2IsT0FBTyxJQUFJLE9BQU9BLE1BQU0sWUFBWUwsU0FBU3RCLFFBQVEsQ0FBQzJCLElBQUk7b0JBQ3hEbkIsUUFBUW1CLEdBQUdEO2dCQUNiLE9BQU87b0JBQ0xsQixRQUFRb0IsT0FBT0YsSUFBSUUsT0FBT0Q7Z0JBQzVCO1lBQ0Y7WUFDQ2xCLElBQVlvQixrQ0FBa0MsR0FBR0o7WUFDbERoQixJQUFJUixFQUFFLENBQUMsV0FBV3dCO1FBQ3BCO0lBQ0YsRUFBRSxPQUFPMUIsR0FBRztRQUNWRyxRQUFRRyxJQUFJLENBQUMsc0NBQXNDTjtJQUNyRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFya2V0aW5nLW12cC8uL2xpYi9yZWRpcy50cz81MWU5Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9yZWRpcy50c1xyXG5pbXBvcnQgSU9SZWRpcyBmcm9tICdpb3JlZGlzJztcclxuXHJcbmV4cG9ydCBjb25zdCByZWRpcyA9IG5ldyBJT1JlZGlzKHByb2Nlc3MuZW52LlJFRElTX1VSTCB8fCAncmVkaXM6Ly8xMjcuMC4wLjE6NjM3OScsIHtcclxuICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogbnVsbCxcclxuICBsYXp5Q29ubmVjdDogdHJ1ZSxcclxuICByZWNvbm5lY3RPbkVycm9yOiAoZXJyOiBhbnkpID0+IHtcclxuICAgIGNvbnN0IHRhcmdldEVycm9ycyA9IFsnUkVBRE9OTFknLCAnRUNPTk5SRVNFVCcsICdFVElNRURPVVQnXTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChlcnIgJiYgdHlwZW9mIGVyci5tZXNzYWdlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHJldHVybiB0YXJnZXRFcnJvcnMuc29tZShlID0+IGVyci5tZXNzYWdlLmluY2x1ZGVzKGUpKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCB7XHJcbiAgICAgIC8vIGZhbGwgdGhyb3VnaFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH0sXHJcbn0pO1xyXG5cclxucmVkaXMub24oJ2Nvbm5lY3QnLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgY29ubmVjdGVkJykpO1xyXG5yZWRpcy5vbigncmVhZHknLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgcmVhZHknKSk7XHJcbnJlZGlzLm9uKCdlcnJvcicsIChlcnIpID0+IGNvbnNvbGUuZXJyb3IoJ1JlZGlzIGVycm9yJywgZXJyKSk7XHJcbnJlZGlzLm9uKCdjbG9zZScsICgpID0+IGNvbnNvbGUud2FybignUmVkaXMgY29ubmVjdGlvbiBjbG9zZWQnKSk7XHJcbnJlZGlzLm9uKCdyZWNvbm5lY3RpbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgcmVjb25uZWN0aW5nJykpO1xyXG5cclxuLyoqXHJcbiAqIFN1YnNjcmliZSB0byBhIHNpbmdsZSBSZWRpcyBjaGFubmVsIChpb3JlZGlzLXN0eWxlKS5cclxuICogUmV0dXJucyBhbiBhc3luYyB1bnN1YnNjcmliZSBmdW5jdGlvbi5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdWJzY3JpYmUoY2hhbm5lbDogc3RyaW5nLCBoYW5kbGVyOiAoZGF0YTogYW55KSA9PiB2b2lkKTogUHJvbWlzZTwoKSA9PiBQcm9taXNlPHZvaWQ+PiB7XHJcbiAgY29uc3Qgc3ViID0gcmVkaXMuZHVwbGljYXRlKCk7XHJcblxyXG4gIGNvbnN0IG9uTWVzc2FnZSA9IChtc2dDaGFubmVsOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykgPT4ge1xyXG4gICAgaWYgKG1zZ0NoYW5uZWwgIT09IGNoYW5uZWwpIHJldHVybjtcclxuICAgIHRyeSB7XHJcbiAgICAgIGhhbmRsZXIoSlNPTi5wYXJzZShtZXNzYWdlKSk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgaGFuZGxlcihtZXNzYWdlKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBzdWIub24oJ2Vycm9yJywgKGVycjogYW55KSA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKGBSZWRpcyBzdWJzY3JpYmVyIGVycm9yIGZvciBjaGFubmVsICR7Y2hhbm5lbH1gLCBlcnIpO1xyXG4gIH0pO1xyXG5cclxuICBzdWIub24oJ21lc3NhZ2UnLCBvbk1lc3NhZ2UpO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gY29ubmVjdCBvbmx5IGlmIG5vdCBhbHJlYWR5IGNvbm5lY3RpbmcvcmVhZHlcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh0eXBlb2YgKHN1YiBhcyBhbnkpLmNvbm5lY3QgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBjb25zdCBzdGF0dXMgPSAoc3ViIGFzIGFueSkuc3RhdHVzO1xyXG4gICAgICAgIGlmIChzdGF0dXMgIT09ICdyZWFkeScgJiYgc3RhdHVzICE9PSAnY29ubmVjdGluZycpIHtcclxuICAgICAgICAgIGF3YWl0IChzdWIgYXMgYW55KS5jb25uZWN0KCkuY2F0Y2goKGVycjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignU3Vic2NyaWJlciBjb25uZWN0IGVycm9yIChjb250aW51aW5nKTonLCBlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIGFscmVhZHkgY29ubmVjdGluZy9yZWFkeSDigJQgc2tpcCBjb25uZWN0XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignU3Vic2NyaWJlciBjb25uZWN0IGd1YXJkIGVycm9yJywgZSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgKHN1YiBhcyBhbnkpLnN1YnNjcmliZShjaGFubmVsKS5jYXRjaCgoZXJyOiBhbnkpID0+IHtcclxuICAgICAgY29uc29sZS53YXJuKGBzdWJzY3JpYmUoJHtjaGFubmVsfSkgZmFpbGVkYCwgZXJyKTtcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHN1YnNjcmliZSB0byBSZWRpcyBjaGFubmVsICR7Y2hhbm5lbH1gLCBlcnIpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGFzeW5jICgpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHN1Yi5vZmYoJ21lc3NhZ2UnLCBvbk1lc3NhZ2UpO1xyXG4gICAgICB0cnkgeyBhd2FpdCAoc3ViIGFzIGFueSkudW5zdWJzY3JpYmUoY2hhbm5lbCk7IH0gY2F0Y2ggKGUpIHt9XHJcbiAgICAgIHRyeSB7IGF3YWl0IChzdWIgYXMgYW55KS5xdWl0KCk7IH0gY2F0Y2ggKGUpIHt9XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gY2xlYW5seSB1bnN1YnNjcmliZSBmcm9tIFJlZGlzIGNoYW5uZWwgJHtjaGFubmVsfWAsIGVycik7XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJvYnVzdCBtdWx0aS1jaGFubmVsIHN1YnNjcmlwdGlvbiBoZWxwZXIuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3Vic2NyaWJlVG9DaGFubmVscyhcclxuICBzdWI6IGFueSxcclxuICBjaGFubmVsczogc3RyaW5nW10sXHJcbiAgaGFuZGxlcjogKGNoYW5uZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nKSA9PiB2b2lkXHJcbik6IFByb21pc2U8dm9pZD4ge1xyXG4gIGlmICghc3ViIHx8ICFjaGFubmVscyB8fCBjaGFubmVscy5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgLy8gZW5zdXJlIGNvbm5lY3Rpb24gaWYgcG9zc2libGUgKGd1YXJkIGFnYWluc3QgZHVwbGljYXRlIGNvbm5lY3QgY2FsbHMpXHJcbiAgdHJ5IHtcclxuICAgIGlmICh0eXBlb2Ygc3ViLmNvbm5lY3QgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgY29uc3Qgc3RhdHVzID0gKHN1YiBhcyBhbnkpLnN0YXR1cztcclxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ3JlYWR5JyAmJiBzdGF0dXMgIT09ICdjb25uZWN0aW5nJykge1xyXG4gICAgICAgIGF3YWl0IHN1Yi5jb25uZWN0KCkuY2F0Y2goKGVycjogYW55KSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ3N1YnNjcmliZVRvQ2hhbm5lbHM6IHN1YnNjcmliZXIgY29ubmVjdCB3YXJuaW5nJywgZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBhbHJlYWR5IGNvbm5lY3RpbmcvcmVhZHksIHNraXAgY29ubmVjdFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgLy8gaWdub3JlIGNvbm5lY3QgZXJyb3JzXHJcbiAgfVxyXG5cclxuICBmb3IgKGNvbnN0IGNoIG9mIGNoYW5uZWxzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAodHlwZW9mIHN1Yi5zdWJzY3JpYmUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBhd2FpdCBzdWIuc3Vic2NyaWJlKGNoKS5jYXRjaCgoZXJyOiBhbnkpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUud2Fybihgc3Vic2NyaWJlVG9DaGFubmVsczogc3Vic2NyaWJlKCR7Y2h9KSBmYWlsZWRgLCBlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGF3YWl0IChzdWIgYXMgYW55KS5zdWJzY3JpYmUoY2gpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2Fybihgc3Vic2NyaWJlIGZhaWxlZCBmb3IgY2hhbm5lbCAke2NofSwgd2lsbCBhdHRlbXB0IGZhbGxiYWNrYCwgZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBBdHRhY2ggJ21lc3NhZ2UnIGxpc3RlbmVyXHJcbiAgdHJ5IHtcclxuICAgIGlmICh0eXBlb2Ygc3ViLm9uID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNvbnN0IG9uTXNnID0gKGE6IGFueSwgYjogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBhID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgYiA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgIGhhbmRsZXIoYSwgYik7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYiA9PT0gJ3N0cmluZycgJiYgY2hhbm5lbHMuaW5jbHVkZXMoYikpIHtcclxuICAgICAgICAgIGhhbmRsZXIoYiwgYSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGhhbmRsZXIoU3RyaW5nKGEpLCBTdHJpbmcoYikpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgKHN1YiBhcyBhbnkpLl9fc3Vic2NyaWJlX3RvX2NoYW5uZWxzX29uX21lc3NhZ2UgPSBvbk1zZztcclxuICAgICAgc3ViLm9uKCdtZXNzYWdlJywgb25Nc2cpO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUud2FybignRmFsbGJhY2sgUmVkaXMgbWVzc2FnZSBob29rIGZhaWxlZCcsIGUpO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiSU9SZWRpcyIsInJlZGlzIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsIm1heFJldHJpZXNQZXJSZXF1ZXN0IiwibGF6eUNvbm5lY3QiLCJyZWNvbm5lY3RPbkVycm9yIiwiZXJyIiwidGFyZ2V0RXJyb3JzIiwibWVzc2FnZSIsInNvbWUiLCJlIiwiaW5jbHVkZXMiLCJvbiIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsIndhcm4iLCJzdWJzY3JpYmUiLCJjaGFubmVsIiwiaGFuZGxlciIsInN1YiIsImR1cGxpY2F0ZSIsIm9uTWVzc2FnZSIsIm1zZ0NoYW5uZWwiLCJKU09OIiwicGFyc2UiLCJjb25uZWN0Iiwic3RhdHVzIiwiY2F0Y2giLCJvZmYiLCJ1bnN1YnNjcmliZSIsInF1aXQiLCJzdWJzY3JpYmVUb0NoYW5uZWxzIiwiY2hhbm5lbHMiLCJsZW5ndGgiLCJjaCIsIm9uTXNnIiwiYSIsImIiLCJTdHJpbmciLCJfX3N1YnNjcmliZV90b19jaGFubmVsc19vbl9tZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/redis.ts\n");

/***/ }),

/***/ "(api)/./pages/api/track/open/[campaign]/[contact].ts":
/*!******************************************************!*\
  !*** ./pages/api/track/open/[campaign]/[contact].ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_mongo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../lib/mongo */ \"(api)/./lib/mongo.ts\");\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../../lib/redis */ \"(api)/./lib/redis.ts\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n// pages/api/track/open/[campaign]/[contact].ts\n\n\n\nfunction tryParseObjectId(maybeId) {\n    if (!maybeId) return null;\n    if (typeof maybeId === \"object\" && maybeId instanceof mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId) return maybeId;\n    if (typeof maybeId === \"string\" && /^[0-9a-fA-F]{24}$/.test(maybeId)) {\n        try {\n            return new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(maybeId);\n        } catch  {\n            return null;\n        }\n    }\n    return null;\n}\nasync function handler(req, res) {\n    const { campaign, contact } = req.query;\n    const trace = req.query.t || String(Date.now());\n    try {\n        if (!campaign || !contact) {\n            // respond pixel anyway to avoid breaking images\n            const pixel = Buffer.from(\"R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\", \"base64\");\n            res.setHeader(\"Content-Type\", \"image/gif\");\n            res.setHeader(\"Cache-Control\", \"no-store\");\n            return res.status(200).end(pixel);\n        }\n        const campaignIdStr = String(campaign);\n        const contactIdStr = String(contact);\n        const campaignIdObj = tryParseObjectId(campaignIdStr);\n        const contactIdObj = tryParseObjectId(contactIdStr);\n        const client = await _lib_mongo__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n        const db = client.db(\"PlatformData\");\n        const ua = req.headers[\"user-agent\"] || \"\";\n        const ip = req.headers[\"x-forwarded-for\"]?.split(\",\")[0] || req.socket.remoteAddress || null;\n        const now = new Date();\n        // Insert event (campaign_events)\n        try {\n            const ev = {\n                campaignId: campaignIdObj ?? campaignIdStr,\n                contactId: contactIdObj ?? contactIdStr,\n                type: \"open\",\n                ua,\n                ip,\n                createdAt: now,\n                trace\n            };\n            const r = await db.collection(\"campaign_events\").insertOne(ev);\n            console.log(\"[OPEN][TRACE:%s] campaign_events.insertedId=%s\", trace, r.insertedId?.toString?.());\n        } catch (e) {\n            console.warn(\"[OPEN] failed to insert campaign_events\", e);\n        }\n        // Update campaign_contacts: set openedAt and $max lastActivityAt (if present)\n        try {\n            const updateDoc = {\n                $set: {\n                    openedAt: now\n                },\n                $max: {\n                    lastActivityAt: now\n                }\n            };\n            // Try multiple matching strategies (ObjectId or string keys)\n            let resUpdate = null;\n            if (campaignIdObj && contactIdObj) {\n                resUpdate = await db.collection(\"campaign_contacts\").updateOne({\n                    campaignId: campaignIdObj,\n                    contactId: contactIdObj\n                }, updateDoc);\n            }\n            if ((!resUpdate || resUpdate.matchedCount === 0) && campaignIdObj) {\n                resUpdate = await db.collection(\"campaign_contacts\").updateOne({\n                    campaignId: campaignIdObj,\n                    contactId: contactIdStr\n                }, updateDoc);\n            }\n            if (!resUpdate || resUpdate.matchedCount === 0) {\n                resUpdate = await db.collection(\"campaign_contacts\").updateOne({\n                    campaignId: campaignIdStr,\n                    contactId: contactIdStr\n                }, updateDoc);\n            }\n            if (!resUpdate || resUpdate.matchedCount === 0) {\n                console.warn(\"[OPEN] campaign_contacts no match for\", {\n                    campaignIdStr,\n                    contactIdStr\n                });\n            } else {\n            // optionally log modifiedCount\n            }\n        } catch (e) {\n            console.warn(\"[OPEN] campaign_contacts update failed\", e);\n        }\n        // Redis counters & publish to contact_update channel (UI listens to this channel)\n        try {\n            await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hincrby(`campaign:${campaignIdStr}:metrics`, \"opens\", 1);\n            const payload = {\n                campaignId: campaignIdStr,\n                contactId: contactIdStr,\n                event: \"open\",\n                openedAt: now.toISOString(),\n                trace,\n                ts: now.toISOString()\n            };\n            await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.publish(`campaign:${campaignIdStr}:contact_update`, JSON.stringify(payload));\n            console.log(\"[OPEN] published contact_update\", payload);\n        } catch (e) {\n            console.warn(\"[OPEN] redis publish failed\", e);\n        }\n        // Return 1x1 pixel\n        const pixel = Buffer.from(\"R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\", \"base64\");\n        res.setHeader(\"Content-Type\", \"image/gif\");\n        res.setHeader(\"Cache-Control\", \"no-store, no-cache, must-revalidate, max-age=0, s-maxage=0\");\n        return res.status(200).end(pixel);\n    } catch (err) {\n        console.error(\"[OPEN] unexpected\", err);\n        const pixel = Buffer.from(\"R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\", \"base64\");\n        res.setHeader(\"Content-Type\", \"image/gif\");\n        res.setHeader(\"Cache-Control\", \"no-store\");\n        return res.status(200).end(pixel);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvdHJhY2svb3Blbi9bY2FtcGFpZ25dL1tjb250YWN0XS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLCtDQUErQztBQUVNO0FBQ0o7QUFDZDtBQUVuQyxTQUFTRyxpQkFBaUJDLE9BQVk7SUFDcEMsSUFBSSxDQUFDQSxTQUFTLE9BQU87SUFDckIsSUFBSSxPQUFPQSxZQUFZLFlBQVlBLG1CQUFtQkYsNkNBQVFBLEVBQUUsT0FBT0U7SUFDdkUsSUFBSSxPQUFPQSxZQUFZLFlBQVksb0JBQW9CQyxJQUFJLENBQUNELFVBQVU7UUFDcEUsSUFBSTtZQUFFLE9BQU8sSUFBSUYsNkNBQVFBLENBQUNFO1FBQVUsRUFBRSxPQUFNO1lBQUUsT0FBTztRQUFNO0lBQzdEO0lBQ0EsT0FBTztBQUNUO0FBRWUsZUFBZUUsUUFBUUMsR0FBbUIsRUFBRUMsR0FBb0I7SUFDN0UsTUFBTSxFQUFFQyxRQUFRLEVBQUVDLE9BQU8sRUFBRSxHQUFHSCxJQUFJSSxLQUFLO0lBQ3ZDLE1BQU1DLFFBQVEsSUFBS0QsS0FBSyxDQUFDRSxDQUFDLElBQWVDLE9BQU9DLEtBQUtDLEdBQUc7SUFFeEQsSUFBSTtRQUNGLElBQUksQ0FBQ1AsWUFBWSxDQUFDQyxTQUFTO1lBQ3pCLGdEQUFnRDtZQUNoRCxNQUFNTyxRQUFRQyxPQUFPQyxJQUFJLENBQUMsZ0VBQWdFO1lBQzFGWCxJQUFJWSxTQUFTLENBQUMsZ0JBQWdCO1lBQzlCWixJQUFJWSxTQUFTLENBQUMsaUJBQWlCO1lBQy9CLE9BQU9aLElBQUlhLE1BQU0sQ0FBQyxLQUFLQyxHQUFHLENBQUNMO1FBQzdCO1FBRUEsTUFBTU0sZ0JBQWdCVCxPQUFPTDtRQUM3QixNQUFNZSxlQUFlVixPQUFPSjtRQUU1QixNQUFNZSxnQkFBZ0J0QixpQkFBaUJvQjtRQUN2QyxNQUFNRyxlQUFldkIsaUJBQWlCcUI7UUFFdEMsTUFBTUcsU0FBUyxNQUFNM0Isa0RBQWFBO1FBQ2xDLE1BQU00QixLQUFLRCxPQUFPQyxFQUFFLENB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SUFDN0IsRUFBRSxPQUFPZ0QsS0FBSztRQUNadEIsUUFBUXVCLEtBQUssQ0FBQyxxQkFBcUJEO1FBQ25DLE1BQU1oRCxRQUFRQyxPQUFPQyxJQUFJLENBQUMsZ0VBQWdFO1FBQzFGWCxJQUFJWSxTQUFTLENBQUMsZ0JBQWdCO1FBQzlCWixJQUFJWSxTQUFTLENBQUMsaUJBQWlCO1FBQy9CLE9BQU9aLElBQUlhLE1BQU0sQ0FBQyxLQUFLQyxHQUFHLENBQUNMO0lBQzdCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vcGFnZXMvYXBpL3RyYWNrL29wZW4vW2NhbXBhaWduXS9bY29udGFjdF0udHM/NTlhYiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9hcGkvdHJhY2svb3Blbi9bY2FtcGFpZ25dL1tjb250YWN0XS50c1xyXG5pbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcclxuaW1wb3J0IGNsaWVudFByb21pc2UgZnJvbSAnLi4vLi4vLi4vLi4vLi4vbGliL21vbmdvJztcclxuaW1wb3J0IHsgcmVkaXMgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9saWIvcmVkaXMnO1xyXG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gJ21vbmdvZGInO1xyXG5cclxuZnVuY3Rpb24gdHJ5UGFyc2VPYmplY3RJZChtYXliZUlkOiBhbnkpIHtcclxuICBpZiAoIW1heWJlSWQpIHJldHVybiBudWxsO1xyXG4gIGlmICh0eXBlb2YgbWF5YmVJZCA9PT0gJ29iamVjdCcgJiYgbWF5YmVJZCBpbnN0YW5jZW9mIE9iamVjdElkKSByZXR1cm4gbWF5YmVJZDtcclxuICBpZiAodHlwZW9mIG1heWJlSWQgPT09ICdzdHJpbmcnICYmIC9eWzAtOWEtZkEtRl17MjR9JC8udGVzdChtYXliZUlkKSkge1xyXG4gICAgdHJ5IHsgcmV0dXJuIG5ldyBPYmplY3RJZChtYXliZUlkKTsgfSBjYXRjaCB7IHJldHVybiBudWxsOyB9XHJcbiAgfVxyXG4gIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XHJcbiAgY29uc3QgeyBjYW1wYWlnbiwgY29udGFjdCB9ID0gcmVxLnF1ZXJ5O1xyXG4gIGNvbnN0IHRyYWNlID0gKHJlcS5xdWVyeS50IGFzIHN0cmluZykgfHwgU3RyaW5nKERhdGUubm93KCkpO1xyXG5cclxuICB0cnkge1xyXG4gICAgaWYgKCFjYW1wYWlnbiB8fCAhY29udGFjdCkge1xyXG4gICAgICAvLyByZXNwb25kIHBpeGVsIGFueXdheSB0byBhdm9pZCBicmVha2luZyBpbWFnZXNcclxuICAgICAgY29uc3QgcGl4ZWwgPSBCdWZmZXIuZnJvbSgnUjBsR09EbGhBUUFCQUlBQkFQLy8vd0FBQUNINUJBRUtBQUVBTEFBQUFBQUJBQUVBQUFJQ1RBRUFPdz09JywgJ2Jhc2U2NCcpO1xyXG4gICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnaW1hZ2UvZ2lmJyk7XHJcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAnbm8tc3RvcmUnKTtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5lbmQocGl4ZWwpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNhbXBhaWduSWRTdHIgPSBTdHJpbmcoY2FtcGFpZ24pO1xyXG4gICAgY29uc3QgY29udGFjdElkU3RyID0gU3RyaW5nKGNvbnRhY3QpO1xyXG5cclxuICAgIGNvbnN0IGNhbXBhaWduSWRPYmogPSB0cnlQYXJzZU9iamVjdElkKGNhbXBhaWduSWRTdHIpO1xyXG4gICAgY29uc3QgY29udGFjdElkT2JqID0gdHJ5UGFyc2VPYmplY3RJZChjb250YWN0SWRTdHIpO1xyXG5cclxuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IGNsaWVudFByb21pc2U7XHJcbiAgICBjb25zdCBkYiA9IGNsaWVudC5kYignUGxhdGZvcm1EYXRhJyk7XHJcblxyXG4gICAgY29uc3QgdWEgPSAocmVxLmhlYWRlcnNbJ3VzZXItYWdlbnQnXSBhcyBzdHJpbmcpIHx8ICcnO1xyXG4gICAgY29uc3QgaXAgPVxyXG4gICAgICAocmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddIGFzIHN0cmluZyk/LnNwbGl0KCcsJylbMF0gfHxcclxuICAgICAgcmVxLnNvY2tldC5yZW1vdGVBZGRyZXNzIHx8XHJcbiAgICAgIG51bGw7XHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgIC8vIEluc2VydCBldmVudCAoY2FtcGFpZ25fZXZlbnRzKVxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZXY6IGFueSA9IHtcclxuICAgICAgICBjYW1wYWlnbklkOiBjYW1wYWlnbklkT2JqID8/IGNhbXBhaWduSWRTdHIsXHJcbiAgICAgICAgY29udGFjdElkOiBjb250YWN0SWRPYmogPz8gY29udGFjdElkU3RyLFxyXG4gICAgICAgIHR5cGU6ICdvcGVuJyxcclxuICAgICAgICB1YSxcclxuICAgICAgICBpcCxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5vdyxcclxuICAgICAgICB0cmFjZSxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgciA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NhbXBhaWduX2V2ZW50cycpLmluc2VydE9uZShldik7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdbT1BFTl1bVFJBQ0U6JXNdIGNhbXBhaWduX2V2ZW50cy5pbnNlcnRlZElkPSVzJywgdHJhY2UsIHIuaW5zZXJ0ZWRJZD8udG9TdHJpbmc/LigpKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS53YXJuKCdbT1BFTl0gZmFpbGVkIHRvIGluc2VydCBjYW1wYWlnbl9ldmVudHMnLCBlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgY2FtcGFpZ25fY29udGFjdHM6IHNldCBvcGVuZWRBdCBhbmQgJG1heCBsYXN0QWN0aXZpdHlBdCAoaWYgcHJlc2VudClcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZURvYzogYW55ID0ge1xyXG4gICAgICAgICRzZXQ6IHsgb3BlbmVkQXQ6IG5vdyB9LFxyXG4gICAgICAgICRtYXg6IHsgbGFzdEFjdGl2aXR5QXQ6IG5vdyB9LFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gVHJ5IG11bHRpcGxlIG1hdGNoaW5nIHN0cmF0ZWdpZXMgKE9iamVjdElkIG9yIHN0cmluZyBrZXlzKVxyXG4gICAgICBsZXQgcmVzVXBkYXRlID0gbnVsbDtcclxuICAgICAgaWYgKGNhbXBhaWduSWRPYmogJiYgY29udGFjdElkT2JqKSB7XHJcbiAgICAgICAgcmVzVXBkYXRlID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS51cGRhdGVPbmUoeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkT2JqLCBjb250YWN0SWQ6IGNvbnRhY3RJZE9iaiB9LCB1cGRhdGVEb2MpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICgoIXJlc1VwZGF0ZSB8fCByZXNVcGRhdGUubWF0Y2hlZENvdW50ID09PSAwKSAmJiBjYW1wYWlnbklkT2JqKSB7XHJcbiAgICAgICAgcmVzVXBkYXRlID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS51cGRhdGVPbmUoeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkT2JqLCBjb250YWN0SWQ6IGNvbnRhY3RJZFN0ciB9LCB1cGRhdGVEb2MpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICgoIXJlc1VwZGF0ZSB8fCByZXNVcGRhdGUubWF0Y2hlZENvdW50ID09PSAwKSkge1xyXG4gICAgICAgIHJlc1VwZGF0ZSA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NhbXBhaWduX2NvbnRhY3RzJykudXBkYXRlT25lKHsgY2FtcGFpZ25JZDogY2FtcGFpZ25JZFN0ciwgY29udGFjdElkOiBjb250YWN0SWRTdHIgfSwgdXBkYXRlRG9jKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFyZXNVcGRhdGUgfHwgcmVzVXBkYXRlLm1hdGNoZWRDb3VudCA9PT0gMCkge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignW09QRU5dIGNhbXBhaWduX2NvbnRhY3RzIG5vIG1hdGNoIGZvcicsIHsgY2FtcGFpZ25JZFN0ciwgY29udGFjdElkU3RyIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIG9wdGlvbmFsbHkgbG9nIG1vZGlmaWVkQ291bnRcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ1tPUEVOXSBjYW1wYWlnbl9jb250YWN0cyB1cGRhdGUgZmFpbGVkJywgZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVkaXMgY291bnRlcnMgJiBwdWJsaXNoIHRvIGNvbnRhY3RfdXBkYXRlIGNoYW5uZWwgKFVJIGxpc3RlbnMgdG8gdGhpcyBjaGFubmVsKVxyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgcmVkaXMuaGluY3JieShgY2FtcGFpZ246JHtjYW1wYWlnbklkU3RyfTptZXRyaWNzYCwgJ29wZW5zJywgMSk7XHJcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7IGNhbXBhaWduSWQ6IGNhbXBhaWduSWRTdHIsIGNvbnRhY3RJZDogY29udGFjdElkU3RyLCBldmVudDogJ29wZW4nLCBvcGVuZWRBdDogbm93LnRvSVNPU3RyaW5nKCksIHRyYWNlLCB0czogbm93LnRvSVNPU3RyaW5nKCkgfTtcclxuICAgICAgYXdhaXQgcmVkaXMucHVibGlzaChgY2FtcGFpZ246JHtjYW1wYWlnbklkU3RyfTpjb250YWN0X3VwZGF0ZWAsIEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKTtcclxuICAgICAgY29uc29sZS5sb2coJ1tPUEVOXSBwdWJsaXNoZWQgY29udGFjdF91cGRhdGUnLCBwYXlsb2FkKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS53YXJuKCdbT1BFTl0gcmVkaXMgcHVibGlzaCBmYWlsZWQnLCBlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZXR1cm4gMXgxIHBpeGVsXHJcbiAgICBjb25zdCBwaXhlbCA9IEJ1ZmZlci5mcm9tKCdSMGxHT0RsaEFRQUJBSUFCQVAvLy93QUFBQ0g1QkFFS0FBRUFMQUFBQUFBQkFBRUFBQUlDVEFFQU93PT0nLCAnYmFzZTY0Jyk7XHJcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnaW1hZ2UvZ2lmJyk7XHJcbiAgICByZXMuc2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJywgJ25vLXN0b3JlLCBuby1jYWNoZSwgbXVzdC1yZXZhbGlkYXRlLCBtYXgtYWdlPTAsIHMtbWF4YWdlPTAnKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuZW5kKHBpeGVsKTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tPUEVOXSB1bmV4cGVjdGVkJywgZXJyKTtcclxuICAgIGNvbnN0IHBpeGVsID0gQnVmZmVyLmZyb20oJ1IwbEdPRGxoQVFBQkFJQUJBUC8vL3dBQUFDSDVCQUVLQUFFQUxBQUFBQUFCQUFFQUFBSUNUQUVBT3c9PScsICdiYXNlNjQnKTtcclxuICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdpbWFnZS9naWYnKTtcclxuICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAnbm8tc3RvcmUnKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuZW5kKHBpeGVsKTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbImNsaWVudFByb21pc2UiLCJyZWRpcyIsIk9iamVjdElkIiwidHJ5UGFyc2VPYmplY3RJZCIsIm1heWJlSWQiLCJ0ZXN0IiwiaGFuZGxlciIsInJlcSIsInJlcyIsImNhbXBhaWduIiwiY29udGFjdCIsInF1ZXJ5IiwidHJhY2UiLCJ0IiwiU3RyaW5nIiwiRGF0ZSIsIm5vdyIsInBpeGVsIiwiQnVmZmVyIiwiZnJvbSIsInNldEhlYWRlciIsInN0YXR1cyIsImVuZCIsImNhbXBhaWduSWRTdHIiLCJjb250YWN0SWRTdHIiLCJjYW1wYWlnbklkT2JqIiwiY29udGFjdElkT2JqIiwiY2xpZW50IiwiZGIiLCJ1YSIsImhlYWRlcnMiLCJpcCIsInNwbGl0Iiwic29ja2V0IiwicmVtb3RlQWRkcmVzcyIsImV2IiwiY2FtcGFpZ25JZCIsImNvbnRhY3RJZCIsInR5cGUiLCJjcmVhdGVkQXQiLCJyIiwiY29sbGVjdGlvbiIsImluc2VydE9uZSIsImNvbnNvbGUiLCJsb2ciLCJpbnNlcnRlZElkIiwidG9TdHJpbmciLCJlIiwid2FybiIsInVwZGF0ZURvYyIsIiRzZXQiLCJvcGVuZWRBdCIsIiRtYXgiLCJsYXN0QWN0aXZpdHlBdCIsInJlc1VwZGF0ZSIsInVwZGF0ZU9uZSIsIm1hdGNoZWRDb3VudCIsImhpbmNyYnkiLCJwYXlsb2FkIiwiZXZlbnQiLCJ0b0lTT1N0cmluZyIsInRzIiwicHVibGlzaCIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnIiLCJlcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/track/open/[campaign]/[contact].ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftrack%2Fopen%2F%5Bcampaign%5D%2F%5Bcontact%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctrack%5Copen%5C%5Bcampaign%5D%5C%5Bcontact%5D.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();