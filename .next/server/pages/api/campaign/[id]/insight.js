"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/campaign/[id]/insight";
exports.ids = ["pages/api/campaign/[id]/insight"];
exports.modules = {

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Finsight&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Cinsight.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Finsight&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Cinsight.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_campaign_id_insight_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\campaign\\[id]\\insight.ts */ \"(api)/./pages/api/campaign/[id]/insight.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_id_insight_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_id_insight_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/campaign/[id]/insight\",\n        pathname: \"/api/campaign/[id]/insight\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_campaign_id_insight_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNhbXBhaWduJTJGJTVCaWQlNUQlMkZpbnNpZ2h0JnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNjYW1wYWlnbiU1QyU1QmlkJTVEJTVDaW5zaWdodC50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNxRTtBQUNyRTtBQUNBLGlFQUFlLHdFQUFLLENBQUMsOERBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLDhEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL21hcmtldGluZy1tdnAvP2M4N2YiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxjYW1wYWlnblxcXFxbaWRdXFxcXGluc2lnaHQudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jYW1wYWlnbi9baWRdL2luc2lnaHRcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jYW1wYWlnbi9baWRdL2luc2lnaHRcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Finsight&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Cinsight.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/mongo.ts":
/*!**********************!*\
  !*** ./lib/mongo.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n// lib/mongo.ts\n\nconst uri = process.env.MONGODB_URI;\nif (!uri) throw new Error(\"MONGODB_URI not set\");\nlet client;\nlet clientPromise;\n// Retry logic in case MongoDB connection fails\nasync function connectWithRetry() {\n    const MAX_RETRIES = 5;\n    let attempts = 0;\n    let lastError = null;\n    while(attempts < MAX_RETRIES){\n        try {\n            const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, {\n                maxPoolSize: 10,\n                serverSelectionTimeoutMS: 10000,\n                socketTimeoutMS: 45000\n            });\n            await client.connect();\n            return client;\n        } catch (err) {\n            lastError = err;\n            attempts++;\n            console.error(`MongoDB connection failed (attempt ${attempts}/${MAX_RETRIES}):`, err);\n            if (attempts < MAX_RETRIES) {\n                await new Promise((resolve)=>setTimeout(resolve, 5000)); // wait for 5 seconds before retrying\n            }\n        }\n    }\n    // After max retries, throw the last error encountered\n    throw lastError || new Error(\"MongoDB connection failed after maximum retry attempts\");\n}\nif (!global._mongoClientPromise) {\n    global._mongoClientPromise = connectWithRetry();\n    // Optional: log connection events\n    global._mongoClientPromise.then((client)=>{\n        client.on(\"serverOpening\", (event)=>console.log(\"MongoDB server opening\", event));\n        client.on(\"serverClosed\", (event)=>console.warn(\"MongoDB server closed\", event));\n        client.on(\"topologyClosed\", ()=>console.warn(\"MongoDB topology closed\"));\n        client.on(\"topologyOpening\", ()=>console.log(\"MongoDB topology opening\"));\n        client.on(\"error\", (err)=>console.error(\"MongoDB error\", err));\n    }).catch((err)=>{\n        console.error(\"MongoDB client failed to connect after retries\", err);\n    });\n}\nclientPromise = global._mongoClientPromise;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvbW9uZ28udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZUFBZTtBQUN1QjtBQUV0QyxNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFdBQVc7QUFDbkMsSUFBSSxDQUFDSCxLQUFLLE1BQU0sSUFBSUksTUFBTTtBQUUxQixJQUFJQztBQUNKLElBQUlDO0FBT0osK0NBQStDO0FBQy9DLGVBQWVDO0lBQ2IsTUFBTUMsY0FBYztJQUNwQixJQUFJQyxXQUFXO0lBQ2YsSUFBSUMsWUFBMEI7SUFFOUIsTUFBT0QsV0FBV0QsWUFBYTtRQUM3QixJQUFJO1lBQ0YsTUFBTUgsU0FBUyxJQUFJTixnREFBV0EsQ0FBQ0MsS0FBSztnQkFDbENXLGFBQWE7Z0JBQ2JDLDBCQUEwQjtnQkFDMUJDLGlCQUFpQjtZQUNuQjtZQUNBLE1BQU1SLE9BQU9TLE9BQU87WUFDcEIsT0FBT1Q7UUFDVCxFQUFFLE9BQU9VLEtBQVU7WUFDakJMLFlBQVlLO1lBQ1pOO1lBQ0FPLFFBQVFDLEtBQUssQ0FBQyxDQUFDLG1DQUFtQyxFQUFFUixTQUFTLENBQUMsRUFBRUQsWUFBWSxFQUFFLENBQUMsRUFBRU87WUFDakYsSUFBSU4sV0FBV0QsYUFBYTtnQkFDMUIsTUFBTSxJQUFJVSxRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTLFFBQVEscUNBQXFDO1lBQ2hHO1FBQ0Y7SUFDRjtJQUVBLHNEQUFzRDtJQUN0RCxNQUFNVCxhQUFhLElBQUlOLE1BQU07QUFDL0I7QUFFQSxJQUFJLENBQUNpQixPQUFPQyxtQkFBbUIsRUFBRTtJQUMvQkQsT0FBT0MsbUJBQW1CLEdBQUdmO0lBRTdCLGtDQUFrQztJQUNsQ2MsT0FBT0MsbUJBQW1CLENBQ3ZCQyxJQUFJLENBQUNsQixDQUFBQTtRQUNKQSxPQUFPbUIsRUFBRSxDQUFDLGlCQUFpQixDQUFDQyxRQUFVVCxRQUFRVSxHQUFHLENBQUMsMEJBQTBCRDtRQUM1RXBCLE9BQU9tQixFQUFFLENBQUMsZ0JBQWdCLENBQUNDLFFBQVVULFFBQVFXLElBQUksQ0FBQyx5QkFBeUJGO1FBQzNFcEIsT0FBT21CLEVBQUUsQ0FBQyxrQkFBa0IsSUFBTVIsUUFBUVcsSUFBSSxDQUFDO1FBQy9DdEIsT0FBT21CLEVBQUUsQ0FBQyxtQkFBbUIsSUFBTVIsUUFBUVUsR0FBRyxDQUFDO1FBQy9DckIsT0FBT21CLEVBQUUsQ0FBQyxTQUFTLENBQUNULE1BQVFDLFFBQVFDLEtBQUssQ0FBQyxpQkFBaUJGO0lBQzdELEdBQ0NhLEtBQUssQ0FBQ2IsQ0FBQUE7UUFDTEMsUUFBUUMsS0FBSyxDQUFDLGtEQUFrREY7SUFDbEU7QUFDSjtBQUVBVCxnQkFBZ0JlLE9BQU9DLG1CQUFtQjtBQUUxQyxpRUFBZWhCLGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vbGliL21vbmdvLnRzPzU3ZmUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21vbmdvLnRzXHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuaWYgKCF1cmkpIHRocm93IG5ldyBFcnJvcignTU9OR09EQl9VUkkgbm90IHNldCcpO1xyXG5cclxubGV0IGNsaWVudDogTW9uZ29DbGllbnQ7XHJcbmxldCBjbGllbnRQcm9taXNlOiBQcm9taXNlPE1vbmdvQ2xpZW50PjtcclxuXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXHJcbiAgdmFyIF9tb25nb0NsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+IHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG4vLyBSZXRyeSBsb2dpYyBpbiBjYXNlIE1vbmdvREIgY29ubmVjdGlvbiBmYWlsc1xyXG5hc3luYyBmdW5jdGlvbiBjb25uZWN0V2l0aFJldHJ5KCk6IFByb21pc2U8TW9uZ29DbGllbnQ+IHtcclxuICBjb25zdCBNQVhfUkVUUklFUyA9IDU7XHJcbiAgbGV0IGF0dGVtcHRzID0gMDtcclxuICBsZXQgbGFzdEVycm9yOiBFcnJvciB8IG51bGwgPSBudWxsO1xyXG5cclxuICB3aGlsZSAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwge1xyXG4gICAgICAgIG1heFBvb2xTaXplOiAxMCxcclxuICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDEwMDAwLFxyXG4gICAgICAgIHNvY2tldFRpbWVvdXRNUzogNDUwMDAsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgICByZXR1cm4gY2xpZW50O1xyXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgbGFzdEVycm9yID0gZXJyO1xyXG4gICAgICBhdHRlbXB0cysrO1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBNb25nb0RCIGNvbm5lY3Rpb24gZmFpbGVkIChhdHRlbXB0ICR7YXR0ZW1wdHN9LyR7TUFYX1JFVFJJRVN9KTpgLCBlcnIpO1xyXG4gICAgICBpZiAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDAwKSk7IC8vIHdhaXQgZm9yIDUgc2Vjb25kcyBiZWZvcmUgcmV0cnlpbmdcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQWZ0ZXIgbWF4IHJldHJpZXMsIHRocm93IHRoZSBsYXN0IGVycm9yIGVuY291bnRlcmVkXHJcbiAgdGhyb3cgbGFzdEVycm9yIHx8IG5ldyBFcnJvcignTW9uZ29EQiBjb25uZWN0aW9uIGZhaWxlZCBhZnRlciBtYXhpbXVtIHJldHJ5IGF0dGVtcHRzJyk7XHJcbn1cclxuXHJcbmlmICghZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UpIHtcclxuICBnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZSA9IGNvbm5lY3RXaXRoUmV0cnkoKTtcclxuICBcclxuICAvLyBPcHRpb25hbDogbG9nIGNvbm5lY3Rpb24gZXZlbnRzXHJcbiAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2VcclxuICAgIC50aGVuKGNsaWVudCA9PiB7XHJcbiAgICAgIGNsaWVudC5vbignc2VydmVyT3BlbmluZycsIChldmVudCkgPT4gY29uc29sZS5sb2coJ01vbmdvREIgc2VydmVyIG9wZW5pbmcnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3NlcnZlckNsb3NlZCcsIChldmVudCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHNlcnZlciBjbG9zZWQnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3RvcG9sb2d5Q2xvc2VkJywgKCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHRvcG9sb2d5IGNsb3NlZCcpKTtcclxuICAgICAgY2xpZW50Lm9uKCd0b3BvbG9neU9wZW5pbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnTW9uZ29EQiB0b3BvbG9neSBvcGVuaW5nJykpO1xyXG4gICAgICBjbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4gY29uc29sZS5lcnJvcignTW9uZ29EQiBlcnJvcicsIGVycikpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIGNsaWVudCBmYWlsZWQgdG8gY29ubmVjdCBhZnRlciByZXRyaWVzJywgZXJyKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jbGllbnRQcm9taXNlID0gZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2U7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnRQcm9taXNlOyJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwiY2xpZW50IiwiY2xpZW50UHJvbWlzZSIsImNvbm5lY3RXaXRoUmV0cnkiLCJNQVhfUkVUUklFUyIsImF0dGVtcHRzIiwibGFzdEVycm9yIiwibWF4UG9vbFNpemUiLCJzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMiLCJzb2NrZXRUaW1lb3V0TVMiLCJjb25uZWN0IiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZ2xvYmFsIiwiX21vbmdvQ2xpZW50UHJvbWlzZSIsInRoZW4iLCJvbiIsImV2ZW50IiwibG9nIiwid2FybiIsImNhdGNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/mongo.ts\n");

/***/ }),

/***/ "(api)/./lib/redis.ts":
/*!**********************!*\
  !*** ./lib/redis.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   redis: () => (/* binding */ redis),\n/* harmony export */   subscribe: () => (/* binding */ subscribe),\n/* harmony export */   subscribeToChannels: () => (/* binding */ subscribeToChannels)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n// lib/redis.ts\n\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(process.env.REDIS_URL || \"redis://127.0.0.1:6379\", {\n    maxRetriesPerRequest: null,\n    lazyConnect: true,\n    reconnectOnError: (err)=>{\n        const targetErrors = [\n            \"READONLY\",\n            \"ECONNRESET\",\n            \"ETIMEDOUT\"\n        ];\n        return targetErrors.some((e)=>err.message.includes(e));\n    }\n});\nredis.on(\"connect\", ()=>console.log(\"Redis connected\"));\nredis.on(\"ready\", ()=>console.log(\"Redis ready\"));\nredis.on(\"error\", (err)=>console.error(\"Redis error\", err));\nredis.on(\"close\", ()=>console.warn(\"Redis connection closed\"));\nredis.on(\"reconnecting\", ()=>console.log(\"Redis reconnecting\"));\n/**\r\n * Single-channel subscription helper\r\n */ function subscribe(channel, handler) {\n    const sub = redis.duplicate();\n    const onMessage = (ch, message)=>{\n        if (ch !== channel) return;\n        try {\n            handler(JSON.parse(message));\n        } catch  {\n            handler(message);\n        }\n    };\n    sub.on(\"message\", onMessage);\n    sub.subscribe(channel).catch((err)=>{\n        console.error(`Redis subscribe failed for ${channel}`, err);\n    });\n    return async ()=>{\n        try {\n            sub.off(\"message\", onMessage);\n            await sub.unsubscribe(channel);\n            await sub.quit();\n        } catch (err) {\n            console.warn(`Failed to unsubscribe from ${channel}`, err);\n        }\n    };\n}\n/**\r\n * Multi-channel subscriber (worker & SSE safe)\r\n */ async function subscribeToChannels(sub, channels, handler) {\n    for (const ch of channels){\n        await sub.subscribe(ch);\n    }\n    sub.on(\"message\", (channel, message)=>{\n        if (channels.includes(channel)) {\n            handler(channel, message);\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvcmVkaXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxlQUFlO0FBQ2U7QUFFdkIsTUFBTUMsUUFBUSxJQUFJRCxnREFBT0EsQ0FBQ0UsUUFBUUMsR0FBRyxDQUFDQyxTQUFTLElBQUksMEJBQTBCO0lBQ2xGQyxzQkFBc0I7SUFDdEJDLGFBQWE7SUFDYkMsa0JBQWtCLENBQUNDO1FBQ2pCLE1BQU1DLGVBQWU7WUFBQztZQUFZO1lBQWM7U0FBWTtRQUM1RCxPQUFPQSxhQUFhQyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUgsSUFBSUksT0FBTyxDQUFDQyxRQUFRLENBQUNGO0lBQ3ZEO0FBQ0YsR0FBRztBQUVIVixNQUFNYSxFQUFFLENBQUMsV0FBVyxJQUFNQyxRQUFRQyxHQUFHLENBQUM7QUFDdENmLE1BQU1hLEVBQUUsQ0FBQyxTQUFTLElBQU1DLFFBQVFDLEdBQUcsQ0FBQztBQUNwQ2YsTUFBTWEsRUFBRSxDQUFDLFNBQVMsQ0FBQ04sTUFBUU8sUUFBUUUsS0FBSyxDQUFDLGVBQWVUO0FBQ3hEUCxNQUFNYSxFQUFFLENBQUMsU0FBUyxJQUFNQyxRQUFRRyxJQUFJLENBQUM7QUFDckNqQixNQUFNYSxFQUFFLENBQUMsZ0JBQWdCLElBQU1DLFFBQVFDLEdBQUcsQ0FBQztBQUUzQzs7Q0FFQyxHQUNNLFNBQVNHLFVBQ2RDLE9BQWUsRUFDZkMsT0FBNEI7SUFFNUIsTUFBTUMsTUFBTXJCLE1BQU1zQixTQUFTO0lBRTNCLE1BQU1DLFlBQVksQ0FBQ0MsSUFBWWI7UUFDN0IsSUFBSWEsT0FBT0wsU0FBUztRQUNwQixJQUFJO1lBQ0ZDLFFBQVFLLEtBQUtDLEtBQUssQ0FBQ2Y7UUFDckIsRUFBRSxPQUFNO1lBQ05TLFFBQVFUO1FBQ1Y7SUFDRjtJQUVBVSxJQUFJUixFQUFFLENBQUMsV0FBV1U7SUFFbEJGLElBQUlILFNBQVMsQ0FBQ0MsU0FBU1EsS0FBSyxDQUFDLENBQUNwQjtRQUM1Qk8sUUFBUUUsS0FBSyxDQUFDLENBQUMsMkJBQTJCLEVBQUVHLFFBQVEsQ0FBQyxFQUFFWjtJQUN6RDtJQUVBLE9BQU87UUFDTCxJQUFJO1lBQ0ZjLElBQUlPLEdBQUcsQ0FBQyxXQUFXTDtZQUNuQixNQUFNRixJQUFJUSxXQUFXLENBQUNWO1lBQ3RCLE1BQU1FLElBQUlTLElBQUk7UUFDaEIsRUFBRSxPQUFPdkIsS0FBSztZQUNaTyxRQUFRRyxJQUFJLENBQUMsQ0FBQywyQkFBMkIsRUFBRUUsUUFBUSxDQUFDLEVBQUVaO1FBQ3hEO0lBQ0Y7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZXdCLG9CQUNwQlYsR0FBWSxFQUNaVyxRQUFrQixFQUNsQlosT0FBbUQ7SUFFbkQsS0FBSyxNQUFNSSxNQUFNUSxTQUFVO1FBQ3pCLE1BQU1YLElBQUlILFNBQVMsQ0FBQ007SUFDdEI7SUFFQUgsSUFBSVIsRUFBRSxDQUFDLFdBQVcsQ0FBQ00sU0FBU1I7UUFDMUIsSUFBSXFCLFNBQVNwQixRQUFRLENBQUNPLFVBQVU7WUFDOUJDLFFBQVFELFNBQVNSO1FBQ25CO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL21hcmtldGluZy1tdnAvLi9saWIvcmVkaXMudHM/NTFlOSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvcmVkaXMudHNcclxuaW1wb3J0IElPUmVkaXMgZnJvbSBcImlvcmVkaXNcIjtcclxuXHJcbmV4cG9ydCBjb25zdCByZWRpcyA9IG5ldyBJT1JlZGlzKHByb2Nlc3MuZW52LlJFRElTX1VSTCB8fCBcInJlZGlzOi8vMTI3LjAuMC4xOjYzNzlcIiwge1xyXG4gIG1heFJldHJpZXNQZXJSZXF1ZXN0OiBudWxsLFxyXG4gIGxhenlDb25uZWN0OiB0cnVlLFxyXG4gIHJlY29ubmVjdE9uRXJyb3I6IChlcnIpID0+IHtcclxuICAgIGNvbnN0IHRhcmdldEVycm9ycyA9IFtcIlJFQURPTkxZXCIsIFwiRUNPTk5SRVNFVFwiLCBcIkVUSU1FRE9VVFwiXTtcclxuICAgIHJldHVybiB0YXJnZXRFcnJvcnMuc29tZSgoZSkgPT4gZXJyLm1lc3NhZ2UuaW5jbHVkZXMoZSkpO1xyXG4gIH0sXHJcbn0pO1xyXG5cclxucmVkaXMub24oXCJjb25uZWN0XCIsICgpID0+IGNvbnNvbGUubG9nKFwiUmVkaXMgY29ubmVjdGVkXCIpKTtcclxucmVkaXMub24oXCJyZWFkeVwiLCAoKSA9PiBjb25zb2xlLmxvZyhcIlJlZGlzIHJlYWR5XCIpKTtcclxucmVkaXMub24oXCJlcnJvclwiLCAoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiUmVkaXMgZXJyb3JcIiwgZXJyKSk7XHJcbnJlZGlzLm9uKFwiY2xvc2VcIiwgKCkgPT4gY29uc29sZS53YXJuKFwiUmVkaXMgY29ubmVjdGlvbiBjbG9zZWRcIikpO1xyXG5yZWRpcy5vbihcInJlY29ubmVjdGluZ1wiLCAoKSA9PiBjb25zb2xlLmxvZyhcIlJlZGlzIHJlY29ubmVjdGluZ1wiKSk7XHJcblxyXG4vKipcclxuICogU2luZ2xlLWNoYW5uZWwgc3Vic2NyaXB0aW9uIGhlbHBlclxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHN1YnNjcmliZShcclxuICBjaGFubmVsOiBzdHJpbmcsXHJcbiAgaGFuZGxlcjogKGRhdGE6IGFueSkgPT4gdm9pZFxyXG4pOiAoKSA9PiBQcm9taXNlPHZvaWQ+IHtcclxuICBjb25zdCBzdWIgPSByZWRpcy5kdXBsaWNhdGUoKTtcclxuXHJcbiAgY29uc3Qgb25NZXNzYWdlID0gKGNoOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykgPT4ge1xyXG4gICAgaWYgKGNoICE9PSBjaGFubmVsKSByZXR1cm47XHJcbiAgICB0cnkge1xyXG4gICAgICBoYW5kbGVyKEpTT04ucGFyc2UobWVzc2FnZSkpO1xyXG4gICAgfSBjYXRjaCB7XHJcbiAgICAgIGhhbmRsZXIobWVzc2FnZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgc3ViLm9uKFwibWVzc2FnZVwiLCBvbk1lc3NhZ2UpO1xyXG5cclxuICBzdWIuc3Vic2NyaWJlKGNoYW5uZWwpLmNhdGNoKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUuZXJyb3IoYFJlZGlzIHN1YnNjcmliZSBmYWlsZWQgZm9yICR7Y2hhbm5lbH1gLCBlcnIpO1xyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3ViLm9mZihcIm1lc3NhZ2VcIiwgb25NZXNzYWdlKTtcclxuICAgICAgYXdhaXQgc3ViLnVuc3Vic2NyaWJlKGNoYW5uZWwpO1xyXG4gICAgICBhd2FpdCBzdWIucXVpdCgpO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIHVuc3Vic2NyaWJlIGZyb20gJHtjaGFubmVsfWAsIGVycik7XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIE11bHRpLWNoYW5uZWwgc3Vic2NyaWJlciAod29ya2VyICYgU1NFIHNhZmUpXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3Vic2NyaWJlVG9DaGFubmVscyhcclxuICBzdWI6IElPUmVkaXMsXHJcbiAgY2hhbm5lbHM6IHN0cmluZ1tdLFxyXG4gIGhhbmRsZXI6IChjaGFubmVsOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykgPT4gdm9pZFxyXG4pIHtcclxuICBmb3IgKGNvbnN0IGNoIG9mIGNoYW5uZWxzKSB7XHJcbiAgICBhd2FpdCBzdWIuc3Vic2NyaWJlKGNoKTtcclxuICB9XHJcblxyXG4gIHN1Yi5vbihcIm1lc3NhZ2VcIiwgKGNoYW5uZWwsIG1lc3NhZ2UpID0+IHtcclxuICAgIGlmIChjaGFubmVscy5pbmNsdWRlcyhjaGFubmVsKSkge1xyXG4gICAgICBoYW5kbGVyKGNoYW5uZWwsIG1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJJT1JlZGlzIiwicmVkaXMiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfVVJMIiwibWF4UmV0cmllc1BlclJlcXVlc3QiLCJsYXp5Q29ubmVjdCIsInJlY29ubmVjdE9uRXJyb3IiLCJlcnIiLCJ0YXJnZXRFcnJvcnMiLCJzb21lIiwiZSIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsIm9uIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwid2FybiIsInN1YnNjcmliZSIsImNoYW5uZWwiLCJoYW5kbGVyIiwic3ViIiwiZHVwbGljYXRlIiwib25NZXNzYWdlIiwiY2giLCJKU09OIiwicGFyc2UiLCJjYXRjaCIsIm9mZiIsInVuc3Vic2NyaWJlIiwicXVpdCIsInN1YnNjcmliZVRvQ2hhbm5lbHMiLCJjaGFubmVscyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/redis.ts\n");

/***/ }),

/***/ "(api)/./pages/api/campaign/[id]/insight.ts":
/*!********************************************!*\
  !*** ./pages/api/campaign/[id]/insight.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_mongo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/mongo */ \"(api)/./lib/mongo.ts\");\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../lib/redis */ \"(api)/./lib/redis.ts\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n// pages/api/campaign/[id]/insight.ts\n\n\n\nconst MAX_ATTEMPTS = Number(process.env.MAX_ATTEMPTS || 3);\nasync function handler(req, res) {\n    const { id } = req.query;\n    if (!id || typeof id !== \"string\") {\n        return res.status(400).json({\n            error: \"Invalid campaign id\"\n        });\n    }\n    try {\n        const client = await _lib_mongo__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n        const db = client.db(\"PlatformData\");\n        const campaignId = new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(id);\n        // --- MongoDB: authoritative campaign document ---\n        const campaign = await db.collection(\"campaigns\").findOne({\n            _id: campaignId\n        });\n        if (!campaign) return res.status(404).json({\n            error: \"Campaign not found\"\n        });\n        // --- Redis meta (best-effort, optional) ---\n        let redisMeta = null;\n        try {\n            if (_lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis?.status === \"ready\" || _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.isOpen) {\n                const meta = await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hgetall(`campaign:${id}:meta`);\n                redisMeta = Object.keys(meta).length > 0 ? meta : null;\n            }\n        } catch (e) {\n            console.warn(\"Redis unavailable, falling back to Mongo\", e);\n        }\n        // --- Breakdown from MongoDB ledger (authoritative) ---\n        const aggregation = await db.collection(\"campaign_contacts\").aggregate([\n            {\n                $match: {\n                    campaignId\n                }\n            },\n            {\n                $group: {\n                    _id: \"$status\",\n                    count: {\n                        $sum: 1\n                    }\n                }\n            }\n        ]).toArray();\n        const breakdown = {\n            pending: 0,\n            sent: 0,\n            failed: 0\n        };\n        for (const row of aggregation){\n            if (row._id === \"pending\") breakdown.pending = row.count;\n            else if (row._id === \"sent\") breakdown.sent = row.count;\n            else if (row._id === \"failed\") breakdown.failed = row.count;\n        }\n        // --- Totals derived from breakdown (ensure consistency) ---\n        const totals = {\n            intended: Number(redisMeta?.total ?? campaign.totals?.intended ?? 0),\n            processed: breakdown.sent + breakdown.failed,\n            sent: breakdown.sent,\n            failed: breakdown.failed\n        };\n        // --- Recent failures (same as before) ---\n        const recentFailures = await db.collection(\"campaign_contacts\").find({\n            campaignId,\n            status: \"failed\"\n        }).sort({\n            lastAttemptAt: -1\n        }).limit(10).project({\n            _id: 0,\n            contactId: 1,\n            email: 1,\n            attempts: 1,\n            lastError: 1,\n            lastAttemptAt: 1,\n            bgAttempts: 1\n        }).toArray();\n        // --- Status resolution ---\n        const resolvedStatus = campaign.completedAt ? \"completed\" : redisMeta?.status ?? campaign.status;\n        res.status(200).json({\n            campaign: {\n                id: campaign._id.toString(),\n                name: campaign.name,\n                status: resolvedStatus,\n                createdAt: campaign.createdAt,\n                completedAt: campaign.completedAt ?? null\n            },\n            totals,\n            breakdown,\n            recentFailures: recentFailures.map((f)=>({\n                    contactId: f.contactId?.toString?.() ?? f.contactId,\n                    email: f.email,\n                    attempts: f.attempts,\n                    bgAttempts: typeof f.bgAttempts === \"number\" ? f.bgAttempts : 0,\n                    error: f.lastError ?? null,\n                    lastAttemptAt: f.lastAttemptAt\n                })),\n            // NEW: expose MAX_ATTEMPTS so UI can show attempts / max\n            maxAttempts: MAX_ATTEMPTS\n        });\n    } catch (err) {\n        console.error(\"Insight API error\", err);\n        res.status(500).json({\n            error: \"Internal server error\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvY2FtcGFpZ24vW2lkXS9pbnNpZ2h0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEscUNBQXFDO0FBR2E7QUFDSjtBQUNYO0FBRW5DLE1BQU1HLGVBQWVDLE9BQU9DLFFBQVFDLEdBQUcsQ0FBQ0gsWUFBWSxJQUFJO0FBRXpDLGVBQWVJLFFBQzVCQyxHQUFtQixFQUNuQkMsR0FBb0I7SUFFcEIsTUFBTSxFQUFFQyxFQUFFLEVBQUUsR0FBR0YsSUFBSUcsS0FBSztJQUV4QixJQUFJLENBQUNELE1BQU0sT0FBT0EsT0FBTyxVQUFVO1FBQ2pDLE9BQU9ELElBQUlHLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFzQjtJQUM3RDtJQUVBLElBQUk7UUFDRixNQUFNQyxTQUFTLE1BQU1mLGtEQUFhQTtRQUNsQyxNQUFNZ0IsS0FBS0QsT0FBT0MsRUFBRSxDQUFDO1FBQ3JCLE1BQU1DLGFBQWEsSUFBSWYsNkNBQVFBLENBQUNRO1FBRWhDLG1EQUFtRDtRQUNuRCxNQUFNUSxXQUFXLE1BQU1GLEdBQUdHLFVBQVUsQ0FBQyxhQUFhQyxPQUFPLENBQUM7WUFBRUMsS0FBS0o7UUFBVztRQUM1RSxJQUFJLENBQUNDLFVBQVUsT0FBT1QsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXFCO1FBRXpFLDZDQUE2QztRQUM3QyxJQUFJUSxZQUEyQztRQUMvQyxJQUFJO1lBQ0YsSUFBSXJCLDZDQUFLQSxFQUFFVyxXQUFXLFdBQVcsOENBQWVXLE1BQU0sRUFBRTtnQkFDdEQsTUFBTUMsT0FBTyxNQUFNdkIsNkNBQUtBLENBQUN3QixPQUFPLENBQUMsQ0FBQyxTQUFTLEVBQUVmLEdBQUcsS0FBSyxDQUFDO2dCQUN0RFksWUFBWUksT0FBT0MsSUFBSSxDQUFDSCxNQUFNSSxNQUFNLEdBQUcsSUFBSUosT0FBTztZQUNwRDtRQUNGLEVBQUUsT0FBT0ssR0FBRztZQUNWQyxRQUFRQyxJQUFJLENBQUMsNENBQTRDRjtRQUMzRDtRQUVBLHdEQUF3RDtRQUN4RCxNQUFNRyxjQUFjLE1BQU1oQixHQUN2QkcsVUFBVSxDQUFDLHFCQUNYYyxTQUFTLENBQUM7WUFDVDtnQkFBRUMsUUFBUTtvQkFBRWpCO2dCQUFXO1lBQUU7WUFDekI7Z0JBQUVrQixRQUFRO29CQUFFZCxLQUFLO29CQUFXZSxPQUFPO3dCQUFFQyxNQUFNO29CQUFFO2dCQUFFO1lBQUU7U0FDbEQsRUFDQUMsT0FBTztRQUVWLE1BQU1DLFlBQVk7WUFBRUMsU0FBUztZQUFHQyxNQUFNO1lBQUdDLFFBQVE7UUFBRTtRQUNuRCxLQUFLLE1BQU1DLE9BQU9YLFlBQWE7WUFDN0IsSUFBSVcsSUFBSXRCLEdBQUcsS0FBSyxXQUFXa0IsVUFBVUMsT0FBTyxHQUFHRyxJQUFJUCxLQUFLO2lCQUNuRCxJQUFJTyxJQUFJdEIsR0FBRyxLQUFLLFFBQVFrQixVQUFVRSxJQUFJLEdBQUdFLElBQUlQLEtBQUs7aUJBQ2xELElBQUlPLElBQUl0QixHQUFHLEtBQUssVUFBVWtCLFVBQVVHLE1BQU0sR0FBR0MsSUFBSVAsS0FBSztRQUM3RDtRQUVBLDZEQUE2RDtRQUM3RCxNQUFNUSxTQUFTO1lBQ2JDLFVBQVV6QyxPQUFPa0IsV0FBV3dCLFNBQVM1QixTQUFTMEIsTUFBTSxFQUFFQyxZQUFZO1lBQ2xFRSxXQUFXUixVQUFVRSxJQUFJLEdBQUdGLFVBQVVHLE1BQU07WUFDNUNELE1BQU1GLFVBQVVFLElBQUk7WUFDcEJDLFFBQVFILFVBQVVHLE1BQU07UUFDMUI7UUFFQSwyQ0FBMkM7UUFDM0MsTUFBTU0saUJBQWlCLE1BQU1oQyxHQUMxQkcsVUFBVSxDQUFDLHFCQUNYOEIsSUFBSSxDQUFDO1lBQUVoQztZQUFZTCxRQUFRO1FBQVMsR0FDcENzQyxJQUFJLENBQUM7WUFBRUMsZUFBZSxDQUFDO1FBQUUsR0FDekJDLEtBQUssQ0FBQyxJQUNOQyxPQUFPLENBQUM7WUFBRWhDLEtBQUs7WUFBR2lDLFdBQVc7WUFBR0MsT0FBTztZQUFHQyxVQUFVO1lBQUdDLFdBQVc7WUFBR04sZUFBZTtZQUFHTyxZQUFZO1FBQUUsR0FDckdwQixPQUFPO1FBRVYsNEJBQTRCO1FBQzVCLE1BQU1xQixpQkFBaUJ6QyxTQUFTMEMsV0FBVyxHQUFHLGNBQWN0QyxXQUFXVixVQUFVTSxTQUFTTixNQUFNO1FBRWhHSCxJQUFJRyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQ25CSyxVQUFVO2dCQUNSUixJQUFJUSxTQUFTRyxHQUFHLENBQUN3QyxRQUFRO2dCQUN6QkMsTUFBTTVDLFNBQVM0QyxJQUFJO2dCQUNuQmxELFFBQVErQztnQkFDUkksV0FBVzdDLFNBQVM2QyxTQUFTO2dCQUM3QkgsYUFBYTFDLFNBQVMwQyxXQUFXLElBQUk7WUFDdkM7WUFDQWhCO1lBQ0FMO1lBQ0FTLGdCQUFnQkEsZUFBZWdCLEdBQUcsQ0FBQyxDQUFDQyxJQUFPO29CQUN6Q1gsV0FBV1csRUFBRVgsU0FBUyxFQUFFTyxnQkFBZ0JJLEVBQUVYLFNBQVM7b0JBQ25EQyxPQUFPVSxFQUFFVixLQUFLO29CQUNkQyxVQUFVUyxFQUFFVCxRQUFRO29CQUNwQkUsWUFBWSxPQUFPTyxFQUFFUCxVQUFVLEtBQUssV0FBV08sRUFBRVAsVUFBVSxHQUFHO29CQUM5RDVDLE9BQU9tRCxFQUFFUixTQUFTLElBQUk7b0JBQ3RCTixlQUFlYyxFQUFFZCxhQUFhO2dCQUNoQztZQUNBLHlEQUF5RDtZQUN6RGUsYUFBYS9EO1FBQ2Y7SUFDRixFQUFFLE9BQU9nRSxLQUFLO1FBQ1pyQyxRQUFRaEIsS0FBSyxDQUFDLHFCQUFxQnFEO1FBQ25DMUQsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXdCO0lBQ3hEO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vcGFnZXMvYXBpL2NhbXBhaWduL1tpZF0vaW5zaWdodC50cz9kYTg0Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIHBhZ2VzL2FwaS9jYW1wYWlnbi9baWRdL2luc2lnaHQudHNcclxuXHJcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgY2xpZW50UHJvbWlzZSBmcm9tICcuLi8uLi8uLi8uLi9saWIvbW9uZ28nO1xyXG5pbXBvcnQgeyByZWRpcyB9IGZyb20gJy4uLy4uLy4uLy4uL2xpYi9yZWRpcyc7XHJcbmltcG9ydCB7IE9iamVjdElkIH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCBNQVhfQVRURU1QVFMgPSBOdW1iZXIocHJvY2Vzcy5lbnYuTUFYX0FUVEVNUFRTIHx8IDMpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihcclxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxyXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlXHJcbikge1xyXG4gIGNvbnN0IHsgaWQgfSA9IHJlcS5xdWVyeTtcclxuXHJcbiAgaWYgKCFpZCB8fCB0eXBlb2YgaWQgIT09ICdzdHJpbmcnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgY2FtcGFpZ24gaWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IGNsaWVudFByb21pc2U7XHJcbiAgICBjb25zdCBkYiA9IGNsaWVudC5kYignUGxhdGZvcm1EYXRhJyk7XHJcbiAgICBjb25zdCBjYW1wYWlnbklkID0gbmV3IE9iamVjdElkKGlkKTtcclxuXHJcbiAgICAvLyAtLS0gTW9uZ29EQjogYXV0aG9yaXRhdGl2ZSBjYW1wYWlnbiBkb2N1bWVudCAtLS1cclxuICAgIGNvbnN0IGNhbXBhaWduID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25zJykuZmluZE9uZSh7IF9pZDogY2FtcGFpZ25JZCB9KTtcclxuICAgIGlmICghY2FtcGFpZ24pIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnQ2FtcGFpZ24gbm90IGZvdW5kJyB9KTtcclxuXHJcbiAgICAvLyAtLS0gUmVkaXMgbWV0YSAoYmVzdC1lZmZvcnQsIG9wdGlvbmFsKSAtLS1cclxuICAgIGxldCByZWRpc01ldGE6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCBudWxsID0gbnVsbDtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChyZWRpcz8uc3RhdHVzID09PSAncmVhZHknIHx8IChyZWRpcyBhcyBhbnkpLmlzT3Blbikge1xyXG4gICAgICAgIGNvbnN0IG1ldGEgPSBhd2FpdCByZWRpcy5oZ2V0YWxsKGBjYW1wYWlnbjoke2lkfTptZXRhYCk7XHJcbiAgICAgICAgcmVkaXNNZXRhID0gT2JqZWN0LmtleXMobWV0YSkubGVuZ3RoID4gMCA/IG1ldGEgOiBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignUmVkaXMgdW5hdmFpbGFibGUsIGZhbGxpbmcgYmFjayB0byBNb25nbycsIGUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIC0tLSBCcmVha2Rvd24gZnJvbSBNb25nb0RCIGxlZGdlciAoYXV0aG9yaXRhdGl2ZSkgLS0tXHJcbiAgICBjb25zdCBhZ2dyZWdhdGlvbiA9IGF3YWl0IGRiXHJcbiAgICAgIC5jb2xsZWN0aW9uKCdjYW1wYWlnbl9jb250YWN0cycpXHJcbiAgICAgIC5hZ2dyZWdhdGUoW1xyXG4gICAgICAgIHsgJG1hdGNoOiB7IGNhbXBhaWduSWQgfSB9LFxyXG4gICAgICAgIHsgJGdyb3VwOiB7IF9pZDogJyRzdGF0dXMnLCBjb3VudDogeyAkc3VtOiAxIH0gfSB9LFxyXG4gICAgICBdKVxyXG4gICAgICAudG9BcnJheSgpO1xyXG5cclxuICAgIGNvbnN0IGJyZWFrZG93biA9IHsgcGVuZGluZzogMCwgc2VudDogMCwgZmFpbGVkOiAwIH07XHJcbiAgICBmb3IgKGNvbnN0IHJvdyBvZiBhZ2dyZWdhdGlvbikge1xyXG4gICAgICBpZiAocm93Ll9pZCA9PT0gJ3BlbmRpbmcnKSBicmVha2Rvd24ucGVuZGluZyA9IHJvdy5jb3VudDtcclxuICAgICAgZWxzZSBpZiAocm93Ll9pZCA9PT0gJ3NlbnQnKSBicmVha2Rvd24uc2VudCA9IHJvdy5jb3VudDtcclxuICAgICAgZWxzZSBpZiAocm93Ll9pZCA9PT0gJ2ZhaWxlZCcpIGJyZWFrZG93bi5mYWlsZWQgPSByb3cuY291bnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gLS0tIFRvdGFscyBkZXJpdmVkIGZyb20gYnJlYWtkb3duIChlbnN1cmUgY29uc2lzdGVuY3kpIC0tLVxyXG4gICAgY29uc3QgdG90YWxzID0ge1xyXG4gICAgICBpbnRlbmRlZDogTnVtYmVyKHJlZGlzTWV0YT8udG90YWwgPz8gY2FtcGFpZ24udG90YWxzPy5pbnRlbmRlZCA/PyAwKSxcclxuICAgICAgcHJvY2Vzc2VkOiBicmVha2Rvd24uc2VudCArIGJyZWFrZG93bi5mYWlsZWQsXHJcbiAgICAgIHNlbnQ6IGJyZWFrZG93bi5zZW50LFxyXG4gICAgICBmYWlsZWQ6IGJyZWFrZG93bi5mYWlsZWQsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLSBSZWNlbnQgZmFpbHVyZXMgKHNhbWUgYXMgYmVmb3JlKSAtLS1cclxuICAgIGNvbnN0IHJlY2VudEZhaWx1cmVzID0gYXdhaXQgZGJcclxuICAgICAgLmNvbGxlY3Rpb24oJ2NhbXBhaWduX2NvbnRhY3RzJylcclxuICAgICAgLmZpbmQoeyBjYW1wYWlnbklkLCBzdGF0dXM6ICdmYWlsZWQnIH0pXHJcbiAgICAgIC5zb3J0KHsgbGFzdEF0dGVtcHRBdDogLTEgfSlcclxuICAgICAgLmxpbWl0KDEwKVxyXG4gICAgICAucHJvamVjdCh7IF9pZDogMCwgY29udGFjdElkOiAxLCBlbWFpbDogMSwgYXR0ZW1wdHM6IDEsIGxhc3RFcnJvcjogMSwgbGFzdEF0dGVtcHRBdDogMSwgYmdBdHRlbXB0czogMSB9KVxyXG4gICAgICAudG9BcnJheSgpO1xyXG5cclxuICAgIC8vIC0tLSBTdGF0dXMgcmVzb2x1dGlvbiAtLS1cclxuICAgIGNvbnN0IHJlc29sdmVkU3RhdHVzID0gY2FtcGFpZ24uY29tcGxldGVkQXQgPyAnY29tcGxldGVkJyA6IHJlZGlzTWV0YT8uc3RhdHVzID8/IGNhbXBhaWduLnN0YXR1cztcclxuXHJcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIGNhbXBhaWduOiB7XHJcbiAgICAgICAgaWQ6IGNhbXBhaWduLl9pZC50b1N0cmluZygpLFxyXG4gICAgICAgIG5hbWU6IGNhbXBhaWduLm5hbWUsXHJcbiAgICAgICAgc3RhdHVzOiByZXNvbHZlZFN0YXR1cyxcclxuICAgICAgICBjcmVhdGVkQXQ6IGNhbXBhaWduLmNyZWF0ZWRBdCxcclxuICAgICAgICBjb21wbGV0ZWRBdDogY2FtcGFpZ24uY29tcGxldGVkQXQgPz8gbnVsbCxcclxuICAgICAgfSxcclxuICAgICAgdG90YWxzLFxyXG4gICAgICBicmVha2Rvd24sXHJcbiAgICAgIHJlY2VudEZhaWx1cmVzOiByZWNlbnRGYWlsdXJlcy5tYXAoKGYpID0+ICh7XHJcbiAgICAgICAgY29udGFjdElkOiBmLmNvbnRhY3RJZD8udG9TdHJpbmc/LigpID8/IGYuY29udGFjdElkLFxyXG4gICAgICAgIGVtYWlsOiBmLmVtYWlsLFxyXG4gICAgICAgIGF0dGVtcHRzOiBmLmF0dGVtcHRzLFxyXG4gICAgICAgIGJnQXR0ZW1wdHM6IHR5cGVvZiBmLmJnQXR0ZW1wdHMgPT09ICdudW1iZXInID8gZi5iZ0F0dGVtcHRzIDogMCxcclxuICAgICAgICBlcnJvcjogZi5sYXN0RXJyb3IgPz8gbnVsbCxcclxuICAgICAgICBsYXN0QXR0ZW1wdEF0OiBmLmxhc3RBdHRlbXB0QXQsXHJcbiAgICAgIH0pKSxcclxuICAgICAgLy8gTkVXOiBleHBvc2UgTUFYX0FUVEVNUFRTIHNvIFVJIGNhbiBzaG93IGF0dGVtcHRzIC8gbWF4XHJcbiAgICAgIG1heEF0dGVtcHRzOiBNQVhfQVRURU1QVFMsXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0luc2lnaHQgQVBJIGVycm9yJywgZXJyKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiY2xpZW50UHJvbWlzZSIsInJlZGlzIiwiT2JqZWN0SWQiLCJNQVhfQVRURU1QVFMiLCJOdW1iZXIiLCJwcm9jZXNzIiwiZW52IiwiaGFuZGxlciIsInJlcSIsInJlcyIsImlkIiwicXVlcnkiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJjbGllbnQiLCJkYiIsImNhbXBhaWduSWQiLCJjYW1wYWlnbiIsImNvbGxlY3Rpb24iLCJmaW5kT25lIiwiX2lkIiwicmVkaXNNZXRhIiwiaXNPcGVuIiwibWV0YSIsImhnZXRhbGwiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwiZSIsImNvbnNvbGUiLCJ3YXJuIiwiYWdncmVnYXRpb24iLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCIkZ3JvdXAiLCJjb3VudCIsIiRzdW0iLCJ0b0FycmF5IiwiYnJlYWtkb3duIiwicGVuZGluZyIsInNlbnQiLCJmYWlsZWQiLCJyb3ciLCJ0b3RhbHMiLCJpbnRlbmRlZCIsInRvdGFsIiwicHJvY2Vzc2VkIiwicmVjZW50RmFpbHVyZXMiLCJmaW5kIiwic29ydCIsImxhc3RBdHRlbXB0QXQiLCJsaW1pdCIsInByb2plY3QiLCJjb250YWN0SWQiLCJlbWFpbCIsImF0dGVtcHRzIiwibGFzdEVycm9yIiwiYmdBdHRlbXB0cyIsInJlc29sdmVkU3RhdHVzIiwiY29tcGxldGVkQXQiLCJ0b1N0cmluZyIsIm5hbWUiLCJjcmVhdGVkQXQiLCJtYXAiLCJmIiwibWF4QXR0ZW1wdHMiLCJlcnIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/campaign/[id]/insight.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Finsight&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Cinsight.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();