"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/campaign/[id]/control";
exports.ids = ["pages/api/campaign/[id]/control"];
exports.modules = {

/***/ "bullmq":
/*!*************************!*\
  !*** external "bullmq" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("bullmq");

/***/ }),

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fcontrol&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Ccontrol.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fcontrol&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Ccontrol.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_campaign_id_control_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\campaign\\[id]\\control.ts */ \"(api)/./pages/api/campaign/[id]/control.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_id_control_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_id_control_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/campaign/[id]/control\",\n        pathname: \"/api/campaign/[id]/control\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_campaign_id_control_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNhbXBhaWduJTJGJTVCaWQlNUQlMkZjb250cm9sJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNjYW1wYWlnbiU1QyU1QmlkJTVEJTVDY29udHJvbC50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNxRTtBQUNyRTtBQUNBLGlFQUFlLHdFQUFLLENBQUMsOERBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLDhEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL21hcmtldGluZy1tdnAvPzhjNzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxjYW1wYWlnblxcXFxbaWRdXFxcXGNvbnRyb2wudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jYW1wYWlnbi9baWRdL2NvbnRyb2xcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jYW1wYWlnbi9baWRdL2NvbnRyb2xcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fcontrol&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Ccontrol.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/mongo.ts":
/*!**********************!*\
  !*** ./lib/mongo.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst uri = process.env.MONGODB_URI;\nif (!uri) throw new Error(\"MONGODB_URI not set\");\nlet client;\nlet clientPromise;\nif (!global._mongoClientPromise) {\n    client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, {\n        maxPoolSize: 10,\n        serverSelectionTimeoutMS: 5000,\n        socketTimeoutMS: 45000\n    });\n    // Connect immediately but reuse promise globally\n    global._mongoClientPromise = client.connect();\n    // Optional: log connection events\n    client.on(\"serverOpening\", (event)=>console.log(\"MongoDB server opening\", event));\n    client.on(\"serverClosed\", (event)=>console.warn(\"MongoDB server closed\", event));\n    client.on(\"topologyClosed\", ()=>console.warn(\"MongoDB topology closed\"));\n    client.on(\"topologyOpening\", ()=>console.log(\"MongoDB topology opening\"));\n    client.on(\"error\", (err)=>console.error(\"MongoDB error\", err));\n}\nclientPromise = global._mongoClientPromise;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvbW9uZ28udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXNDO0FBRXRDLE1BQU1DLE1BQU1DLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVztBQUNuQyxJQUFJLENBQUNILEtBQUssTUFBTSxJQUFJSSxNQUFNO0FBRTFCLElBQUlDO0FBQ0osSUFBSUM7QUFPSixJQUFJLENBQUNDLE9BQU9DLG1CQUFtQixFQUFFO0lBQy9CSCxTQUFTLElBQUlOLGdEQUFXQSxDQUFDQyxLQUFLO1FBQzVCUyxhQUFhO1FBQ2JDLDBCQUEwQjtRQUMxQkMsaUJBQWlCO0lBRW5CO0lBRUEsaURBQWlEO0lBQ2pESixPQUFPQyxtQkFBbUIsR0FBR0gsT0FBT08sT0FBTztJQUUzQyxrQ0FBa0M7SUFDbENQLE9BQU9RLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQ0MsUUFBVUMsUUFBUUMsR0FBRyxDQUFDLDBCQUEwQkY7SUFDNUVULE9BQU9RLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQ0MsUUFBVUMsUUFBUUUsSUFBSSxDQUFDLHlCQUF5Qkg7SUFDM0VULE9BQU9RLEVBQUUsQ0FBQyxrQkFBa0IsSUFBTUUsUUFBUUUsSUFBSSxDQUFDO0lBQy9DWixPQUFPUSxFQUFFLENBQUMsbUJBQW1CLElBQU1FLFFBQVFDLEdBQUcsQ0FBQztJQUMvQ1gsT0FBT1EsRUFBRSxDQUFDLFNBQVMsQ0FBQ0ssTUFBUUgsUUFBUUksS0FBSyxDQUFDLGlCQUFpQkQ7QUFDN0Q7QUFFQVosZ0JBQWdCQyxPQUFPQyxtQkFBbUI7QUFFMUMsaUVBQWVGLGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vbGliL21vbmdvLnRzPzU3ZmUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9uZ29DbGllbnQgfSBmcm9tICdtb25nb2RiJztcclxuXHJcbmNvbnN0IHVyaSA9IHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJO1xyXG5pZiAoIXVyaSkgdGhyb3cgbmV3IEVycm9yKCdNT05HT0RCX1VSSSBub3Qgc2V0Jyk7XHJcblxyXG5sZXQgY2xpZW50OiBNb25nb0NsaWVudDtcclxubGV0IGNsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+O1xyXG5cclxuZGVjbGFyZSBnbG9iYWwge1xyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby12YXJcclxuICB2YXIgX21vbmdvQ2xpZW50UHJvbWlzZTogUHJvbWlzZTxNb25nb0NsaWVudD4gfCB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmlmICghZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UpIHtcclxuICBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpLCB7XHJcbiAgICBtYXhQb29sU2l6ZTogMTAsXHJcbiAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDUwMDAsXHJcbiAgICBzb2NrZXRUaW1lb3V0TVM6IDQ1MDAwLFxyXG4gICAgLy8gdXNlVW5pZmllZFRvcG9sb2d5IGlzIGRlZmF1bHQgaW4gbW9kZXJuIGRyaXZlcnNcclxuICB9KTtcclxuXHJcbiAgLy8gQ29ubmVjdCBpbW1lZGlhdGVseSBidXQgcmV1c2UgcHJvbWlzZSBnbG9iYWxseVxyXG4gIGdsb2JhbC5fbW9uZ29DbGllbnRQcm9taXNlID0gY2xpZW50LmNvbm5lY3QoKTtcclxuXHJcbiAgLy8gT3B0aW9uYWw6IGxvZyBjb25uZWN0aW9uIGV2ZW50c1xyXG4gIGNsaWVudC5vbignc2VydmVyT3BlbmluZycsIChldmVudCkgPT4gY29uc29sZS5sb2coJ01vbmdvREIgc2VydmVyIG9wZW5pbmcnLCBldmVudCkpO1xyXG4gIGNsaWVudC5vbignc2VydmVyQ2xvc2VkJywgKGV2ZW50KSA9PiBjb25zb2xlLndhcm4oJ01vbmdvREIgc2VydmVyIGNsb3NlZCcsIGV2ZW50KSk7XHJcbiAgY2xpZW50Lm9uKCd0b3BvbG9neUNsb3NlZCcsICgpID0+IGNvbnNvbGUud2FybignTW9uZ29EQiB0b3BvbG9neSBjbG9zZWQnKSk7XHJcbiAgY2xpZW50Lm9uKCd0b3BvbG9neU9wZW5pbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnTW9uZ29EQiB0b3BvbG9neSBvcGVuaW5nJykpO1xyXG4gIGNsaWVudC5vbignZXJyb3InLCAoZXJyKSA9PiBjb25zb2xlLmVycm9yKCdNb25nb0RCIGVycm9yJywgZXJyKSk7XHJcbn1cclxuXHJcbmNsaWVudFByb21pc2UgPSBnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsaWVudFByb21pc2U7XHJcbiJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwiY2xpZW50IiwiY2xpZW50UHJvbWlzZSIsImdsb2JhbCIsIl9tb25nb0NsaWVudFByb21pc2UiLCJtYXhQb29sU2l6ZSIsInNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyIsInNvY2tldFRpbWVvdXRNUyIsImNvbm5lY3QiLCJvbiIsImV2ZW50IiwiY29uc29sZSIsImxvZyIsIndhcm4iLCJlcnIiLCJlcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/mongo.ts\n");

/***/ }),

/***/ "(api)/./lib/redis.ts":
/*!**********************!*\
  !*** ./lib/redis.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   redis: () => (/* binding */ redis)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(process.env.REDIS_URL || \"redis://127.0.0.1:6379\", {\n    maxRetriesPerRequest: null,\n    lazyConnect: true,\n    reconnectOnError: (err)=>{\n        // reconnect on most errors\n        const targetErrors = [\n            \"READONLY\",\n            \"ECONNRESET\",\n            \"ETIMEDOUT\"\n        ];\n        if (targetErrors.some((e)=>err.message.includes(e))) return true;\n        return false;\n    }\n});\n// Optional: log Redis connection events for observability\nredis.on(\"connect\", ()=>console.log(\"Redis connected\"));\nredis.on(\"ready\", ()=>console.log(\"Redis ready\"));\nredis.on(\"error\", (err)=>console.error(\"Redis error\", err));\nredis.on(\"close\", ()=>console.warn(\"Redis connection closed\"));\nredis.on(\"reconnecting\", ()=>console.log(\"Redis reconnecting\"));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvcmVkaXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQThCO0FBRXZCLE1BQU1DLFFBQVEsSUFBSUQsZ0RBQU9BLENBQUNFLFFBQVFDLEdBQUcsQ0FBQ0MsU0FBUyxJQUFJLDBCQUEwQjtJQUNsRkMsc0JBQXNCO0lBQ3RCQyxhQUFhO0lBQ2JDLGtCQUFrQixDQUFDQztRQUNqQiwyQkFBMkI7UUFDM0IsTUFBTUMsZUFBZTtZQUFDO1lBQVk7WUFBYztTQUFZO1FBQzVELElBQUlBLGFBQWFDLElBQUksQ0FBQ0MsQ0FBQUEsSUFBS0gsSUFBSUksT0FBTyxDQUFDQyxRQUFRLENBQUNGLEtBQUssT0FBTztRQUM1RCxPQUFPO0lBQ1Q7QUFDRixHQUFHO0FBRUgsMERBQTBEO0FBQzFEVixNQUFNYSxFQUFFLENBQUMsV0FBVyxJQUFNQyxRQUFRQyxHQUFHLENBQUM7QUFDdENmLE1BQU1hLEVBQUUsQ0FBQyxTQUFTLElBQU1DLFFBQVFDLEdBQUcsQ0FBQztBQUNwQ2YsTUFBTWEsRUFBRSxDQUFDLFNBQVMsQ0FBQ04sTUFBUU8sUUFBUUUsS0FBSyxDQUFDLGVBQWVUO0FBQ3hEUCxNQUFNYSxFQUFFLENBQUMsU0FBUyxJQUFNQyxRQUFRRyxJQUFJLENBQUM7QUFDckNqQixNQUFNYSxFQUFFLENBQUMsZ0JBQWdCLElBQU1DLFFBQVFDLEdBQUcsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL21hcmtldGluZy1tdnAvLi9saWIvcmVkaXMudHM/NTFlOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSU9SZWRpcyBmcm9tICdpb3JlZGlzJztcblxuZXhwb3J0IGNvbnN0IHJlZGlzID0gbmV3IElPUmVkaXMocHJvY2Vzcy5lbnYuUkVESVNfVVJMIHx8ICdyZWRpczovLzEyNy4wLjAuMTo2Mzc5Jywge1xuICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogbnVsbCxcbiAgbGF6eUNvbm5lY3Q6IHRydWUsICAgICAgICAgICAvLyBwcmV2ZW50cyBpbW1lZGlhdGUgY29ubmVjdGlvbiBvbiBpbXBvcnRcbiAgcmVjb25uZWN0T25FcnJvcjogKGVycikgPT4ge1xuICAgIC8vIHJlY29ubmVjdCBvbiBtb3N0IGVycm9yc1xuICAgIGNvbnN0IHRhcmdldEVycm9ycyA9IFsnUkVBRE9OTFknLCAnRUNPTk5SRVNFVCcsICdFVElNRURPVVQnXTtcbiAgICBpZiAodGFyZ2V0RXJyb3JzLnNvbWUoZSA9PiBlcnIubWVzc2FnZS5pbmNsdWRlcyhlKSkpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbn0pO1xuXG4vLyBPcHRpb25hbDogbG9nIFJlZGlzIGNvbm5lY3Rpb24gZXZlbnRzIGZvciBvYnNlcnZhYmlsaXR5XG5yZWRpcy5vbignY29ubmVjdCcsICgpID0+IGNvbnNvbGUubG9nKCdSZWRpcyBjb25uZWN0ZWQnKSk7XG5yZWRpcy5vbigncmVhZHknLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgcmVhZHknKSk7XG5yZWRpcy5vbignZXJyb3InLCAoZXJyKSA9PiBjb25zb2xlLmVycm9yKCdSZWRpcyBlcnJvcicsIGVycikpO1xucmVkaXMub24oJ2Nsb3NlJywgKCkgPT4gY29uc29sZS53YXJuKCdSZWRpcyBjb25uZWN0aW9uIGNsb3NlZCcpKTtcbnJlZGlzLm9uKCdyZWNvbm5lY3RpbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgcmVjb25uZWN0aW5nJykpOyJdLCJuYW1lcyI6WyJJT1JlZGlzIiwicmVkaXMiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfVVJMIiwibWF4UmV0cmllc1BlclJlcXVlc3QiLCJsYXp5Q29ubmVjdCIsInJlY29ubmVjdE9uRXJyb3IiLCJlcnIiLCJ0YXJnZXRFcnJvcnMiLCJzb21lIiwiZSIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsIm9uIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwid2FybiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/redis.ts\n");

/***/ }),

/***/ "(api)/./pages/api/campaign/[id]/control.ts":
/*!********************************************!*\
  !*** ./pages/api/campaign/[id]/control.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_mongo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/mongo */ \"(api)/./lib/mongo.ts\");\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../lib/redis */ \"(api)/./lib/redis.ts\");\n/* harmony import */ var bullmq__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! bullmq */ \"bullmq\");\n/* harmony import */ var bullmq__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(bullmq__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_3__);\n// pages/api/campaign/[id]/control.ts\n\n\n\n\nconst queue = new bullmq__WEBPACK_IMPORTED_MODULE_2__.Queue(\"campaigns\", {\n    connection: _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis\n});\nasync function safeHSet(key, obj) {\n    try {\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hset(key, obj);\n    } catch (err) {\n        console.warn(\"Redis unavailable while setting meta\", err);\n    }\n}\nasync function safePublish(channel, payload) {\n    try {\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.publish(channel, JSON.stringify(payload));\n    } catch (err) {\n        console.warn(\"Redis publish failed\", err);\n    }\n}\n// Remove waiting/delayed/active jobs for a campaignId (best-effort)\nasync function removeQueuedJobsForCampaign(campaignId) {\n    try {\n        // get waiting/delayed/active jobs\n        const jobs = await queue.getJobs([\n            \"waiting\",\n            \"delayed\",\n            \"active\",\n            \"paused\"\n        ], 0, -1);\n        const matched = jobs.filter((j)=>{\n            try {\n                return j.data?.campaignId === campaignId;\n            } catch  {\n                return false;\n            }\n        });\n        for (const j of matched){\n            try {\n                // if the job is active, remove may fail - still try\n                await j.remove();\n            } catch (e) {\n                // best-effort — ignore\n                console.warn(`Failed to remove job ${j.id}`, e);\n            }\n        }\n        return matched.length;\n    } catch (err) {\n        console.warn(\"Failed to enumerate/remove jobs for campaign\", err);\n        return 0;\n    }\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    const { id } = req.query;\n    if (!id || typeof id !== \"string\") {\n        return res.status(400).json({\n            error: \"Invalid campaign id\"\n        });\n    }\n    const { action, confirm } = req.body;\n    if (!action || ![\n        \"pause\",\n        \"resume\",\n        \"cancel\",\n        \"delete\"\n    ].includes(action)) {\n        return res.status(400).json({\n            error: \"Invalid action\"\n        });\n    }\n    const client = await _lib_mongo__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n    const db = client.db(\"PlatformData\");\n    const campaignObjectId = new mongodb__WEBPACK_IMPORTED_MODULE_3__.ObjectId(id);\n    try {\n        // Reload campaign from Mongo (authoritative)\n        const campaign = await db.collection(\"campaigns\").findOne({\n            _id: campaignObjectId\n        });\n        if (!campaign) {\n            return res.status(404).json({\n                error: \"Campaign not found\"\n            });\n        }\n        // Lightweight helpers\n        const redisKey = `campaign:${id}:meta`;\n        // ACTION: Pause\n        if (action === \"pause\") {\n            if (campaign.status === \"paused\") {\n                return res.status(200).json({\n                    ok: true,\n                    message: \"Already paused\"\n                });\n            }\n            await db.collection(\"campaigns\").updateOne({\n                _id: campaignObjectId\n            }, {\n                $set: {\n                    status: \"paused\"\n                }\n            });\n            await safeHSet(redisKey, {\n                status: \"paused\"\n            });\n            await safePublish(\"campaign:new\", {\n                id,\n                status: \"paused\"\n            });\n            return res.status(200).json({\n                ok: true,\n                action: \"paused\"\n            });\n        }\n        // ACTION: Resume\n        if (action === \"resume\") {\n            if (campaign.status === \"running\") {\n                return res.status(200).json({\n                    ok: true,\n                    message: \"Already running\"\n                });\n            }\n            await db.collection(\"campaigns\").updateOne({\n                _id: campaignObjectId\n            }, {\n                $set: {\n                    status: \"running\"\n                }\n            });\n            await safeHSet(redisKey, {\n                status: \"running\"\n            });\n            await safePublish(\"campaign:new\", {\n                id,\n                status: \"running\"\n            });\n            return res.status(200).json({\n                ok: true,\n                action: \"resumed\"\n            });\n        }\n        // ACTION: Cancel\n        if (action === \"cancel\") {\n            if (campaign.status === \"cancelled\") {\n                return res.status(200).json({\n                    ok: true,\n                    message: \"Already cancelled\"\n                });\n            }\n            // 1) Mark campaign cancelled and completedAt\n            const completedAt = new Date();\n            await db.collection(\"campaigns\").updateOne({\n                _id: campaignObjectId\n            }, {\n                $set: {\n                    status: \"cancelled\",\n                    completedAt\n                }\n            });\n            await safeHSet(redisKey, {\n                status: \"cancelled\"\n            });\n            // 2) Find and atomically mark pending ledger rows as failed (single updateMany)\n            const filter = {\n                campaignId: campaignObjectId,\n                status: \"pending\"\n            };\n            const update = {\n                $set: {\n                    status: \"failed\",\n                    lastError: \"cancelled\",\n                    lastAttemptAt: completedAt\n                },\n                $inc: {\n                    attempts: 1\n                }\n            };\n            const updateResult = await db.collection(\"campaign_contacts\").updateMany(filter, update);\n            const cancelledCount = updateResult.modifiedCount ?? 0;\n            // 3) Update Redis counters (best-effort)\n            try {\n                if (cancelledCount > 0) {\n                    await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hincrby(redisKey, \"processed\", cancelledCount);\n                    await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hincrby(redisKey, \"failed\", cancelledCount);\n                }\n            } catch (e) {\n                console.warn(\"Failed to update redis counters during cancel\", e);\n            }\n            // 4) Persist totals snapshot to campaigns.totals (read redis if available, fallback to db)\n            let meta = {};\n            try {\n                meta = await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hgetall(redisKey) || {};\n            } catch  {\n                meta = {};\n            }\n            // Compute totals final values combining persisted totals and our cancelledCount as fallback\n            const processedNow = Number(meta[\"processed\"] ?? (campaign.totals?.processed ?? 0) + cancelledCount);\n            const sentNow = Number(meta[\"sent\"] ?? campaign.totals?.sent ?? 0);\n            const failedNow = Number(meta[\"failed\"] ?? (campaign.totals?.failed ?? 0) + cancelledCount);\n            await db.collection(\"campaigns\").updateOne({\n                _id: campaignObjectId\n            }, {\n                $set: {\n                    \"totals.processed\": processedNow,\n                    \"totals.sent\": sentNow,\n                    \"totals.failed\": failedNow,\n                    completedAt\n                }\n            });\n            // 5) Remove queued jobs for this campaign (best-effort)\n            const removedJobs = await removeQueuedJobsForCampaign(id);\n            // 6) Publish event\n            await safePublish(\"campaign:new\", {\n                id,\n                status: \"cancelled\",\n                cancelledCount,\n                removedJobs\n            });\n            return res.status(200).json({\n                ok: true,\n                action: \"cancelled\",\n                cancelledCount,\n                removedJobs\n            });\n        }\n        // ACTION: Delete\n        if (action === \"delete\") {\n            // Require explicit confirmation — safeguards in UI must set confirm=true\n            if (confirm !== true) {\n                return res.status(400).json({\n                    error: \"Deletion requires confirm=true in request body\"\n                });\n            }\n            // Prevent accidental deletion while running\n            if (campaign.status === \"running\") {\n                return res.status(400).json({\n                    error: \"Cancel the campaign before deletion\"\n                });\n            }\n            // Remove queued jobs (best-effort)\n            const removedJobs = await removeQueuedJobsForCampaign(id);\n            // Delete Redis keys (best-effort)\n            try {\n                await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.del(`campaign:${id}:meta`);\n                await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.del(`campaign:${id}:definition`);\n                await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.srem(\"campaign:all\", id);\n            } catch (e) {\n                console.warn(\"Redis cleanup on delete failed\", e);\n            }\n            // Delete Mongo docs\n            const [campaignDel, ledgerDel] = await Promise.all([\n                db.collection(\"campaigns\").deleteOne({\n                    _id: campaignObjectId\n                }),\n                db.collection(\"campaign_contacts\").deleteMany({\n                    campaignId: campaignObjectId\n                })\n            ]);\n            await safePublish(\"campaign:new\", {\n                id,\n                status: \"deleted\"\n            });\n            return res.status(200).json({\n                ok: true,\n                action: \"deleted\",\n                campaignDeleted: campaignDel.deletedCount ?? 0,\n                ledgerDeleted: ledgerDel.deletedCount ?? 0,\n                removedJobs\n            });\n        }\n        // Should not reach here\n        return res.status(400).json({\n            error: \"Unsupported action\"\n        });\n    } catch (err) {\n        console.error(\"Campaign control error\", err);\n        return res.status(500).json({\n            error: \"Internal server error\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvY2FtcGFpZ24vW2lkXS9jb250cm9sLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxxQ0FBcUM7QUFFYTtBQUNKO0FBQ2Y7QUFDSTtBQUVuQyxNQUFNSSxRQUFRLElBQUlGLHlDQUFLQSxDQUFDLGFBQWE7SUFBRUcsWUFBWUosNkNBQUtBO0FBQUM7QUFJekQsZUFBZUssU0FBU0MsR0FBVyxFQUFFQyxHQUEyQjtJQUM5RCxJQUFJO1FBQ0YsTUFBTVAsNkNBQUtBLENBQUNRLElBQUksQ0FBQ0YsS0FBS0M7SUFDeEIsRUFBRSxPQUFPRSxLQUFLO1FBQ1pDLFFBQVFDLElBQUksQ0FBQyx3Q0FBd0NGO0lBQ3ZEO0FBQ0Y7QUFFQSxlQUFlRyxZQUFZQyxPQUFlLEVBQUVDLE9BQVk7SUFDdEQsSUFBSTtRQUNGLE1BQU1kLDZDQUFLQSxDQUFDZSxPQUFPLENBQUNGLFNBQVNHLEtBQUtDLFNBQVMsQ0FBQ0g7SUFDOUMsRUFBRSxPQUFPTCxLQUFLO1FBQ1pDLFFBQVFDLElBQUksQ0FBQyx3QkFBd0JGO0lBQ3ZDO0FBQ0Y7QUFFQSxvRUFBb0U7QUFDcEUsZUFBZVMsNEJBQTRCQyxVQUFrQjtJQUMzRCxJQUFJO1FBQ0Ysa0NBQWtDO1FBQ2xDLE1BQU1DLE9BQU8sTUFBTWpCLE1BQU1rQixPQUFPLENBQzlCO1lBQUM7WUFBVztZQUFXO1lBQVU7U0FBUyxFQUMxQyxHQUNBLENBQUM7UUFHSCxNQUFNQyxVQUFVRixLQUFLRyxNQUFNLENBQUMsQ0FBQ0M7WUFDM0IsSUFBSTtnQkFDRixPQUFPQSxFQUFFQyxJQUFJLEVBQUVOLGVBQWVBO1lBQ2hDLEVBQUUsT0FBTTtnQkFDTixPQUFPO1lBQ1Q7UUFDRjtRQUVBLEtBQUssTUFBTUssS0FBS0YsUUFBUztZQUN2QixJQUFJO2dCQUNGLG9EQUFvRDtnQkFDcEQsTUFBTUUsRUFBRUUsTUFBTTtZQUNoQixFQUFFLE9BQU9DLEdBQUc7Z0JBQ1YsdUJBQXVCO2dCQUN2QmpCLFFBQVFDLElBQUksQ0FBQyxD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Q0FBQywwQkFBMEIzQjtRQUN4QyxPQUFPdUIsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXdCO0lBQy9EO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vcGFnZXMvYXBpL2NhbXBhaWduL1tpZF0vY29udHJvbC50cz82NzE2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIHBhZ2VzL2FwaS9jYW1wYWlnbi9baWRdL2NvbnRyb2wudHNcclxuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCBjbGllbnRQcm9taXNlIGZyb20gJy4uLy4uLy4uLy4uL2xpYi9tb25nbyc7XHJcbmltcG9ydCB7IHJlZGlzIH0gZnJvbSAnLi4vLi4vLi4vLi4vbGliL3JlZGlzJztcclxuaW1wb3J0IHsgUXVldWUgfSBmcm9tICdidWxsbXEnO1xyXG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gJ21vbmdvZGInO1xyXG5cclxuY29uc3QgcXVldWUgPSBuZXcgUXVldWUoJ2NhbXBhaWducycsIHsgY29ubmVjdGlvbjogcmVkaXMgfSk7XHJcblxyXG50eXBlIEFjdGlvbiA9ICdwYXVzZScgfCAncmVzdW1lJyB8ICdjYW5jZWwnIHwgJ2RlbGV0ZSc7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBzYWZlSFNldChrZXk6IHN0cmluZywgb2JqOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KSB7XHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IHJlZGlzLmhzZXQoa2V5LCBvYmopO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS53YXJuKCdSZWRpcyB1bmF2YWlsYWJsZSB3aGlsZSBzZXR0aW5nIG1ldGEnLCBlcnIpO1xyXG4gIH1cclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gc2FmZVB1Ymxpc2goY2hhbm5lbDogc3RyaW5nLCBwYXlsb2FkOiBhbnkpIHtcclxuICB0cnkge1xyXG4gICAgYXdhaXQgcmVkaXMucHVibGlzaChjaGFubmVsLCBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSk7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLndhcm4oJ1JlZGlzIHB1Ymxpc2ggZmFpbGVkJywgZXJyKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIFJlbW92ZSB3YWl0aW5nL2RlbGF5ZWQvYWN0aXZlIGpvYnMgZm9yIGEgY2FtcGFpZ25JZCAoYmVzdC1lZmZvcnQpXHJcbmFzeW5jIGZ1bmN0aW9uIHJlbW92ZVF1ZXVlZEpvYnNGb3JDYW1wYWlnbihjYW1wYWlnbklkOiBzdHJpbmcpIHtcclxuICB0cnkge1xyXG4gICAgLy8gZ2V0IHdhaXRpbmcvZGVsYXllZC9hY3RpdmUgam9ic1xyXG4gICAgY29uc3Qgam9icyA9IGF3YWl0IHF1ZXVlLmdldEpvYnMoXHJcbiAgICAgIFsnd2FpdGluZycsICdkZWxheWVkJywgJ2FjdGl2ZScsICdwYXVzZWQnXSxcclxuICAgICAgMCxcclxuICAgICAgLTFcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgbWF0Y2hlZCA9IGpvYnMuZmlsdGVyKChqKSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIGouZGF0YT8uY2FtcGFpZ25JZCA9PT0gY2FtcGFpZ25JZDtcclxuICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IGogb2YgbWF0Y2hlZCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIC8vIGlmIHRoZSBqb2IgaXMgYWN0aXZlLCByZW1vdmUgbWF5IGZhaWwgLSBzdGlsbCB0cnlcclxuICAgICAgICBhd2FpdCBqLnJlbW92ZSgpO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgLy8gYmVzdC1lZmZvcnQg4oCUIGlnbm9yZVxyXG4gICAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIHJlbW92ZSBqb2IgJHtqLmlkfWAsIGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbWF0Y2hlZC5sZW5ndGg7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBlbnVtZXJhdGUvcmVtb3ZlIGpvYnMgZm9yIGNhbXBhaWduJywgZXJyKTtcclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihcclxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxyXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlXHJcbikge1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHsgaWQgfSA9IHJlcS5xdWVyeTtcclxuICBpZiAoIWlkIHx8IHR5cGVvZiBpZCAhPT0gJ3N0cmluZycpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnSW52YWxpZCBjYW1wYWlnbiBpZCcgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB7IGFjdGlvbiwgY29uZmlybSB9ID0gcmVxLmJvZHkgYXMge1xyXG4gICAgYWN0aW9uPzogQWN0aW9uO1xyXG4gICAgY29uZmlybT86IGJvb2xlYW47XHJcbiAgfTtcclxuXHJcbiAgaWYgKCFhY3Rpb24gfHwgIVsncGF1c2UnLCAncmVzdW1lJywgJ2NhbmNlbCcsICdkZWxldGUnXS5pbmNsdWRlcyhhY3Rpb24pKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgYWN0aW9uJyB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNsaWVudCA9IGF3YWl0IGNsaWVudFByb21pc2U7XHJcbiAgY29uc3QgZGIgPSBjbGllbnQuZGIoJ1BsYXRmb3JtRGF0YScpO1xyXG4gIGNvbnN0IGNhbXBhaWduT2JqZWN0SWQgPSBuZXcgT2JqZWN0SWQoaWQpO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gUmVsb2FkIGNhbXBhaWduIGZyb20gTW9uZ28gKGF1dGhvcml0YXRpdmUpXHJcbiAgICBjb25zdCBjYW1wYWlnbiA9IGF3YWl0IGRiXHJcbiAgICAgIC5jb2xsZWN0aW9uKCdjYW1wYWlnbnMnKVxyXG4gICAgICAuZmluZE9uZSh7IF9pZDogY2FtcGFpZ25PYmplY3RJZCB9KTtcclxuXHJcbiAgICBpZiAoIWNhbXBhaWduKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnQ2FtcGFpZ24gbm90IGZvdW5kJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBMaWdodHdlaWdodCBoZWxwZXJzXHJcbiAgICBjb25zdCByZWRpc0tleSA9IGBjYW1wYWlnbjoke2lkfTptZXRhYDtcclxuXHJcbiAgICAvLyBBQ1RJT046IFBhdXNlXHJcbiAgICBpZiAoYWN0aW9uID09PSAncGF1c2UnKSB7XHJcbiAgICAgIGlmIChjYW1wYWlnbi5zdGF0dXMgPT09ICdwYXVzZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgb2s6IHRydWUsIG1lc3NhZ2U6ICdBbHJlYWR5IHBhdXNlZCcgfSk7XHJcbiAgICAgIH1cclxuICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25zJykudXBkYXRlT25lKFxyXG4gICAgICAgIHsgX2lkOiBjYW1wYWlnbk9iamVjdElkIH0sXHJcbiAgICAgICAgeyAkc2V0OiB7IHN0YXR1czogJ3BhdXNlZCcgfSB9XHJcbiAgICAgICk7XHJcbiAgICAgIGF3YWl0IHNhZmVIU2V0KHJlZGlzS2V5LCB7IHN0YXR1czogJ3BhdXNlZCcgfSk7XHJcbiAgICAgIGF3YWl0IHNhZmVQdWJsaXNoKCdjYW1wYWlnbjpuZXcnLCB7IGlkLCBzdGF0dXM6ICdwYXVzZWQnIH0pO1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBvazogdHJ1ZSwgYWN0aW9uOiAncGF1c2VkJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBQ1RJT046IFJlc3VtZVxyXG4gICAgaWYgKGFjdGlvbiA9PT0gJ3Jlc3VtZScpIHtcclxuICAgICAgaWYgKGNhbXBhaWduLnN0YXR1cyA9PT0gJ3J1bm5pbmcnKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgb2s6IHRydWUsIG1lc3NhZ2U6ICdBbHJlYWR5IHJ1bm5pbmcnIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbnMnKS51cGRhdGVPbmUoXHJcbiAgICAgICAgeyBfaWQ6IGNhbXBhaWduT2JqZWN0SWQgfSxcclxuICAgICAgICB7ICRzZXQ6IHsgc3RhdHVzOiAncnVubmluZycgfSB9XHJcbiAgICAgICk7XHJcbiAgICAgIGF3YWl0IHNhZmVIU2V0KHJlZGlzS2V5LCB7IHN0YXR1czogJ3J1bm5pbmcnIH0pO1xyXG4gICAgICBhd2FpdCBzYWZlUHVibGlzaCgnY2FtcGFpZ246bmV3JywgeyBpZCwgc3RhdHVzOiAncnVubmluZycgfSk7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IG9rOiB0cnVlLCBhY3Rpb246ICdyZXN1bWVkJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBQ1RJT046IENhbmNlbFxyXG4gICAgaWYgKGFjdGlvbiA9PT0gJ2NhbmNlbCcpIHtcclxuICAgICAgaWYgKGNhbXBhaWduLnN0YXR1cyA9PT0gJ2NhbmNlbGxlZCcpIHtcclxuICAgICAgICByZXR1cm4gcmVzXHJcbiAgICAgICAgICAuc3RhdHVzKDIwMClcclxuICAgICAgICAgIC5qc29uKHsgb2s6IHRydWUsIG1lc3NhZ2U6ICdBbHJlYWR5IGNhbmNlbGxlZCcgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIDEpIE1hcmsgY2FtcGFpZ24gY2FuY2VsbGVkIGFuZCBjb21wbGV0ZWRBdFxyXG4gICAgICBjb25zdCBjb21wbGV0ZWRBdCA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NhbXBhaWducycpLnVwZGF0ZU9uZShcclxuICAgICAgICB7IF9pZDogY2FtcGFpZ25PYmplY3RJZCB9LFxyXG4gICAgICAgIHsgJHNldDogeyBzdGF0dXM6ICdjYW5jZWxsZWQnLCBjb21wbGV0ZWRBdCB9IH1cclxuICAgICAgKTtcclxuICAgICAgYXdhaXQgc2FmZUhTZXQocmVkaXNLZXksIHsgc3RhdHVzOiAnY2FuY2VsbGVkJyB9KTtcclxuXHJcbiAgICAgIC8vIDIpIEZpbmQgYW5kIGF0b21pY2FsbHkgbWFyayBwZW5kaW5nIGxlZGdlciByb3dzIGFzIGZhaWxlZCAoc2luZ2xlIHVwZGF0ZU1hbnkpXHJcbiAgICAgIGNvbnN0IGZpbHRlciA9IHsgY2FtcGFpZ25JZDogY2FtcGFpZ25PYmplY3RJZCwgc3RhdHVzOiAncGVuZGluZycgfTtcclxuICAgICAgY29uc3QgdXBkYXRlID0ge1xyXG4gICAgICAgICRzZXQ6IHtcclxuICAgICAgICAgIHN0YXR1czogJ2ZhaWxlZCcsXHJcbiAgICAgICAgICBsYXN0RXJyb3I6ICdjYW5jZWxsZWQnLFxyXG4gICAgICAgICAgbGFzdEF0dGVtcHRBdDogY29tcGxldGVkQXQsXHJcbiAgICAgICAgfSxcclxuICAgICAgICAkaW5jOiB7IGF0dGVtcHRzOiAxIH0sXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVSZXN1bHQgPSBhd2FpdCBkYlxyXG4gICAgICAgIC5jb2xsZWN0aW9uKCdjYW1wYWlnbl9jb250YWN0cycpXHJcbiAgICAgICAgLnVwZGF0ZU1hbnkoZmlsdGVyLCB1cGRhdGUpO1xyXG5cclxuICAgICAgY29uc3QgY2FuY2VsbGVkQ291bnQgPSB1cGRhdGVSZXN1bHQubW9kaWZpZWRDb3VudCA/PyAwO1xyXG5cclxuICAgICAgLy8gMykgVXBkYXRlIFJlZGlzIGNvdW50ZXJzIChiZXN0LWVmZm9ydClcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBpZiAoY2FuY2VsbGVkQ291bnQgPiAwKSB7XHJcbiAgICAgICAgICBhd2FpdCByZWRpcy5oaW5jcmJ5KHJlZGlzS2V5LCAncHJvY2Vzc2VkJywgY2FuY2VsbGVkQ291bnQpO1xyXG4gICAgICAgICAgYXdhaXQgcmVkaXMuaGluY3JieShyZWRpc0tleSwgJ2ZhaWxlZCcsIGNhbmNlbGxlZENvdW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byB1cGRhdGUgcmVkaXMgY291bnRlcnMgZHVyaW5nIGNhbmNlbCcsIGUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyA0KSBQZXJzaXN0IHRvdGFscyBzbmFwc2hvdCB0byBjYW1wYWlnbnMudG90YWxzIChyZWFkIHJlZGlzIGlmIGF2YWlsYWJsZSwgZmFsbGJhY2sgdG8gZGIpXHJcbiAgICAgIGxldCBtZXRhID0ge307XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgbWV0YSA9IChhd2FpdCByZWRpcy5oZ2V0YWxsKHJlZGlzS2V5KSkgfHwge307XHJcbiAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIG1ldGEgPSB7fTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ29tcHV0ZSB0b3RhbHMgZmluYWwgdmFsdWVzIGNvbWJpbmluZyBwZXJzaXN0ZWQgdG90YWxzIGFuZCBvdXIgY2FuY2VsbGVkQ291bnQgYXMgZmFsbGJhY2tcclxuICAgICAgY29uc3QgcHJvY2Vzc2VkTm93ID0gTnVtYmVyKG1ldGFbJ3Byb2Nlc3NlZCddID8/IChjYW1wYWlnbi50b3RhbHM/LnByb2Nlc3NlZCA/PyAwKSArIGNhbmNlbGxlZENvdW50KTtcclxuICAgICAgY29uc3Qgc2VudE5vdyA9IE51bWJlcihtZXRhWydzZW50J10gPz8gKGNhbXBhaWduLnRvdGFscz8uc2VudCA/PyAwKSk7XHJcbiAgICAgIGNvbnN0IGZhaWxlZE5vdyA9IE51bWJlcihtZXRhWydmYWlsZWQnXSA/PyAoY2FtcGFpZ24udG90YWxzPy5mYWlsZWQgPz8gMCkgKyBjYW5jZWxsZWRDb3VudCk7XHJcblxyXG4gICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbnMnKS51cGRhdGVPbmUoXHJcbiAgICAgICAgeyBfaWQ6IGNhbXBhaWduT2JqZWN0SWQgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAkc2V0OiB7XHJcbiAgICAgICAgICAgICd0b3RhbHMucHJvY2Vzc2VkJzogcHJvY2Vzc2VkTm93LFxyXG4gICAgICAgICAgICAndG90YWxzLnNlbnQnOiBzZW50Tm93LFxyXG4gICAgICAgICAgICAndG90YWxzLmZhaWxlZCc6IGZhaWxlZE5vdyxcclxuICAgICAgICAgICAgY29tcGxldGVkQXQsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIDUpIFJlbW92ZSBxdWV1ZWQgam9icyBmb3IgdGhpcyBjYW1wYWlnbiAoYmVzdC1lZmZvcnQpXHJcbiAgICAgIGNvbnN0IHJlbW92ZWRKb2JzID0gYXdhaXQgcmVtb3ZlUXVldWVkSm9ic0ZvckNhbXBhaWduKGlkKTtcclxuXHJcbiAgICAgIC8vIDYpIFB1Ymxpc2ggZXZlbnRcclxuICAgICAgYXdhaXQgc2FmZVB1Ymxpc2goJ2NhbXBhaWduOm5ldycsIHsgaWQsIHN0YXR1czogJ2NhbmNlbGxlZCcsIGNhbmNlbGxlZENvdW50LCByZW1vdmVkSm9icyB9KTtcclxuXHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgICAgb2s6IHRydWUsXHJcbiAgICAgICAgYWN0aW9uOiAnY2FuY2VsbGVkJyxcclxuICAgICAgICBjYW5jZWxsZWRDb3VudCxcclxuICAgICAgICByZW1vdmVkSm9icyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQUNUSU9OOiBEZWxldGVcclxuICAgIGlmIChhY3Rpb24gPT09ICdkZWxldGUnKSB7XHJcbiAgICAgIC8vIFJlcXVpcmUgZXhwbGljaXQgY29uZmlybWF0aW9uIOKAlCBzYWZlZ3VhcmRzIGluIFVJIG11c3Qgc2V0IGNvbmZpcm09dHJ1ZVxyXG4gICAgICBpZiAoY29uZmlybSAhPT0gdHJ1ZSkge1xyXG4gICAgICAgIHJldHVybiByZXNcclxuICAgICAgICAgIC5zdGF0dXMoNDAwKVxyXG4gICAgICAgICAgLmpzb24oeyBlcnJvcjogJ0RlbGV0aW9uIHJlcXVpcmVzIGNvbmZpcm09dHJ1ZSBpbiByZXF1ZXN0IGJvZHknIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBQcmV2ZW50IGFjY2lkZW50YWwgZGVsZXRpb24gd2hpbGUgcnVubmluZ1xyXG4gICAgICBpZiAoY2FtcGFpZ24uc3RhdHVzID09PSAncnVubmluZycpIHtcclxuICAgICAgICByZXR1cm4gcmVzXHJcbiAgICAgICAgICAuc3RhdHVzKDQwMClcclxuICAgICAgICAgIC5qc29uKHsgZXJyb3I6ICdDYW5jZWwgdGhlIGNhbXBhaWduIGJlZm9yZSBkZWxldGlvbicgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFJlbW92ZSBxdWV1ZWQgam9icyAoYmVzdC1lZmZvcnQpXHJcbiAgICAgIGNvbnN0IHJlbW92ZWRKb2JzID0gYXdhaXQgcmVtb3ZlUXVldWVkSm9ic0ZvckNhbXBhaWduKGlkKTtcclxuXHJcbiAgICAgIC8vIERlbGV0ZSBSZWRpcyBrZXlzIChiZXN0LWVmZm9ydClcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBhd2FpdCByZWRpcy5kZWwoYGNhbXBhaWduOiR7aWR9Om1ldGFgKTtcclxuICAgICAgICBhd2FpdCByZWRpcy5kZWwoYGNhbXBhaWduOiR7aWR9OmRlZmluaXRpb25gKTtcclxuICAgICAgICBhd2FpdCByZWRpcy5zcmVtKCdjYW1wYWlnbjphbGwnLCBpZCk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ1JlZGlzIGNsZWFudXAgb24gZGVsZXRlIGZhaWxlZCcsIGUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBEZWxldGUgTW9uZ28gZG9jc1xyXG4gICAgICBjb25zdCBbY2FtcGFpZ25EZWwsIGxlZGdlckRlbF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgICAgZGIuY29sbGVjdGlvbignY2FtcGFpZ25zJykuZGVsZXRlT25lKHsgX2lkOiBjYW1wYWlnbk9iamVjdElkIH0pLFxyXG4gICAgICAgIGRiLmNvbGxlY3Rpb24oJ2NhbXBhaWduX2NvbnRhY3RzJykuZGVsZXRlTWFueSh7IGNhbXBhaWduSWQ6IGNhbXBhaWduT2JqZWN0SWQgfSksXHJcbiAgICAgIF0pO1xyXG5cclxuICAgICAgYXdhaXQgc2FmZVB1Ymxpc2goJ2NhbXBhaWduOm5ldycsIHsgaWQsIHN0YXR1czogJ2RlbGV0ZWQnIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICBvazogdHJ1ZSxcclxuICAgICAgICBhY3Rpb246ICdkZWxldGVkJyxcclxuICAgICAgICBjYW1wYWlnbkRlbGV0ZWQ6IGNhbXBhaWduRGVsLmRlbGV0ZWRDb3VudCA/PyAwLFxyXG4gICAgICAgIGxlZGdlckRlbGV0ZWQ6IGxlZGdlckRlbC5kZWxldGVkQ291bnQgPz8gMCxcclxuICAgICAgICByZW1vdmVkSm9icyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2hvdWxkIG5vdCByZWFjaCBoZXJlXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ1Vuc3VwcG9ydGVkIGFjdGlvbicgfSk7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdDYW1wYWlnbiBjb250cm9sIGVycm9yJywgZXJyKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbImNsaWVudFByb21pc2UiLCJyZWRpcyIsIlF1ZXVlIiwiT2JqZWN0SWQiLCJxdWV1ZSIsImNvbm5lY3Rpb24iLCJzYWZlSFNldCIsImtleSIsIm9iaiIsImhzZXQiLCJlcnIiLCJjb25zb2xlIiwid2FybiIsInNhZmVQdWJsaXNoIiwiY2hhbm5lbCIsInBheWxvYWQiLCJwdWJsaXNoIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlbW92ZVF1ZXVlZEpvYnNGb3JDYW1wYWlnbiIsImNhbXBhaWduSWQiLCJqb2JzIiwiZ2V0Sm9icyIsIm1hdGNoZWQiLCJmaWx0ZXIiLCJqIiwiZGF0YSIsInJlbW92ZSIsImUiLCJpZCIsImxlbmd0aCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJxdWVyeSIsImFjdGlvbiIsImNvbmZpcm0iLCJib2R5IiwiaW5jbHVkZXMiLCJjbGllbnQiLCJkYiIsImNhbXBhaWduT2JqZWN0SWQiLCJjYW1wYWlnbiIsImNvbGxlY3Rpb24iLCJmaW5kT25lIiwiX2lkIiwicmVkaXNLZXkiLCJvayIsIm1lc3NhZ2UiLCJ1cGRhdGVPbmUiLCIkc2V0IiwiY29tcGxldGVkQXQiLCJEYXRlIiwidXBkYXRlIiwibGFzdEVycm9yIiwibGFzdEF0dGVtcHRBdCIsIiRpbmMiLCJhdHRlbXB0cyIsInVwZGF0ZVJlc3VsdCIsInVwZGF0ZU1hbnkiLCJjYW5jZWxsZWRDb3VudCIsIm1vZGlmaWVkQ291bnQiLCJoaW5jcmJ5IiwibWV0YSIsImhnZXRhbGwiLCJwcm9jZXNzZWROb3ciLCJOdW1iZXIiLCJ0b3RhbHMiLCJwcm9jZXNzZWQiLCJzZW50Tm93Iiwic2VudCIsImZhaWxlZE5vdyIsImZhaWxlZCIsInJlbW92ZWRKb2JzIiwiZGVsIiwic3JlbSIsImNhbXBhaWduRGVsIiwibGVkZ2VyRGVsIiwiUHJvbWlzZSIsImFsbCIsImRlbGV0ZU9uZSIsImRlbGV0ZU1hbnkiLCJjYW1wYWlnbkRlbGV0ZWQiLCJkZWxldGVkQ291bnQiLCJsZWRnZXJEZWxldGVkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/campaign/[id]/control.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fcontrol&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Ccontrol.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();