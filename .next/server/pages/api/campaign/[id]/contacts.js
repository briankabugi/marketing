"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/campaign/[id]/contacts";
exports.ids = ["pages/api/campaign/[id]/contacts"];
exports.modules = {

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fcontacts&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Ccontacts.ts&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fcontacts&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Ccontacts.ts&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_campaign_id_contacts_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\campaign\\[id]\\contacts.ts */ \"(api)/./pages/api/campaign/[id]/contacts.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_id_contacts_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_id_contacts_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/campaign/[id]/contacts\",\n        pathname: \"/api/campaign/[id]/contacts\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_campaign_id_contacts_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNhbXBhaWduJTJGJTVCaWQlNUQlMkZjb250YWN0cyZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDY2FtcGFpZ24lNUMlNUJpZCU1RCU1Q2NvbnRhY3RzLnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ3NFO0FBQ3RFO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQywrREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsK0RBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFya2V0aW5nLW12cC8/OThjZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXGNhbXBhaWduXFxcXFtpZF1cXFxcY29udGFjdHMudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jYW1wYWlnbi9baWRdL2NvbnRhY3RzXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvY2FtcGFpZ24vW2lkXS9jb250YWN0c1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fcontacts&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Ccontacts.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/mongo.ts":
/*!**********************!*\
  !*** ./lib/mongo.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n// lib/mongo.ts\n\nconst uri = process.env.MONGODB_URI;\nif (!uri) throw new Error(\"MONGODB_URI not set\");\nlet client;\nlet clientPromise;\n// Retry logic in case MongoDB connection fails\nasync function connectWithRetry() {\n    const MAX_RETRIES = 5;\n    let attempts = 0;\n    let lastError = null;\n    while(attempts < MAX_RETRIES){\n        try {\n            const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, {\n                maxPoolSize: 10,\n                serverSelectionTimeoutMS: 10000,\n                socketTimeoutMS: 45000\n            });\n            await client.connect();\n            return client;\n        } catch (err) {\n            lastError = err;\n            attempts++;\n            console.error(`MongoDB connection failed (attempt ${attempts}/${MAX_RETRIES}):`, err);\n            if (attempts < MAX_RETRIES) {\n                await new Promise((resolve)=>setTimeout(resolve, 5000)); // wait for 5 seconds before retrying\n            }\n        }\n    }\n    // After max retries, throw the last error encountered\n    throw lastError || new Error(\"MongoDB connection failed after maximum retry attempts\");\n}\nif (!global._mongoClientPromise) {\n    global._mongoClientPromise = connectWithRetry();\n    // Optional: log connection events\n    global._mongoClientPromise.then((client)=>{\n        client.on(\"serverOpening\", (event)=>console.log(\"MongoDB server opening\", event));\n        client.on(\"serverClosed\", (event)=>console.warn(\"MongoDB server closed\", event));\n        client.on(\"topologyClosed\", ()=>console.warn(\"MongoDB topology closed\"));\n        client.on(\"topologyOpening\", ()=>console.log(\"MongoDB topology opening\"));\n        client.on(\"error\", (err)=>console.error(\"MongoDB error\", err));\n    }).catch((err)=>{\n        console.error(\"MongoDB client failed to connect after retries\", err);\n    });\n}\nclientPromise = global._mongoClientPromise;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvbW9uZ28udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZUFBZTtBQUN1QjtBQUV0QyxNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFdBQVc7QUFDbkMsSUFBSSxDQUFDSCxLQUFLLE1BQU0sSUFBSUksTUFBTTtBQUUxQixJQUFJQztBQUNKLElBQUlDO0FBT0osK0NBQStDO0FBQy9DLGVBQWVDO0lBQ2IsTUFBTUMsY0FBYztJQUNwQixJQUFJQyxXQUFXO0lBQ2YsSUFBSUMsWUFBMEI7SUFFOUIsTUFBT0QsV0FBV0QsWUFBYTtRQUM3QixJQUFJO1lBQ0YsTUFBTUgsU0FBUyxJQUFJTixnREFBV0EsQ0FBQ0MsS0FBSztnQkFDbENXLGFBQWE7Z0JBQ2JDLDBCQUEwQjtnQkFDMUJDLGlCQUFpQjtZQUNuQjtZQUNBLE1BQU1SLE9BQU9TLE9BQU87WUFDcEIsT0FBT1Q7UUFDVCxFQUFFLE9BQU9VLEtBQVU7WUFDakJMLFlBQVlLO1lBQ1pOO1lBQ0FPLFFBQVFDLEtBQUssQ0FBQyxDQUFDLG1DQUFtQyxFQUFFUixTQUFTLENBQUMsRUFBRUQsWUFBWSxFQUFFLENBQUMsRUFBRU87WUFDakYsSUFBSU4sV0FBV0QsYUFBYTtnQkFDMUIsTUFBTSxJQUFJVSxRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTLFFBQVEscUNBQXFDO1lBQ2hHO1FBQ0Y7SUFDRjtJQUVBLHNEQUFzRDtJQUN0RCxNQUFNVCxhQUFhLElBQUlOLE1BQU07QUFDL0I7QUFFQSxJQUFJLENBQUNpQixPQUFPQyxtQkFBbUIsRUFBRTtJQUMvQkQsT0FBT0MsbUJBQW1CLEdBQUdmO0lBRTdCLGtDQUFrQztJQUNsQ2MsT0FBT0MsbUJBQW1CLENBQ3ZCQyxJQUFJLENBQUNsQixDQUFBQTtRQUNKQSxPQUFPbUIsRUFBRSxDQUFDLGlCQUFpQixDQUFDQyxRQUFVVCxRQUFRVSxHQUFHLENBQUMsMEJBQTBCRDtRQUM1RXBCLE9BQU9tQixFQUFFLENBQUMsZ0JBQWdCLENBQUNDLFFBQVVULFFBQVFXLElBQUksQ0FBQyx5QkFBeUJGO1FBQzNFcEIsT0FBT21CLEVBQUUsQ0FBQyxrQkFBa0IsSUFBTVIsUUFBUVcsSUFBSSxDQUFDO1FBQy9DdEIsT0FBT21CLEVBQUUsQ0FBQyxtQkFBbUIsSUFBTVIsUUFBUVUsR0FBRyxDQUFDO1FBQy9DckIsT0FBT21CLEVBQUUsQ0FBQyxTQUFTLENBQUNULE1BQVFDLFFBQVFDLEtBQUssQ0FBQyxpQkFBaUJGO0lBQzdELEdBQ0NhLEtBQUssQ0FBQ2IsQ0FBQUE7UUFDTEMsUUFBUUMsS0FBSyxDQUFDLGtEQUFrREY7SUFDbEU7QUFDSjtBQUVBVCxnQkFBZ0JlLE9BQU9DLG1CQUFtQjtBQUUxQyxpRUFBZWhCLGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vbGliL21vbmdvLnRzPzU3ZmUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21vbmdvLnRzXHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuaWYgKCF1cmkpIHRocm93IG5ldyBFcnJvcignTU9OR09EQl9VUkkgbm90IHNldCcpO1xyXG5cclxubGV0IGNsaWVudDogTW9uZ29DbGllbnQ7XHJcbmxldCBjbGllbnRQcm9taXNlOiBQcm9taXNlPE1vbmdvQ2xpZW50PjtcclxuXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXHJcbiAgdmFyIF9tb25nb0NsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+IHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG4vLyBSZXRyeSBsb2dpYyBpbiBjYXNlIE1vbmdvREIgY29ubmVjdGlvbiBmYWlsc1xyXG5hc3luYyBmdW5jdGlvbiBjb25uZWN0V2l0aFJldHJ5KCk6IFByb21pc2U8TW9uZ29DbGllbnQ+IHtcclxuICBjb25zdCBNQVhfUkVUUklFUyA9IDU7XHJcbiAgbGV0IGF0dGVtcHRzID0gMDtcclxuICBsZXQgbGFzdEVycm9yOiBFcnJvciB8IG51bGwgPSBudWxsO1xyXG5cclxuICB3aGlsZSAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwge1xyXG4gICAgICAgIG1heFBvb2xTaXplOiAxMCxcclxuICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDEwMDAwLFxyXG4gICAgICAgIHNvY2tldFRpbWVvdXRNUzogNDUwMDAsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgICByZXR1cm4gY2xpZW50O1xyXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgbGFzdEVycm9yID0gZXJyO1xyXG4gICAgICBhdHRlbXB0cysrO1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBNb25nb0RCIGNvbm5lY3Rpb24gZmFpbGVkIChhdHRlbXB0ICR7YXR0ZW1wdHN9LyR7TUFYX1JFVFJJRVN9KTpgLCBlcnIpO1xyXG4gICAgICBpZiAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDAwKSk7IC8vIHdhaXQgZm9yIDUgc2Vjb25kcyBiZWZvcmUgcmV0cnlpbmdcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQWZ0ZXIgbWF4IHJldHJpZXMsIHRocm93IHRoZSBsYXN0IGVycm9yIGVuY291bnRlcmVkXHJcbiAgdGhyb3cgbGFzdEVycm9yIHx8IG5ldyBFcnJvcignTW9uZ29EQiBjb25uZWN0aW9uIGZhaWxlZCBhZnRlciBtYXhpbXVtIHJldHJ5IGF0dGVtcHRzJyk7XHJcbn1cclxuXHJcbmlmICghZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UpIHtcclxuICBnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZSA9IGNvbm5lY3RXaXRoUmV0cnkoKTtcclxuICBcclxuICAvLyBPcHRpb25hbDogbG9nIGNvbm5lY3Rpb24gZXZlbnRzXHJcbiAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2VcclxuICAgIC50aGVuKGNsaWVudCA9PiB7XHJcbiAgICAgIGNsaWVudC5vbignc2VydmVyT3BlbmluZycsIChldmVudCkgPT4gY29uc29sZS5sb2coJ01vbmdvREIgc2VydmVyIG9wZW5pbmcnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3NlcnZlckNsb3NlZCcsIChldmVudCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHNlcnZlciBjbG9zZWQnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3RvcG9sb2d5Q2xvc2VkJywgKCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHRvcG9sb2d5IGNsb3NlZCcpKTtcclxuICAgICAgY2xpZW50Lm9uKCd0b3BvbG9neU9wZW5pbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnTW9uZ29EQiB0b3BvbG9neSBvcGVuaW5nJykpO1xyXG4gICAgICBjbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4gY29uc29sZS5lcnJvcignTW9uZ29EQiBlcnJvcicsIGVycikpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIGNsaWVudCBmYWlsZWQgdG8gY29ubmVjdCBhZnRlciByZXRyaWVzJywgZXJyKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jbGllbnRQcm9taXNlID0gZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2U7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnRQcm9taXNlOyJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwiY2xpZW50IiwiY2xpZW50UHJvbWlzZSIsImNvbm5lY3RXaXRoUmV0cnkiLCJNQVhfUkVUUklFUyIsImF0dGVtcHRzIiwibGFzdEVycm9yIiwibWF4UG9vbFNpemUiLCJzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMiLCJzb2NrZXRUaW1lb3V0TVMiLCJjb25uZWN0IiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZ2xvYmFsIiwiX21vbmdvQ2xpZW50UHJvbWlzZSIsInRoZW4iLCJvbiIsImV2ZW50IiwibG9nIiwid2FybiIsImNhdGNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/mongo.ts\n");

/***/ }),

/***/ "(api)/./pages/api/campaign/[id]/contacts.ts":
/*!*********************************************!*\
  !*** ./pages/api/campaign/[id]/contacts.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_mongo__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/mongo */ \"(api)/./lib/mongo.ts\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_1__);\n// pages/api/campaign/[id]/contacts.ts\n\n\nfunction tryParseObjectId(s) {\n    if (!s) return null;\n    if (typeof s === \"object\" && s instanceof mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId) return s;\n    if (typeof s === \"string\" && /^[0-9a-fA-F]{24}$/.test(s)) {\n        try {\n            return new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(s);\n        } catch  {\n            return null;\n        }\n    }\n    return null;\n}\nasync function handler(req, res) {\n    if (req.method !== \"GET\") return res.status(405).json({\n        error: \"Method not allowed\"\n    });\n    const { id } = req.query;\n    if (!id || typeof id !== \"string\") return res.status(400).json({\n        error: \"Invalid campaign id\"\n    });\n    const status = typeof req.query.status === \"string\" ? req.query.status : undefined;\n    const page = Math.max(1, Number(req.query.page ? Number(req.query.page) : 1));\n    const pageSize = Math.max(1, Number(req.query.pageSize ? Number(req.query.pageSize) : 25));\n    try {\n        const client = await _lib_mongo__WEBPACK_IMPORTED_MODULE_0__[\"default\"];\n        const db = client.db(\"PlatformData\");\n        const campaignIdStr = String(id);\n        const campaignIdObj = tryParseObjectId(campaignIdStr);\n        // Base filter for campaign_contacts\n        const baseFilter = {\n            campaignId: campaignIdObj ?? campaignIdStr\n        };\n        if (status && status !== \"all\") baseFilter.status = status;\n        // Total count\n        let total = await db.collection(\"campaign_contacts\").countDocuments(baseFilter);\n        // Pagination\n        const skip = (page - 1) * pageSize;\n        const cursor = db.collection(\"campaign_contacts\").find(baseFilter).sort({\n            createdAt: 1\n        }).skip(skip).limit(pageSize);\n        const rows = await cursor.toArray();\n        // Collect contactIds present on this page\n        const contactIdValues = rows.map((r)=>r.contactId).filter(Boolean);\n        // Build arrays for ObjectId vs string contactId lookups\n        const contactObjIds = contactIdValues.map((v)=>{\n            try {\n                if (typeof v === \"object\" && v instanceof mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId) return v;\n                if (typeof v === \"string\" && /^[0-9a-fA-F]{24}$/.test(v)) return new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(v);\n            } catch  {}\n            return null;\n        }).filter(Boolean);\n        const stringContactIds = contactIdValues.map((v)=>typeof v === \"string\" ? v : v && v.toString ? v.toString() : null).filter(Boolean);\n        // Fetch contact details (email) for these contactIds\n        let contactDocsMap = {};\n        if (contactObjIds.length || stringContactIds.length) {\n            const contactQuery = {\n                $or: []\n            };\n            if (contactObjIds.length) contactQuery.$or.push({\n                _id: {\n                    $in: contactObjIds\n                }\n            });\n            if (stringContactIds.length) contactQuery.$or.push({\n                _id: {\n                    $in: stringContactIds\n                }\n            });\n            if (contactQuery.$or.length > 0) {\n                const contactDocs = await db.collection(\"contacts\").find(contactQuery).project({\n                    email: 1\n                }).toArray();\n                for (const c of contactDocs)contactDocsMap[c._id && c._id.toString ? c._id.toString() : String(c._id)] = c;\n            }\n        }\n        // -------------------------\n        // Prefer ledger fields (campaign_contacts) for engagement\n        // Only aggregate campaign_events for those contactIds missing ledger fields.\n        // -------------------------\n        // Initialize lookups from ledger rows when possible\n        const openLookup = {};\n        const clickLookup = {};\n        // Keep a list of contact keys that need event-aggregation fallback\n        const needOpenAggKeys = [];\n        const needClickAggKeys = [];\n        for (const r of rows){\n            const cidKey = r.contactId && r.contactId.toString ? r.contactId.toString() : String(r.contactId ?? \"\");\n            // ledger might already have openedAt/lastClickAt (worker & tracking endpoints update these)\n            openLookup[cidKey] = r.openedAt ? new Date(r.openedAt).toISOString() : null;\n            clickLookup[cidKey] = r.lastClickAt ? new Date(r.lastClickAt).toISOString() : null;\n            if (!openLookup[cidKey]) needOpenAggKeys.push(cidKey);\n            if (!clickLookup[cidKey]) needClickAggKeys.push(cidKey);\n        }\n        // If some rows are missing ledger open/click info, aggregate events only for those keys\n        if (contactIdValues.length > 0 && (needOpenAggKeys.length > 0 || needClickAggKeys.length > 0)) {\n            // Build mapping back to the two forms (ObjectId vs string) for only the missing ones\n            const missingObjIdsForOpen = [];\n            const missingStrIdsForOpen = [];\n            const missingObjIdsForClick = [];\n            const missingStrIdsForClick = [];\n            // Create reverse map from key -> original value to decide if that key corresponds to an ObjectId or string\n            const keyToOriginal = {};\n            for (const v of contactIdValues){\n                const key = v && v.toString ? v.toString() : String(v);\n                if (!(key in keyToOriginal)) keyToOriginal[key] = v;\n            }\n            for (const key of needOpenAggKeys){\n                const orig = keyToOriginal[key];\n                if (!orig) continue;\n                if (typeof orig === \"object\" && orig instanceof mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId) missingObjIdsForOpen.push(orig);\n                else if (typeof orig === \"string\" && /^[0-9a-fA-F]{24}$/.test(orig)) {\n                    try {\n                        missingObjIdsForOpen.push(new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(orig));\n                    } catch  {\n                        missingStrIdsForOpen.push(orig);\n                    }\n                } else {\n                    missingStrIdsForOpen.push(String(orig));\n                }\n            }\n            for (const key of needClickAggKeys){\n                const orig = keyToOriginal[key];\n                if (!orig) continue;\n                if (typeof orig === \"object\" && orig instanceof mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId) missingObjIdsForClick.push(orig);\n                else if (typeof orig === \"string\" && /^[0-9a-fA-F]{24}$/.test(orig)) {\n                    try {\n                        missingObjIdsForClick.push(new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(orig));\n                    } catch  {\n                        missingStrIdsForClick.push(orig);\n                    }\n                } else {\n                    missingStrIdsForClick.push(String(orig));\n                }\n            }\n            // Build campaignId match that copes with ObjectId or string\n            const campaignIdMatch = campaignIdObj ? {\n                $or: [\n                    {\n                        campaignId: campaignIdObj\n                    },\n                    {\n                        campaignId: campaignIdStr\n                    }\n                ]\n            } : {\n                campaignId: campaignIdStr\n            };\n            // Aggregate opens for missing keys\n            try {\n                const contactMatchClauses = [];\n                if (missingObjIdsForOpen.length) contactMatchClauses.push({\n                    contactId: {\n                        $in: missingObjIdsForOpen\n                    }\n                });\n                if (missingStrIdsForOpen.length) contactMatchClauses.push({\n                    contactId: {\n                        $in: missingStrIdsForOpen\n                    }\n                });\n                if (contactMatchClauses.length > 0) {\n                    const openAgg = await db.collection(\"campaign_events\").aggregate([\n                        {\n                            $match: {\n                                $and: [\n                                    campaignIdMatch,\n                                    {\n                                        type: \"open\"\n                                    },\n                                    {\n                                        $or: contactMatchClauses\n                                    }\n                                ]\n                            }\n                        },\n                        {\n                            $group: {\n                                _id: \"$contactId\",\n                                lastOpenAt: {\n                                    $max: \"$createdAt\"\n                                },\n                                opens: {\n                                    $sum: 1\n                                }\n                            }\n                        }\n                    ]).toArray();\n                    for (const o of openAgg){\n                        const k = o._id && o._id.toString ? o._id.toString() : String(o._id);\n                        openLookup[k] = o.lastOpenAt ? new Date(o.lastOpenAt).toISOString() : null;\n                    }\n                }\n            } catch (e) {\n                console.warn(\"Failed to aggregate opens for contacts page (fallback)\", e);\n            }\n            // Aggregate clicks for missing keys\n            try {\n                const contactMatchClauses2 = [];\n                if (missingObjIdsForClick.length) contactMatchClauses2.push({\n                    contactId: {\n                        $in: missingObjIdsForClick\n                    }\n                });\n                if (missingStrIdsForClick.length) contactMatchClauses2.push({\n                    contactId: {\n                        $in: missingStrIdsForClick\n                    }\n                });\n                if (contactMatchClauses2.length > 0) {\n                    const clickAgg = await db.collection(\"campaign_events\").aggregate([\n                        {\n                            $match: {\n                                $and: [\n                                    campaignIdMatch,\n                                    {\n                                        type: \"click\"\n                                    },\n                                    {\n                                        $or: contactMatchClauses2\n                                    }\n                                ]\n                            }\n                        },\n                        {\n                            $group: {\n                                _id: \"$contactId\",\n                                lastClickAt: {\n                                    $max: \"$createdAt\"\n                                },\n                                clicks: {\n                                    $sum: 1\n                                }\n                            }\n                        }\n                    ]).toArray();\n                    for (const c of clickAgg){\n                        const k = c._id && c._id.toString ? c._id.toString() : String(c._id);\n                        clickLookup[k] = c.lastClickAt ? new Date(c.lastClickAt).toISOString() : null;\n                    }\n                }\n            } catch (e) {\n                console.warn(\"Failed to aggregate clicks for contacts page (fallback)\", e);\n            }\n        }\n        // -------------------------\n        // NEW: aggregate followup_sent & followup_skipped events for these page contactIds\n        // -------------------------\n        const followupLookup = {};\n        try {\n            if (contactIdValues.length > 0) {\n                // Build contact match clauses that accept ObjectId or string ids\n                const contactMatchClauses = [];\n                if (contactObjIds.length) contactMatchClauses.push({\n                    contactId: {\n                        $in: contactObjIds\n                    }\n                });\n                if (stringContactIds.length) contactMatchClauses.push({\n                    contactId: {\n                        $in: stringContactIds\n                    }\n                });\n                if (contactMatchClauses.length > 0) {\n                    const campaignIdMatch = campaignIdObj ? {\n                        $or: [\n                            {\n                                campaignId: campaignIdObj\n                            },\n                            {\n                                campaignId: campaignIdStr\n                            }\n                        ]\n                    } : {\n                        campaignId: campaignIdStr\n                    };\n                    const fuAgg = await db.collection(\"campaign_events\").aggregate([\n                        {\n                            $match: {\n                                $and: [\n                                    campaignIdMatch,\n                                    {\n                                        type: {\n                                            $in: [\n                                                \"followup_sent\",\n                                                \"followup_skipped\"\n                                            ]\n                                        }\n                                    },\n                                    {\n                                        $or: contactMatchClauses\n                                    }\n                                ]\n                            }\n                        },\n                        {\n                            $group: {\n                                _id: \"$contactId\",\n                                completed: {\n                                    $sum: 1\n                                },\n                                lastSkippedAt: {\n                                    $max: {\n                                        $cond: [\n                                            {\n                                                $eq: [\n                                                    \"$type\",\n                                                    \"followup_skipped\"\n                                                ]\n                                            },\n                                            \"$createdAt\",\n                                            null\n                                        ]\n                                    }\n                                },\n                                lastSkippedReason: {\n                                    $max: {\n                                        $cond: [\n                                            {\n                                                $eq: [\n                                                    \"$type\",\n                                                    \"followup_skipped\"\n                                                ]\n                                            },\n                                            \"$skippedReason\",\n                                            null\n                                        ]\n                                    }\n                                }\n                            }\n                        }\n                    ]).toArray();\n                    for (const f of fuAgg){\n                        const k = f._id && f._id.toString ? f._id.toString() : String(f._id);\n                        followupLookup[k] = {\n                            completed: typeof f.completed === \"number\" ? f.completed : Number(f.completed || 0),\n                            lastSkippedAt: f.lastSkippedAt ? new Date(f.lastSkippedAt).toISOString() : null,\n                            lastSkippedReason: f.lastSkippedReason ?? null\n                        };\n                    }\n                }\n            }\n        } catch (e) {\n            console.warn(\"Failed to aggregate followup events for contacts page\", e);\n        }\n        // Fetch campaign document to know how many followups are configured (safe fallback)\n        let campaignDoc = null;\n        try {\n            campaignDoc = await db.collection(\"campaigns\").findOne({\n                _id: campaignIdObj ?? campaignIdStr\n            });\n        } catch (e) {\n        // ignore\n        }\n        const followUpCount = Array.isArray(campaignDoc?.followUps) ? campaignDoc.followUps.length : 0;\n        // Build response items\n        const items = rows.map((r)=>{\n            const cidKey = r.contactId && r.contactId.toString ? r.contactId.toString() : String(r.contactId ?? \"\");\n            const contactDoc = contactDocsMap[cidKey];\n            const email = contactDoc?.email ?? r.email ?? null;\n            const lastOpenAt = openLookup[cidKey] ?? null;\n            const lastClickAt = clickLookup[cidKey] ?? null;\n            const fuInfo = followupLookup[cidKey] ?? {\n                completed: 0\n            };\n            // Prefer ledger followUpPlan when present for accurate progression\n            const ledgerPlan = Array.isArray(r.followUpPlan) ? r.followUpPlan : null;\n            let completedFromLedger = null;\n            let lastSkippedAtFromLedger = null;\n            let lastSkippedReasonFromLedger = null;\n            let planCountLocal = followUpCount;\n            if (ledgerPlan) {\n                planCountLocal = ledgerPlan.length;\n                completedFromLedger = ledgerPlan.filter((p)=>{\n                    if (p == null) return false;\n                    const status = (p.status || \"\").toString().toLowerCase();\n                    if (status === \"sent\" || !!p.sentAt) return true;\n                    return false;\n                }).length;\n                // find last skipped entry if any\n                const skippedEntries = ledgerPlan.filter((p)=>p && (p.status === \"skipped\" || p.skippedAt));\n                if (skippedEntries.length) {\n                    // pick latest skippedAt (if present) else null\n                    const latest = skippedEntries.reduce((acc, cur)=>{\n                        const curDate = cur.skippedAt ? new Date(cur.skippedAt) : null;\n                        if (!acc) return cur;\n                        const accDate = acc.skippedAt ? new Date(acc.skippedAt) : null;\n                        if (curDate && accDate) return curDate.getTime() > accDate.getTime() ? cur : acc;\n                        if (curDate && !accDate) return cur;\n                        return acc;\n                    }, null);\n                    if (latest) {\n                        lastSkippedAtFromLedger = latest.skippedAt ? new Date(latest.skippedAt).toISOString() : null;\n                        lastSkippedReasonFromLedger = latest.skippedReason ?? null;\n                    }\n                }\n            }\n            const completed = typeof completedFromLedger === \"number\" ? completedFromLedger : fuInfo.completed ?? 0;\n            const nextStep = typeof completed === \"number\" && completed < (planCountLocal || 0) ? completed + 1 : null;\n            // Normalize followUpPlan for API output (convert Date-like to ISO strings)\n            const followUpPlanOut = (ledgerPlan || []).map((p)=>{\n                return {\n                    index: p.index ?? null,\n                    name: p.name ?? null,\n                    rule: p.rule ?? null,\n                    status: p.status ?? null,\n                    scheduledFor: p.scheduledFor ? new Date(p.scheduledFor).toISOString() : p.scheduledFor ? String(p.scheduledFor) : null,\n                    sentAt: p.sentAt ? new Date(p.sentAt).toISOString() : null,\n                    skippedAt: p.skippedAt ? new Date(p.skippedAt).toISOString() : null,\n                    skippedReason: p.skippedReason ?? null,\n                    delayMinutes: typeof p.delayMinutes === \"number\" ? p.delayMinutes : p.delayMinutes ? Number(p.delayMinutes) : null\n                };\n            });\n            // Step-scoped counters (new model): prefer explicit currentStep fields if present, otherwise fall back.\n            const currentStepIndex = typeof r.currentStepIndex === \"number\" || r.currentStepIndex != null ? Number(r.currentStepIndex) : r.currentStepIndex ? Number(r.currentStepIndex) : null;\n            const currentStepName = r.currentStepName ?? null;\n            const currentStepAttempts = typeof r.currentStepAttempts === \"number\" ? r.currentStepAttempts : typeof r.attempts === \"number\" ? r.attempts : 0;\n            const currentStepBgAttempts = typeof r.currentStepBgAttempts === \"number\" ? r.currentStepBgAttempts : typeof r.bgAttempts === \"number\" ? r.bgAttempts : 0;\n            return {\n                id: r._id?.toString?.() ?? String(r._id),\n                contactId: r.contactId && r.contactId.toString ? r.contactId.toString() : String(r.contactId ?? null),\n                email,\n                status: r.status ?? null,\n                // attempts reflect active step attempts under the new model; keep explicit fields as well\n                attempts: typeof r.attempts === \"number\" ? r.attempts : 0,\n                bgAttempts: typeof r.bgAttempts === \"number\" ? r.bgAttempts : 0,\n                lastAttemptAt: r.lastAttemptAt ? new Date(r.lastAttemptAt).toISOString() : null,\n                lastError: r.lastError ?? null,\n                opened: !!lastOpenAt,\n                lastOpenAt,\n                clicked: !!lastClickAt,\n                lastClickAt,\n                // replies (existing)\n                replied: !!(r.replied || r.repliesCount || r.lastReplyAt),\n                lastReplyAt: r.lastReplyAt ?? null,\n                lastReplySnippet: r.lastReplySnippet ?? null,\n                repliesCount: typeof r.repliesCount === \"number\" ? r.repliesCount : r.replied ? 1 : 0,\n                // followup progress (new / improved)\n                followupsCompleted: completed,\n                nextFollowUpStep: nextStep,\n                // ledger-backed plan + progression fields\n                followUpPlan: followUpPlanOut,\n                nextFollowUpAt: r.nextFollowUpAt ? new Date(r.nextFollowUpAt).toISOString() : null,\n                followUpStatus: r.followUpStatus ?? null,\n                lastStepSentAt: r.lastStepSentAt ? new Date(r.lastStepSentAt).toISOString() : null,\n                currentStepIndex,\n                currentStepName,\n                currentStepAttempts,\n                currentStepBgAttempts,\n                // skipped info: prefer ledger values, fall back to aggregated events\n                lastFollowupSkippedAt: lastSkippedAtFromLedger ?? fuInfo.lastSkippedAt ?? null,\n                lastFollowupSkippedReason: lastSkippedReasonFromLedger ?? fuInfo.lastSkippedReason ?? null\n            };\n        });\n        // Available statuses\n        let availableStatuses = [];\n        try {\n            availableStatuses = await db.collection(\"campaign_contacts\").distinct(\"status\", {\n                campaignId: campaignIdObj ?? campaignIdStr\n            });\n            availableStatuses = (availableStatuses || []).filter(Boolean);\n        } catch (e) {\n        // ignore\n        }\n        const pages = Math.max(1, Math.ceil(total / pageSize));\n        return res.status(200).json({\n            items,\n            total,\n            page,\n            pages,\n            pageSize,\n            availableStatuses\n        });\n    } catch (err) {\n        console.error(\"Contacts API error\", err);\n        return res.status(500).json({\n            error: \"Internal server error\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvY2FtcGFpZ24vW2lkXS9jb250YWN0cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsc0NBQXNDO0FBRVk7QUFDZjtBQUVuQyxTQUFTRSxpQkFBaUJDLENBQU07SUFDOUIsSUFBSSxDQUFDQSxHQUFHLE9BQU87SUFDZixJQUFJLE9BQU9BLE1BQU0sWUFBWUEsYUFBYUYsNkNBQVFBLEVBQUUsT0FBT0U7SUFDM0QsSUFBSSxPQUFPQSxNQUFNLFlBQVksb0JBQW9CQyxJQUFJLENBQUNELElBQUk7UUFDeEQsSUFBSTtZQUFFLE9BQU8sSUFBSUYsNkNBQVFBLENBQUNFO1FBQUksRUFBRSxPQUFNO1lBQUUsT0FBTztRQUFNO0lBQ3ZEO0lBQ0EsT0FBTztBQUNUO0FBRWUsZUFBZUUsUUFBUUMsR0FBbUIsRUFBRUMsR0FBb0I7SUFDN0UsSUFBSUQsSUFBSUUsTUFBTSxLQUFLLE9BQU8sT0FBT0QsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztRQUFFQyxPQUFPO0lBQXFCO0lBRXBGLE1BQU0sRUFBRUMsRUFBRSxFQUFFLEdBQUdOLElBQUlPLEtBQUs7SUFDeEIsSUFBSSxDQUFDRCxNQUFNLE9BQU9BLE9BQU8sVUFBVSxPQUFPTCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1FBQUVDLE9BQU87SUFBc0I7SUFFOUYsTUFBTUYsU0FBUyxPQUFPSCxJQUFJTyxLQUFLLENBQUNKLE1BQU0sS0FBSyxXQUFXSCxJQUFJTyxLQUFLLENBQUNKLE1BQU0sR0FBR0s7SUFDekUsTUFBTUMsT0FBT0MsS0FBS0MsR0FBRyxDQUFDLEdBQUdDLE9BQU9aLElBQUlPLEtBQUssQ0FBQ0UsSUFBSSxHQUFHRyxPQUFPWixJQUFJTyxLQUFLLENBQUNFLElBQUksSUFBSTtJQUMxRSxNQUFNSSxXQUFXSCxLQUFLQyxHQUFHLENBQUMsR0FBR0MsT0FBT1osSUFBSU8sS0FBSyxDQUFDTSxRQUFRLEdBQUdELE9BQU9aLElBQUlPLEtBQUssQ0FBQ00s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MkIxQywrQkFBZ0NMLE9BQU9WLGlCQUFpQixJQUFJO1lBQ3pGO1FBQ0Y7UUFFQSxxQkFBcUI7UUFDckIsSUFBSTBELG9CQUE4QixFQUFFO1FBQ3BDLElBQUk7WUFDRkEsb0JBQW9CLE1BQU0xSSxHQUFHTyxVQUFVLENBQUMscUJBQXFCb0ksUUFBUSxDQUFDLFVBQVU7Z0JBQUV0SSxZQUFZRixpQkFBaUJGO1lBQWM7WUFDN0h5SSxvQkFBb0IsQ0FBQ0EscUJBQXFCLEVBQUUsRUFBRXJILE1BQU0sQ0FBQ0M7UUFDdkQsRUFBRSxPQUFPOEMsR0FBRztRQUNWLFNBQVM7UUFDWDtRQUVBLE1BQU13RSxRQUFRakosS0FBS0MsR0FBRyxDQUFDLEdBQUdELEtBQUtrSixJQUFJLENBQUN2SSxRQUFRUjtRQUU1QyxPQUFPWixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCbUc7WUFDQWxGO1lBQ0FaO1lBQ0FrSjtZQUNBOUk7WUFDQTRJO1FBQ0Y7SUFDRixFQUFFLE9BQU9JLEtBQUs7UUFDWnpFLFFBQVEvRSxLQUFLLENBQUMsc0JBQXNCd0o7UUFDcEMsT0FBTzVKLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF3QjtJQUMvRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFya2V0aW5nLW12cC8uL3BhZ2VzL2FwaS9jYW1wYWlnbi9baWRdL2NvbnRhY3RzLnRzPzI3NGIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvYXBpL2NhbXBhaWduL1tpZF0vY29udGFjdHMudHNcclxuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCBjbGllbnRQcm9taXNlIGZyb20gJy4uLy4uLy4uLy4uL2xpYi9tb25nbyc7XHJcbmltcG9ydCB7IE9iamVjdElkIH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5mdW5jdGlvbiB0cnlQYXJzZU9iamVjdElkKHM6IGFueSkge1xyXG4gIGlmICghcykgcmV0dXJuIG51bGw7XHJcbiAgaWYgKHR5cGVvZiBzID09PSAnb2JqZWN0JyAmJiBzIGluc3RhbmNlb2YgT2JqZWN0SWQpIHJldHVybiBzO1xyXG4gIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycgJiYgL15bMC05YS1mQS1GXXsyNH0kLy50ZXN0KHMpKSB7XHJcbiAgICB0cnkgeyByZXR1cm4gbmV3IE9iamVjdElkKHMpOyB9IGNhdGNoIHsgcmV0dXJuIG51bGw7IH1cclxuICB9XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gJ0dFVCcpIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcclxuXHJcbiAgY29uc3QgeyBpZCB9ID0gcmVxLnF1ZXJ5O1xyXG4gIGlmICghaWQgfHwgdHlwZW9mIGlkICE9PSAnc3RyaW5nJykgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdJbnZhbGlkIGNhbXBhaWduIGlkJyB9KTtcclxuXHJcbiAgY29uc3Qgc3RhdHVzID0gdHlwZW9mIHJlcS5xdWVyeS5zdGF0dXMgPT09ICdzdHJpbmcnID8gcmVxLnF1ZXJ5LnN0YXR1cyA6IHVuZGVmaW5lZDtcclxuICBjb25zdCBwYWdlID0gTWF0aC5tYXgoMSwgTnVtYmVyKHJlcS5xdWVyeS5wYWdlID8gTnVtYmVyKHJlcS5xdWVyeS5wYWdlKSA6IDEpKTtcclxuICBjb25zdCBwYWdlU2l6ZSA9IE1hdGgubWF4KDEsIE51bWJlcihyZXEucXVlcnkucGFnZVNpemUgPyBOdW1iZXIocmVxLnF1ZXJ5LnBhZ2VTaXplKSA6IDI1KSk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBjbGllbnRQcm9taXNlO1xyXG4gICAgY29uc3QgZGIgPSBjbGllbnQuZGIoJ1BsYXRmb3JtRGF0YScpO1xyXG5cclxuICAgIGNvbnN0IGNhbXBhaWduSWRTdHIgPSBTdHJpbmcoaWQpO1xyXG4gICAgY29uc3QgY2FtcGFpZ25JZE9iaiA9IHRyeVBhcnNlT2JqZWN0SWQoY2FtcGFpZ25JZFN0cik7XHJcblxyXG4gICAgLy8gQmFzZSBmaWx0ZXIgZm9yIGNhbXBhaWduX2NvbnRhY3RzXHJcbiAgICBjb25zdCBiYXNlRmlsdGVyOiBhbnkgPSB7IGNhbXBhaWduSWQ6IGNhbXBhaWduSWRPYmogPz8gY2FtcGFpZ25JZFN0ciB9O1xyXG4gICAgaWYgKHN0YXR1cyAmJiBzdGF0dXMgIT09ICdhbGwnKSBiYXNlRmlsdGVyLnN0YXR1cyA9IHN0YXR1cztcclxuXHJcbiAgICAvLyBUb3RhbCBjb3VudFxyXG4gICAgbGV0IHRvdGFsID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS5jb3VudERvY3VtZW50cyhiYXNlRmlsdGVyKTtcclxuXHJcbiAgICAvLyBQYWdpbmF0aW9uXHJcbiAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIHBhZ2VTaXplO1xyXG4gICAgY29uc3QgY3Vyc29yID0gZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS5maW5kKGJhc2VGaWx0ZXIpLnNvcnQoeyBjcmVhdGVkQXQ6IDEgfSkuc2tpcChza2lwKS5saW1pdChwYWdlU2l6ZSk7XHJcblxyXG4gICAgY29uc3Qgcm93cyA9IGF3YWl0IGN1cnNvci50b0FycmF5KCk7XHJcblxyXG4gICAgLy8gQ29sbGVjdCBjb250YWN0SWRzIHByZXNlbnQgb24gdGhpcyBwYWdlXHJcbiAgICBjb25zdCBjb250YWN0SWRWYWx1ZXMgPSByb3dzLm1hcChyID0+IHIuY29udGFjdElkKS5maWx0ZXIoQm9vbGVhbik7XHJcblxyXG4gICAgLy8gQnVpbGQgYXJyYXlzIGZvciBPYmplY3RJZCB2cyBzdHJpbmcgY29udGFjdElkIGxvb2t1cHNcclxuICAgIGNvbnN0IGNvbnRhY3RPYmpJZHMgPSBjb250YWN0SWRWYWx1ZXNcclxuICAgICAgLm1hcCgodikgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICdvYmplY3QnICYmIHYgaW5zdGFuY2VvZiBPYmplY3RJZCkgcmV0dXJuIHY7XHJcbiAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICdzdHJpbmcnICYmIC9eWzAtOWEtZkEtRl17MjR9JC8udGVzdCh2KSkgcmV0dXJuIG5ldyBPYmplY3RJZCh2KTtcclxuICAgICAgICB9IGNhdGNoIHt9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5maWx0ZXIoQm9vbGVhbikgYXMgT2JqZWN0SWRbXTtcclxuXHJcbiAgICBjb25zdCBzdHJpbmdDb250YWN0SWRzID0gY29udGFjdElkVmFsdWVzXHJcbiAgICAgIC5tYXAoKHYpID0+ICh0eXBlb2YgdiA9PT0gJ3N0cmluZycgPyB2IDogKHYgJiYgdi50b1N0cmluZyA/IHYudG9TdHJpbmcoKSA6IG51bGwpKSlcclxuICAgICAgLmZpbHRlcihCb29sZWFuKSBhcyBzdHJpbmdbXTtcclxuXHJcbiAgICAvLyBGZXRjaCBjb250YWN0IGRldGFpbHMgKGVtYWlsKSBmb3IgdGhlc2UgY29udGFjdElkc1xyXG4gICAgbGV0IGNvbnRhY3REb2NzTWFwOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XHJcbiAgICBpZiAoY29udGFjdE9iaklkcy5sZW5ndGggfHwgc3RyaW5nQ29udGFjdElkcy5sZW5ndGgpIHtcclxuICAgICAgY29uc3QgY29udGFjdFF1ZXJ5OiBhbnkgPSB7ICRvcjogW10gYXMgYW55W10gfTtcclxuICAgICAgaWYgKGNvbnRhY3RPYmpJZHMubGVuZ3RoKSBjb250YWN0UXVlcnkuJG9yLnB1c2goeyBfaWQ6IHsgJGluOiBjb250YWN0T2JqSWRzIH0gfSk7XHJcbiAgICAgIGlmIChzdHJpbmdDb250YWN0SWRzLmxlbmd0aCkgY29udGFjdFF1ZXJ5LiRvci5wdXNoKHsgX2lkOiB7ICRpbjogc3RyaW5nQ29udGFjdElkcyB9IH0pO1xyXG4gICAgICBpZiAoY29udGFjdFF1ZXJ5LiRvci5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgY29uc3QgY29udGFjdERvY3MgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjb250YWN0cycpLmZpbmQoY29udGFjdFF1ZXJ5KS5wcm9qZWN0KHsgZW1haWw6IDEgfSkudG9BcnJheSgpO1xyXG4gICAgICAgIGZvciAoY29uc3QgYyBvZiBjb250YWN0RG9jcykgY29udGFjdERvY3NNYXBbKGMuX2lkICYmIGMuX2lkLnRvU3RyaW5nID8gYy5faWQudG9TdHJpbmcoKSA6IFN0cmluZyhjLl9pZCkpXSA9IGM7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyBQcmVmZXIgbGVkZ2VyIGZpZWxkcyAoY2FtcGFpZ25fY29udGFjdHMpIGZvciBlbmdhZ2VtZW50XHJcbiAgICAvLyBPbmx5IGFnZ3JlZ2F0ZSBjYW1wYWlnbl9ldmVudHMgZm9yIHRob3NlIGNvbnRhY3RJZHMgbWlzc2luZyBsZWRnZXIgZmllbGRzLlxyXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgIC8vIEluaXRpYWxpemUgbG9va3VwcyBmcm9tIGxlZGdlciByb3dzIHdoZW4gcG9zc2libGVcclxuICAgIGNvbnN0IG9wZW5Mb29rdXA6IFJlY29yZDxzdHJpbmcsIHN0cmluZyB8IG51bGw+ID0ge307XHJcbiAgICBjb25zdCBjbGlja0xvb2t1cDogUmVjb3JkPHN0cmluZywgc3RyaW5nIHwgbnVsbD4gPSB7fTtcclxuXHJcbiAgICAvLyBLZWVwIGEgbGlzdCBvZiBjb250YWN0IGtleXMgdGhhdCBuZWVkIGV2ZW50LWFnZ3JlZ2F0aW9uIGZhbGxiYWNrXHJcbiAgICBjb25zdCBuZWVkT3BlbkFnZ0tleXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBjb25zdCBuZWVkQ2xpY2tBZ2dLZXlzOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICAgIGZvciAoY29uc3QgciBvZiByb3dzKSB7XHJcbiAgICAgIGNvbnN0IGNpZEtleSA9IHIuY29udGFjdElkICYmIHIuY29udGFjdElkLnRvU3RyaW5nID8gci5jb250YWN0SWQudG9TdHJpbmcoKSA6IFN0cmluZyhyLmNvbnRhY3RJZCA/PyAnJyk7XHJcbiAgICAgIC8vIGxlZGdlciBtaWdodCBhbHJlYWR5IGhhdmUgb3BlbmVkQXQvbGFzdENsaWNrQXQgKHdvcmtlciAmIHRyYWNraW5nIGVuZHBvaW50cyB1cGRhdGUgdGhlc2UpXHJcbiAgICAgIG9wZW5Mb29rdXBbY2lkS2V5XSA9IHIub3BlbmVkQXQgPyAobmV3IERhdGUoci5vcGVuZWRBdCkpLnRvSVNPU3RyaW5nKCkgOiBudWxsO1xyXG4gICAgICBjbGlja0xvb2t1cFtjaWRLZXldID0gci5sYXN0Q2xpY2tBdCA/IChuZXcgRGF0ZShyLmxhc3RDbGlja0F0KSkudG9JU09TdHJpbmcoKSA6IG51bGw7XHJcblxyXG4gICAgICBpZiAoIW9wZW5Mb29rdXBbY2lkS2V5XSkgbmVlZE9wZW5BZ2dLZXlzLnB1c2goY2lkS2V5KTtcclxuICAgICAgaWYgKCFjbGlja0xvb2t1cFtjaWRLZXldKSBuZWVkQ2xpY2tBZ2dLZXlzLnB1c2goY2lkS2V5KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBJZiBzb21lIHJvd3MgYXJlIG1pc3NpbmcgbGVkZ2VyIG9wZW4vY2xpY2sgaW5mbywgYWdncmVnYXRlIGV2ZW50cyBvbmx5IGZvciB0aG9zZSBrZXlzXHJcbiAgICBpZiAoY29udGFjdElkVmFsdWVzLmxlbmd0aCA+IDAgJiYgKG5lZWRPcGVuQWdnS2V5cy5sZW5ndGggPiAwIHx8IG5lZWRDbGlja0FnZ0tleXMubGVuZ3RoID4gMCkpIHtcclxuICAgICAgLy8gQnVpbGQgbWFwcGluZyBiYWNrIHRvIHRoZSB0d28gZm9ybXMgKE9iamVjdElkIHZzIHN0cmluZykgZm9yIG9ubHkgdGhlIG1pc3Npbmcgb25lc1xyXG4gICAgICBjb25zdCBtaXNzaW5nT2JqSWRzRm9yT3BlbjogT2JqZWN0SWRbXSA9IFtdO1xyXG4gICAgICBjb25zdCBtaXNzaW5nU3RySWRzRm9yT3Blbjogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICAgIGNvbnN0IG1pc3NpbmdPYmpJZHNGb3JDbGljazogT2JqZWN0SWRbXSA9IFtdO1xyXG4gICAgICBjb25zdCBtaXNzaW5nU3RySWRzRm9yQ2xpY2s6IHN0cmluZ1tdID0gW107XHJcblxyXG4gICAgICAvLyBDcmVhdGUgcmV2ZXJzZSBtYXAgZnJvbSBrZXkgLT4gb3JpZ2luYWwgdmFsdWUgdG8gZGVjaWRlIGlmIHRoYXQga2V5IGNvcnJlc3BvbmRzIHRvIGFuIE9iamVjdElkIG9yIHN0cmluZ1xyXG4gICAgICBjb25zdCBrZXlUb09yaWdpbmFsOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XHJcbiAgICAgIGZvciAoY29uc3QgdiBvZiBjb250YWN0SWRWYWx1ZXMpIHtcclxuICAgICAgICBjb25zdCBrZXkgPSAodiAmJiB2LnRvU3RyaW5nID8gdi50b1N0cmluZygpIDogU3RyaW5nKHYpKTtcclxuICAgICAgICBpZiAoIShrZXkgaW4ga2V5VG9PcmlnaW5hbCkpIGtleVRvT3JpZ2luYWxba2V5XSA9IHY7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIG5lZWRPcGVuQWdnS2V5cykge1xyXG4gICAgICAgIGNvbnN0IG9yaWcgPSBrZXlUb09yaWdpbmFsW2tleV07XHJcbiAgICAgICAgaWYgKCFvcmlnKSBjb250aW51ZTtcclxuICAgICAgICBpZiAodHlwZW9mIG9yaWcgPT09ICdvYmplY3QnICYmIG9yaWcgaW5zdGFuY2VvZiBPYmplY3RJZCkgbWlzc2luZ09iaklkc0Zvck9wZW4ucHVzaChvcmlnKTtcclxuICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb3JpZyA9PT0gJ3N0cmluZycgJiYgL15bMC05YS1mQS1GXXsyNH0kLy50ZXN0KG9yaWcpKSB7XHJcbiAgICAgICAgICB0cnkgeyBtaXNzaW5nT2JqSWRzRm9yT3Blbi5wdXNoKG5ldyBPYmplY3RJZChvcmlnKSk7IH0gY2F0Y2ggeyBtaXNzaW5nU3RySWRzRm9yT3Blbi5wdXNoKG9yaWcpOyB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIG1pc3NpbmdTdHJJZHNGb3JPcGVuLnB1c2goU3RyaW5nKG9yaWcpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIG5lZWRDbGlja0FnZ0tleXMpIHtcclxuICAgICAgICBjb25zdCBvcmlnID0ga2V5VG9PcmlnaW5hbFtrZXldO1xyXG4gICAgICAgIGlmICghb3JpZykgY29udGludWU7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBvcmlnID09PSAnb2JqZWN0JyAmJiBvcmlnIGluc3RhbmNlb2YgT2JqZWN0SWQpIG1pc3NpbmdPYmpJZHNGb3JDbGljay5wdXNoKG9yaWcpO1xyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvcmlnID09PSAnc3RyaW5nJyAmJiAvXlswLTlhLWZBLUZdezI0fSQvLnRlc3Qob3JpZykpIHtcclxuICAgICAgICAgIHRyeSB7IG1pc3NpbmdPYmpJZHNGb3JDbGljay5wdXNoKG5ldyBPYmplY3RJZChvcmlnKSk7IH0gY2F0Y2ggeyBtaXNzaW5nU3RySWRzRm9yQ2xpY2sucHVzaChvcmlnKTsgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBtaXNzaW5nU3RySWRzRm9yQ2xpY2sucHVzaChTdHJpbmcob3JpZykpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQnVpbGQgY2FtcGFpZ25JZCBtYXRjaCB0aGF0IGNvcGVzIHdpdGggT2JqZWN0SWQgb3Igc3RyaW5nXHJcbiAgICAgIGNvbnN0IGNhbXBhaWduSWRNYXRjaDogYW55ID0gY2FtcGFpZ25JZE9iaiA/IHsgJG9yOiBbeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkT2JqIH0sIHsgY2FtcGFpZ25JZDogY2FtcGFpZ25JZFN0ciB9XSB9IDogeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkU3RyIH07XHJcblxyXG4gICAgICAvLyBBZ2dyZWdhdGUgb3BlbnMgZm9yIG1pc3Npbmcga2V5c1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGNvbnRhY3RNYXRjaENsYXVzZXM6IGFueVtdID0gW107XHJcbiAgICAgICAgaWYgKG1pc3NpbmdPYmpJZHNGb3JPcGVuLmxlbmd0aCkgY29udGFjdE1hdGNoQ2xhdXNlcy5wdXNoKHsgY29udGFjdElkOiB7ICRpbjogbWlzc2luZ09iaklkc0Zvck9wZW4gfSB9KTtcclxuICAgICAgICBpZiAobWlzc2luZ1N0cklkc0Zvck9wZW4ubGVuZ3RoKSBjb250YWN0TWF0Y2hDbGF1c2VzLnB1c2goeyBjb250YWN0SWQ6IHsgJGluOiBtaXNzaW5nU3RySWRzRm9yT3BlbiB9IH0pO1xyXG5cclxuICAgICAgICBpZiAoY29udGFjdE1hdGNoQ2xhdXNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBjb25zdCBvcGVuQWdnID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fZXZlbnRzJykuYWdncmVnYXRlKFtcclxuICAgICAgICAgICAgeyAkbWF0Y2g6IHsgJGFuZDogWyBjYW1wYWlnbklkTWF0Y2gsIHsgdHlwZTogJ29wZW4nIH0sIHsgJG9yOiBjb250YWN0TWF0Y2hDbGF1c2VzIH0gXSB9IH0sXHJcbiAgICAgICAgICAgIHsgJGdyb3VwOiB7IF9pZDogJyRjb250YWN0SWQnLCBsYXN0T3BlbkF0OiB7ICRtYXg6ICckY3JlYXRlZEF0JyB9LCBvcGVuczogeyAkc3VtOiAxIH0gfSB9LFxyXG4gICAgICAgICAgXSkudG9BcnJheSgpO1xyXG5cclxuICAgICAgICAgIGZvciAoY29uc3QgbyBvZiBvcGVuQWdnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGsgPSAoby5faWQgJiYgby5faWQudG9TdHJpbmcpID8gby5faWQudG9TdHJpbmcoKSA6IFN0cmluZyhvLl9pZCk7XHJcbiAgICAgICAgICAgIG9wZW5Mb29rdXBba10gPSBvLmxhc3RPcGVuQXQgPyAobmV3IERhdGUoby5sYXN0T3BlbkF0KSkudG9JU09TdHJpbmcoKSA6IG51bGw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gYWdncmVnYXRlIG9wZW5zIGZvciBjb250YWN0cyBwYWdlIChmYWxsYmFjayknLCBlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQWdncmVnYXRlIGNsaWNrcyBmb3IgbWlzc2luZyBrZXlzXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgY29udGFjdE1hdGNoQ2xhdXNlczI6IGFueVtdID0gW107XHJcbiAgICAgICAgaWYgKG1pc3NpbmdPYmpJZHNGb3JDbGljay5sZW5ndGgpIGNvbnRhY3RNYXRjaENsYXVzZXMyLnB1c2goeyBjb250YWN0SWQ6IHsgJGluOiBtaXNzaW5nT2JqSWRzRm9yQ2xpY2sgfSB9KTtcclxuICAgICAgICBpZiAobWlzc2luZ1N0cklkc0ZvckNsaWNrLmxlbmd0aCkgY29udGFjdE1hdGNoQ2xhdXNlczIucHVzaCh7IGNvbnRhY3RJZDogeyAkaW46IG1pc3NpbmdTdHJJZHNGb3JDbGljayB9IH0pO1xyXG5cclxuICAgICAgICBpZiAoY29udGFjdE1hdGNoQ2xhdXNlczIubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgY29uc3QgY2xpY2tBZ2cgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbl9ldmVudHMnKS5hZ2dyZWdhdGUoW1xyXG4gICAgICAgICAgICB7ICRtYXRjaDogeyAkYW5kOiBbIGNhbXBhaWduSWRNYXRjaCwgeyB0eXBlOiAnY2xpY2snIH0sIHsgJG9yOiBjb250YWN0TWF0Y2hDbGF1c2VzMiB9IF0gfSB9LFxyXG4gICAgICAgICAgICB7ICRncm91cDogeyBfaWQ6ICckY29udGFjdElkJywgbGFzdENsaWNrQXQ6IHsgJG1heDogJyRjcmVhdGVkQXQnIH0sIGNsaWNrczogeyAkc3VtOiAxIH0gfSB9LFxyXG4gICAgICAgICAgXSkudG9BcnJheSgpO1xyXG5cclxuICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBjbGlja0FnZykge1xyXG4gICAgICAgICAgICBjb25zdCBrID0gKGMuX2lkICYmIGMuX2lkLnRvU3RyaW5nKSA/IGMuX2lkLnRvU3RyaW5nKCkgOiBTdHJpbmcoYy5faWQpO1xyXG4gICAgICAgICAgICBjbGlja0xvb2t1cFtrXSA9IGMubGFzdENsaWNrQXQgPyAobmV3IERhdGUoYy5sYXN0Q2xpY2tBdCkpLnRvSVNPU3RyaW5nKCkgOiBudWxsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGFnZ3JlZ2F0ZSBjbGlja3MgZm9yIGNvbnRhY3RzIHBhZ2UgKGZhbGxiYWNrKScsIGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8gTkVXOiBhZ2dyZWdhdGUgZm9sbG93dXBfc2VudCAmIGZvbGxvd3VwX3NraXBwZWQgZXZlbnRzIGZvciB0aGVzZSBwYWdlIGNvbnRhY3RJZHNcclxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgIGNvbnN0IGZvbGxvd3VwTG9va3VwOiBSZWNvcmQ8c3RyaW5nLCB7IGNvbXBsZXRlZDogbnVtYmVyOyBsYXN0U2tpcHBlZEF0Pzogc3RyaW5nIHwgbnVsbDsgbGFzdFNraXBwZWRSZWFzb24/OiBzdHJpbmcgfCBudWxsIH0+ID0ge307XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoY29udGFjdElkVmFsdWVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyBCdWlsZCBjb250YWN0IG1hdGNoIGNsYXVzZXMgdGhhdCBhY2NlcHQgT2JqZWN0SWQgb3Igc3RyaW5nIGlkc1xyXG4gICAgICAgIGNvbnN0IGNvbnRhY3RNYXRjaENsYXVzZXM6IGFueVtdID0gW107XHJcbiAgICAgICAgaWYgKGNvbnRhY3RPYmpJZHMubGVuZ3RoKSBjb250YWN0TWF0Y2hDbGF1c2VzLnB1c2goeyBjb250YWN0SWQ6IHsgJGluOiBjb250YWN0T2JqSWRzIH0gfSk7XHJcbiAgICAgICAgaWYgKHN0cmluZ0NvbnRhY3RJZHMubGVuZ3RoKSBjb250YWN0TWF0Y2hDbGF1c2VzLnB1c2goeyBjb250YWN0SWQ6IHsgJGluOiBzdHJpbmdDb250YWN0SWRzIH0gfSk7XHJcblxyXG4gICAgICAgIGlmIChjb250YWN0TWF0Y2hDbGF1c2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGNvbnN0IGNhbXBhaWduSWRNYXRjaDogYW55ID0gY2FtcGFpZ25JZE9iaiA/IHsgJG9yOiBbeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkT2JqIH0sIHsgY2FtcGFpZ25JZDogY2FtcGFpZ25JZFN0ciB9XSB9IDogeyBjYW1wYWlnbklkOiBjYW1wYWlnbklkU3RyIH07XHJcblxyXG4gICAgICAgICAgY29uc3QgZnVBZ2cgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbl9ldmVudHMnKS5hZ2dyZWdhdGUoW1xyXG4gICAgICAgICAgICB7ICRtYXRjaDogeyAkYW5kOiBbIGNhbXBhaWduSWRNYXRjaCwgeyB0eXBlOiB7ICRpbjogWydmb2xsb3d1cF9zZW50JywgJ2ZvbGxvd3VwX3NraXBwZWQnXSB9IH0sIHsgJG9yOiBjb250YWN0TWF0Y2hDbGF1c2VzIH0gXSB9IH0sXHJcbiAgICAgICAgICAgIHsgJGdyb3VwOiB7XHJcbiAgICAgICAgICAgICAgICBfaWQ6ICckY29udGFjdElkJyxcclxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogeyAkc3VtOiAxIH0sXHJcbiAgICAgICAgICAgICAgICBsYXN0U2tpcHBlZEF0OiB7ICRtYXg6IHsgJGNvbmQ6IFsgeyAkZXE6IFsnJHR5cGUnLCAnZm9sbG93dXBfc2tpcHBlZCddIH0sICckY3JlYXRlZEF0JywgbnVsbCBdIH0gfSxcclxuICAgICAgICAgICAgICAgIGxhc3RTa2lwcGVkUmVhc29uOiB7ICRtYXg6IHsgJGNvbmQ6IFsgeyAkZXE6IFsnJHR5cGUnLCAnZm9sbG93dXBfc2tpcHBlZCddIH0sICckc2tpcHBlZFJlYXNvbicsIG51bGwgXSB9IH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIF0pLnRvQXJyYXkoKTtcclxuXHJcbiAgICAgICAgICBmb3IgKGNvbnN0IGYgb2YgZnVBZ2cpIHtcclxuICAgICAgICAgICAgY29uc3QgayA9IChmLl9pZCAmJiBmLl9pZC50b1N0cmluZykgPyBmLl9pZC50b1N0cmluZygpIDogU3RyaW5nKGYuX2lkKTtcclxuICAgICAgICAgICAgZm9sbG93dXBMb29rdXBba10gPSB7XHJcbiAgICAgICAgICAgICAgY29tcGxldGVkOiAodHlwZW9mIGYuY29tcGxldGVkID09PSAnbnVtYmVyJyA/IGYuY29tcGxldGVkIDogTnVtYmVyKGYuY29tcGxldGVkIHx8IDApKSxcclxuICAgICAgICAgICAgICBsYXN0U2tpcHBlZEF0OiBmLmxhc3RTa2lwcGVkQXQgPyAobmV3IERhdGUoZi5sYXN0U2tpcHBlZEF0KSkudG9JU09TdHJpbmcoKSA6IG51bGwsXHJcbiAgICAgICAgICAgICAgbGFzdFNraXBwZWRSZWFzb246IGYubGFzdFNraXBwZWRSZWFzb24gPz8gbnVsbCxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gYWdncmVnYXRlIGZvbGxvd3VwIGV2ZW50cyBmb3IgY29udGFjdHMgcGFnZScsIGUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZldGNoIGNhbXBhaWduIGRvY3VtZW50IHRvIGtub3cgaG93IG1hbnkgZm9sbG93dXBzIGFyZSBjb25maWd1cmVkIChzYWZlIGZhbGxiYWNrKVxyXG4gICAgbGV0IGNhbXBhaWduRG9jOiBhbnkgPSBudWxsO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY2FtcGFpZ25Eb2MgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbnMnKS5maW5kT25lKHsgX2lkOiBjYW1wYWlnbklkT2JqID8/IGNhbXBhaWduSWRTdHIgfSk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIC8vIGlnbm9yZVxyXG4gICAgfVxyXG4gICAgY29uc3QgZm9sbG93VXBDb3VudCA9IEFycmF5LmlzQXJyYXkoY2FtcGFpZ25Eb2M/LmZvbGxvd1VwcykgPyBjYW1wYWlnbkRvYy5mb2xsb3dVcHMubGVuZ3RoIDogMDtcclxuXHJcbiAgICAvLyBCdWlsZCByZXNwb25zZSBpdGVtc1xyXG4gICAgY29uc3QgaXRlbXMgPSByb3dzLm1hcCgocjogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IGNpZEtleSA9IHIuY29udGFjdElkICYmIHIuY29udGFjdElkLnRvU3RyaW5nID8gci5jb250YWN0SWQudG9TdHJpbmcoKSA6IFN0cmluZyhyLmNvbnRhY3RJZCA/PyAnJyk7XHJcbiAgICAgIGNvbnN0IGNvbnRhY3REb2MgPSBjb250YWN0RG9jc01hcFtjaWRLZXldO1xyXG4gICAgICBjb25zdCBlbWFpbCA9IGNvbnRhY3REb2M/LmVtYWlsID8/IHIuZW1haWwgPz8gbnVsbDtcclxuXHJcbiAgICAgIGNvbnN0IGxhc3RPcGVuQXQgPSBvcGVuTG9va3VwW2NpZEtleV0gPz8gbnVsbDtcclxuICAgICAgY29uc3QgbGFzdENsaWNrQXQgPSBjbGlja0xvb2t1cFtjaWRLZXldID8/IG51bGw7XHJcblxyXG4gICAgICBjb25zdCBmdUluZm8gPSBmb2xsb3d1cExvb2t1cFtjaWRLZXldID8/IHsgY29tcGxldGVkOiAwIH07XHJcblxyXG4gICAgICAvLyBQcmVmZXIgbGVkZ2VyIGZvbGxvd1VwUGxhbiB3aGVuIHByZXNlbnQgZm9yIGFjY3VyYXRlIHByb2dyZXNzaW9uXHJcbiAgICAgIGNvbnN0IGxlZGdlclBsYW4gPSBBcnJheS5pc0FycmF5KHIuZm9sbG93VXBQbGFuKSA/IHIuZm9sbG93VXBQbGFuIDogbnVsbDtcclxuICAgICAgbGV0IGNvbXBsZXRlZEZyb21MZWRnZXI6IG51bWJlciB8IG51bGwgPSBudWxsO1xyXG4gICAgICBsZXQgbGFzdFNraXBwZWRBdEZyb21MZWRnZXI6IHN0cmluZyB8IG51bGwgPSBudWxsO1xyXG4gICAgICBsZXQgbGFzdFNraXBwZWRSZWFzb25Gcm9tTGVkZ2VyOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICAgICAgbGV0IHBsYW5Db3VudExvY2FsID0gZm9sbG93VXBDb3VudDtcclxuXHJcbiAgICAgIGlmIChsZWRnZXJQbGFuKSB7XHJcbiAgICAgICAgcGxhbkNvdW50TG9jYWwgPSBsZWRnZXJQbGFuLmxlbmd0aDtcclxuICAgICAgICBjb21wbGV0ZWRGcm9tTGVkZ2VyID0gbGVkZ2VyUGxhbi5maWx0ZXIoKHA6IGFueSkgPT4ge1xyXG4gICAgICAgICAgaWYgKHAgPT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgY29uc3Qgc3RhdHVzID0gKHAuc3RhdHVzIHx8ICcnKS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICBpZiAoc3RhdHVzID09PSAnc2VudCcgfHwgISFwLnNlbnRBdCkgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSkubGVuZ3RoO1xyXG5cclxuICAgICAgICAvLyBmaW5kIGxhc3Qgc2tpcHBlZCBlbnRyeSBpZiBhbnlcclxuICAgICAgICBjb25zdCBza2lwcGVkRW50cmllcyA9IGxlZGdlclBsYW4uZmlsdGVyKChwOiBhbnkpID0+IChwICYmIChwLnN0YXR1cyA9PT0gJ3NraXBwZWQnIHx8IHAuc2tpcHBlZEF0KSkpO1xyXG4gICAgICAgIGlmIChza2lwcGVkRW50cmllcy5sZW5ndGgpIHtcclxuICAgICAgICAgIC8vIHBpY2sgbGF0ZXN0IHNraXBwZWRBdCAoaWYgcHJlc2VudCkgZWxzZSBudWxsXHJcbiAgICAgICAgICBjb25zdCBsYXRlc3QgPSBza2lwcGVkRW50cmllcy5yZWR1Y2UoKGFjYzogYW55LCBjdXI6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjdXJEYXRlID0gY3VyLnNraXBwZWRBdCA/IG5ldyBEYXRlKGN1ci5za2lwcGVkQXQpIDogbnVsbDtcclxuICAgICAgICAgICAgaWYgKCFhY2MpIHJldHVybiBjdXI7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjY0RhdGUgPSBhY2Muc2tpcHBlZEF0ID8gbmV3IERhdGUoYWNjLnNraXBwZWRBdCkgOiBudWxsO1xyXG4gICAgICAgICAgICBpZiAoY3VyRGF0ZSAmJiBhY2NEYXRlKSByZXR1cm4gY3VyRGF0ZS5nZXRUaW1lKCkgPiBhY2NEYXRlLmdldFRpbWUoKSA/IGN1ciA6IGFjYztcclxuICAgICAgICAgICAgaWYgKGN1ckRhdGUgJiYgIWFjY0RhdGUpIHJldHVybiBjdXI7XHJcbiAgICAgICAgICAgIHJldHVybiBhY2M7XHJcbiAgICAgICAgICB9LCBudWxsKTtcclxuICAgICAgICAgIGlmIChsYXRlc3QpIHtcclxuICAgICAgICAgICAgbGFzdFNraXBwZWRBdEZyb21MZWRnZXIgPSBsYXRlc3Quc2tpcHBlZEF0ID8gKG5ldyBEYXRlKGxhdGVzdC5za2lwcGVkQXQpKS50b0lTT1N0cmluZygpIDogbnVsbDtcclxuICAgICAgICAgICAgbGFzdFNraXBwZWRSZWFzb25Gcm9tTGVkZ2VyID0gbGF0ZXN0LnNraXBwZWRSZWFzb24gPz8gbnVsbDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGNvbXBsZXRlZCA9ICh0eXBlb2YgY29tcGxldGVkRnJvbUxlZGdlciA9PT0gJ251bWJlcicpID8gY29tcGxldGVkRnJvbUxlZGdlciA6IChmdUluZm8uY29tcGxldGVkID8/IDApO1xyXG4gICAgICBjb25zdCBuZXh0U3RlcCA9ICh0eXBlb2YgY29tcGxldGVkID09PSAnbnVtYmVyJyAmJiBjb21wbGV0ZWQgPCAocGxhbkNvdW50TG9jYWwgfHwgMCkpID8gKGNvbXBsZXRlZCArIDEpIDogbnVsbDtcclxuXHJcbiAgICAgIC8vIE5vcm1hbGl6ZSBmb2xsb3dVcFBsYW4gZm9yIEFQSSBvdXRwdXQgKGNvbnZlcnQgRGF0ZS1saWtlIHRvIElTTyBzdHJpbmdzKVxyXG4gICAgICBjb25zdCBmb2xsb3dVcFBsYW5PdXQgPSAobGVkZ2VyUGxhbiB8fCBbXSkubWFwKChwOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgaW5kZXg6IHAuaW5kZXggPz8gbnVsbCxcclxuICAgICAgICAgIG5hbWU6IHAubmFtZSA/PyBudWxsLFxyXG4gICAgICAgICAgcnVsZTogcC5ydWxlID8/IG51bGwsXHJcbiAgICAgICAgICBzdGF0dXM6IHAuc3RhdHVzID8/IG51bGwsXHJcbiAgICAgICAgICBzY2hlZHVsZWRGb3I6IHAuc2NoZWR1bGVkRm9yID8gKG5ldyBEYXRlKHAuc2NoZWR1bGVkRm9yKSkudG9JU09TdHJpbmcoKSA6IChwLnNjaGVkdWxlZEZvciA/IFN0cmluZyhwLnNjaGVkdWxlZEZvcikgOiBudWxsKSxcclxuICAgICAgICAgIHNlbnRBdDogcC5zZW50QXQgPyAobmV3IERhdGUocC5zZW50QXQpKS50b0lTT1N0cmluZygpIDogbnVsbCxcclxuICAgICAgICAgIHNraXBwZWRBdDogcC5za2lwcGVkQXQgPyAobmV3IERhdGUocC5za2lwcGVkQXQpKS50b0lTT1N0cmluZygpIDogbnVsbCxcclxuICAgICAgICAgIHNraXBwZWRSZWFzb246IHAuc2tpcHBlZFJlYXNvbiA/PyBudWxsLFxyXG4gICAgICAgICAgZGVsYXlNaW51dGVzOiB0eXBlb2YgcC5kZWxheU1pbnV0ZXMgPT09ICdudW1iZXInID8gcC5kZWxheU1pbnV0ZXMgOiAocC5kZWxheU1pbnV0ZXMgPyBOdW1iZXIocC5kZWxheU1pbnV0ZXMpIDogbnVsbCksXHJcbiAgICAgICAgfTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBTdGVwLXNjb3BlZCBjb3VudGVycyAobmV3IG1vZGVsKTogcHJlZmVyIGV4cGxpY2l0IGN1cnJlbnRTdGVwIGZpZWxkcyBpZiBwcmVzZW50LCBvdGhlcndpc2UgZmFsbCBiYWNrLlxyXG4gICAgICBjb25zdCBjdXJyZW50U3RlcEluZGV4ID0gKHR5cGVvZiByLmN1cnJlbnRTdGVwSW5kZXggPT09ICdudW1iZXInIHx8IChyLmN1cnJlbnRTdGVwSW5kZXggIT0gbnVsbCkpID8gTnVtYmVyKHIuY3VycmVudFN0ZXBJbmRleCkgOiAoci5jdXJyZW50U3RlcEluZGV4ID8gTnVtYmVyKHIuY3VycmVudFN0ZXBJbmRleCkgOiBudWxsKTtcclxuICAgICAgY29uc3QgY3VycmVudFN0ZXBOYW1lID0gci5jdXJyZW50U3RlcE5hbWUgPz8gbnVsbDtcclxuICAgICAgY29uc3QgY3VycmVudFN0ZXBBdHRlbXB0cyA9IHR5cGVvZiByLmN1cnJlbnRTdGVwQXR0ZW1wdHMgPT09ICdudW1iZXInID8gci5jdXJyZW50U3RlcEF0dGVtcHRzIDogKHR5cGVvZiByLmF0dGVtcHRzID09PSAnbnVtYmVyJyA/IHIuYXR0ZW1wdHMgOiAwKTtcclxuICAgICAgY29uc3QgY3VycmVudFN0ZXBCZ0F0dGVtcHRzID0gdHlwZW9mIHIuY3VycmVudFN0ZXBCZ0F0dGVtcHRzID09PSAnbnVtYmVyJyA/IHIuY3VycmVudFN0ZXBCZ0F0dGVtcHRzIDogKHR5cGVvZiByLmJnQXR0ZW1wdHMgPT09ICdudW1iZXInID8gci5iZ0F0dGVtcHRzIDogMCk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGlkOiByLl9pZD8udG9TdHJpbmc/LigpID8/IFN0cmluZyhyLl9pZCksXHJcbiAgICAgICAgY29udGFjdElkOiByLmNvbnRhY3RJZCAmJiByLmNvbnRhY3RJZC50b1N0cmluZyA/IHIuY29udGFjdElkLnRvU3RyaW5nKCkgOiBTdHJpbmcoci5jb250YWN0SWQgPz8gbnVsbCksXHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgc3RhdHVzOiByLnN0YXR1cyA/PyBudWxsLFxyXG4gICAgICAgIC8vIGF0dGVtcHRzIHJlZmxlY3QgYWN0aXZlIHN0ZXAgYXR0ZW1wdHMgdW5kZXIgdGhlIG5ldyBtb2RlbDsga2VlcCBleHBsaWNpdCBmaWVsZHMgYXMgd2VsbFxyXG4gICAgICAgIGF0dGVtcHRzOiB0eXBlb2Ygci5hdHRlbXB0cyA9PT0gJ251bWJlcicgPyByLmF0dGVtcHRzIDogMCxcclxuICAgICAgICBiZ0F0dGVtcHRzOiB0eXBlb2Ygci5iZ0F0dGVtcHRzID09PSAnbnVtYmVyJyA/IHIuYmdBdHRlbXB0cyA6IDAsXHJcbiAgICAgICAgbGFzdEF0dGVtcHRBdDogci5sYXN0QXR0ZW1wdEF0ID8gbmV3IERhdGUoci5sYXN0QXR0ZW1wdEF0KS50b0lTT1N0cmluZygpIDogbnVsbCxcclxuICAgICAgICBsYXN0RXJyb3I6IHIubGFzdEVycm9yID8/IG51bGwsXHJcbiAgICAgICAgb3BlbmVkOiAhIWxhc3RPcGVuQXQsXHJcbiAgICAgICAgbGFzdE9wZW5BdCxcclxuICAgICAgICBjbGlja2VkOiAhIWxhc3RDbGlja0F0LFxyXG4gICAgICAgIGxhc3RDbGlja0F0LFxyXG4gICAgICAgIC8vIHJlcGxpZXMgKGV4aXN0aW5nKVxyXG4gICAgICAgIHJlcGxpZWQ6ICEhKHIucmVwbGllZCB8fCByLnJlcGxpZXNDb3VudCB8fCByLmxhc3RSZXBseUF0KSxcclxuICAgICAgICBsYXN0UmVwbHlBdDogci5sYXN0UmVwbHlBdCA/PyBudWxsLFxyXG4gICAgICAgIGxhc3RSZXBseVNuaXBwZXQ6IHIubGFzdFJlcGx5U25pcHBldCA/PyBudWxsLFxyXG4gICAgICAgIHJlcGxpZXNDb3VudDogdHlwZW9mIHIucmVwbGllc0NvdW50ID09PSAnbnVtYmVyJyA/IHIucmVwbGllc0NvdW50IDogKHIucmVwbGllZCA/IDEgOiAwKSxcclxuICAgICAgICAvLyBmb2xsb3d1cCBwcm9ncmVzcyAobmV3IC8gaW1wcm92ZWQpXHJcbiAgICAgICAgZm9sbG93dXBzQ29tcGxldGVkOiBjb21wbGV0ZWQsXHJcbiAgICAgICAgbmV4dEZvbGxvd1VwU3RlcDogbmV4dFN0ZXAsIC8vIDEtYmFzZWQgaW5kZXggb3IgbnVsbFxyXG4gICAgICAgIC8vIGxlZGdlci1iYWNrZWQgcGxhbiArIHByb2dyZXNzaW9uIGZpZWxkc1xyXG4gICAgICAgIGZvbGxvd1VwUGxhbjogZm9sbG93VXBQbGFuT3V0LFxyXG4gICAgICAgIG5leHRGb2xsb3dVcEF0OiByLm5leHRGb2xsb3dVcEF0ID8gKG5ldyBEYXRlKHIubmV4dEZvbGxvd1VwQXQpKS50b0lTT1N0cmluZygpIDogbnVsbCxcclxuICAgICAgICBmb2xsb3dVcFN0YXR1czogci5mb2xsb3dVcFN0YXR1cyA/PyBudWxsLFxyXG4gICAgICAgIGxhc3RTdGVwU2VudEF0OiByLmxhc3RTdGVwU2VudEF0ID8gKG5ldyBEYXRlKHIubGFzdFN0ZXBTZW50QXQpKS50b0lTT1N0cmluZygpIDogbnVsbCxcclxuICAgICAgICBjdXJyZW50U3RlcEluZGV4LFxyXG4gICAgICAgIGN1cnJlbnRTdGVwTmFtZSxcclxuICAgICAgICBjdXJyZW50U3RlcEF0dGVtcHRzLFxyXG4gICAgICAgIGN1cnJlbnRTdGVwQmdBdHRlbXB0cyxcclxuICAgICAgICAvLyBza2lwcGVkIGluZm86IHByZWZlciBsZWRnZXIgdmFsdWVzLCBmYWxsIGJhY2sgdG8gYWdncmVnYXRlZCBldmVudHNcclxuICAgICAgICBsYXN0Rm9sbG93dXBTa2lwcGVkQXQ6IGxhc3RTa2lwcGVkQXRGcm9tTGVkZ2VyID8/IChmdUluZm8ubGFzdFNraXBwZWRBdCA/PyBudWxsKSxcclxuICAgICAgICBsYXN0Rm9sbG93dXBTa2lwcGVkUmVhc29uOiBsYXN0U2tpcHBlZFJlYXNvbkZyb21MZWRnZXIgPz8gKGZ1SW5mby5sYXN0U2tpcHBlZFJlYXNvbiA/PyBudWxsKSxcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEF2YWlsYWJsZSBzdGF0dXNlc1xyXG4gICAgbGV0IGF2YWlsYWJsZVN0YXR1c2VzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXZhaWxhYmxlU3RhdHVzZXMgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjYW1wYWlnbl9jb250YWN0cycpLmRpc3RpbmN0KCdzdGF0dXMnLCB7IGNhbXBhaWduSWQ6IGNhbXBhaWduSWRPYmogPz8gY2FtcGFpZ25JZFN0ciB9KTtcclxuICAgICAgYXZhaWxhYmxlU3RhdHVzZXMgPSAoYXZhaWxhYmxlU3RhdHVzZXMgfHwgW10pLmZpbHRlcihCb29sZWFuKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgLy8gaWdub3JlXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGFnZXMgPSBNYXRoLm1heCgxLCBNYXRoLmNlaWwodG90YWwgLyBwYWdlU2l6ZSkpO1xyXG5cclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIGl0ZW1zLFxyXG4gICAgICB0b3RhbCxcclxuICAgICAgcGFnZSxcclxuICAgICAgcGFnZXMsXHJcbiAgICAgIHBhZ2VTaXplLFxyXG4gICAgICBhdmFpbGFibGVTdGF0dXNlcyxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS5lcnJvcignQ29udGFjdHMgQVBJIGVycm9yJywgZXJyKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbImNsaWVudFByb21pc2UiLCJPYmplY3RJZCIsInRyeVBhcnNlT2JqZWN0SWQiLCJzIiwidGVzdCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJpZCIsInF1ZXJ5IiwidW5kZWZpbmVkIiwicGFnZSIsIk1hdGgiLCJtYXgiLCJOdW1iZXIiLCJwYWdlU2l6ZSIsImNsaWVudCIsImRiIiwiY2FtcGFpZ25JZFN0ciIsIlN0cmluZyIsImNhbXBhaWduSWRPYmoiLCJiYXNlRmlsdGVyIiwiY2FtcGFpZ25JZCIsInRvdGFsIiwiY29sbGVjdGlvbiIsImNvdW50RG9jdW1lbnRzIiwic2tpcCIsImN1cnNvciIsImZpbmQiLCJzb3J0IiwiY3JlYXRlZEF0IiwibGltaXQiLCJyb3dzIiwidG9BcnJheSIsImNvbnRhY3RJZFZhbHVlcyIsIm1hcCIsInIiLCJjb250YWN0SWQiLCJmaWx0ZXIiLCJCb29sZWFuIiwiY29udGFjdE9iaklkcyIsInYiLCJzdHJpbmdDb250YWN0SWRzIiwidG9TdHJpbmciLCJjb250YWN0RG9jc01hcCIsImxlbmd0aCIsImNvbnRhY3RRdWVyeSIsIiRvciIsInB1c2giLCJfaWQiLCIkaW4iLCJjb250YWN0RG9jcyIsInByb2plY3QiLCJlbWFpbCIsImMiLCJvcGVuTG9va3VwIiwiY2xpY2tMb29rdXAiLCJuZWVkT3BlbkFnZ0tleXMiLCJuZWVkQ2xpY2tBZ2dLZXlzIiwiY2lkS2V5Iiwib3BlbmVkQXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJsYXN0Q2xpY2tBdCIsIm1pc3NpbmdPYmpJZHNGb3JPcGVuIiwibWlzc2luZ1N0cklkc0Zvck9wZW4iLCJtaXNzaW5nT2JqSWRzRm9yQ2xpY2siLCJtaXNzaW5nU3RySWRzRm9yQ2xpY2siLCJrZXlUb09yaWdpbmFsIiwia2V5Iiwib3JpZyIsImNhbXBhaWduSWRNYXRjaCIsImNvbnRhY3RNYXRjaENsYXVzZXMiLCJvcGVuQWdnIiwiYWdncmVnYXRlIiwiJG1hdGNoIiwiJGFuZCIsInR5cGUiLCIkZ3JvdXAiLCJsYXN0T3BlbkF0IiwiJG1heCIsIm9wZW5zIiwiJHN1bSIsIm8iLCJrIiwiZSIsImNvbnNvbGUiLCJ3YXJuIiwiY29udGFjdE1hdGNoQ2xhdXNlczIiLCJjbGlja0FnZyIsImNsaWNrcyIsImZvbGxvd3VwTG9va3VwIiwiZnVBZ2ciLCJjb21wbGV0ZWQiLCJsYXN0U2tpcHBlZEF0IiwiJGNvbmQiLCIkZXEiLCJsYXN0U2tpcHBlZFJlYXNvbiIsImYiLCJjYW1wYWlnbkRvYyIsImZpbmRPbmUiLCJmb2xsb3dVcENvdW50IiwiQXJyYXkiLCJpc0FycmF5IiwiZm9sbG93VXBzIiwiaXRlbXMiLCJjb250YWN0RG9jIiwiZnVJbmZvIiwibGVkZ2VyUGxhbiIsImZvbGxvd1VwUGxhbiIsImNvbXBsZXRlZEZyb21MZWRnZXIiLCJsYXN0U2tpcHBlZEF0RnJvbUxlZGdlciIsImxhc3RTa2lwcGVkUmVhc29uRnJvbUxlZGdlciIsInBsYW5Db3VudExvY2FsIiwicCIsInRvTG93ZXJDYXNlIiwic2VudEF0Iiwic2tpcHBlZEVudHJpZXMiLCJza2lwcGVkQXQiLCJsYXRlc3QiLCJyZWR1Y2UiLCJhY2MiLCJjdXIiLCJjdXJEYXRlIiwiYWNjRGF0ZSIsImdldFRpbWUiLCJza2lwcGVkUmVhc29uIiwibmV4dFN0ZXAiLCJmb2xsb3dVcFBsYW5PdXQiLCJpbmRleCIsIm5hbWUiLCJydWxlIiwic2NoZWR1bGVkRm9yIiwiZGVsYXlNaW51dGVzIiwiY3VycmVudFN0ZXBJbmRleCIsImN1cnJlbnRTdGVwTmFtZSIsImN1cnJlbnRTdGVwQXR0ZW1wdHMiLCJhdHRlbXB0cyIsImN1cnJlbnRTdGVwQmdBdHRlbXB0cyIsImJnQXR0ZW1wdHMiLCJsYXN0QXR0ZW1wdEF0IiwibGFzdEVycm9yIiwib3BlbmVkIiwiY2xpY2tlZCIsInJlcGxpZWQiLCJyZXBsaWVzQ291bnQiLCJsYXN0UmVwbHlBdCIsImxhc3RSZXBseVNuaXBwZXQiLCJmb2xsb3d1cHNDb21wbGV0ZWQiLCJuZXh0Rm9sbG93VXBTdGVwIiwibmV4dEZvbGxvd1VwQXQiLCJmb2xsb3dVcFN0YXR1cyIsImxhc3RTdGVwU2VudEF0IiwibGFzdEZvbGxvd3VwU2tpcHBlZEF0IiwibGFzdEZvbGxvd3VwU2tpcHBlZFJlYXNvbiIsImF2YWlsYWJsZVN0YXR1c2VzIiwiZGlzdGluY3QiLCJwYWdlcyIsImNlaWwiLCJlcnIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/campaign/[id]/contacts.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fcontacts&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Ccontacts.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();