"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/campaign/[id]/events";
exports.ids = ["pages/api/campaign/[id]/events"];
exports.modules = {

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fevents&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Cevents.ts&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fevents&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Cevents.ts&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_campaign_id_events_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\campaign\\[id]\\events.ts */ \"(api)/./pages/api/campaign/[id]/events.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_id_events_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_id_events_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/campaign/[id]/events\",\n        pathname: \"/api/campaign/[id]/events\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_campaign_id_events_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNhbXBhaWduJTJGJTVCaWQlNUQlMkZldmVudHMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2NhbXBhaWduJTVDJTVCaWQlNUQlNUNldmVudHMudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDb0U7QUFDcEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLDZEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyw2REFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLz9jNTk5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcY2FtcGFpZ25cXFxcW2lkXVxcXFxldmVudHMudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jYW1wYWlnbi9baWRdL2V2ZW50c1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NhbXBhaWduL1tpZF0vZXZlbnRzXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fevents&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Cevents.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/redis.ts":
/*!**********************!*\
  !*** ./lib/redis.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   redis: () => (/* binding */ redis),\n/* harmony export */   subscribe: () => (/* binding */ subscribe),\n/* harmony export */   subscribeToChannels: () => (/* binding */ subscribeToChannels)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n// lib/redis.ts\n\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(process.env.REDIS_URL || \"redis://127.0.0.1:6379\", {\n    maxRetriesPerRequest: null,\n    lazyConnect: true,\n    reconnectOnError: (err)=>{\n        const targetErrors = [\n            \"READONLY\",\n            \"ECONNRESET\",\n            \"ETIMEDOUT\"\n        ];\n        return targetErrors.some((e)=>err.message.includes(e));\n    }\n});\nredis.on(\"connect\", ()=>console.log(\"Redis connected\"));\nredis.on(\"ready\", ()=>console.log(\"Redis ready\"));\nredis.on(\"error\", (err)=>console.error(\"Redis error\", err));\nredis.on(\"close\", ()=>console.warn(\"Redis connection closed\"));\nredis.on(\"reconnecting\", ()=>console.log(\"Redis reconnecting\"));\n/**\r\n * Single-channel subscription helper\r\n */ function subscribe(channel, handler) {\n    const sub = redis.duplicate();\n    const onMessage = (ch, message)=>{\n        if (ch !== channel) return;\n        try {\n            handler(JSON.parse(message));\n        } catch  {\n            handler(message);\n        }\n    };\n    sub.on(\"message\", onMessage);\n    sub.subscribe(channel).catch((err)=>{\n        console.error(`Redis subscribe failed for ${channel}`, err);\n    });\n    return async ()=>{\n        try {\n            sub.off(\"message\", onMessage);\n            await sub.unsubscribe(channel);\n            await sub.quit();\n        } catch (err) {\n            console.warn(`Failed to unsubscribe from ${channel}`, err);\n        }\n    };\n}\n/**\r\n * Multi-channel subscriber (worker & SSE safe)\r\n */ async function subscribeToChannels(sub, channels, handler) {\n    for (const ch of channels){\n        await sub.subscribe(ch);\n    }\n    sub.on(\"message\", (channel, message)=>{\n        if (channels.includes(channel)) {\n            handler(channel, message);\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvcmVkaXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxlQUFlO0FBQ2U7QUFFdkIsTUFBTUMsUUFBUSxJQUFJRCxnREFBT0EsQ0FBQ0UsUUFBUUMsR0FBRyxDQUFDQyxTQUFTLElBQUksMEJBQTBCO0lBQ2xGQyxzQkFBc0I7SUFDdEJDLGFBQWE7SUFDYkMsa0JBQWtCLENBQUNDO1FBQ2pCLE1BQU1DLGVBQWU7WUFBQztZQUFZO1lBQWM7U0FBWTtRQUM1RCxPQUFPQSxhQUFhQyxJQUFJLENBQUMsQ0FBQ0MsSUFBTUgsSUFBSUksT0FBTyxDQUFDQyxRQUFRLENBQUNGO0lBQ3ZEO0FBQ0YsR0FBRztBQUVIVixNQUFNYSxFQUFFLENBQUMsV0FBVyxJQUFNQyxRQUFRQyxHQUFHLENBQUM7QUFDdENmLE1BQU1hLEVBQUUsQ0FBQyxTQUFTLElBQU1DLFFBQVFDLEdBQUcsQ0FBQztBQUNwQ2YsTUFBTWEsRUFBRSxDQUFDLFNBQVMsQ0FBQ04sTUFBUU8sUUFBUUUsS0FBSyxDQUFDLGVBQWVUO0FBQ3hEUCxNQUFNYSxFQUFFLENBQUMsU0FBUyxJQUFNQyxRQUFRRyxJQUFJLENBQUM7QUFDckNqQixNQUFNYSxFQUFFLENBQUMsZ0JBQWdCLElBQU1DLFFBQVFDLEdBQUcsQ0FBQztBQUUzQzs7Q0FFQyxHQUNNLFNBQVNHLFVBQ2RDLE9BQWUsRUFDZkMsT0FBNEI7SUFFNUIsTUFBTUMsTUFBTXJCLE1BQU1zQixTQUFTO0lBRTNCLE1BQU1DLFlBQVksQ0FBQ0MsSUFBWWI7UUFDN0IsSUFBSWEsT0FBT0wsU0FBUztRQUNwQixJQUFJO1lBQ0ZDLFFBQVFLLEtBQUtDLEtBQUssQ0FBQ2Y7UUFDckIsRUFBRSxPQUFNO1lBQ05TLFFBQVFUO1FBQ1Y7SUFDRjtJQUVBVSxJQUFJUixFQUFFLENBQUMsV0FBV1U7SUFFbEJGLElBQUlILFNBQVMsQ0FBQ0MsU0FBU1EsS0FBSyxDQUFDLENBQUNwQjtRQUM1Qk8sUUFBUUUsS0FBSyxDQUFDLENBQUMsMkJBQTJCLEVBQUVHLFFBQVEsQ0FBQyxFQUFFWjtJQUN6RDtJQUVBLE9BQU87UUFDTCxJQUFJO1lBQ0ZjLElBQUlPLEdBQUcsQ0FBQyxXQUFXTDtZQUNuQixNQUFNRixJQUFJUSxXQUFXLENBQUNWO1lBQ3RCLE1BQU1FLElBQUlTLElBQUk7UUFDaEIsRUFBRSxPQUFPdkIsS0FBSztZQUNaTyxRQUFRRyxJQUFJLENBQUMsQ0FBQywyQkFBMkIsRUFBRUUsUUFBUSxDQUFDLEVBQUVaO1FBQ3hEO0lBQ0Y7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZXdCLG9CQUNwQlYsR0FBWSxFQUNaVyxRQUFrQixFQUNsQlosT0FBbUQ7SUFFbkQsS0FBSyxNQUFNSSxNQUFNUSxTQUFVO1FBQ3pCLE1BQU1YLElBQUlILFNBQVMsQ0FBQ007SUFDdEI7SUFFQUgsSUFBSVIsRUFBRSxDQUFDLFdBQVcsQ0FBQ00sU0FBU1I7UUFDMUIsSUFBSXFCLFNBQVNwQixRQUFRLENBQUNPLFVBQVU7WUFDOUJDLFFBQVFELFNBQVNSO1FBQ25CO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL21hcmtldGluZy1tdnAvLi9saWIvcmVkaXMudHM/NTFlOSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvcmVkaXMudHNcclxuaW1wb3J0IElPUmVkaXMgZnJvbSBcImlvcmVkaXNcIjtcclxuXHJcbmV4cG9ydCBjb25zdCByZWRpcyA9IG5ldyBJT1JlZGlzKHByb2Nlc3MuZW52LlJFRElTX1VSTCB8fCBcInJlZGlzOi8vMTI3LjAuMC4xOjYzNzlcIiwge1xyXG4gIG1heFJldHJpZXNQZXJSZXF1ZXN0OiBudWxsLFxyXG4gIGxhenlDb25uZWN0OiB0cnVlLFxyXG4gIHJlY29ubmVjdE9uRXJyb3I6IChlcnIpID0+IHtcclxuICAgIGNvbnN0IHRhcmdldEVycm9ycyA9IFtcIlJFQURPTkxZXCIsIFwiRUNPTk5SRVNFVFwiLCBcIkVUSU1FRE9VVFwiXTtcclxuICAgIHJldHVybiB0YXJnZXRFcnJvcnMuc29tZSgoZSkgPT4gZXJyLm1lc3NhZ2UuaW5jbHVkZXMoZSkpO1xyXG4gIH0sXHJcbn0pO1xyXG5cclxucmVkaXMub24oXCJjb25uZWN0XCIsICgpID0+IGNvbnNvbGUubG9nKFwiUmVkaXMgY29ubmVjdGVkXCIpKTtcclxucmVkaXMub24oXCJyZWFkeVwiLCAoKSA9PiBjb25zb2xlLmxvZyhcIlJlZGlzIHJlYWR5XCIpKTtcclxucmVkaXMub24oXCJlcnJvclwiLCAoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiUmVkaXMgZXJyb3JcIiwgZXJyKSk7XHJcbnJlZGlzLm9uKFwiY2xvc2VcIiwgKCkgPT4gY29uc29sZS53YXJuKFwiUmVkaXMgY29ubmVjdGlvbiBjbG9zZWRcIikpO1xyXG5yZWRpcy5vbihcInJlY29ubmVjdGluZ1wiLCAoKSA9PiBjb25zb2xlLmxvZyhcIlJlZGlzIHJlY29ubmVjdGluZ1wiKSk7XHJcblxyXG4vKipcclxuICogU2luZ2xlLWNoYW5uZWwgc3Vic2NyaXB0aW9uIGhlbHBlclxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHN1YnNjcmliZShcclxuICBjaGFubmVsOiBzdHJpbmcsXHJcbiAgaGFuZGxlcjogKGRhdGE6IGFueSkgPT4gdm9pZFxyXG4pOiAoKSA9PiBQcm9taXNlPHZvaWQ+IHtcclxuICBjb25zdCBzdWIgPSByZWRpcy5kdXBsaWNhdGUoKTtcclxuXHJcbiAgY29uc3Qgb25NZXNzYWdlID0gKGNoOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykgPT4ge1xyXG4gICAgaWYgKGNoICE9PSBjaGFubmVsKSByZXR1cm47XHJcbiAgICB0cnkge1xyXG4gICAgICBoYW5kbGVyKEpTT04ucGFyc2UobWVzc2FnZSkpO1xyXG4gICAgfSBjYXRjaCB7XHJcbiAgICAgIGhhbmRsZXIobWVzc2FnZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgc3ViLm9uKFwibWVzc2FnZVwiLCBvbk1lc3NhZ2UpO1xyXG5cclxuICBzdWIuc3Vic2NyaWJlKGNoYW5uZWwpLmNhdGNoKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUuZXJyb3IoYFJlZGlzIHN1YnNjcmliZSBmYWlsZWQgZm9yICR7Y2hhbm5lbH1gLCBlcnIpO1xyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3ViLm9mZihcIm1lc3NhZ2VcIiwgb25NZXNzYWdlKTtcclxuICAgICAgYXdhaXQgc3ViLnVuc3Vic2NyaWJlKGNoYW5uZWwpO1xyXG4gICAgICBhd2FpdCBzdWIucXVpdCgpO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIHVuc3Vic2NyaWJlIGZyb20gJHtjaGFubmVsfWAsIGVycik7XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIE11bHRpLWNoYW5uZWwgc3Vic2NyaWJlciAod29ya2VyICYgU1NFIHNhZmUpXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3Vic2NyaWJlVG9DaGFubmVscyhcclxuICBzdWI6IElPUmVkaXMsXHJcbiAgY2hhbm5lbHM6IHN0cmluZ1tdLFxyXG4gIGhhbmRsZXI6IChjaGFubmVsOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykgPT4gdm9pZFxyXG4pIHtcclxuICBmb3IgKGNvbnN0IGNoIG9mIGNoYW5uZWxzKSB7XHJcbiAgICBhd2FpdCBzdWIuc3Vic2NyaWJlKGNoKTtcclxuICB9XHJcblxyXG4gIHN1Yi5vbihcIm1lc3NhZ2VcIiwgKGNoYW5uZWwsIG1lc3NhZ2UpID0+IHtcclxuICAgIGlmIChjaGFubmVscy5pbmNsdWRlcyhjaGFubmVsKSkge1xyXG4gICAgICBoYW5kbGVyKGNoYW5uZWwsIG1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJJT1JlZGlzIiwicmVkaXMiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfVVJMIiwibWF4UmV0cmllc1BlclJlcXVlc3QiLCJsYXp5Q29ubmVjdCIsInJlY29ubmVjdE9uRXJyb3IiLCJlcnIiLCJ0YXJnZXRFcnJvcnMiLCJzb21lIiwiZSIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsIm9uIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwid2FybiIsInN1YnNjcmliZSIsImNoYW5uZWwiLCJoYW5kbGVyIiwic3ViIiwiZHVwbGljYXRlIiwib25NZXNzYWdlIiwiY2giLCJKU09OIiwicGFyc2UiLCJjYXRjaCIsIm9mZiIsInVuc3Vic2NyaWJlIiwicXVpdCIsInN1YnNjcmliZVRvQ2hhbm5lbHMiLCJjaGFubmVscyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/redis.ts\n");

/***/ }),

/***/ "(api)/./pages/api/campaign/[id]/events.ts":
/*!*******************************************!*\
  !*** ./pages/api/campaign/[id]/events.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/redis */ \"(api)/./lib/redis.ts\");\n// pages/api/campaign/[id]/events.ts\n\n/**\r\n * SSE endpoint that subscribes to Redis channels and forwards events to clients.\r\n * - Keeps the connection alive with periodic heartbeats.\r\n * - Supports node-redis v4 subscribe signature and ioredis-style subscribe.\r\n * - Forwards campaign-level events as \"campaign\" and contact-level as \"contact\".\r\n * - Protects against malformed JSON and newline payload issues by serializing here.\r\n */ async function handler(req, res) {\n    const { id } = req.query;\n    if (!id || typeof id !== \"string\") {\n        res.status(400).end(\"Invalid campaign id\");\n        return;\n    }\n    // SSE headers\n    res.setHeader(\"Content-Type\", \"text/event-stream\");\n    res.setHeader(\"Cache-Control\", \"no-cache, no-transform\");\n    res.setHeader(\"Connection\", \"keep-alive\");\n    res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n    try {\n        res.flushHeaders();\n    } catch  {}\n    // Duplicate Redis client for pub/sub\n    const sub = _lib_redis__WEBPACK_IMPORTED_MODULE_0__.redis.duplicate();\n    try {\n        await sub.connect();\n    } catch (err) {\n        console.error(\"Failed to connect redis subscriber\", err);\n        res.write(`event: error\\n`);\n        res.write(`data: ${JSON.stringify({\n            error: \"redis-connect-failed\"\n        })}\\n\\n`);\n        res.end();\n        return;\n    }\n    const channels = [\n        `campaign:${id}:contact_update`,\n        \"campaign:new\"\n    ];\n    // SSE helper\n    function writeEvent(eventName, payload) {\n        try {\n            const data = JSON.stringify(payload);\n            res.write(`event: ${eventName}\\n`);\n            res.write(`data: ${data}\\n\\n`);\n            try {\n                res.flush?.();\n            } catch  {}\n        } catch (e) {\n            console.warn(\"Failed to write SSE event\", e);\n        }\n    }\n    // Standardized message handler\n    const messageHandler = (channel, message)=>{\n        try {\n            let payload = null;\n            try {\n                payload = typeof message === \"string\" ? JSON.parse(message) : message;\n            } catch  {\n                payload = {\n                    raw: String(message)\n                };\n            }\n            if (channel === \"campaign:new\") {\n                writeEvent(\"campaign\", payload);\n            } else {\n                writeEvent(\"contact\", payload);\n            }\n        } catch (e) {\n            console.warn(\"messageHandler error\", e);\n        }\n    };\n    // Use helper from lib/redis for robust subscription\n    try {\n        await (0,_lib_redis__WEBPACK_IMPORTED_MODULE_0__.subscribeToChannels)(sub, channels, messageHandler);\n    } catch (e) {\n        console.error(\"Failed to set up Redis subscriptions\", e);\n        writeEvent(\"error\", {\n            error: \"subscribe-failed\"\n        });\n    }\n    // Heartbeat\n    const heartbeatMs = 15000;\n    const heartbeat = setInterval(()=>{\n        try {\n            writeEvent(\"ping\", {\n                ts: Date.now()\n            });\n        } catch  {}\n    }, heartbeatMs);\n    // Cleanup\n    req.on(\"close\", async ()=>{\n        clearInterval(heartbeat);\n        try {\n            await sub.unsubscribe(channels);\n        } catch  {}\n        try {\n            await sub.quit();\n        } catch  {}\n        try {\n            res.end();\n        } catch  {}\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WUFBRSxNQUFNeEIsSUFBSStCLFdBQVcsQ0FBQ3RCO1FBQVcsRUFBRSxPQUFNLENBQUM7UUFDaEQsSUFBSTtZQUFFLE1BQU1ULElBQUlnQyxJQUFJO1FBQUksRUFBRSxPQUFNLENBQUM7UUFDakMsSUFBSTtZQUFFdkMsSUFBSUksR0FBRztRQUFJLEVBQUUsT0FBTSxDQUFDO0lBQzVCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vcGFnZXMvYXBpL2NhbXBhaWduL1tpZF0vZXZlbnRzLnRzPzdhNmQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvYXBpL2NhbXBhaWduL1tpZF0vZXZlbnRzLnRzXHJcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgeyByZWRpcywgc3Vic2NyaWJlVG9DaGFubmVscyB9IGZyb20gJy4uLy4uLy4uLy4uL2xpYi9yZWRpcyc7XHJcblxyXG4vKipcclxuICogU1NFIGVuZHBvaW50IHRoYXQgc3Vic2NyaWJlcyB0byBSZWRpcyBjaGFubmVscyBhbmQgZm9yd2FyZHMgZXZlbnRzIHRvIGNsaWVudHMuXHJcbiAqIC0gS2VlcHMgdGhlIGNvbm5lY3Rpb24gYWxpdmUgd2l0aCBwZXJpb2RpYyBoZWFydGJlYXRzLlxyXG4gKiAtIFN1cHBvcnRzIG5vZGUtcmVkaXMgdjQgc3Vic2NyaWJlIHNpZ25hdHVyZSBhbmQgaW9yZWRpcy1zdHlsZSBzdWJzY3JpYmUuXHJcbiAqIC0gRm9yd2FyZHMgY2FtcGFpZ24tbGV2ZWwgZXZlbnRzIGFzIFwiY2FtcGFpZ25cIiBhbmQgY29udGFjdC1sZXZlbCBhcyBcImNvbnRhY3RcIi5cclxuICogLSBQcm90ZWN0cyBhZ2FpbnN0IG1hbGZvcm1lZCBKU09OIGFuZCBuZXdsaW5lIHBheWxvYWQgaXNzdWVzIGJ5IHNlcmlhbGl6aW5nIGhlcmUuXHJcbiAqL1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xyXG4gIGNvbnN0IHsgaWQgfSA9IHJlcS5xdWVyeTtcclxuICBpZiAoIWlkIHx8IHR5cGVvZiBpZCAhPT0gJ3N0cmluZycpIHtcclxuICAgIHJlcy5zdGF0dXMoNDAwKS5lbmQoJ0ludmFsaWQgY2FtcGFpZ24gaWQnKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIC8vIFNTRSBoZWFkZXJzXHJcbiAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ3RleHQvZXZlbnQtc3RyZWFtJyk7XHJcbiAgcmVzLnNldEhlYWRlcignQ2FjaGUtQ29udHJvbCcsICduby1jYWNoZSwgbm8tdHJhbnNmb3JtJyk7XHJcbiAgcmVzLnNldEhlYWRlcignQ29ubmVjdGlvbicsICdrZWVwLWFsaXZlJyk7XHJcbiAgcmVzLnNldEhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJyonKTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIHJlcy5mbHVzaEhlYWRlcnMoKTtcclxuICB9IGNhdGNoIHt9XHJcblxyXG4gIC8vIER1cGxpY2F0ZSBSZWRpcyBjbGllbnQgZm9yIHB1Yi9zdWJcclxuICBjb25zdCBzdWIgPSAocmVkaXMgYXMgYW55KS5kdXBsaWNhdGUoKTtcclxuICB0cnkge1xyXG4gICAgYXdhaXQgc3ViLmNvbm5lY3QoKTtcclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHJlZGlzIHN1YnNjcmliZXInLCBlcnIpO1xyXG4gICAgcmVzLndyaXRlKGBldmVudDogZXJyb3JcXG5gKTtcclxuICAgIHJlcy53cml0ZShgZGF0YTogJHtKU09OLnN0cmluZ2lmeSh7IGVycm9yOiAncmVkaXMtY29ubmVjdC1mYWlsZWQnIH0pfVxcblxcbmApO1xyXG4gICAgcmVzLmVuZCgpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgY2hhbm5lbHMgPSBbXHJcbiAgICBgY2FtcGFpZ246JHtpZH06Y29udGFjdF91cGRhdGVgLFxyXG4gICAgJ2NhbXBhaWduOm5ldycsXHJcbiAgXTtcclxuXHJcbiAgLy8gU1NFIGhlbHBlclxyXG4gIGZ1bmN0aW9uIHdyaXRlRXZlbnQoZXZlbnROYW1lOiBzdHJpbmcsIHBheWxvYWQ6IHVua25vd24pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkKTtcclxuICAgICAgcmVzLndyaXRlKGBldmVudDogJHtldmVudE5hbWV9XFxuYCk7XHJcbiAgICAgIHJlcy53cml0ZShgZGF0YTogJHtkYXRhfVxcblxcbmApO1xyXG4gICAgICB0cnkgeyAocmVzIGFzIGFueSkuZmx1c2g/LigpOyB9IGNhdGNoIHt9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIHdyaXRlIFNTRSBldmVudCcsIGUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gU3RhbmRhcmRpemVkIG1lc3NhZ2UgaGFuZGxlclxyXG4gIGNvbnN0IG1lc3NhZ2VIYW5kbGVyID0gKGNoYW5uZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgcGF5bG9hZDogYW55ID0gbnVsbDtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBwYXlsb2FkID0gdHlwZW9mIG1lc3NhZ2UgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShtZXNzYWdlKSA6IG1lc3NhZ2U7XHJcbiAgICAgIH0gY2F0Y2gge1xyXG4gICAgICAgIHBheWxvYWQgPSB7IHJhdzogU3RyaW5nKG1lc3NhZ2UpIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjaGFubmVsID09PSAnY2FtcGFpZ246bmV3Jykge1xyXG4gICAgICAgIHdyaXRlRXZlbnQoJ2NhbXBhaWduJywgcGF5bG9hZCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgd3JpdGVFdmVudCgnY29udGFjdCcsIHBheWxvYWQpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignbWVzc2FnZUhhbmRsZXIgZXJyb3InLCBlKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAvLyBVc2UgaGVscGVyIGZyb20gbGliL3JlZGlzIGZvciByb2J1c3Qgc3Vic2NyaXB0aW9uXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IHN1YnNjcmliZVRvQ2hhbm5lbHMoc3ViLCBjaGFubmVscywgbWVzc2FnZUhhbmRsZXIpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZXQgdXAgUmVkaXMgc3Vic2NyaXB0aW9ucycsIGUpO1xyXG4gICAgd3JpdGVFdmVudCgnZXJyb3InLCB7IGVycm9yOiAnc3Vic2NyaWJlLWZhaWxlZCcgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBIZWFydGJlYXRcclxuICBjb25zdCBoZWFydGJlYXRNcyA9IDE1MDAwO1xyXG4gIGNvbnN0IGhlYXJ0YmVhdCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHdyaXRlRXZlbnQoJ3BpbmcnLCB7IHRzOiBEYXRlLm5vdygpIH0pO1xyXG4gICAgfSBjYXRjaCB7fVxyXG4gIH0sIGhlYXJ0YmVhdE1zKTtcclxuXHJcbiAgLy8gQ2xlYW51cFxyXG4gIHJlcS5vbignY2xvc2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjbGVhckludGVydmFsKGhlYXJ0YmVhdCk7XHJcbiAgICB0cnkgeyBhd2FpdCBzdWIudW5zdWJzY3JpYmUoY2hhbm5lbHMpOyB9IGNhdGNoIHt9XHJcbiAgICB0cnkgeyBhd2FpdCBzdWIucXVpdCgpOyB9IGNhdGNoIHt9XHJcbiAgICB0cnkgeyByZXMuZW5kKCk7IH0gY2F0Y2gge31cclxuICB9KTtcclxufVxyXG4iXSwibmFtZXMiOlsicmVkaXMiLCJzdWJzY3JpYmVUb0NoYW5uZWxzIiwiaGFuZGxlciIsInJlcSIsInJlcyIsImlkIiwicXVlcnkiLCJzdGF0dXMiLCJlbmQiLCJzZXRIZWFkZXIiLCJmbHVzaEhlYWRlcnMiLCJzdWIiLCJkdXBsaWNhdGUiLCJjb25uZWN0IiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwid3JpdGUiLCJKU09OIiwic3RyaW5naWZ5IiwiY2hhbm5lbHMiLCJ3cml0ZUV2ZW50IiwiZXZlbnROYW1lIiwicGF5bG9hZCIsImRhdGEiLCJmbHVzaCIsImUiLCJ3YXJuIiwibWVzc2FnZUhhbmRsZXIiLCJjaGFubmVsIiwibWVzc2FnZSIsInBhcnNlIiwicmF3IiwiU3RyaW5nIiwiaGVhcnRiZWF0TXMiLCJoZWFydGJlYXQiLCJzZXRJbnRlcnZhbCIsInRzIiwiRGF0ZSIsIm5vdyIsIm9uIiwiY2xlYXJJbnRlcnZhbCIsInVuc3Vic2NyaWJlIiwicXVpdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/campaign/[id]/events.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2F%5Bid%5D%2Fevents&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5C%5Bid%5D%5Cevents.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();