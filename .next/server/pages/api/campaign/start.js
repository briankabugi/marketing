"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/campaign/start";
exports.ids = ["pages/api/campaign/start"];
exports.modules = {

/***/ "bullmq":
/*!*************************!*\
  !*** external "bullmq" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("bullmq");

/***/ }),

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2Fstart&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5Cstart.ts&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2Fstart&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5Cstart.ts&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_campaign_start_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\campaign\\start.ts */ \"(api)/./pages/api/campaign/start.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_start_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_start_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/campaign/start\",\n        pathname: \"/api/campaign/start\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_campaign_start_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNhbXBhaWduJTJGc3RhcnQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2NhbXBhaWduJTVDc3RhcnQudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDNkQ7QUFDN0Q7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHlEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx5REFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLz9mYzFhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcY2FtcGFpZ25cXFxcc3RhcnQudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jYW1wYWlnbi9zdGFydFwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NhbXBhaWduL3N0YXJ0XCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2Fstart&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5Cstart.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/mongo.ts":
/*!**********************!*\
  !*** ./lib/mongo.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n// lib/mongo.ts\n\nconst uri = process.env.MONGODB_URI;\nif (!uri) throw new Error(\"MONGODB_URI not set\");\nlet client;\nlet clientPromise;\n// Retry logic in case MongoDB connection fails\nasync function connectWithRetry() {\n    const MAX_RETRIES = 5;\n    let attempts = 0;\n    let lastError = null;\n    while(attempts < MAX_RETRIES){\n        try {\n            const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, {\n                maxPoolSize: 10,\n                serverSelectionTimeoutMS: 10000,\n                socketTimeoutMS: 45000\n            });\n            await client.connect();\n            return client;\n        } catch (err) {\n            lastError = err;\n            attempts++;\n            console.error(`MongoDB connection failed (attempt ${attempts}/${MAX_RETRIES}):`, err);\n            if (attempts < MAX_RETRIES) {\n                await new Promise((resolve)=>setTimeout(resolve, 5000)); // wait for 5 seconds before retrying\n            }\n        }\n    }\n    // After max retries, throw the last error encountered\n    throw lastError || new Error(\"MongoDB connection failed after maximum retry attempts\");\n}\nif (!global._mongoClientPromise) {\n    global._mongoClientPromise = connectWithRetry();\n    // Optional: log connection events\n    global._mongoClientPromise.then((client)=>{\n        client.on(\"serverOpening\", (event)=>console.log(\"MongoDB server opening\", event));\n        client.on(\"serverClosed\", (event)=>console.warn(\"MongoDB server closed\", event));\n        client.on(\"topologyClosed\", ()=>console.warn(\"MongoDB topology closed\"));\n        client.on(\"topologyOpening\", ()=>console.log(\"MongoDB topology opening\"));\n        client.on(\"error\", (err)=>console.error(\"MongoDB error\", err));\n    }).catch((err)=>{\n        console.error(\"MongoDB client failed to connect after retries\", err);\n    });\n}\nclientPromise = global._mongoClientPromise;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvbW9uZ28udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZUFBZTtBQUN1QjtBQUV0QyxNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFdBQVc7QUFDbkMsSUFBSSxDQUFDSCxLQUFLLE1BQU0sSUFBSUksTUFBTTtBQUUxQixJQUFJQztBQUNKLElBQUlDO0FBT0osK0NBQStDO0FBQy9DLGVBQWVDO0lBQ2IsTUFBTUMsY0FBYztJQUNwQixJQUFJQyxXQUFXO0lBQ2YsSUFBSUMsWUFBMEI7SUFFOUIsTUFBT0QsV0FBV0QsWUFBYTtRQUM3QixJQUFJO1lBQ0YsTUFBTUgsU0FBUyxJQUFJTixnREFBV0EsQ0FBQ0MsS0FBSztnQkFDbENXLGFBQWE7Z0JBQ2JDLDBCQUEwQjtnQkFDMUJDLGlCQUFpQjtZQUNuQjtZQUNBLE1BQU1SLE9BQU9TLE9BQU87WUFDcEIsT0FBT1Q7UUFDVCxFQUFFLE9BQU9VLEtBQVU7WUFDakJMLFlBQVlLO1lBQ1pOO1lBQ0FPLFFBQVFDLEtBQUssQ0FBQyxDQUFDLG1DQUFtQyxFQUFFUixTQUFTLENBQUMsRUFBRUQsWUFBWSxFQUFFLENBQUMsRUFBRU87WUFDakYsSUFBSU4sV0FBV0QsYUFBYTtnQkFDMUIsTUFBTSxJQUFJVSxRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTLFFBQVEscUNBQXFDO1lBQ2hHO1FBQ0Y7SUFDRjtJQUVBLHNEQUFzRDtJQUN0RCxNQUFNVCxhQUFhLElBQUlOLE1BQU07QUFDL0I7QUFFQSxJQUFJLENBQUNpQixPQUFPQyxtQkFBbUIsRUFBRTtJQUMvQkQsT0FBT0MsbUJBQW1CLEdBQUdmO0lBRTdCLGtDQUFrQztJQUNsQ2MsT0FBT0MsbUJBQW1CLENBQ3ZCQyxJQUFJLENBQUNsQixDQUFBQTtRQUNKQSxPQUFPbUIsRUFBRSxDQUFDLGlCQUFpQixDQUFDQyxRQUFVVCxRQUFRVSxHQUFHLENBQUMsMEJBQTBCRDtRQUM1RXBCLE9BQU9tQixFQUFFLENBQUMsZ0JBQWdCLENBQUNDLFFBQVVULFFBQVFXLElBQUksQ0FBQyx5QkFBeUJGO1FBQzNFcEIsT0FBT21CLEVBQUUsQ0FBQyxrQkFBa0IsSUFBTVIsUUFBUVcsSUFBSSxDQUFDO1FBQy9DdEIsT0FBT21CLEVBQUUsQ0FBQyxtQkFBbUIsSUFBTVIsUUFBUVUsR0FBRyxDQUFDO1FBQy9DckIsT0FBT21CLEVBQUUsQ0FBQyxTQUFTLENBQUNULE1BQVFDLFFBQVFDLEtBQUssQ0FBQyxpQkFBaUJGO0lBQzdELEdBQ0NhLEtBQUssQ0FBQ2IsQ0FBQUE7UUFDTEMsUUFBUUMsS0FBSyxDQUFDLGtEQUFrREY7SUFDbEU7QUFDSjtBQUVBVCxnQkFBZ0JlLE9BQU9DLG1CQUFtQjtBQUUxQyxpRUFBZWhCLGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vbGliL21vbmdvLnRzPzU3ZmUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21vbmdvLnRzXHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuaWYgKCF1cmkpIHRocm93IG5ldyBFcnJvcignTU9OR09EQl9VUkkgbm90IHNldCcpO1xyXG5cclxubGV0IGNsaWVudDogTW9uZ29DbGllbnQ7XHJcbmxldCBjbGllbnRQcm9taXNlOiBQcm9taXNlPE1vbmdvQ2xpZW50PjtcclxuXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXHJcbiAgdmFyIF9tb25nb0NsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+IHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG4vLyBSZXRyeSBsb2dpYyBpbiBjYXNlIE1vbmdvREIgY29ubmVjdGlvbiBmYWlsc1xyXG5hc3luYyBmdW5jdGlvbiBjb25uZWN0V2l0aFJldHJ5KCk6IFByb21pc2U8TW9uZ29DbGllbnQ+IHtcclxuICBjb25zdCBNQVhfUkVUUklFUyA9IDU7XHJcbiAgbGV0IGF0dGVtcHRzID0gMDtcclxuICBsZXQgbGFzdEVycm9yOiBFcnJvciB8IG51bGwgPSBudWxsO1xyXG5cclxuICB3aGlsZSAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwge1xyXG4gICAgICAgIG1heFBvb2xTaXplOiAxMCxcclxuICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDEwMDAwLFxyXG4gICAgICAgIHNvY2tldFRpbWVvdXRNUzogNDUwMDAsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgICByZXR1cm4gY2xpZW50O1xyXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgbGFzdEVycm9yID0gZXJyO1xyXG4gICAgICBhdHRlbXB0cysrO1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBNb25nb0RCIGNvbm5lY3Rpb24gZmFpbGVkIChhdHRlbXB0ICR7YXR0ZW1wdHN9LyR7TUFYX1JFVFJJRVN9KTpgLCBlcnIpO1xyXG4gICAgICBpZiAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDAwKSk7IC8vIHdhaXQgZm9yIDUgc2Vjb25kcyBiZWZvcmUgcmV0cnlpbmdcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQWZ0ZXIgbWF4IHJldHJpZXMsIHRocm93IHRoZSBsYXN0IGVycm9yIGVuY291bnRlcmVkXHJcbiAgdGhyb3cgbGFzdEVycm9yIHx8IG5ldyBFcnJvcignTW9uZ29EQiBjb25uZWN0aW9uIGZhaWxlZCBhZnRlciBtYXhpbXVtIHJldHJ5IGF0dGVtcHRzJyk7XHJcbn1cclxuXHJcbmlmICghZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UpIHtcclxuICBnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZSA9IGNvbm5lY3RXaXRoUmV0cnkoKTtcclxuICBcclxuICAvLyBPcHRpb25hbDogbG9nIGNvbm5lY3Rpb24gZXZlbnRzXHJcbiAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2VcclxuICAgIC50aGVuKGNsaWVudCA9PiB7XHJcbiAgICAgIGNsaWVudC5vbignc2VydmVyT3BlbmluZycsIChldmVudCkgPT4gY29uc29sZS5sb2coJ01vbmdvREIgc2VydmVyIG9wZW5pbmcnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3NlcnZlckNsb3NlZCcsIChldmVudCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHNlcnZlciBjbG9zZWQnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3RvcG9sb2d5Q2xvc2VkJywgKCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHRvcG9sb2d5IGNsb3NlZCcpKTtcclxuICAgICAgY2xpZW50Lm9uKCd0b3BvbG9neU9wZW5pbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnTW9uZ29EQiB0b3BvbG9neSBvcGVuaW5nJykpO1xyXG4gICAgICBjbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4gY29uc29sZS5lcnJvcignTW9uZ29EQiBlcnJvcicsIGVycikpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIGNsaWVudCBmYWlsZWQgdG8gY29ubmVjdCBhZnRlciByZXRyaWVzJywgZXJyKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jbGllbnRQcm9taXNlID0gZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2U7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnRQcm9taXNlOyJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwiY2xpZW50IiwiY2xpZW50UHJvbWlzZSIsImNvbm5lY3RXaXRoUmV0cnkiLCJNQVhfUkVUUklFUyIsImF0dGVtcHRzIiwibGFzdEVycm9yIiwibWF4UG9vbFNpemUiLCJzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMiLCJzb2NrZXRUaW1lb3V0TVMiLCJjb25uZWN0IiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZ2xvYmFsIiwiX21vbmdvQ2xpZW50UHJvbWlzZSIsInRoZW4iLCJvbiIsImV2ZW50IiwibG9nIiwid2FybiIsImNhdGNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/mongo.ts\n");

/***/ }),

/***/ "(api)/./lib/redis.ts":
/*!**********************!*\
  !*** ./lib/redis.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   redis: () => (/* binding */ redis),\n/* harmony export */   subscribe: () => (/* binding */ subscribe),\n/* harmony export */   subscribeToChannels: () => (/* binding */ subscribeToChannels)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n// lib/redis.ts\n\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(process.env.REDIS_URL || \"redis://127.0.0.1:6379\", {\n    maxRetriesPerRequest: null,\n    lazyConnect: true,\n    reconnectOnError: (err)=>{\n        const targetErrors = [\n            \"READONLY\",\n            \"ECONNRESET\",\n            \"ETIMEDOUT\"\n        ];\n        try {\n            if (err && typeof err.message === \"string\") {\n                return targetErrors.some((e)=>err.message.includes(e));\n            }\n        } catch  {\n        // fall through\n        }\n        return false;\n    }\n});\nredis.on(\"connect\", ()=>console.log(\"Redis connected\"));\nredis.on(\"ready\", ()=>console.log(\"Redis ready\"));\nredis.on(\"error\", (err)=>console.error(\"Redis error\", err));\nredis.on(\"close\", ()=>console.warn(\"Redis connection closed\"));\nredis.on(\"reconnecting\", ()=>console.log(\"Redis reconnecting\"));\n/**\r\n * Subscribe to a single Redis channel (ioredis-style).\r\n * Returns an async unsubscribe function.\r\n */ async function subscribe(channel, handler) {\n    const sub = redis.duplicate();\n    const onMessage = (msgChannel, message)=>{\n        if (msgChannel !== channel) return;\n        try {\n            handler(JSON.parse(message));\n        } catch  {\n            handler(message);\n        }\n    };\n    sub.on(\"error\", (err)=>{\n        console.error(`Redis subscriber error for channel ${channel}`, err);\n    });\n    sub.on(\"message\", onMessage);\n    try {\n        // connect only if not already connecting/ready\n        try {\n            if (typeof sub.connect === \"function\") {\n                const status = sub.status;\n                if (status !== \"ready\" && status !== \"connecting\") {\n                    await sub.connect().catch((err)=>{\n                        console.warn(\"Subscriber connect error (continuing):\", err);\n                    });\n                } else {\n                // already connecting/ready â€” skip connect\n                }\n            }\n        } catch (e) {\n            console.warn(\"Subscriber connect guard error\", e);\n        }\n        await sub.subscribe(channel).catch((err)=>{\n            console.warn(`subscribe(${channel}) failed`, err);\n        });\n    } catch (err) {\n        console.error(`Failed to subscribe to Redis channel ${channel}`, err);\n    }\n    return async ()=>{\n        try {\n            sub.off(\"message\", onMessage);\n            try {\n                await sub.unsubscribe(channel);\n            } catch (e) {}\n            try {\n                await sub.quit();\n            } catch (e) {}\n        } catch (err) {\n            console.warn(`Failed to cleanly unsubscribe from Redis channel ${channel}`, err);\n        }\n    };\n}\n/**\r\n * Robust multi-channel subscription helper.\r\n */ async function subscribeToChannels(sub, channels, handler) {\n    if (!sub || !channels || channels.length === 0) return;\n    // ensure connection if possible (guard against duplicate connect calls)\n    try {\n        if (typeof sub.connect === \"function\") {\n            const status = sub.status;\n            if (status !== \"ready\" && status !== \"connecting\") {\n                await sub.connect().catch((err)=>{\n                    console.warn(\"subscribeToChannels: subscriber connect warning\", err);\n                });\n            } else {\n            // already connecting/ready, skip connect\n            }\n        }\n    } catch (e) {\n    // ignore connect errors\n    }\n    for (const ch of channels){\n        try {\n            if (typeof sub.subscribe === \"function\") {\n                await sub.subscribe(ch).catch((err)=>{\n                    console.warn(`subscribeToChannels: subscribe(${ch}) failed`, err);\n                });\n            } else {\n                await sub.subscribe(ch);\n            }\n        } catch (e) {\n            console.warn(`subscribe failed for channel ${ch}, will attempt fallback`, e);\n        }\n    }\n    // Attach 'message' listener\n    try {\n        if (typeof sub.on === \"function\") {\n            const onMsg = (a, b)=>{\n                if (typeof a === \"string\" && typeof b === \"string\") {\n                    handler(a, b);\n                } else if (typeof b === \"string\" && channels.includes(b)) {\n                    handler(b, a);\n                } else {\n                    handler(String(a), String(b));\n                }\n            };\n            sub.__subscribe_to_channels_on_message = onMsg;\n            sub.on(\"message\", onMsg);\n        }\n    } catch (e) {\n        console.warn(\"Fallback Redis message hook failed\", e);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJLE9BQU9BLE1BQU0sWUFBWUwsU0FBU3RCLFFBQVEsQ0FBQzJCLElBQUk7b0JBQ3hEbkIsUUFBUW1CLEdBQUdEO2dCQUNiLE9BQU87b0JBQ0xsQixRQUFRb0IsT0FBT0YsSUFBSUUsT0FBT0Q7Z0JBQzVCO1lBQ0Y7WUFDQ2xCLElBQVlvQixrQ0FBa0MsR0FBR0o7WUFDbERoQixJQUFJUixFQUFFLENBQUMsV0FBV3dCO1FBQ3BCO0lBQ0YsRUFBRSxPQUFPMUIsR0FBRztRQUNWRyxRQUFRRyxJQUFJLENBQUMsc0NBQXNDTjtJQUNyRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFya2V0aW5nLW12cC8uL2xpYi9yZWRpcy50cz81MWU5Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9yZWRpcy50c1xyXG5pbXBvcnQgSU9SZWRpcyBmcm9tICdpb3JlZGlzJztcclxuXHJcbmV4cG9ydCBjb25zdCByZWRpcyA9IG5ldyBJT1JlZGlzKHByb2Nlc3MuZW52LlJFRElTX1VSTCB8fCAncmVkaXM6Ly8xMjcuMC4wLjE6NjM3OScsIHtcclxuICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogbnVsbCxcclxuICBsYXp5Q29ubmVjdDogdHJ1ZSxcclxuICByZWNvbm5lY3RPbkVycm9yOiAoZXJyOiBhbnkpID0+IHtcclxuICAgIGNvbnN0IHRhcmdldEVycm9ycyA9IFsnUkVBRE9OTFknLCAnRUNPTk5SRVNFVCcsICdFVElNRURPVVQnXTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmIChlcnIgJiYgdHlwZW9mIGVyci5tZXNzYWdlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHJldHVybiB0YXJnZXRFcnJvcnMuc29tZShlID0+IGVyci5tZXNzYWdlLmluY2x1ZGVzKGUpKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCB7XHJcbiAgICAgIC8vIGZhbGwgdGhyb3VnaFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH0sXHJcbn0pO1xyXG5cclxucmVkaXMub24oJ2Nvbm5lY3QnLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgY29ubmVjdGVkJykpO1xyXG5yZWRpcy5vbigncmVhZHknLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgcmVhZHknKSk7XHJcbnJlZGlzLm9uKCdlcnJvcicsIChlcnIpID0+IGNvbnNvbGUuZXJyb3IoJ1JlZGlzIGVycm9yJywgZXJyKSk7XHJcbnJlZGlzLm9uKCdjbG9zZScsICgpID0+IGNvbnNvbGUud2FybignUmVkaXMgY29ubmVjdGlvbiBjbG9zZWQnKSk7XHJcbnJlZGlzLm9uKCdyZWNvbm5lY3RpbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnUmVkaXMgcmVjb25uZWN0aW5nJykpO1xyXG5cclxuLyoqXHJcbiAqIFN1YnNjcmliZSB0byBhIHNpbmdsZSBSZWRpcyBjaGFubmVsIChpb3JlZGlzLXN0eWxlKS5cclxuICogUmV0dXJucyBhbiBhc3luYyB1bnN1YnNjcmliZSBmdW5jdGlvbi5cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdWJzY3JpYmUoY2hhbm5lbDogc3RyaW5nLCBoYW5kbGVyOiAoZGF0YTogYW55KSA9PiB2b2lkKTogUHJvbWlzZTwoKSA9PiBQcm9taXNlPHZvaWQ+PiB7XHJcbiAgY29uc3Qgc3ViID0gcmVkaXMuZHVwbGljYXRlKCk7XHJcblxyXG4gIGNvbnN0IG9uTWVzc2FnZSA9IChtc2dDaGFubmVsOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykgPT4ge1xyXG4gICAgaWYgKG1zZ0NoYW5uZWwgIT09IGNoYW5uZWwpIHJldHVybjtcclxuICAgIHRyeSB7XHJcbiAgICAgIGhhbmRsZXIoSlNPTi5wYXJzZShtZXNzYWdlKSk7XHJcbiAgICB9IGNhdGNoIHtcclxuICAgICAgaGFuZGxlcihtZXNzYWdlKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBzdWIub24oJ2Vycm9yJywgKGVycjogYW55KSA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKGBSZWRpcyBzdWJzY3JpYmVyIGVycm9yIGZvciBjaGFubmVsICR7Y2hhbm5lbH1gLCBlcnIpO1xyXG4gIH0pO1xyXG5cclxuICBzdWIub24oJ21lc3NhZ2UnLCBvbk1lc3NhZ2UpO1xyXG5cclxuICB0cnkge1xyXG4gICAgLy8gY29ubmVjdCBvbmx5IGlmIG5vdCBhbHJlYWR5IGNvbm5lY3RpbmcvcmVhZHlcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh0eXBlb2YgKHN1YiBhcyBhbnkpLmNvbm5lY3QgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBjb25zdCBzdGF0dXMgPSAoc3ViIGFzIGFueSkuc3RhdHVzO1xyXG4gICAgICAgIGlmIChzdGF0dXMgIT09ICdyZWFkeScgJiYgc3RhdHVzICE9PSAnY29ubmVjdGluZycpIHtcclxuICAgICAgICAgIGF3YWl0IChzdWIgYXMgYW55KS5jb25uZWN0KCkuY2F0Y2goKGVycjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignU3Vic2NyaWJlciBjb25uZWN0IGVycm9yIChjb250aW51aW5nKTonLCBlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIGFscmVhZHkgY29ubmVjdGluZy9yZWFkeSDigJQgc2tpcCBjb25uZWN0XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignU3Vic2NyaWJlciBjb25uZWN0IGd1YXJkIGVycm9yJywgZSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgKHN1YiBhcyBhbnkpLnN1YnNjcmliZShjaGFubmVsKS5jYXRjaCgoZXJyOiBhbnkpID0+IHtcclxuICAgICAgY29uc29sZS53YXJuKGBzdWJzY3JpYmUoJHtjaGFubmVsfSkgZmFpbGVkYCwgZXJyKTtcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHN1YnNjcmliZSB0byBSZWRpcyBjaGFubmVsICR7Y2hhbm5lbH1gLCBlcnIpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGFzeW5jICgpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHN1Yi5vZmYoJ21lc3NhZ2UnLCBvbk1lc3NhZ2UpO1xyXG4gICAgICB0cnkgeyBhd2FpdCAoc3ViIGFzIGFueSkudW5zdWJzY3JpYmUoY2hhbm5lbCk7IH0gY2F0Y2ggKGUpIHt9XHJcbiAgICAgIHRyeSB7IGF3YWl0IChzdWIgYXMgYW55KS5xdWl0KCk7IH0gY2F0Y2ggKGUpIHt9XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gY2xlYW5seSB1bnN1YnNjcmliZSBmcm9tIFJlZGlzIGNoYW5uZWwgJHtjaGFubmVsfWAsIGVycik7XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJvYnVzdCBtdWx0aS1jaGFubmVsIHN1YnNjcmlwdGlvbiBoZWxwZXIuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3Vic2NyaWJlVG9DaGFubmVscyhcclxuICBzdWI6IGFueSxcclxuICBjaGFubmVsczogc3RyaW5nW10sXHJcbiAgaGFuZGxlcjogKGNoYW5uZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nKSA9PiB2b2lkXHJcbik6IFByb21pc2U8dm9pZD4ge1xyXG4gIGlmICghc3ViIHx8ICFjaGFubmVscyB8fCBjaGFubmVscy5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgLy8gZW5zdXJlIGNvbm5lY3Rpb24gaWYgcG9zc2libGUgKGd1YXJkIGFnYWluc3QgZHVwbGljYXRlIGNvbm5lY3QgY2FsbHMpXHJcbiAgdHJ5IHtcclxuICAgIGlmICh0eXBlb2Ygc3ViLmNvbm5lY3QgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgY29uc3Qgc3RhdHVzID0gKHN1YiBhcyBhbnkpLnN0YXR1cztcclxuICAgICAgaWYgKHN0YXR1cyAhPT0gJ3JlYWR5JyAmJiBzdGF0dXMgIT09ICdjb25uZWN0aW5nJykge1xyXG4gICAgICAgIGF3YWl0IHN1Yi5jb25uZWN0KCkuY2F0Y2goKGVycjogYW55KSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ3N1YnNjcmliZVRvQ2hhbm5lbHM6IHN1YnNjcmliZXIgY29ubmVjdCB3YXJuaW5nJywgZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBhbHJlYWR5IGNvbm5lY3RpbmcvcmVhZHksIHNraXAgY29ubmVjdFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgLy8gaWdub3JlIGNvbm5lY3QgZXJyb3JzXHJcbiAgfVxyXG5cclxuICBmb3IgKGNvbnN0IGNoIG9mIGNoYW5uZWxzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAodHlwZW9mIHN1Yi5zdWJzY3JpYmUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBhd2FpdCBzdWIuc3Vic2NyaWJlKGNoKS5jYXRjaCgoZXJyOiBhbnkpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUud2Fybihgc3Vic2NyaWJlVG9DaGFubmVsczogc3Vic2NyaWJlKCR7Y2h9KSBmYWlsZWRgLCBlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGF3YWl0IChzdWIgYXMgYW55KS5zdWJzY3JpYmUoY2gpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUud2Fybihgc3Vic2NyaWJlIGZhaWxlZCBmb3IgY2hhbm5lbCAke2NofSwgd2lsbCBhdHRlbXB0IGZhbGxiYWNrYCwgZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBBdHRhY2ggJ21lc3NhZ2UnIGxpc3RlbmVyXHJcbiAgdHJ5IHtcclxuICAgIGlmICh0eXBlb2Ygc3ViLm9uID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNvbnN0IG9uTXNnID0gKGE6IGFueSwgYjogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBhID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgYiA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgIGhhbmRsZXIoYSwgYik7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYiA9PT0gJ3N0cmluZycgJiYgY2hhbm5lbHMuaW5jbHVkZXMoYikpIHtcclxuICAgICAgICAgIGhhbmRsZXIoYiwgYSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGhhbmRsZXIoU3RyaW5nKGEpLCBTdHJpbmcoYikpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgKHN1YiBhcyBhbnkpLl9fc3Vic2NyaWJlX3RvX2NoYW5uZWxzX29uX21lc3NhZ2UgPSBvbk1zZztcclxuICAgICAgc3ViLm9uKCdtZXNzYWdlJywgb25Nc2cpO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUud2FybignRmFsbGJhY2sgUmVkaXMgbWVzc2FnZSBob29rIGZhaWxlZCcsIGUpO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiSU9SZWRpcyIsInJlZGlzIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsIm1heFJldHJpZXNQZXJSZXF1ZXN0IiwibGF6eUNvbm5lY3QiLCJyZWNvbm5lY3RPbkVycm9yIiwiZXJyIiwidGFyZ2V0RXJyb3JzIiwibWVzc2FnZSIsInNvbWUiLCJlIiwiaW5jbHVkZXMiLCJvbiIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsIndhcm4iLCJzdWJzY3JpYmUiLCJjaGFubmVsIiwiaGFuZGxlciIsInN1YiIsImR1cGxpY2F0ZSIsIm9uTWVzc2FnZSIsIm1zZ0NoYW5uZWwiLCJKU09OIiwicGFyc2UiLCJjb25uZWN0Iiwic3RhdHVzIiwiY2F0Y2giLCJvZmYiLCJ1bnN1YnNjcmliZSIsInF1aXQiLCJzdWJzY3JpYmVUb0NoYW5uZWxzIiwiY2hhbm5lbHMiLCJsZW5ndGgiLCJjaCIsIm9uTXNnIiwiYSIsImIiLCJTdHJpbmciLCJfX3N1YnNjcmliZV90b19jaGFubmVsc19vbl9tZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/redis.ts\n");

/***/ }),

/***/ "(api)/./pages/api/campaign/start.ts":
/*!*************************************!*\
  !*** ./pages/api/campaign/start.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var bullmq__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bullmq */ \"bullmq\");\n/* harmony import */ var bullmq__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bullmq__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/redis */ \"(api)/./lib/redis.ts\");\n/* harmony import */ var _lib_mongo__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/mongo */ \"(api)/./lib/mongo.ts\");\n// pages/api/campaign/start.ts\n\n\n\nconst queue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(\"campaigns\", {\n    connection: _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis\n});\nconst MAX_ATTEMPTS = 3;\n// utility to chunk arrays\nfunction chunkArray(arr, size = 1000) {\n    const out = [];\n    for(let i = 0; i < arr.length; i += size)out.push(arr.slice(i, i + size));\n    return out;\n}\nfunction isValidUrl(u) {\n    if (typeof u !== \"string\") return false;\n    try {\n        const parsed = new URL(u);\n        return parsed.protocol === \"http:\" || parsed.protocol === \"https:\";\n    } catch  {\n        return false;\n    }\n}\nfunction hasDotDotSegments(p) {\n    // normalize and check for .. segments (basic)\n    return p.split(\"/\").some((segment)=>segment === \"..\");\n}\nfunction validateAttachments(arr) {\n    if (!arr) return [];\n    if (!Array.isArray(arr)) throw new Error(\"attachments must be an array\");\n    const out = [];\n    const MAX_ATTACHMENTS = 10;\n    const MAX_INLINE_BASE64_BYTES = 10 * 1024 * 1024; // 10 MB cap for inline base64 content\n    if (arr.length > MAX_ATTACHMENTS) {\n        throw new Error(`Too many attachments; max ${MAX_ATTACHMENTS}`);\n    }\n    for (const a of arr){\n        if (!a || typeof a !== \"object\") throw new Error(\"Invalid attachment entry\");\n        const name = typeof a.name === \"string\" && a.name.trim() ? a.name.trim() : null;\n        const source = a.source === \"url\" || a.source === \"path\" || a.source === \"content\" ? a.source : null;\n        const contentType = typeof a.contentType === \"string\" ? a.contentType.trim() : undefined;\n        if (!name) throw new Error(\"Attachment missing name\");\n        if (!source) throw new Error(\"Attachment missing valid source\");\n        if (source === \"url\") {\n            if (!isValidUrl(a.url)) throw new Error(`Attachment url invalid for ${name}`);\n            out.push({\n                name,\n                source,\n                url: a.url,\n                contentType\n            });\n        } else if (source === \"path\") {\n            if (typeof a.path !== \"string\" || !a.path.trim()) throw new Error(`Attachment path missing for ${name}`);\n            if (hasDotDotSegments(a.path)) throw new Error(`Attachment path contains .. segments (not allowed): ${name}`);\n            // prefer relative paths for safety; do not resolve/validate existence here\n            out.push({\n                name,\n                source,\n                path: a.path.trim(),\n                contentType\n            });\n        } else if (source === \"content\") {\n            if (typeof a.content !== \"string\" || !a.content.trim()) throw new Error(`Attachment content missing for ${name}`);\n            // crude base64 length estimate: base64 length * 3/4\n            const estimatedBytes = Math.floor(a.content.length * 3 / 4);\n            if (estimatedBytes > MAX_INLINE_BASE64_BYTES) throw new Error(`Attachment ${name} exceeds inline size limit`);\n            // Basic base64 characters validation (not perfect)\n            if (!/^[A-Za-z0-9+/=\\s]+$/.test(a.content)) {\n                throw new Error(`Attachment ${name} content is not valid base64`);\n            }\n            out.push({\n                name,\n                source,\n                content: a.content.replace(/\\s+/g, \"\"),\n                contentType\n            });\n        }\n    }\n    return out;\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    const { name, contacts, initial, followUps = [] } = req.body;\n    if (!name || typeof name !== \"string\") {\n        return res.status(400).json({\n            error: \"Campaign name required\"\n        });\n    }\n    if (!initial?.subject || !initial?.body) {\n        return res.status(400).json({\n            error: \"Initial email subject and body required\"\n        });\n    }\n    if (!contacts || ![\n        \"all\",\n        \"segment\"\n    ].includes(contacts.type)) {\n        return res.status(400).json({\n            error: \"Invalid contact selection\"\n        });\n    }\n    // Validate and normalize attachments (if provided)\n    try {\n        if (initial.attachments) {\n            initial.attachments = validateAttachments(initial.attachments);\n        }\n        if (Array.isArray(followUps)) {\n            for(let i = 0; i < followUps.length; i++){\n                if (followUps[i]?.attachments) {\n                    followUps[i].attachments = validateAttachments(followUps[i].attachments);\n                }\n            }\n        }\n    } catch (e) {\n        return res.status(400).json({\n            error: `Invalid attachments: ${e.message || String(e)}`\n        });\n    }\n    const client = await _lib_mongo__WEBPACK_IMPORTED_MODULE_2__[\"default\"];\n    const db = client.db(\"PlatformData\");\n    const query = contacts.type === \"all\" ? {} : {\n        segments: contacts.value\n    };\n    const contactDocs = await db.collection(\"contacts\").find(query).project({\n        _id: 1,\n        email: 1\n    }).toArray();\n    if (!contactDocs.length) {\n        return res.status(400).json({\n            error: \"No contacts matched selection\"\n        });\n    }\n    const createdAt = new Date();\n    // --- Create campaign document (persist attachments metadata) ---\n    const campaignDoc = {\n        name,\n        contacts,\n        initial,\n        followUps,\n        totals: {\n            intended: contactDocs.length,\n            processed: 0,\n            sent: 0,\n            failed: 0\n        },\n        status: \"running\",\n        createdAt\n    };\n    const campaignResult = await db.collection(\"campaigns\").insertOne(campaignDoc);\n    const campaignObjectId = campaignResult.insertedId;\n    const campaignId = campaignObjectId.toString();\n    // --- Insert ledger idempotently ---\n    const ledgerDocs = contactDocs.map((c)=>({\n            campaignId: campaignObjectId,\n            contactId: c._id,\n            status: \"pending\",\n            attempts: 0,\n            bgAttempts: 0,\n            createdAt: new Date()\n        }));\n    const chunks = chunkArray(ledgerDocs, 1000);\n    for (const chunk of chunks){\n        try {\n            await db.collection(\"campaign_contacts\").insertMany(chunk, {\n                ordered: false\n            });\n        } catch (e) {\n        // Duplicate key errors are safe to ignore (idempotency)\n        }\n    }\n    // --- Redis runtime meta (best-effort) ---\n    try {\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hset(`campaign:${campaignId}:meta`, {\n            name,\n            total: String(contactDocs.length),\n            processed: \"0\",\n            sent: \"0\",\n            failed: \"0\",\n            status: \"running\",\n            createdAt: createdAt.toISOString()\n        });\n        // Persist an enriched definition (includes attachments metadata) for the worker to pick up\n        const definition = {\n            initial,\n            followUps,\n            name,\n            contacts\n        };\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.set(`campaign:${campaignId}:definition`, JSON.stringify(definition));\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.sadd(\"campaign:all\", campaignId);\n    } catch (e) {\n        console.warn(\"Redis unavailable during campaign start\", e);\n    }\n    // --- Enqueue initial jobs (MUST include attempts + backoff for BullMQ retry system) ---\n    for (const c of contactDocs){\n        if (!c.email) continue;\n        await queue.add(\"initial\", {\n            campaignId,\n            contactId: c._id.toString()\n        }, {\n            attempts: MAX_ATTEMPTS,\n            backoff: {\n                type: \"exponential\",\n                delay: 60000\n            },\n            removeOnComplete: true,\n            removeOnFail: true\n        });\n    }\n    // --- Notify UI ---\n    try {\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.publish(\"campaign:new\", JSON.stringify({\n            id: campaignId,\n            name,\n            total: contactDocs.length,\n            createdAt: createdAt.toISOString()\n        }));\n    } catch  {\n    // non-fatal\n    }\n    return res.status(201).json({\n        campaignId,\n        total: contactDocs.length\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBRSxPQUFNO0lBQ04sWUFBWTtJQUNkO0lBRUEsT0FBT3RELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7UUFDMUJxQztRQUNBYSxPQUFPaEMsWUFBWXhELE1BQU07SUFDM0I7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL21hcmtldGluZy1tdnAvLi9wYWdlcy9hcGkvY2FtcGFpZ24vc3RhcnQudHM/NDU1ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBwYWdlcy9hcGkvY2FtcGFpZ24vc3RhcnQudHNcclxuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCB7IFF1ZXVlIH0gZnJvbSAnYnVsbG1xJztcclxuaW1wb3J0IHsgcmVkaXMgfSBmcm9tICcuLi8uLi8uLi9saWIvcmVkaXMnO1xyXG5pbXBvcnQgY2xpZW50UHJvbWlzZSBmcm9tICcuLi8uLi8uLi9saWIvbW9uZ28nO1xyXG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gJ21vbmdvZGInO1xyXG5cclxuY29uc3QgcXVldWUgPSBuZXcgUXVldWUoJ2NhbXBhaWducycsIHsgY29ubmVjdGlvbjogcmVkaXMgfSk7XHJcbmNvbnN0IE1BWF9BVFRFTVBUUyA9IDM7XHJcblxyXG4vLyB1dGlsaXR5IHRvIGNodW5rIGFycmF5c1xyXG5mdW5jdGlvbiBjaHVua0FycmF5PFQ+KGFycjogVFtdLCBzaXplID0gMTAwMCk6IFRbXVtdIHtcclxuICBjb25zdCBvdXQ6IFRbXVtdID0gW107XHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpICs9IHNpemUpIG91dC5wdXNoKGFyci5zbGljZShpLCBpICsgc2l6ZSkpO1xyXG4gIHJldHVybiBvdXQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBdHRhY2htZW50IHZhbGlkYXRpb24gcnVsZXM6XHJcbiAqIC0gQWNjZXB0IGF0dGFjaG1lbnQgbWV0YWRhdGEgb25seSAobm8gZmlsZSB1cGxvYWQgaGVyZSkuXHJcbiAqIC0gRWFjaCBhdHRhY2htZW50IG11c3QgaGF2ZTogbmFtZSAoc3RyaW5nKSwgc291cmNlICgndXJsJ3wncGF0aCd8J2NvbnRlbnQnKVxyXG4gKiAtIElmIHNvdXJjZSA9PT0gJ3VybCcgPT4gdXJsIG11c3QgYmUgdmFsaWQgaHR0cChzKSB1cmxcclxuICogLSBJZiBzb3VyY2UgPT09ICdwYXRoJyA9PiBwYXRoIG11c3Qgbm90IGNvbnRhaW4gJy4uJyAoYmFzaWMgdHJhdmVyc2FsIHByb3RlY3Rpb24pXHJcbiAqIC0gSWYgc291cmNlID09PSAnY29udGVudCcgPT4gY29udGVudCBzaG91bGQgYmUgYmFzZTY0IHN0cmluZyAod2UgZG9uJ3QgZGVjb2RlIGhlcmUgZXhjZXB0IG1pbmltYWwgbGVuZ3RoIGNoZWNrKVxyXG4gKi9cclxudHlwZSBBdHRhY2htZW50ID0ge1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBzb3VyY2U6ICd1cmwnIHwgJ3BhdGgnIHwgJ2NvbnRlbnQnO1xyXG4gIHVybD86IHN0cmluZztcclxuICBwYXRoPzogc3RyaW5nO1xyXG4gIGNvbnRlbnQ/OiBzdHJpbmc7IC8vIGJhc2U2NFxyXG4gIGNvbnRlbnRUeXBlPzogc3RyaW5nO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gaXNWYWxpZFVybCh1OiBhbnkpIHtcclxuICBpZiAodHlwZW9mIHUgIT09ICdzdHJpbmcnKSByZXR1cm4gZmFsc2U7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHBhcnNlZCA9IG5ldyBVUkwodSk7XHJcbiAgICByZXR1cm4gcGFyc2VkLnByb3RvY29sID09PSAnaHR0cDonIHx8IHBhcnNlZC5wcm90b2NvbCA9PT0gJ2h0dHBzOic7XHJcbiAgfSBjYXRjaCB7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYXNEb3REb3RTZWdtZW50cyhwOiBzdHJpbmcpIHtcclxuICAvLyBub3JtYWxpemUgYW5kIGNoZWNrIGZvciAuLiBzZWdtZW50cyAoYmFzaWMpXHJcbiAgcmV0dXJuIHAuc3BsaXQoJy8nKS5zb21lKHNlZ21lbnQgPT4gc2VnbWVudCA9PT0gJy4uJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHZhbGlkYXRlQXR0YWNobWVudHMoYXJyOiBhbnkpOiBBdHRhY2htZW50W10ge1xyXG4gIGlmICghYXJyKSByZXR1cm4gW107XHJcbiAgaWYgKCFBcnJheS5pc0FycmF5KGFycikpIHRocm93IG5ldyBFcnJvcignYXR0YWNobWVudHMgbXVzdCBiZSBhbiBhcnJheScpO1xyXG4gIGNvbnN0IG91dDogQXR0YWNobWVudFtdID0gW107XHJcbiAgY29uc3QgTUFYX0FUVEFDSE1FTlRTID0gMTA7XHJcbiAgY29uc3QgTUFYX0lOTElORV9CQVNFNjRfQllURVMgPSAxMCAqIDEwMjQgKiAxMDI0OyAvLyAxMCBNQiBjYXAgZm9yIGlubGluZSBiYXNlNjQgY29udGVudFxyXG5cclxuICBpZiAoYXJyLmxlbmd0aCA+IE1BWF9BVFRBQ0hNRU5UUykge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGBUb28gbWFueSBhdHRhY2htZW50czsgbWF4ICR7TUFYX0FUVEFDSE1FTlRTfWApO1xyXG4gIH1cclxuXHJcbiAgZm9yIChjb25zdCBhIG9mIGFycikge1xyXG4gICAgaWYgKCFhIHx8IHR5cGVvZiBhICE9PSAnb2JqZWN0JykgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGF0dGFjaG1lbnQgZW50cnknKTtcclxuICAgIGNvbnN0IG5hbWUgPSB0eXBlb2YgYS5uYW1lID09PSAnc3RyaW5nJyAmJiBhLm5hbWUudHJpbSgpID8gYS5uYW1lLnRyaW0oKSA6IG51bGw7XHJcbiAgICBjb25zdCBzb3VyY2UgPSAoYS5zb3VyY2UgPT09ICd1cmwnIHx8IGEuc291cmNlID09PSAncGF0aCcgfHwgYS5zb3VyY2UgPT09ICdjb250ZW50JykgPyBhLnNvdXJjZSA6IG51bGw7XHJcbiAgICBjb25zdCBjb250ZW50VHlwZSA9IHR5cGVvZiBhLmNvbnRlbnRUeXBlID09PSAnc3RyaW5nJyA/IGEuY29udGVudFR5cGUudHJpbSgpIDogdW5kZWZpbmVkO1xyXG5cclxuICAgIGlmICghbmFtZSkgdGhyb3cgbmV3IEVycm9yKCdBdHRhY2htZW50IG1pc3NpbmcgbmFtZScpO1xyXG4gICAgaWYgKCFzb3VyY2UpIHRocm93IG5ldyBFcnJvcignQXR0YWNobWVudCBtaXNzaW5nIHZhbGlkIHNvdXJjZScpO1xyXG5cclxuICAgIGlmIChzb3VyY2UgPT09ICd1cmwnKSB7XHJcbiAgICAgIGlmICghaXNWYWxpZFVybChhLnVybCkpIHRocm93IG5ldyBFcnJvcihgQXR0YWNobWVudCB1cmwgaW52YWxpZCBmb3IgJHtuYW1lfWApO1xyXG4gICAgICBvdXQucHVzaCh7IG5hbWUsIHNvdXJjZSwgdXJsOiBhLnVybCwgY29udGVudFR5cGUgfSk7XHJcbiAgICB9IGVsc2UgaWYgKHNvdXJjZSA9PT0gJ3BhdGgnKSB7XHJcbiAgICAgIGlmICh0eXBlb2YgYS5wYXRoICE9PSAnc3RyaW5nJyB8fCAhYS5wYXRoLnRyaW0oKSkgdGhyb3cgbmV3IEVycm9yKGBBdHRhY2htZW50IHBhdGggbWlzc2luZyBmb3IgJHtuYW1lfWApO1xyXG4gICAgICBpZiAoaGFzRG90RG90U2VnbWVudHMoYS5wYXRoKSkgdGhyb3cgbmV3IEVycm9yKGBBdHRhY2htZW50IHBhdGggY29udGFpbnMgLi4gc2VnbWVudHMgKG5vdCBhbGxvd2VkKTogJHtuYW1lfWApO1xyXG4gICAgICAvLyBwcmVmZXIgcmVsYXRpdmUgcGF0aHMgZm9yIHNhZmV0eTsgZG8gbm90IHJlc29sdmUvdmFsaWRhdGUgZXhpc3RlbmNlIGhlcmVcclxuICAgICAgb3V0LnB1c2goeyBuYW1lLCBzb3VyY2UsIHBhdGg6IGEucGF0aC50cmltKCksIGNvbnRlbnRUeXBlIH0pO1xyXG4gICAgfSBlbHNlIGlmIChzb3VyY2UgPT09ICdjb250ZW50Jykge1xyXG4gICAgICBpZiAodHlwZW9mIGEuY29udGVudCAhPT0gJ3N0cmluZycgfHwgIWEuY29udGVudC50cmltKCkpIHRocm93IG5ldyBFcnJvcihgQXR0YWNobWVudCBjb250ZW50IG1pc3NpbmcgZm9yICR7bmFtZX1gKTtcclxuICAgICAgLy8gY3J1ZGUgYmFzZTY0IGxlbmd0aCBlc3RpbWF0ZTogYmFzZTY0IGxlbmd0aCAqIDMvNFxyXG4gICAgICBjb25zdCBlc3RpbWF0ZWRCeXRlcyA9IE1hdGguZmxvb3IoKGEuY29udGVudC5sZW5ndGggKiAzKSAvIDQpO1xyXG4gICAgICBpZiAoZXN0aW1hdGVkQnl0ZXMgPiBNQVhfSU5MSU5FX0JBU0U2NF9CWVRFUykgdGhyb3cgbmV3IEVycm9yKGBBdHRhY2htZW50ICR7bmFtZX0gZXhjZWVkcyBpbmxpbmUgc2l6ZSBsaW1pdGApO1xyXG4gICAgICAvLyBCYXNpYyBiYXNlNjQgY2hhcmFjdGVycyB2YWxpZGF0aW9uIChub3QgcGVyZmVjdClcclxuICAgICAgaWYgKCEvXltBLVphLXowLTkrLz1cXHNdKyQvLnRlc3QoYS5jb250ZW50KSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQXR0YWNobWVudCAke25hbWV9IGNvbnRlbnQgaXMgbm90IHZhbGlkIGJhc2U2NGApO1xyXG4gICAgICB9XHJcbiAgICAgIG91dC5wdXNoKHsgbmFtZSwgc291cmNlLCBjb250ZW50OiBhLmNvbnRlbnQucmVwbGFjZSgvXFxzKy9nLCAnJyksIGNvbnRlbnRUeXBlIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG91dDtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihcclxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxyXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlXHJcbikge1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHsgbmFtZSwgY29udGFjdHMsIGluaXRpYWwsIGZvbGxvd1VwcyA9IFtdIH0gPSByZXEuYm9keTtcclxuXHJcbiAgaWYgKCFuYW1lIHx8IHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdDYW1wYWlnbiBuYW1lIHJlcXVpcmVkJyB9KTtcclxuICB9XHJcblxyXG4gIGlmICghaW5pdGlhbD8uc3ViamVjdCB8fCAhaW5pdGlhbD8uYm9keSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdJbml0aWFsIGVtYWlsIHN1YmplY3QgYW5kIGJvZHkgcmVxdWlyZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFjb250YWN0cyB8fCAhWydhbGwnLCAnc2VnbWVudCddLmluY2x1ZGVzKGNvbnRhY3RzLnR5cGUpKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgY29udGFjdCBzZWxlY3Rpb24nIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gVmFsaWRhdGUgYW5kIG5vcm1hbGl6ZSBhdHRhY2htZW50cyAoaWYgcHJvdmlkZWQpXHJcbiAgdHJ5IHtcclxuICAgIGlmIChpbml0aWFsLmF0dGFjaG1lbnRzKSB7XHJcbiAgICAgIGluaXRpYWwuYXR0YWNobWVudHMgPSB2YWxpZGF0ZUF0dGFjaG1lbnRzKGluaXRpYWwuYXR0YWNobWVudHMpO1xyXG4gICAgfVxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZm9sbG93VXBzKSkge1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvbGxvd1Vwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGlmIChmb2xsb3dVcHNbaV0/LmF0dGFjaG1lbnRzKSB7XHJcbiAgICAgICAgICBmb2xsb3dVcHNbaV0uYXR0YWNobWVudHMgPSB2YWxpZGF0ZUF0dGFjaG1lbnRzKGZvbGxvd1Vwc1tpXS5hdHRhY2htZW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogYEludmFsaWQgYXR0YWNobWVudHM6ICR7ZS5tZXNzYWdlIHx8IFN0cmluZyhlKX1gIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgY2xpZW50UHJvbWlzZTtcclxuICBjb25zdCBkYiA9IGNsaWVudC5kYignUGxhdGZvcm1EYXRhJyk7XHJcblxyXG4gIGNvbnN0IHF1ZXJ5ID1cclxuICAgIGNvbnRhY3RzLnR5cGUgPT09ICdhbGwnXHJcbiAgICAgID8ge31cclxuICAgICAgOiB7IHNlZ21lbnRzOiBjb250YWN0cy52YWx1ZSB9O1xyXG5cclxuICBjb25zdCBjb250YWN0RG9jcyA9IGF3YWl0IGRiXHJcbiAgICAuY29sbGVjdGlvbignY29udGFjdHMnKVxyXG4gICAgLmZpbmQocXVlcnkpXHJcbiAgICAucHJvamVjdCh7IF9pZDogMSwgZW1haWw6IDEgfSlcclxuICAgIC50b0FycmF5KCk7XHJcblxyXG4gIGlmICghY29udGFjdERvY3MubGVuZ3RoKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ05vIGNvbnRhY3RzIG1hdGNoZWQgc2VsZWN0aW9uJyB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKCk7XHJcblxyXG4gIC8vIC0tLSBDcmVhdGUgY2FtcGFpZ24gZG9jdW1lbnQgKHBlcnNpc3QgYXR0YWNobWVudHMgbWV0YWRhdGEpIC0tLVxyXG4gIGNvbnN0IGNhbXBhaWduRG9jOiBhbnkgPSB7XHJcbiAgICBuYW1lLFxyXG4gICAgY29udGFjdHMsXHJcbiAgICBpbml0aWFsLFxyXG4gICAgZm9sbG93VXBzLFxyXG4gICAgdG90YWxzOiB7XHJcbiAgICAgIGludGVuZGVkOiBjb250YWN0RG9jcy5sZW5ndGgsXHJcbiAgICAgIHByb2Nlc3NlZDogMCxcclxuICAgICAgc2VudDogMCxcclxuICAgICAgZmFpbGVkOiAwLFxyXG4gICAgfSxcclxuICAgIHN0YXR1czogJ3J1bm5pbmcnLFxyXG4gICAgY3JlYXRlZEF0LFxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNhbXBhaWduUmVzdWx0ID0gYXdhaXQgZGJcclxuICAgIC5jb2xsZWN0aW9uKCdjYW1wYWlnbnMnKVxyXG4gICAgLmluc2VydE9uZShjYW1wYWlnbkRvYyk7XHJcblxyXG4gIGNvbnN0IGNhbXBhaWduT2JqZWN0SWQgPSBjYW1wYWlnblJlc3VsdC5pbnNlcnRlZElkO1xyXG4gIGNvbnN0IGNhbXBhaWduSWQgPSBjYW1wYWlnbk9iamVjdElkLnRvU3RyaW5nKCk7XHJcblxyXG4gIC8vIC0tLSBJbnNlcnQgbGVkZ2VyIGlkZW1wb3RlbnRseSAtLS1cclxuICBjb25zdCBsZWRnZXJEb2NzID0gY29udGFjdERvY3MubWFwKChjKSA9PiAoe1xyXG4gICAgY2FtcGFpZ25JZDogY2FtcGFpZ25PYmplY3RJZCxcclxuICAgIGNvbnRhY3RJZDogYy5faWQsXHJcbiAgICBzdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgIGF0dGVtcHRzOiAwLFxyXG4gICAgYmdBdHRlbXB0czogMCxcclxuICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcclxuICB9KSk7XHJcblxyXG4gIGNvbnN0IGNodW5rcyA9IGNodW5rQXJyYXkobGVkZ2VyRG9jcywgMTAwMCk7XHJcbiAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3MpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IGRiXHJcbiAgICAgICAgLmNvbGxlY3Rpb24oJ2NhbXBhaWduX2NvbnRhY3RzJylcclxuICAgICAgICAuaW5zZXJ0TWFueShjaHVuaywgeyBvcmRlcmVkOiBmYWxzZSB9KTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgLy8gRHVwbGljYXRlIGtleSBlcnJvcnMgYXJlIHNhZmUgdG8gaWdub3JlIChpZGVtcG90ZW5jeSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIC0tLSBSZWRpcyBydW50aW1lIG1ldGEgKGJlc3QtZWZmb3J0KSAtLS1cclxuICB0cnkge1xyXG4gICAgYXdhaXQgcmVkaXMuaHNldChgY2FtcGFpZ246JHtjYW1wYWlnbklkfTptZXRhYCwge1xyXG4gICAgICBuYW1lLFxyXG4gICAgICB0b3RhbDogU3RyaW5nKGNvbnRhY3REb2NzLmxlbmd0aCksXHJcbiAgICAgIHByb2Nlc3NlZDogJzAnLFxyXG4gICAgICBzZW50OiAnMCcsXHJcbiAgICAgIGZhaWxlZDogJzAnLFxyXG4gICAgICBzdGF0dXM6ICdydW5uaW5nJyxcclxuICAgICAgY3JlYXRlZEF0OiBjcmVhdGVkQXQudG9JU09TdHJpbmcoKSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFBlcnNpc3QgYW4gZW5yaWNoZWQgZGVmaW5pdGlvbiAoaW5jbHVkZXMgYXR0YWNobWVudHMgbWV0YWRhdGEpIGZvciB0aGUgd29ya2VyIHRvIHBpY2sgdXBcclxuICAgIGNvbnN0IGRlZmluaXRpb24gPSB7IGluaXRpYWwsIGZvbGxvd1VwcywgbmFtZSwgY29udGFjdHMgfTtcclxuICAgIGF3YWl0IHJlZGlzLnNldChcclxuICAgICAgYGNhbXBhaWduOiR7Y2FtcGFpZ25JZH06ZGVmaW5pdGlvbmAsXHJcbiAgICAgIEpTT04uc3RyaW5naWZ5KGRlZmluaXRpb24pXHJcbiAgICApO1xyXG5cclxuICAgIGF3YWl0IHJlZGlzLnNhZGQoJ2NhbXBhaWduOmFsbCcsIGNhbXBhaWduSWQpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIGNvbnNvbGUud2FybignUmVkaXMgdW5hdmFpbGFibGUgZHVyaW5nIGNhbXBhaWduIHN0YXJ0JywgZSk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gRW5xdWV1ZSBpbml0aWFsIGpvYnMgKE1VU1QgaW5jbHVkZSBhdHRlbXB0cyArIGJhY2tvZmYgZm9yIEJ1bGxNUSByZXRyeSBzeXN0ZW0pIC0tLVxyXG4gIGZvciAoY29uc3QgYyBvZiBjb250YWN0RG9jcykge1xyXG4gICAgaWYgKCFjLmVtYWlsKSBjb250aW51ZTtcclxuXHJcbiAgICBhd2FpdCBxdWV1ZS5hZGQoXHJcbiAgICAgICdpbml0aWFsJyxcclxuICAgICAge1xyXG4gICAgICAgIGNhbXBhaWduSWQsXHJcbiAgICAgICAgY29udGFjdElkOiBjLl9pZC50b1N0cmluZygpLFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgYXR0ZW1wdHM6IE1BWF9BVFRFTVBUUyxcclxuICAgICAgICBiYWNrb2ZmOiB7XHJcbiAgICAgICAgICB0eXBlOiAnZXhwb25lbnRpYWwnLFxyXG4gICAgICAgICAgZGVsYXk6IDYwXzAwMCwgLy8gMSBtaW51dGUgYmFzZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVtb3ZlT25Db21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICByZW1vdmVPbkZhaWw6IHRydWUsXHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gTm90aWZ5IFVJIC0tLVxyXG4gIHRyeSB7XHJcbiAgICBhd2FpdCByZWRpcy5wdWJsaXNoKFxyXG4gICAgICAnY2FtcGFpZ246bmV3JyxcclxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGlkOiBjYW1wYWlnbklkLFxyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgdG90YWw6IGNvbnRhY3REb2NzLmxlbmd0aCxcclxuICAgICAgICBjcmVhdGVkQXQ6IGNyZWF0ZWRBdC50b0lTT1N0cmluZygpLFxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9IGNhdGNoIHtcclxuICAgIC8vIG5vbi1mYXRhbFxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgIGNhbXBhaWduSWQsXHJcbiAgICB0b3RhbDogY29udGFjdERvY3MubGVuZ3RoLFxyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJRdWV1ZSIsInJlZGlzIiwiY2xpZW50UHJvbWlzZSIsInF1ZXVlIiwiY29ubmVjdGlvbiIsIk1BWF9BVFRFTVBUUyIsImNodW5rQXJyYXkiLCJhcnIiLCJzaXplIiwib3V0IiwiaSIsImxlbmd0aCIsInB1c2giLCJzbGljZSIsImlzVmFsaWRVcmwiLCJ1IiwicGFyc2VkIiwiVVJMIiwicHJvdG9jb2wiLCJoYXNEb3REb3RTZWdtZW50cyIsInAiLCJzcGxpdCIsInNvbWUiLCJzZWdtZW50IiwidmFsaWRhdGVBdHRhY2htZW50cyIsIkFycmF5IiwiaXNBcnJheSIsIkVycm9yIiwiTUFYX0FUVEFDSE1FTlRTIiwiTUFYX0lOTElORV9CQVNFNjRfQllURVMiLCJhIiwibmFtZSIsInRyaW0iLCJzb3VyY2UiLCJjb250ZW50VHlwZSIsInVuZGVmaW5lZCIsInVybCIsInBhdGgiLCJjb250ZW50IiwiZXN0aW1hdGVkQnl0ZXMiLCJNYXRoIiwiZmxvb3IiLCJ0ZXN0IiwicmVwbGFjZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJjb250YWN0cyIsImluaXRpYWwiLCJmb2xsb3dVcHMiLCJib2R5Iiwic3ViamVjdCIsImluY2x1ZGVzIiwidHlwZSIsImF0dGFjaG1lbnRzIiwiZSIsIm1lc3NhZ2UiLCJTdHJpbmciLCJjbGllbnQiLCJkYiIsInF1ZXJ5Iiwic2VnbWVudHMiLCJ2YWx1ZSIsImNvbnRhY3REb2NzIiwiY29sbGVjdGlvbiIsImZpbmQiLCJwcm9qZWN0IiwiX2lkIiwiZW1haWwiLCJ0b0FycmF5IiwiY3JlYXRlZEF0IiwiRGF0ZSIsImNhbXBhaWduRG9jIiwidG90YWxzIiwiaW50ZW5kZWQiLCJwcm9jZXNzZWQiLCJzZW50IiwiZmFpbGVkIiwiY2FtcGFpZ25SZXN1bHQiLCJpbnNlcnRPbmUiLCJjYW1wYWlnbk9iamVjdElkIiwiaW5zZXJ0ZWRJZCIsImNhbXBhaWduSWQiLCJ0b1N0cmluZyIsImxlZGdlckRvY3MiLCJtYXAiLCJjIiwiY29udGFjdElkIiwiYXR0ZW1wdHMiLCJiZ0F0dGVtcHRzIiwiY2h1bmtzIiwiY2h1bmsiLCJpbnNlcnRNYW55Iiwib3JkZXJlZCIsImhzZXQiLCJ0b3RhbCIsInRvSVNPU3RyaW5nIiwiZGVmaW5pdGlvbiIsInNldCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzYWRkIiwiY29uc29sZSIsIndhcm4iLCJhZGQiLCJiYWNrb2ZmIiwiZGVsYXkiLCJyZW1vdmVPbkNvbXBsZXRlIiwicmVtb3ZlT25GYWlsIiwicHVibGlzaCIsImlkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/campaign/start.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2Fstart&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5Cstart.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();