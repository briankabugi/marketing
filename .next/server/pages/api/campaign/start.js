"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/campaign/start";
exports.ids = ["pages/api/campaign/start"];
exports.modules = {

/***/ "bullmq":
/*!*************************!*\
  !*** external "bullmq" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("bullmq");

/***/ }),

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2Fstart&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5Cstart.ts&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2Fstart&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5Cstart.ts&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_campaign_start_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\campaign\\start.ts */ \"(api)/./pages/api/campaign/start.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_start_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_campaign_start_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/campaign/start\",\n        pathname: \"/api/campaign/start\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_campaign_start_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmNhbXBhaWduJTJGc3RhcnQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2NhbXBhaWduJTVDc3RhcnQudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDNkQ7QUFDN0Q7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHlEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx5REFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLz9mYzFhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcY2FtcGFpZ25cXFxcc3RhcnQudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9jYW1wYWlnbi9zdGFydFwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NhbXBhaWduL3N0YXJ0XCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2Fstart&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5Cstart.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/mongo.ts":
/*!**********************!*\
  !*** ./lib/mongo.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n// lib/mongo.ts\n\nconst uri = process.env.MONGODB_URI;\nif (!uri) throw new Error(\"MONGODB_URI not set\");\nlet client;\nlet clientPromise;\n// Retry logic in case MongoDB connection fails\nasync function connectWithRetry() {\n    const MAX_RETRIES = 5;\n    let attempts = 0;\n    let lastError = null;\n    while(attempts < MAX_RETRIES){\n        try {\n            const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, {\n                maxPoolSize: 10,\n                serverSelectionTimeoutMS: 10000,\n                socketTimeoutMS: 45000\n            });\n            await client.connect();\n            return client;\n        } catch (err) {\n            lastError = err;\n            attempts++;\n            console.error(`MongoDB connection failed (attempt ${attempts}/${MAX_RETRIES}):`, err);\n            if (attempts < MAX_RETRIES) {\n                await new Promise((resolve)=>setTimeout(resolve, 5000)); // wait for 5 seconds before retrying\n            }\n        }\n    }\n    // After max retries, throw the last error encountered\n    throw lastError || new Error(\"MongoDB connection failed after maximum retry attempts\");\n}\nif (!global._mongoClientPromise) {\n    global._mongoClientPromise = connectWithRetry();\n    // Optional: log connection events\n    global._mongoClientPromise.then((client)=>{\n        client.on(\"serverOpening\", (event)=>console.log(\"MongoDB server opening\", event));\n        client.on(\"serverClosed\", (event)=>console.warn(\"MongoDB server closed\", event));\n        client.on(\"topologyClosed\", ()=>console.warn(\"MongoDB topology closed\"));\n        client.on(\"topologyOpening\", ()=>console.log(\"MongoDB topology opening\"));\n        client.on(\"error\", (err)=>console.error(\"MongoDB error\", err));\n    }).catch((err)=>{\n        console.error(\"MongoDB client failed to connect after retries\", err);\n    });\n}\nclientPromise = global._mongoClientPromise;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvbW9uZ28udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZUFBZTtBQUN1QjtBQUV0QyxNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFdBQVc7QUFDbkMsSUFBSSxDQUFDSCxLQUFLLE1BQU0sSUFBSUksTUFBTTtBQUUxQixJQUFJQztBQUNKLElBQUlDO0FBT0osK0NBQStDO0FBQy9DLGVBQWVDO0lBQ2IsTUFBTUMsY0FBYztJQUNwQixJQUFJQyxXQUFXO0lBQ2YsSUFBSUMsWUFBMEI7SUFFOUIsTUFBT0QsV0FBV0QsWUFBYTtRQUM3QixJQUFJO1lBQ0YsTUFBTUgsU0FBUyxJQUFJTixnREFBV0EsQ0FBQ0MsS0FBSztnQkFDbENXLGFBQWE7Z0JBQ2JDLDBCQUEwQjtnQkFDMUJDLGlCQUFpQjtZQUNuQjtZQUNBLE1BQU1SLE9BQU9TLE9BQU87WUFDcEIsT0FBT1Q7UUFDVCxFQUFFLE9BQU9VLEtBQVU7WUFDakJMLFlBQVlLO1lBQ1pOO1lBQ0FPLFFBQVFDLEtBQUssQ0FBQyxDQUFDLG1DQUFtQyxFQUFFUixTQUFTLENBQUMsRUFBRUQsWUFBWSxFQUFFLENBQUMsRUFBRU87WUFDakYsSUFBSU4sV0FBV0QsYUFBYTtnQkFDMUIsTUFBTSxJQUFJVSxRQUFRQyxDQUFBQSxVQUFXQyxXQUFXRCxTQUFTLFFBQVEscUNBQXFDO1lBQ2hHO1FBQ0Y7SUFDRjtJQUVBLHNEQUFzRDtJQUN0RCxNQUFNVCxhQUFhLElBQUlOLE1BQU07QUFDL0I7QUFFQSxJQUFJLENBQUNpQixPQUFPQyxtQkFBbUIsRUFBRTtJQUMvQkQsT0FBT0MsbUJBQW1CLEdBQUdmO0lBRTdCLGtDQUFrQztJQUNsQ2MsT0FBT0MsbUJBQW1CLENBQ3ZCQyxJQUFJLENBQUNsQixDQUFBQTtRQUNKQSxPQUFPbUIsRUFBRSxDQUFDLGlCQUFpQixDQUFDQyxRQUFVVCxRQUFRVSxHQUFHLENBQUMsMEJBQTBCRDtRQUM1RXBCLE9BQU9tQixFQUFFLENBQUMsZ0JBQWdCLENBQUNDLFFBQVVULFFBQVFXLElBQUksQ0FBQyx5QkFBeUJGO1FBQzNFcEIsT0FBT21CLEVBQUUsQ0FBQyxrQkFBa0IsSUFBTVIsUUFBUVcsSUFBSSxDQUFDO1FBQy9DdEIsT0FBT21CLEVBQUUsQ0FBQyxtQkFBbUIsSUFBTVIsUUFBUVUsR0FBRyxDQUFDO1FBQy9DckIsT0FBT21CLEVBQUUsQ0FBQyxTQUFTLENBQUNULE1BQVFDLFFBQVFDLEtBQUssQ0FBQyxpQkFBaUJGO0lBQzdELEdBQ0NhLEtBQUssQ0FBQ2IsQ0FBQUE7UUFDTEMsUUFBUUMsS0FBSyxDQUFDLGtEQUFrREY7SUFDbEU7QUFDSjtBQUVBVCxnQkFBZ0JlLE9BQU9DLG1CQUFtQjtBQUUxQyxpRUFBZWhCLGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tYXJrZXRpbmctbXZwLy4vbGliL21vbmdvLnRzPzU3ZmUiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL21vbmdvLnRzXHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSTtcclxuaWYgKCF1cmkpIHRocm93IG5ldyBFcnJvcignTU9OR09EQl9VUkkgbm90IHNldCcpO1xyXG5cclxubGV0IGNsaWVudDogTW9uZ29DbGllbnQ7XHJcbmxldCBjbGllbnRQcm9taXNlOiBQcm9taXNlPE1vbmdvQ2xpZW50PjtcclxuXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXHJcbiAgdmFyIF9tb25nb0NsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+IHwgdW5kZWZpbmVkO1xyXG59XHJcblxyXG4vLyBSZXRyeSBsb2dpYyBpbiBjYXNlIE1vbmdvREIgY29ubmVjdGlvbiBmYWlsc1xyXG5hc3luYyBmdW5jdGlvbiBjb25uZWN0V2l0aFJldHJ5KCk6IFByb21pc2U8TW9uZ29DbGllbnQ+IHtcclxuICBjb25zdCBNQVhfUkVUUklFUyA9IDU7XHJcbiAgbGV0IGF0dGVtcHRzID0gMDtcclxuICBsZXQgbGFzdEVycm9yOiBFcnJvciB8IG51bGwgPSBudWxsO1xyXG5cclxuICB3aGlsZSAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwge1xyXG4gICAgICAgIG1heFBvb2xTaXplOiAxMCxcclxuICAgICAgICBzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVM6IDEwMDAwLFxyXG4gICAgICAgIHNvY2tldFRpbWVvdXRNUzogNDUwMDAsXHJcbiAgICAgIH0pO1xyXG4gICAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgICByZXR1cm4gY2xpZW50O1xyXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgbGFzdEVycm9yID0gZXJyO1xyXG4gICAgICBhdHRlbXB0cysrO1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBNb25nb0RCIGNvbm5lY3Rpb24gZmFpbGVkIChhdHRlbXB0ICR7YXR0ZW1wdHN9LyR7TUFYX1JFVFJJRVN9KTpgLCBlcnIpO1xyXG4gICAgICBpZiAoYXR0ZW1wdHMgPCBNQVhfUkVUUklFUykge1xyXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDAwKSk7IC8vIHdhaXQgZm9yIDUgc2Vjb25kcyBiZWZvcmUgcmV0cnlpbmdcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQWZ0ZXIgbWF4IHJldHJpZXMsIHRocm93IHRoZSBsYXN0IGVycm9yIGVuY291bnRlcmVkXHJcbiAgdGhyb3cgbGFzdEVycm9yIHx8IG5ldyBFcnJvcignTW9uZ29EQiBjb25uZWN0aW9uIGZhaWxlZCBhZnRlciBtYXhpbXVtIHJldHJ5IGF0dGVtcHRzJyk7XHJcbn1cclxuXHJcbmlmICghZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2UpIHtcclxuICBnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZSA9IGNvbm5lY3RXaXRoUmV0cnkoKTtcclxuICBcclxuICAvLyBPcHRpb25hbDogbG9nIGNvbm5lY3Rpb24gZXZlbnRzXHJcbiAgZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2VcclxuICAgIC50aGVuKGNsaWVudCA9PiB7XHJcbiAgICAgIGNsaWVudC5vbignc2VydmVyT3BlbmluZycsIChldmVudCkgPT4gY29uc29sZS5sb2coJ01vbmdvREIgc2VydmVyIG9wZW5pbmcnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3NlcnZlckNsb3NlZCcsIChldmVudCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHNlcnZlciBjbG9zZWQnLCBldmVudCkpO1xyXG4gICAgICBjbGllbnQub24oJ3RvcG9sb2d5Q2xvc2VkJywgKCkgPT4gY29uc29sZS53YXJuKCdNb25nb0RCIHRvcG9sb2d5IGNsb3NlZCcpKTtcclxuICAgICAgY2xpZW50Lm9uKCd0b3BvbG9neU9wZW5pbmcnLCAoKSA9PiBjb25zb2xlLmxvZygnTW9uZ29EQiB0b3BvbG9neSBvcGVuaW5nJykpO1xyXG4gICAgICBjbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4gY29uc29sZS5lcnJvcignTW9uZ29EQiBlcnJvcicsIGVycikpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIGNsaWVudCBmYWlsZWQgdG8gY29ubmVjdCBhZnRlciByZXRyaWVzJywgZXJyKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jbGllbnRQcm9taXNlID0gZ2xvYmFsLl9tb25nb0NsaWVudFByb21pc2U7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnRQcm9taXNlOyJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInVyaSIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwiY2xpZW50IiwiY2xpZW50UHJvbWlzZSIsImNvbm5lY3RXaXRoUmV0cnkiLCJNQVhfUkVUUklFUyIsImF0dGVtcHRzIiwibGFzdEVycm9yIiwibWF4UG9vbFNpemUiLCJzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMiLCJzb2NrZXRUaW1lb3V0TVMiLCJjb25uZWN0IiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZ2xvYmFsIiwiX21vbmdvQ2xpZW50UHJvbWlzZSIsInRoZW4iLCJvbiIsImV2ZW50IiwibG9nIiwid2FybiIsImNhdGNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/mongo.ts\n");

/***/ }),

/***/ "(api)/./lib/redis.ts":
/*!**********************!*\
  !*** ./lib/redis.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   redis: () => (/* binding */ redis)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n// lib/redis.ts\n\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(process.env.REDIS_URL || \"redis://127.0.0.1:6379\", {\n    maxRetriesPerRequest: null,\n    lazyConnect: true,\n    reconnectOnError: (err)=>{\n        // reconnect on most errors\n        const targetErrors = [\n            \"READONLY\",\n            \"ECONNRESET\",\n            \"ETIMEDOUT\"\n        ];\n        if (targetErrors.some((e)=>err.message.includes(e))) return true;\n        return false;\n    }\n});\n// Optional: log Redis connection events for observability\nredis.on(\"connect\", ()=>console.log(\"Redis connected\"));\nredis.on(\"ready\", ()=>console.log(\"Redis ready\"));\nredis.on(\"error\", (err)=>console.error(\"Redis error\", err));\nredis.on(\"close\", ()=>console.warn(\"Redis connection closed\"));\nredis.on(\"reconnecting\", ()=>console.log(\"Redis reconnecting\"));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvcmVkaXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZUFBZTtBQUVlO0FBRXZCLE1BQU1DLFFBQVEsSUFBSUQsZ0RBQU9BLENBQUNFLFFBQVFDLEdBQUcsQ0FBQ0MsU0FBUyxJQUFJLDBCQUEwQjtJQUNsRkMsc0JBQXNCO0lBQ3RCQyxhQUFhO0lBQ2JDLGtCQUFrQixDQUFDQztRQUNqQiwyQkFBMkI7UUFDM0IsTUFBTUMsZUFBZTtZQUFDO1lBQVk7WUFBYztTQUFZO1FBQzVELElBQUlBLGFBQWFDLElBQUksQ0FBQ0MsQ0FBQUEsSUFBS0gsSUFBSUksT0FBTyxDQUFDQyxRQUFRLENBQUNGLEtBQUssT0FBTztRQUM1RCxPQUFPO0lBQ1Q7QUFDRixHQUFHO0FBRUgsMERBQTBEO0FBQzFEVixNQUFNYSxFQUFFLENBQUMsV0FBVyxJQUFNQyxRQUFRQyxHQUFHLENBQUM7QUFDdENmLE1BQU1hLEVBQUUsQ0FBQyxTQUFTLElBQU1DLFFBQVFDLEdBQUcsQ0FBQztBQUNwQ2YsTUFBTWEsRUFBRSxDQUFDLFNBQVMsQ0FBQ04sTUFBUU8sUUFBUUUsS0FBSyxDQUFDLGVBQWVUO0FBQ3hEUCxNQUFNYSxFQUFFLENBQUMsU0FBUyxJQUFNQyxRQUFRRyxJQUFJLENBQUM7QUFDckNqQixNQUFNYSxFQUFFLENBQUMsZ0JBQWdCLElBQU1DLFFBQVFDLEdBQUcsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL21hcmtldGluZy1tdnAvLi9saWIvcmVkaXMudHM/NTFlOSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvcmVkaXMudHNcclxuXHJcbmltcG9ydCBJT1JlZGlzIGZyb20gJ2lvcmVkaXMnO1xyXG5cclxuZXhwb3J0IGNvbnN0IHJlZGlzID0gbmV3IElPUmVkaXMocHJvY2Vzcy5lbnYuUkVESVNfVVJMIHx8ICdyZWRpczovLzEyNy4wLjAuMTo2Mzc5Jywge1xyXG4gIG1heFJldHJpZXNQZXJSZXF1ZXN0OiBudWxsLFxyXG4gIGxhenlDb25uZWN0OiB0cnVlLCAgICAgICAgICAgLy8gcHJldmVudHMgaW1tZWRpYXRlIGNvbm5lY3Rpb24gb24gaW1wb3J0XHJcbiAgcmVjb25uZWN0T25FcnJvcjogKGVycikgPT4ge1xyXG4gICAgLy8gcmVjb25uZWN0IG9uIG1vc3QgZXJyb3JzXHJcbiAgICBjb25zdCB0YXJnZXRFcnJvcnMgPSBbJ1JFQURPTkxZJywgJ0VDT05OUkVTRVQnLCAnRVRJTUVET1VUJ107XHJcbiAgICBpZiAodGFyZ2V0RXJyb3JzLnNvbWUoZSA9PiBlcnIubWVzc2FnZS5pbmNsdWRlcyhlKSkpIHJldHVybiB0cnVlO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH0sXHJcbn0pO1xyXG5cclxuLy8gT3B0aW9uYWw6IGxvZyBSZWRpcyBjb25uZWN0aW9uIGV2ZW50cyBmb3Igb2JzZXJ2YWJpbGl0eVxyXG5yZWRpcy5vbignY29ubmVjdCcsICgpID0+IGNvbnNvbGUubG9nKCdSZWRpcyBjb25uZWN0ZWQnKSk7XHJcbnJlZGlzLm9uKCdyZWFkeScsICgpID0+IGNvbnNvbGUubG9nKCdSZWRpcyByZWFkeScpKTtcclxucmVkaXMub24oJ2Vycm9yJywgKGVycikgPT4gY29uc29sZS5lcnJvcignUmVkaXMgZXJyb3InLCBlcnIpKTtcclxucmVkaXMub24oJ2Nsb3NlJywgKCkgPT4gY29uc29sZS53YXJuKCdSZWRpcyBjb25uZWN0aW9uIGNsb3NlZCcpKTtcclxucmVkaXMub24oJ3JlY29ubmVjdGluZycsICgpID0+IGNvbnNvbGUubG9nKCdSZWRpcyByZWNvbm5lY3RpbmcnKSk7Il0sIm5hbWVzIjpbIklPUmVkaXMiLCJyZWRpcyIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19VUkwiLCJtYXhSZXRyaWVzUGVyUmVxdWVzdCIsImxhenlDb25uZWN0IiwicmVjb25uZWN0T25FcnJvciIsImVyciIsInRhcmdldEVycm9ycyIsInNvbWUiLCJlIiwibWVzc2FnZSIsImluY2x1ZGVzIiwib24iLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJ3YXJuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/redis.ts\n");

/***/ }),

/***/ "(api)/./pages/api/campaign/start.ts":
/*!*************************************!*\
  !*** ./pages/api/campaign/start.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var bullmq__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bullmq */ \"bullmq\");\n/* harmony import */ var bullmq__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bullmq__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_redis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/redis */ \"(api)/./lib/redis.ts\");\n/* harmony import */ var _lib_mongo__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/mongo */ \"(api)/./lib/mongo.ts\");\n// pages/api/campaign/start.ts\n\n\n\nconst queue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(\"campaigns\", {\n    connection: _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis\n});\nconst MAX_BACKGROUND_ATTEMPTS = Number(process.env.MAX_BACKGROUND_ATTEMPTS || process.env.MAX_ATTEMPTS || 3);\nconst MAX_CORE_ATTEMPTS = Number(process.env.MAX_CORE_ATTEMPTS || 3);\n// utility to chunk arrays\nfunction chunkArray(arr, size = 1000) {\n    const out = [];\n    for(let i = 0; i < arr.length; i += size)out.push(arr.slice(i, i + size));\n    return out;\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    const { name, contacts, initial, followUps = [] } = req.body;\n    if (!name || typeof name !== \"string\") {\n        return res.status(400).json({\n            error: \"Campaign name required\"\n        });\n    }\n    if (!initial?.subject || !initial?.body) {\n        return res.status(400).json({\n            error: \"Initial email subject and body required\"\n        });\n    }\n    if (!contacts || ![\n        \"all\",\n        \"segment\"\n    ].includes(contacts.type)) {\n        return res.status(400).json({\n            error: \"Invalid contact selection\"\n        });\n    }\n    const client = await _lib_mongo__WEBPACK_IMPORTED_MODULE_2__[\"default\"];\n    const db = client.db(\"PlatformData\");\n    const query = contacts.type === \"all\" ? {} : {\n        segments: contacts.value\n    };\n    const contactDocs = await db.collection(\"contacts\").find(query).project({\n        _id: 1,\n        email: 1\n    }).toArray();\n    if (!contactDocs.length) {\n        return res.status(400).json({\n            error: \"No contacts matched selection\"\n        });\n    }\n    const createdAt = new Date();\n    const campaignDoc = {\n        name,\n        contacts,\n        initial,\n        followUps,\n        totals: {\n            intended: contactDocs.length,\n            processed: 0,\n            sent: 0,\n            failed: 0\n        },\n        status: \"running\",\n        createdAt\n    };\n    const campaignResult = await db.collection(\"campaigns\").insertOne(campaignDoc);\n    const campaignObjectId = campaignResult.insertedId;\n    const campaignId = campaignObjectId.toString();\n    // --- Insert ledger rows with new fields: coreAttempts/backgroundAttempts, etc.\n    const ledgerDocs = contactDocs.map((c)=>({\n            campaignId: campaignObjectId,\n            contactId: c._id,\n            email: c.email ?? null,\n            status: \"pending\",\n            // coreAttempts: indicate an initial core attempt has been started\n            coreAttempts: 1,\n            // backgroundAttempts start at 0 (no follow-ups yet)\n            backgroundAttempts: 0,\n            maxCoreAttempts: MAX_CORE_ATTEMPTS,\n            maxBackgroundAttempts: MAX_BACKGROUND_ATTEMPTS,\n            retryLocked: true\n        }));\n    const chunks = chunkArray(ledgerDocs, 1000);\n    for (const chunk of chunks){\n        try {\n            await db.collection(\"campaign_contacts\").insertMany(chunk, {\n                ordered: false\n            });\n        } catch (e) {\n        // Duplicate key errors are safe to ignore (idempotency)\n        }\n    }\n    // --- Redis runtime meta (best-effort) ---\n    try {\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.hset(`campaign:${campaignId}:meta`, {\n            name,\n            total: String(contactDocs.length),\n            processed: \"0\",\n            sent: \"0\",\n            failed: \"0\",\n            status: \"running\",\n            createdAt: createdAt.toISOString()\n        });\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.set(`campaign:${campaignId}:definition`, JSON.stringify({\n            initial,\n            followUps,\n            name,\n            contacts\n        }));\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.sadd(\"campaign:all\", campaignId);\n    } catch (e) {\n        console.warn(\"Redis unavailable during campaign start\", e);\n    }\n    // --- Enqueue initial jobs and update ledger rows with lastJobId (per-contact updates)\n    for (const c of contactDocs){\n        if (!c.email) continue;\n        try {\n            const jobObj = await queue.add(\"initial\", {\n                campaignId,\n                contactId: c._id.toString()\n            }, {\n                attempts: MAX_BACKGROUND_ATTEMPTS,\n                backoff: {\n                    type: \"exponential\",\n                    delay: 60 * 1000\n                },\n                removeOnComplete: true,\n                removeOnFail: false\n            });\n            // write lastJobId and ensure retryLocked true and set max* fields (best-effort)\n            await db.collection(\"campaign_contacts\").updateOne({\n                campaignId: campaignObjectId,\n                contactId: c._id\n            }, {\n                $set: {\n                    lastJobId: jobObj.id,\n                    retryLocked: true,\n                    maxBackgroundAttempts: MAX_BACKGROUND_ATTEMPTS,\n                    maxCoreAttempts: MAX_CORE_ATTEMPTS\n                }\n            });\n            // publish an initial in-flight update so the UI reflects lastJobId/retryLock immediately\n            try {\n                const ledger = await db.collection(\"campaign_contacts\").findOne({\n                    campaignId: campaignObjectId,\n                    contactId: c._id\n                }, {\n                    projection: {\n                        contactId: 1,\n                        status: 1,\n                        coreAttempts: 1,\n                        backgroundAttempts: 1,\n                        maxBackgroundAttempts: 1,\n                        retryLocked: 1,\n                        lastJobId: 1\n                    }\n                });\n                await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.publish(`campaign:${campaignId}:contact`, JSON.stringify({\n                    contactId: ledger?.contactId?.toString?.() ?? ledger?._id?.toString?.(),\n                    status: ledger?.status,\n                    coreAttempts: ledger?.coreAttempts ?? 1,\n                    backgroundAttempts: ledger?.backgroundAttempts ?? 0,\n                    maxBackgroundAttempts: ledger?.maxBackgroundAttempts,\n                    retryLocked: ledger?.retryLocked ?? true,\n                    lastJobId: ledger?.lastJobId\n                }));\n            } catch (e) {\n            // best-effort publish; swallow\n            }\n        } catch (e) {\n            console.warn(\"Failed to enqueue initial job for contact\", c._id?.toString?.(), e);\n            // if queue.add fails, update ledger to reflect not-locked so UI doesn't block forever\n            try {\n                await db.collection(\"campaign_contacts\").updateOne({\n                    campaignId: campaignObjectId,\n                    contactId: c._id\n                }, {\n                    $set: {\n                        retryLocked: false,\n                        lastJobId: null\n                    }\n                });\n            } catch (_) {}\n        }\n    }\n    // --- Notify UI ---\n    try {\n        await _lib_redis__WEBPACK_IMPORTED_MODULE_1__.redis.publish(\"campaign:new\", JSON.stringify({\n            id: campaignId,\n            name,\n            total: contactDocs.length,\n            createdAt: createdAt.toISOString()\n        }));\n    } catch  {\n    // non-fatal\n    }\n    return res.status(201).json({\n        campaignId,\n        total: contactDocs.length\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YUFBYTJCLFFBQVEzQixlQUFlO29CQUNwQ3lCLFdBQVdFLFFBQVFGO2dCQUNyQjtZQUVKLEVBQUUsT0FBT3BCLEdBQUc7WUFDViwrQkFBK0I7WUFDakM7UUFDRixFQUFFLE9BQU9BLEdBQUc7WUFDVlMsUUFBUUMsSUFBSSxDQUFDLDZDQUE2Q3JCLEVBQUVuQixHQUFHLEVBQUVnQixjQUFjYztZQUMvRSxzRkFBc0Y7WUFDdEYsSUFBSTtnQkFDRixNQUFNdEMsR0FBR0ssVUFBVSxDQUFDLHFCQUFxQm1ELFNBQVMsQ0FDaEQ7b0JBQUVqQyxZQUFZRjtvQkFBa0JPLFdBQVdELEVBQUVuQixHQUFHO2dCQUFDLEdBQ2pEO29CQUFFaUQsTUFBTTt3QkFBRXhCLGFBQWE7d0JBQU95QixXQUFXO29CQUFLO2dCQUFFO1lBRXBELEVBQUUsT0FBT00sR0FBRyxDQUFDO1FBQ2Y7SUFDRjtJQUVBLG9CQUFvQjtJQUNwQixJQUFJO1FBQ0YsTUFBTWxHLDZDQUFLQSxDQUFDaUcsT0FBTyxDQUNqQixnQkFDQW5CLEtBQUtDLFNBQVMsQ0FBQztZQUNiYyxJQUFJcEM7WUFDSmhDO1lBQ0FpRCxPQUFPcEMsWUFBWXZCLE1BQU07WUFDekI4QixXQUFXQSxVQUFVK0IsV0FBVztRQUNsQztJQUVKLEVBQUUsT0FBTTtJQUNOLFlBQVk7SUFDZDtJQUVBLE9BQU94RCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1FBQzFCa0M7UUFDQWlCLE9BQU9wQyxZQUFZdkIsTUFBTTtJQUMzQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWFya2V0aW5nLW12cC8uL3BhZ2VzL2FwaS9jYW1wYWlnbi9zdGFydC50cz80NTVmIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHBhZ2VzL2FwaS9jYW1wYWlnbi9zdGFydC50c1xyXG5cclxuaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCB7IFF1ZXVlIH0gZnJvbSAnYnVsbG1xJztcclxuaW1wb3J0IHsgcmVkaXMgfSBmcm9tICcuLi8uLi8uLi9saWIvcmVkaXMnO1xyXG5pbXBvcnQgY2xpZW50UHJvbWlzZSBmcm9tICcuLi8uLi8uLi9saWIvbW9uZ28nO1xyXG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gJ21vbmdvZGInO1xyXG5cclxuY29uc3QgcXVldWUgPSBuZXcgUXVldWUoJ2NhbXBhaWducycsIHsgY29ubmVjdGlvbjogcmVkaXMgfSk7XHJcblxyXG5jb25zdCBNQVhfQkFDS0dST1VORF9BVFRFTVBUUyA9IE51bWJlcihwcm9jZXNzLmVudi5NQVhfQkFDS0dST1VORF9BVFRFTVBUUyB8fCBwcm9jZXNzLmVudi5NQVhfQVRURU1QVFMgfHwgMyk7XHJcbmNvbnN0IE1BWF9DT1JFX0FUVEVNUFRTID0gTnVtYmVyKHByb2Nlc3MuZW52Lk1BWF9DT1JFX0FUVEVNUFRTIHx8IDMpO1xyXG5cclxuLy8gdXRpbGl0eSB0byBjaHVuayBhcnJheXNcclxuZnVuY3Rpb24gY2h1bmtBcnJheTxUPihhcnI6IFRbXSwgc2l6ZSA9IDEwMDApOiBUW11bXSB7XHJcbiAgY29uc3Qgb3V0OiBUW11bXSA9IFtdO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSArPSBzaXplKSBvdXQucHVzaChhcnIuc2xpY2UoaSwgaSArIHNpemUpKTtcclxuICByZXR1cm4gb3V0O1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKFxyXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXHJcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2VcclxuKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgeyBuYW1lLCBjb250YWN0cywgaW5pdGlhbCwgZm9sbG93VXBzID0gW10gfSA9IHJlcS5ib2R5O1xyXG5cclxuICBpZiAoIW5hbWUgfHwgdHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0NhbXBhaWduIG5hbWUgcmVxdWlyZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFpbml0aWFsPy5zdWJqZWN0IHx8ICFpbml0aWFsPy5ib2R5KSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0luaXRpYWwgZW1haWwgc3ViamVjdCBhbmQgYm9keSByZXF1aXJlZCcgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoIWNvbnRhY3RzIHx8ICFbJ2FsbCcsICdzZWdtZW50J10uaW5jbHVkZXMoY29udGFjdHMudHlwZSkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnSW52YWxpZCBjb250YWN0IHNlbGVjdGlvbicgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBjbGllbnQgPSBhd2FpdCBjbGllbnRQcm9taXNlO1xyXG4gIGNvbnN0IGRiID0gY2xpZW50LmRiKCdQbGF0Zm9ybURhdGEnKTtcclxuXHJcbiAgY29uc3QgcXVlcnkgPVxyXG4gICAgY29udGFjdHMudHlwZSA9PT0gJ2FsbCdcclxuICAgICAgPyB7fVxyXG4gICAgICA6IHsgc2VnbWVudHM6IGNvbnRhY3RzLnZhbHVlIH07XHJcblxyXG4gIGNvbnN0IGNvbnRhY3REb2NzID0gYXdhaXQgZGJcclxuICAgIC5jb2xsZWN0aW9uKCdjb250YWN0cycpXHJcbiAgICAuZmluZChxdWVyeSlcclxuICAgIC5wcm9qZWN0KHsgX2lkOiAxLCBlbWFpbDogMSB9KVxyXG4gICAgLnRvQXJyYXkoKTtcclxuXHJcbiAgaWYgKCFjb250YWN0RG9jcy5sZW5ndGgpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnTm8gY29udGFjdHMgbWF0Y2hlZCBzZWxlY3Rpb24nIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUoKTtcclxuXHJcbiAgY29uc3QgY2FtcGFpZ25Eb2MgPSB7XHJcbiAgICBuYW1lLFxyXG4gICAgY29udGFjdHMsXHJcbiAgICBpbml0aWFsLFxyXG4gICAgZm9sbG93VXBzLFxyXG4gICAgdG90YWxzOiB7XHJcbiAgICAgIGludGVuZGVkOiBjb250YWN0RG9jcy5sZW5ndGgsXHJcbiAgICAgIHByb2Nlc3NlZDogMCxcclxuICAgICAgc2VudDogMCxcclxuICAgICAgZmFpbGVkOiAwLFxyXG4gICAgfSxcclxuICAgIHN0YXR1czogJ3J1bm5pbmcnLFxyXG4gICAgY3JlYXRlZEF0LFxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNhbXBhaWduUmVzdWx0ID0gYXdhaXQgZGJcclxuICAgIC5jb2xsZWN0aW9uKCdjYW1wYWlnbnMnKVxyXG4gICAgLmluc2VydE9uZShjYW1wYWlnbkRvYyk7XHJcblxyXG4gIGNvbnN0IGNhbXBhaWduT2JqZWN0SWQgPSBjYW1wYWlnblJlc3VsdC5pbnNlcnRlZElkO1xyXG4gIGNvbnN0IGNhbXBhaWduSWQgPSBjYW1wYWlnbk9iamVjdElkLnRvU3RyaW5nKCk7XHJcblxyXG4gIC8vIC0tLSBJbnNlcnQgbGVkZ2VyIHJvd3Mgd2l0aCBuZXcgZmllbGRzOiBjb3JlQXR0ZW1wdHMvYmFja2dyb3VuZEF0dGVtcHRzLCBldGMuXHJcbiAgY29uc3QgbGVkZ2VyRG9jcyA9IGNvbnRhY3REb2NzLm1hcCgoYykgPT4gKHtcclxuICAgIGNhbXBhaWduSWQ6IGNhbXBhaWduT2JqZWN0SWQsXHJcbiAgICBjb250YWN0SWQ6IGMuX2lkLFxyXG4gICAgZW1haWw6IGMuZW1haWwgPz8gbnVsbCxcclxuICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgLy8gY29yZUF0dGVtcHRzOiBpbmRpY2F0ZSBhbiBpbml0aWFsIGNvcmUgYXR0ZW1wdCBoYXMgYmVlbiBzdGFydGVkXHJcbiAgICBjb3JlQXR0ZW1wdHM6IDEsXHJcbiAgICAvLyBiYWNrZ3JvdW5kQXR0ZW1wdHMgc3RhcnQgYXQgMCAobm8gZm9sbG93LXVwcyB5ZXQpXHJcbiAgICBiYWNrZ3JvdW5kQXR0ZW1wdHM6IDAsXHJcbiAgICBtYXhDb3JlQXR0ZW1wdHM6IE1BWF9DT1JFX0FUVEVNUFRTLFxyXG4gICAgbWF4QmFja2dyb3VuZEF0dGVtcHRzOiBNQVhfQkFDS0dST1VORF9BVFRFTVBUUyxcclxuICAgIHJldHJ5TG9ja2VkOiB0cnVlLCAvLyBqb2IgaXMgZW5xdWV1ZWRcclxuICB9KSk7XHJcblxyXG4gIGNvbnN0IGNodW5rcyA9IGNodW5rQXJyYXkobGVkZ2VyRG9jcywgMTAwMCk7XHJcbiAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3MpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IGRiXHJcbiAgICAgICAgLmNvbGxlY3Rpb24oJ2NhbXBhaWduX2NvbnRhY3RzJylcclxuICAgICAgICAuaW5zZXJ0TWFueShjaHVuaywgeyBvcmRlcmVkOiBmYWxzZSB9KTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgLy8gRHVwbGljYXRlIGtleSBlcnJvcnMgYXJlIHNhZmUgdG8gaWdub3JlIChpZGVtcG90ZW5jeSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIC0tLSBSZWRpcyBydW50aW1lIG1ldGEgKGJlc3QtZWZmb3J0KSAtLS1cclxuICB0cnkge1xyXG4gICAgYXdhaXQgcmVkaXMuaHNldChgY2FtcGFpZ246JHtjYW1wYWlnbklkfTptZXRhYCwge1xyXG4gICAgICBuYW1lLFxyXG4gICAgICB0b3RhbDogU3RyaW5nKGNvbnRhY3REb2NzLmxlbmd0aCksXHJcbiAgICAgIHByb2Nlc3NlZDogJzAnLFxyXG4gICAgICBzZW50OiAnMCcsXHJcbiAgICAgIGZhaWxlZDogJzAnLFxyXG4gICAgICBzdGF0dXM6ICdydW5uaW5nJyxcclxuICAgICAgY3JlYXRlZEF0OiBjcmVhdGVkQXQudG9JU09TdHJpbmcoKSxcclxuICAgIH0pO1xyXG5cclxuICAgIGF3YWl0IHJlZGlzLnNldChcclxuICAgICAgYGNhbXBhaWduOiR7Y2FtcGFpZ25JZH06ZGVmaW5pdGlvbmAsXHJcbiAgICAgIEpTT04uc3RyaW5naWZ5KHsgaW5pdGlhbCwgZm9sbG93VXBzLCBuYW1lLCBjb250YWN0cyB9KVxyXG4gICAgKTtcclxuXHJcbiAgICBhd2FpdCByZWRpcy5zYWRkKCdjYW1wYWlnbjphbGwnLCBjYW1wYWlnbklkKTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICBjb25zb2xlLndhcm4oJ1JlZGlzIHVuYXZhaWxhYmxlIGR1cmluZyBjYW1wYWlnbiBzdGFydCcsIGUpO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIEVucXVldWUgaW5pdGlhbCBqb2JzIGFuZCB1cGRhdGUgbGVkZ2VyIHJvd3Mgd2l0aCBsYXN0Sm9iSWQgKHBlci1jb250YWN0IHVwZGF0ZXMpXHJcbiAgZm9yIChjb25zdCBjIG9mIGNvbnRhY3REb2NzKSB7XHJcbiAgICBpZiAoIWMuZW1haWwpIGNvbnRpbnVlO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGpvYk9iaiA9IGF3YWl0IHF1ZXVlLmFkZChcclxuICAgICAgICAnaW5pdGlhbCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgY2FtcGFpZ25JZCxcclxuICAgICAgICAgIGNvbnRhY3RJZDogYy5faWQudG9TdHJpbmcoKSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGF0dGVtcHRzOiBNQVhfQkFDS0dST1VORF9BVFRFTVBUUyxcclxuICAgICAgICAgIGJhY2tvZmY6IHsgdHlwZTogJ2V4cG9uZW50aWFsJywgZGVsYXk6IDYwICogMTAwMCB9LFxyXG4gICAgICAgICAgcmVtb3ZlT25Db21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICAgIHJlbW92ZU9uRmFpbDogZmFsc2UsXHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gd3JpdGUgbGFzdEpvYklkIGFuZCBlbnN1cmUgcmV0cnlMb2NrZWQgdHJ1ZSBhbmQgc2V0IG1heCogZmllbGRzIChiZXN0LWVmZm9ydClcclxuICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS51cGRhdGVPbmUoXHJcbiAgICAgICAgeyBjYW1wYWlnbklkOiBjYW1wYWlnbk9iamVjdElkLCBjb250YWN0SWQ6IGMuX2lkIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgJHNldDoge1xyXG4gICAgICAgICAgICBsYXN0Sm9iSWQ6IGpvYk9iai5pZCxcclxuICAgICAgICAgICAgcmV0cnlMb2NrZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIG1heEJhY2tncm91bmRBdHRlbXB0czogTUFYX0JBQ0tHUk9VTkRfQVRURU1QVFMsXHJcbiAgICAgICAgICAgIG1heENvcmVBdHRlbXB0czogTUFYX0NPUkVfQVRURU1QVFMsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIHB1Ymxpc2ggYW4gaW5pdGlhbCBpbi1mbGlnaHQgdXBkYXRlIHNvIHRoZSBVSSByZWZsZWN0cyBsYXN0Sm9iSWQvcmV0cnlMb2NrIGltbWVkaWF0ZWx5XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgbGVkZ2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS5maW5kT25lKFxyXG4gICAgICAgICAgeyBjYW1wYWlnbklkOiBjYW1wYWlnbk9iamVjdElkLCBjb250YWN0SWQ6IGMuX2lkIH0sXHJcbiAgICAgICAgICB7IHByb2plY3Rpb246IHsgY29udGFjdElkOiAxLCBzdGF0dXM6IDEsIGNvcmVBdHRlbXB0czogMSwgYmFja2dyb3VuZEF0dGVtcHRzOiAxLCBtYXhCYWNrZ3JvdW5kQXR0ZW1wdHM6IDEsIHJldHJ5TG9ja2VkOiAxLCBsYXN0Sm9iSWQ6IDEgfSB9XHJcbiAgICAgICAgKTtcclxuICAgICAgICBhd2FpdCByZWRpcy5wdWJsaXNoKFxyXG4gICAgICAgICAgYGNhbXBhaWduOiR7Y2FtcGFpZ25JZH06Y29udGFjdGAsXHJcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgIGNvbnRhY3RJZDogbGVkZ2VyPy5jb250YWN0SWQ/LnRvU3RyaW5nPy4oKSA/PyBsZWRnZXI/Ll9pZD8udG9TdHJpbmc/LigpLFxyXG4gICAgICAgICAgICBzdGF0dXM6IGxlZGdlcj8uc3RhdHVzLFxyXG4gICAgICAgICAgICBjb3JlQXR0ZW1wdHM6IGxlZGdlcj8uY29yZUF0dGVtcHRzID8/IDEsXHJcbiAgICAgICAgICAgIGJhY2tncm91bmRBdHRlbXB0czogbGVkZ2VyPy5iYWNrZ3JvdW5kQXR0ZW1wdHMgPz8gMCxcclxuICAgICAgICAgICAgbWF4QmFja2dyb3VuZEF0dGVtcHRzOiBsZWRnZXI/Lm1heEJhY2tncm91bmRBdHRlbXB0cyxcclxuICAgICAgICAgICAgcmV0cnlMb2NrZWQ6IGxlZGdlcj8ucmV0cnlMb2NrZWQgPz8gdHJ1ZSxcclxuICAgICAgICAgICAgbGFzdEpvYklkOiBsZWRnZXI/Lmxhc3RKb2JJZCxcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vIGJlc3QtZWZmb3J0IHB1Ymxpc2g7IHN3YWxsb3dcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBlbnF1ZXVlIGluaXRpYWwgam9iIGZvciBjb250YWN0JywgYy5faWQ/LnRvU3RyaW5nPy4oKSwgZSk7XHJcbiAgICAgIC8vIGlmIHF1ZXVlLmFkZCBmYWlscywgdXBkYXRlIGxlZGdlciB0byByZWZsZWN0IG5vdC1sb2NrZWQgc28gVUkgZG9lc24ndCBibG9jayBmb3JldmVyXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbignY2FtcGFpZ25fY29udGFjdHMnKS51cGRhdGVPbmUoXHJcbiAgICAgICAgICB7IGNhbXBhaWduSWQ6IGNhbXBhaWduT2JqZWN0SWQsIGNvbnRhY3RJZDogYy5faWQgfSxcclxuICAgICAgICAgIHsgJHNldDogeyByZXRyeUxvY2tlZDogZmFsc2UsIGxhc3RKb2JJZDogbnVsbCB9IH1cclxuICAgICAgICApO1xyXG4gICAgICB9IGNhdGNoIChfKSB7fVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gLS0tIE5vdGlmeSBVSSAtLS1cclxuICB0cnkge1xyXG4gICAgYXdhaXQgcmVkaXMucHVibGlzaChcclxuICAgICAgJ2NhbXBhaWduOm5ldycsXHJcbiAgICAgIEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBpZDogY2FtcGFpZ25JZCxcclxuICAgICAgICBuYW1lLFxyXG4gICAgICAgIHRvdGFsOiBjb250YWN0RG9jcy5sZW5ndGgsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBjcmVhdGVkQXQudG9JU09TdHJpbmcoKSxcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfSBjYXRjaCB7XHJcbiAgICAvLyBub24tZmF0YWxcclxuICB9XHJcblxyXG4gIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICBjYW1wYWlnbklkLFxyXG4gICAgdG90YWw6IGNvbnRhY3REb2NzLmxlbmd0aCxcclxuICB9KTtcclxufVxyXG4iXSwibmFtZXMiOlsiUXVldWUiLCJyZWRpcyIsImNsaWVudFByb21pc2UiLCJxdWV1ZSIsImNvbm5lY3Rpb24iLCJNQVhfQkFDS0dST1VORF9BVFRFTVBUUyIsIk51bWJlciIsInByb2Nlc3MiLCJlbnYiLCJNQVhfQVRURU1QVFMiLCJNQVhfQ09SRV9BVFRFTVBUUyIsImNodW5rQXJyYXkiLCJhcnIiLCJzaXplIiwib3V0IiwiaSIsImxlbmd0aCIsInB1c2giLCJzbGljZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJuYW1lIiwiY29udGFjdHMiLCJpbml0aWFsIiwiZm9sbG93VXBzIiwiYm9keSIsInN1YmplY3QiLCJpbmNsdWRlcyIsInR5cGUiLCJjbGllbnQiLCJkYiIsInF1ZXJ5Iiwic2VnbWVudHMiLCJ2YWx1ZSIsImNvbnRhY3REb2NzIiwiY29sbGVjdGlvbiIsImZpbmQiLCJwcm9qZWN0IiwiX2lkIiwiZW1haWwiLCJ0b0FycmF5IiwiY3JlYXRlZEF0IiwiRGF0ZSIsImNhbXBhaWduRG9jIiwidG90YWxzIiwiaW50ZW5kZWQiLCJwcm9jZXNzZWQiLCJzZW50IiwiZmFpbGVkIiwiY2FtcGFpZ25SZXN1bHQiLCJpbnNlcnRPbmUiLCJjYW1wYWlnbk9iamVjdElkIiwiaW5zZXJ0ZWRJZCIsImNhbXBhaWduSWQiLCJ0b1N0cmluZyIsImxlZGdlckRvY3MiLCJtYXAiLCJjIiwiY29udGFjdElkIiwiY29yZUF0dGVtcHRzIiwiYmFja2dyb3VuZEF0dGVtcHRzIiwibWF4Q29yZUF0dGVtcHRzIiwibWF4QmFja2dyb3VuZEF0dGVtcHRzIiwicmV0cnlMb2NrZWQiLCJjaHVua3MiLCJjaHVuayIsImluc2VydE1hbnkiLCJvcmRlcmVkIiwiZSIsImhzZXQiLCJ0b3RhbCIsIlN0cmluZyIsInRvSVNPU3RyaW5nIiwic2V0IiwiSlNPTiIsInN0cmluZ2lmeSIsInNhZGQiLCJjb25zb2xlIiwid2FybiIsImpvYk9iaiIsImFkZCIsImF0dGVtcHRzIiwiYmFja29mZiIsImRlbGF5IiwicmVtb3ZlT25Db21wbGV0ZSIsInJlbW92ZU9uRmFpbCIsInVwZGF0ZU9uZSIsIiRzZXQiLCJsYXN0Sm9iSWQiLCJpZCIsImxlZGdlciIsImZpbmRPbmUiLCJwcm9qZWN0aW9uIiwicHVibGlzaCIsIl8iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/campaign/start.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fcampaign%2Fstart&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ccampaign%5Cstart.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();